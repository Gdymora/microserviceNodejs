/*! For license information please see main.js.LICENSE.txt */
(()=>{var __webpack_modules__={4537:e=>{"use strict";e.exports=function(e,t){for(var r=new Array(arguments.length-1),n=0,i=2,s=!0;i<arguments.length;)r[n++]=arguments[i++];return new Promise((function(i,o){r[n]=function(e){if(s)if(s=!1,e)o(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}};try{e.apply(t||null,r)}catch(e){s&&(s=!1,o(e))}}))}},7419:(e,t)=>{"use strict";var r=t;r.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var n=new Array(64),i=new Array(123),s=0;s<64;)i[n[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;r.encode=function(e,t,r){for(var i,s=null,o=[],a=0,c=0;t<r;){var l=e[t++];switch(c){case 0:o[a++]=n[l>>2],i=(3&l)<<4,c=1;break;case 1:o[a++]=n[i|l>>4],i=(15&l)<<2,c=2;break;case 2:o[a++]=n[i|l>>6],o[a++]=n[63&l],c=0}a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0)}return c&&(o[a++]=n[i],o[a++]=61,1===c&&(o[a++]=61)),s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};var o="invalid encoding";r.decode=function(e,t,r){for(var n,s=r,a=0,c=0;c<e.length;){var l=e.charCodeAt(c++);if(61===l&&a>1)break;if(void 0===(l=i[l]))throw Error(o);switch(a){case 0:n=l,a=1;break;case 1:t[r++]=n<<2|(48&l)>>4,n=l,a=2;break;case 2:t[r++]=(15&n)<<4|(60&l)>>2,n=l,a=3;break;case 3:t[r++]=(3&n)<<6|l,a=0}}if(1===a)throw Error(o);return r-s},r.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},9211:e=>{"use strict";function t(){this._listeners={}}e.exports=t,t.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},t.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},t.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this}},945:e=>{"use strict";function t(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3]}function s(e,n,i){t[0]=e,n[i]=r[3],n[i+1]=r[2],n[i+2]=r[1],n[i+3]=r[0]}function o(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function a(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?i:s,e.writeFloatBE=n?s:i,e.readFloatLE=n?o:a,e.readFloatBE=n?a:o}():function(){function t(e,t,r,n){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,r,n);else if(isNaN(t))e(2143289344,r,n);else if(t>34028234663852886e22)e((i<<31|2139095040)>>>0,r,n);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var s=Math.floor(Math.log(t)/Math.LN2);e((i<<31|s+127<<23|8388607&Math.round(t*Math.pow(2,-s)*8388608))>>>0,r,n)}}function o(e,t,r){var n=e(t,r),i=2*(n>>31)+1,s=n>>>23&255,o=8388607&n;return 255===s?o?NaN:i*(1/0):0===s?1401298464324817e-60*i*o:i*Math.pow(2,s-150)*(o+8388608)}e.writeFloatLE=t.bind(null,r),e.writeFloatBE=t.bind(null,n),e.readFloatLE=o.bind(null,i),e.readFloatBE=o.bind(null,s)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3],n[i+4]=r[4],n[i+5]=r[5],n[i+6]=r[6],n[i+7]=r[7]}function s(e,n,i){t[0]=e,n[i]=r[7],n[i+1]=r[6],n[i+2]=r[5],n[i+3]=r[4],n[i+4]=r[3],n[i+5]=r[2],n[i+6]=r[1],n[i+7]=r[0]}function o(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function a(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?i:s,e.writeDoubleBE=n?s:i,e.readDoubleLE=n?o:a,e.readDoubleBE=n?a:o}():function(){function t(e,t,r,n,i,s){var o=n<0?1:0;if(o&&(n=-n),0===n)e(0,i,s+t),e(1/n>0?0:2147483648,i,s+r);else if(isNaN(n))e(0,i,s+t),e(2146959360,i,s+r);else if(n>17976931348623157e292)e(0,i,s+t),e((o<<31|2146435072)>>>0,i,s+r);else{var a;if(n<22250738585072014e-324)e((a=n/5e-324)>>>0,i,s+t),e((o<<31|a/4294967296)>>>0,i,s+r);else{var c=Math.floor(Math.log(n)/Math.LN2);1024===c&&(c=1023),e(4503599627370496*(a=n*Math.pow(2,-c))>>>0,i,s+t),e((o<<31|c+1023<<20|1048576*a&1048575)>>>0,i,s+r)}}}function o(e,t,r,n,i){var s=e(n,i+t),o=e(n,i+r),a=2*(o>>31)+1,c=o>>>20&2047,l=4294967296*(1048575&o)+s;return 2047===c?l?NaN:a*(1/0):0===c?5e-324*a*l:a*Math.pow(2,c-1075)*(l+4503599627370496)}e.writeDoubleLE=t.bind(null,r,0,4),e.writeDoubleBE=t.bind(null,n,4,0),e.readDoubleLE=o.bind(null,i,0,4),e.readDoubleBE=o.bind(null,s,4,0)}(),e}function r(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function n(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function i(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function s(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=t(t)},7199:module=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},6662:e=>{"use strict";e.exports=function(e,t,r){var n=r||8192,i=n>>>1,s=null,o=n;return function(r){if(r<1||r>i)return e(r);o+r>n&&(s=e(n),o=0);var a=t.call(s,o,o+=r);return 7&o&&(o=1+(7|o)),a}}},4997:(e,t)=>{"use strict";var r=t;r.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},r.read=function(e,t,r){if(r-t<1)return"";for(var n,i=null,s=[],o=0;t<r;)(n=e[t++])<128?s[o++]=n:n>191&&n<224?s[o++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[o++]=55296+(n>>10),s[o++]=56320+(1023&n)):s[o++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0);return i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))},r.write=function(e,t,r){for(var n,i,s=r,o=0;o<e.length;++o)(n=e.charCodeAt(o))<128?t[r++]=n:n<2048?(t[r++]=n>>6|192,t[r++]=63&n|128):55296==(64512&n)&&56320==(64512&(i=e.charCodeAt(o+1)))?(n=65536+((1023&n)<<10)+(1023&i),++o,t[r++]=n>>18|240,t[r++]=n>>12&63|128,t[r++]=n>>6&63|128,t[r++]=63&n|128):(t[r++]=n>>12|224,t[r++]=n>>6&63|128,t[r++]=63&n|128);return r-s}},8099:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(7117);function i(e,t,r){return void 0===t&&(t=new Uint8Array(2)),void 0===r&&(r=0),t[r+0]=e>>>8,t[r+1]=e>>>0,t}function s(e,t,r){return void 0===t&&(t=new Uint8Array(2)),void 0===r&&(r=0),t[r+0]=e>>>0,t[r+1]=e>>>8,t}function o(e,t){return void 0===t&&(t=0),e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function a(e,t){return void 0===t&&(t=0),(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function c(e,t){return void 0===t&&(t=0),e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]}function l(e,t){return void 0===t&&(t=0),(e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t])>>>0}function u(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),t[r+0]=e>>>24,t[r+1]=e>>>16,t[r+2]=e>>>8,t[r+3]=e>>>0,t}function h(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),t[r+0]=e>>>0,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24,t}function d(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),u(e/4294967296>>>0,t,r),u(e>>>0,t,r+4),t}function p(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),h(e>>>0,t,r),h(e/4294967296>>>0,t,r+4),t}t.readInt16BE=function(e,t){return void 0===t&&(t=0),(e[t+0]<<8|e[t+1])<<16>>16},t.readUint16BE=function(e,t){return void 0===t&&(t=0),(e[t+0]<<8|e[t+1])>>>0},t.readInt16LE=function(e,t){return void 0===t&&(t=0),(e[t+1]<<8|e[t])<<16>>16},t.readUint16LE=function(e,t){return void 0===t&&(t=0),(e[t+1]<<8|e[t])>>>0},t.writeUint16BE=i,t.writeInt16BE=i,t.writeUint16LE=s,t.writeInt16LE=s,t.readInt32BE=o,t.readUint32BE=a,t.readInt32LE=c,t.readUint32LE=l,t.writeUint32BE=u,t.writeInt32BE=u,t.writeUint32LE=h,t.writeInt32LE=h,t.readInt64BE=function(e,t){void 0===t&&(t=0);var r=o(e,t),n=o(e,t+4);return 4294967296*r+n-4294967296*(n>>31)},t.readUint64BE=function(e,t){return void 0===t&&(t=0),4294967296*a(e,t)+a(e,t+4)},t.readInt64LE=function(e,t){void 0===t&&(t=0);var r=c(e,t);return 4294967296*c(e,t+4)+r-4294967296*(r>>31)},t.readUint64LE=function(e,t){void 0===t&&(t=0);var r=l(e,t);return 4294967296*l(e,t+4)+r},t.writeUint64BE=d,t.writeInt64BE=d,t.writeUint64LE=p,t.writeInt64LE=p,t.readUintBE=function(e,t,r){if(void 0===r&&(r=0),e%8!=0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(e/8>t.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var n=0,i=1,s=e/8+r-1;s>=r;s--)n+=t[s]*i,i*=256;return n},t.readUintLE=function(e,t,r){if(void 0===r&&(r=0),e%8!=0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(e/8>t.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var n=0,i=1,s=r;s<r+e/8;s++)n+=t[s]*i,i*=256;return n},t.writeUintBE=function(e,t,r,i){if(void 0===r&&(r=new Uint8Array(e/8)),void 0===i&&(i=0),e%8!=0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!n.isSafeInteger(t))throw new Error("writeUintBE value must be an integer");for(var s=1,o=e/8+i-1;o>=i;o--)r[o]=t/s&255,s*=256;return r},t.writeUintLE=function(e,t,r,i){if(void 0===r&&(r=new Uint8Array(e/8)),void 0===i&&(i=0),e%8!=0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!n.isSafeInteger(t))throw new Error("writeUintLE value must be an integer");for(var s=1,o=i;o<i+e/8;o++)r[o]=t/s&255,s*=256;return r},t.readFloat32BE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat32(t)},t.readFloat32LE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat32(t,!0)},t.readFloat64BE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat64(t)},t.readFloat64LE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat64(t,!0)},t.writeFloat32BE=function(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(r,e),t},t.writeFloat32LE=function(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(r,e,!0),t},t.writeFloat64BE=function(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(r,e),t},t.writeFloat64LE=function(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(r,e,!0),t}},5439:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(8099),i=r(7309),s=20;function o(e,t,r){for(var i=1634760805,o=857760878,a=2036477234,c=1797285236,l=r[3]<<24|r[2]<<16|r[1]<<8|r[0],u=r[7]<<24|r[6]<<16|r[5]<<8|r[4],h=r[11]<<24|r[10]<<16|r[9]<<8|r[8],d=r[15]<<24|r[14]<<16|r[13]<<8|r[12],p=r[19]<<24|r[18]<<16|r[17]<<8|r[16],f=r[23]<<24|r[22]<<16|r[21]<<8|r[20],y=r[27]<<24|r[26]<<16|r[25]<<8|r[24],g=r[31]<<24|r[30]<<16|r[29]<<8|r[28],m=t[3]<<24|t[2]<<16|t[1]<<8|t[0],w=t[7]<<24|t[6]<<16|t[5]<<8|t[4],E=t[11]<<24|t[10]<<16|t[9]<<8|t[8],b=t[15]<<24|t[14]<<16|t[13]<<8|t[12],v=i,_=o,S=a,C=c,A=l,I=u,T=h,R=d,k=p,N=f,L=y,D=g,P=m,B=w,O=E,x=b,U=0;U<s;U+=2)A=(A^=k=k+(P=(P^=v=v+A|0)>>>16|P<<16)|0)>>>20|A<<12,I=(I^=N=N+(B=(B^=_=_+I|0)>>>16|B<<16)|0)>>>20|I<<12,T=(T^=L=L+(O=(O^=S=S+T|0)>>>16|O<<16)|0)>>>20|T<<12,R=(R^=D=D+(x=(x^=C=C+R|0)>>>16|x<<16)|0)>>>20|R<<12,T=(T^=L=L+(O=(O^=S=S+T|0)>>>24|O<<8)|0)>>>25|T<<7,R=(R^=D=D+(x=(x^=C=C+R|0)>>>24|x<<8)|0)>>>25|R<<7,I=(I^=N=N+(B=(B^=_=_+I|0)>>>24|B<<8)|0)>>>25|I<<7,A=(A^=k=k+(P=(P^=v=v+A|0)>>>24|P<<8)|0)>>>25|A<<7,I=(I^=L=L+(x=(x^=v=v+I|0)>>>16|x<<16)|0)>>>20|I<<12,T=(T^=D=D+(P=(P^=_=_+T|0)>>>16|P<<16)|0)>>>20|T<<12,R=(R^=k=k+(B=(B^=S=S+R|0)>>>16|B<<16)|0)>>>20|R<<12,A=(A^=N=N+(O=(O^=C=C+A|0)>>>16|O<<16)|0)>>>20|A<<12,R=(R^=k=k+(B=(B^=S=S+R|0)>>>24|B<<8)|0)>>>25|R<<7,A=(A^=N=N+(O=(O^=C=C+A|0)>>>24|O<<8)|0)>>>25|A<<7,T=(T^=D=D+(P=(P^=_=_+T|0)>>>24|P<<8)|0)>>>25|T<<7,I=(I^=L=L+(x=(x^=v=v+I|0)>>>24|x<<8)|0)>>>25|I<<7;n.writeUint32LE(v+i|0,e,0),n.writeUint32LE(_+o|0,e,4),n.writeUint32LE(S+a|0,e,8),n.writeUint32LE(C+c|0,e,12),n.writeUint32LE(A+l|0,e,16),n.writeUint32LE(I+u|0,e,20),n.writeUint32LE(T+h|0,e,24),n.writeUint32LE(R+d|0,e,28),n.writeUint32LE(k+p|0,e,32),n.writeUint32LE(N+f|0,e,36),n.writeUint32LE(L+y|0,e,40),n.writeUint32LE(D+g|0,e,44),n.writeUint32LE(P+m|0,e,48),n.writeUint32LE(B+w|0,e,52),n.writeUint32LE(O+E|0,e,56),n.writeUint32LE(x+b|0,e,60)}function a(e,t,r,n,s){if(void 0===s&&(s=0),32!==e.length)throw new Error("ChaCha: key size must be 32 bytes");if(n.length<r.length)throw new Error("ChaCha: destination is shorter than source");var a,l;if(0===s){if(8!==t.length&&12!==t.length)throw new Error("ChaCha nonce must be 8 or 12 bytes");l=(a=new Uint8Array(16)).length-t.length,a.set(t,l)}else{if(16!==t.length)throw new Error("ChaCha nonce with counter must be 16 bytes");a=t,l=s}for(var u=new Uint8Array(64),h=0;h<r.length;h+=64){o(u,a,e);for(var d=h;d<h+64&&d<r.length;d++)n[d]=r[d]^u[d-h];c(a,0,l)}return i.wipe(u),0===s&&i.wipe(a),n}function c(e,t,r){for(var n=1;r--;)n=n+(255&e[t])|0,e[t]=255&n,n>>>=8,t++;if(n>0)throw new Error("ChaCha: counter overflow")}t.streamXOR=a,t.stream=function(e,t,r,n){return void 0===n&&(n=0),i.wipe(r),a(e,t,r,r,n)}},5501:(e,t,r)=>{"use strict";var n=r(5439),i=r(3027),s=r(7309),o=r(8099),a=r(4153);t.Cv=32,t.WH=12,t.pg=16;var c=new Uint8Array(16),l=function(){function e(e){if(this.nonceLength=t.WH,this.tagLength=t.pg,e.length!==t.Cv)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(e)}return e.prototype.seal=function(e,t,r,i){if(e.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var o=new Uint8Array(16);o.set(e,o.length-e.length);var a=new Uint8Array(32);n.stream(this._key,o,a,4);var c,l=t.length+this.tagLength;if(i){if(i.length!==l)throw new Error("ChaCha20Poly1305: incorrect destination length");c=i}else c=new Uint8Array(l);return n.streamXOR(this._key,o,t,c,4),this._authenticate(c.subarray(c.length-this.tagLength,c.length),a,c.subarray(0,c.length-this.tagLength),r),s.wipe(o),c},e.prototype.open=function(e,t,r,i){if(e.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(t.length<this.tagLength)return null;var o=new Uint8Array(16);o.set(e,o.length-e.length);var c=new Uint8Array(32);n.stream(this._key,o,c,4);var l=new Uint8Array(this.tagLength);if(this._authenticate(l,c,t.subarray(0,t.length-this.tagLength),r),!a.equal(l,t.subarray(t.length-this.tagLength,t.length)))return null;var u,h=t.length-this.tagLength;if(i){if(i.length!==h)throw new Error("ChaCha20Poly1305: incorrect destination length");u=i}else u=new Uint8Array(h);return n.streamXOR(this._key,o,t.subarray(0,t.length-this.tagLength),u,4),s.wipe(o),u},e.prototype.clean=function(){return s.wipe(this._key),this},e.prototype._authenticate=function(e,t,r,n){var a=new i.Poly1305(t);n&&(a.update(n),n.length%16>0&&a.update(c.subarray(n.length%16))),a.update(r),r.length%16>0&&a.update(c.subarray(r.length%16));var l=new Uint8Array(8);n&&o.writeUint64LE(n.length,l),a.update(l),o.writeUint64LE(r.length,l),a.update(l);for(var u=a.digest(),h=0;h<u.length;h++)e[h]=u[h];a.clean(),s.wipe(u),s.wipe(l)},e}();t.OK=l},4153:(e,t)=>{"use strict";function r(e,t){if(e.length!==t.length)return 0;for(var r=0,n=0;n<e.length;n++)r|=e[n]^t[n];return 1&r-1>>>8}Object.defineProperty(t,"__esModule",{value:!0}),t.select=function(e,t,r){return~(e-1)&t|e-1&r},t.lessOrEqual=function(e,t){return(0|e)-(0|t)-1>>>31&1},t.compare=r,t.equal=function(e,t){return 0!==e.length&&0!==t.length&&0!==r(e,t)}},9984:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSerializableHash=function(e){return void 0!==e.saveState&&void 0!==e.restoreState&&void 0!==e.cleanSavedState}},512:(e,t,r)=>{"use strict";var n=r(5629),i=r(7309),s=function(){function e(e,t,r,i){void 0===r&&(r=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=i;var s=n.hmac(this._hash,r,t);this._hmac=new n.HMAC(e,s),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return e.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(0===e)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},e.prototype.expand=function(e){for(var t=new Uint8Array(e),r=0;r<t.length;r++)this._bufpos===this._buffer.length&&this._fillBuffer(),t[r]=this._buffer[this._bufpos++];return t},e.prototype.clean=function(){this._hmac.clean(),i.wipe(this._buffer),i.wipe(this._counter),this._bufpos=0},e}();t.t=s},5629:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(9984),i=r(4153),s=r(7309),o=function(){function e(e,t){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var r=new Uint8Array(this.blockSize);t.length>this.blockSize?this._inner.update(t).finish(r).clean():r.set(t);for(var i=0;i<r.length;i++)r[i]^=54;for(this._inner.update(r),i=0;i<r.length;i++)r[i]^=106;this._outer.update(r),n.isSerializableHash(this._inner)&&n.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),s.wipe(r)}return e.prototype.reset=function(){if(!n.isSerializableHash(this._inner)||!n.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},e.prototype.clean=function(){n.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),n.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},e.prototype.update=function(e){return this._inner.update(e),this},e.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},e.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},e.prototype.saveState=function(){if(!n.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},e.prototype.restoreState=function(e){if(!n.isSerializableHash(this._inner)||!n.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},e.prototype.cleanSavedState=function(e){if(!n.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},e}();t.HMAC=o,t.hmac=function(e,t,r){var n=new o(e,t);n.update(r);var i=n.digest();return n.clean(),i},t.equal=i.equal},7117:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mul=Math.imul||function(e,t){var r=65535&e,n=65535&t;return r*n+((e>>>16&65535)*n+r*(t>>>16&65535)<<16>>>0)|0},t.add=function(e,t){return e+t|0},t.sub=function(e,t){return e-t|0},t.rotl=function(e,t){return e<<t|e>>>32-t},t.rotr=function(e,t){return e<<32-t|e>>>t},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(e){return t.isInteger(e)&&e>=-t.MAX_SAFE_INTEGER&&e<=t.MAX_SAFE_INTEGER}},3027:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(4153),i=r(7309);t.DIGEST_LENGTH=16;var s=function(){function e(e){this.digestLength=t.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var r=e[0]|e[1]<<8;this._r[0]=8191&r;var n=e[2]|e[3]<<8;this._r[1]=8191&(r>>>13|n<<3);var i=e[4]|e[5]<<8;this._r[2]=7939&(n>>>10|i<<6);var s=e[6]|e[7]<<8;this._r[3]=8191&(i>>>7|s<<9);var o=e[8]|e[9]<<8;this._r[4]=255&(s>>>4|o<<12),this._r[5]=o>>>1&8190;var a=e[10]|e[11]<<8;this._r[6]=8191&(o>>>14|a<<2);var c=e[12]|e[13]<<8;this._r[7]=8065&(a>>>11|c<<5);var l=e[14]|e[15]<<8;this._r[8]=8191&(c>>>8|l<<8),this._r[9]=l>>>5&127,this._pad[0]=e[16]|e[17]<<8,this._pad[1]=e[18]|e[19]<<8,this._pad[2]=e[20]|e[21]<<8,this._pad[3]=e[22]|e[23]<<8,this._pad[4]=e[24]|e[25]<<8,this._pad[5]=e[26]|e[27]<<8,this._pad[6]=e[28]|e[29]<<8,this._pad[7]=e[30]|e[31]<<8}return e.prototype._blocks=function(e,t,r){for(var n=this._fin?0:2048,i=this._h[0],s=this._h[1],o=this._h[2],a=this._h[3],c=this._h[4],l=this._h[5],u=this._h[6],h=this._h[7],d=this._h[8],p=this._h[9],f=this._r[0],y=this._r[1],g=this._r[2],m=this._r[3],w=this._r[4],E=this._r[5],b=this._r[6],v=this._r[7],_=this._r[8],S=this._r[9];r>=16;){var C=e[t+0]|e[t+1]<<8;i+=8191&C;var A=e[t+2]|e[t+3]<<8;s+=8191&(C>>>13|A<<3);var I=e[t+4]|e[t+5]<<8;o+=8191&(A>>>10|I<<6);var T=e[t+6]|e[t+7]<<8;a+=8191&(I>>>7|T<<9);var R=e[t+8]|e[t+9]<<8;c+=8191&(T>>>4|R<<12),l+=R>>>1&8191;var k=e[t+10]|e[t+11]<<8;u+=8191&(R>>>14|k<<2);var N=e[t+12]|e[t+13]<<8;h+=8191&(k>>>11|N<<5);var L=e[t+14]|e[t+15]<<8,D=0,P=D;P+=i*f,P+=s*(5*S),P+=o*(5*_),P+=a*(5*v),D=(P+=c*(5*b))>>>13,P&=8191,P+=l*(5*E),P+=u*(5*w),P+=h*(5*m),P+=(d+=8191&(N>>>8|L<<8))*(5*g);var B=D+=(P+=(p+=L>>>5|n)*(5*y))>>>13;B+=i*y,B+=s*f,B+=o*(5*S),B+=a*(5*_),D=(B+=c*(5*v))>>>13,B&=8191,B+=l*(5*b),B+=u*(5*E),B+=h*(5*w),B+=d*(5*m),D+=(B+=p*(5*g))>>>13,B&=8191;var O=D;O+=i*g,O+=s*y,O+=o*f,O+=a*(5*S),D=(O+=c*(5*_))>>>13,O&=8191,O+=l*(5*v),O+=u*(5*b),O+=h*(5*E),O+=d*(5*w);var x=D+=(O+=p*(5*m))>>>13;x+=i*m,x+=s*g,x+=o*y,x+=a*f,D=(x+=c*(5*S))>>>13,x&=8191,x+=l*(5*_),x+=u*(5*v),x+=h*(5*b),x+=d*(5*E);var U=D+=(x+=p*(5*w))>>>13;U+=i*w,U+=s*m,U+=o*g,U+=a*y,D=(U+=c*f)>>>13,U&=8191,U+=l*(5*S),U+=u*(5*_),U+=h*(5*v),U+=d*(5*b);var M=D+=(U+=p*(5*E))>>>13;M+=i*E,M+=s*w,M+=o*m,M+=a*g,D=(M+=c*y)>>>13,M&=8191,M+=l*f,M+=u*(5*S),M+=h*(5*_),M+=d*(5*v);var V=D+=(M+=p*(5*b))>>>13;V+=i*b,V+=s*E,V+=o*w,V+=a*m,D=(V+=c*g)>>>13,V&=8191,V+=l*y,V+=u*f,V+=h*(5*S),V+=d*(5*_);var K=D+=(V+=p*(5*v))>>>13;K+=i*v,K+=s*b,K+=o*E,K+=a*w,D=(K+=c*m)>>>13,K&=8191,K+=l*g,K+=u*y,K+=h*f,K+=d*(5*S);var F=D+=(K+=p*(5*_))>>>13;F+=i*_,F+=s*v,F+=o*b,F+=a*E,D=(F+=c*w)>>>13,F&=8191,F+=l*m,F+=u*g,F+=h*y,F+=d*f;var q=D+=(F+=p*(5*S))>>>13;q+=i*S,q+=s*_,q+=o*v,q+=a*b,D=(q+=c*E)>>>13,q&=8191,q+=l*w,q+=u*m,q+=h*g,q+=d*y,i=P=8191&(D=(D=((D+=(q+=p*f)>>>13)<<2)+D|0)+(P&=8191)|0),s=B+=D>>>=13,o=O&=8191,a=x&=8191,c=U&=8191,l=M&=8191,u=V&=8191,h=K&=8191,d=F&=8191,p=q&=8191,t+=16,r-=16}this._h[0]=i,this._h[1]=s,this._h[2]=o,this._h[3]=a,this._h[4]=c,this._h[5]=l,this._h[6]=u,this._h[7]=h,this._h[8]=d,this._h[9]=p},e.prototype.finish=function(e,t){void 0===t&&(t=0);var r,n,i,s,o=new Uint16Array(10);if(this._leftover){for(s=this._leftover,this._buffer[s++]=1;s<16;s++)this._buffer[s]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(r=this._h[1]>>>13,this._h[1]&=8191,s=2;s<10;s++)this._h[s]+=r,r=this._h[s]>>>13,this._h[s]&=8191;for(this._h[0]+=5*r,r=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=r,r=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=r,o[0]=this._h[0]+5,r=o[0]>>>13,o[0]&=8191,s=1;s<10;s++)o[s]=this._h[s]+r,r=o[s]>>>13,o[s]&=8191;for(o[9]-=8192,n=(1^r)-1,s=0;s<10;s++)o[s]&=n;for(n=~n,s=0;s<10;s++)this._h[s]=this._h[s]&n|o[s];for(this._h[0]=65535&(this._h[0]|this._h[1]<<13),this._h[1]=65535&(this._h[1]>>>3|this._h[2]<<10),this._h[2]=65535&(this._h[2]>>>6|this._h[3]<<7),this._h[3]=65535&(this._h[3]>>>9|this._h[4]<<4),this._h[4]=65535&(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14),this._h[5]=65535&(this._h[6]>>>2|this._h[7]<<11),this._h[6]=65535&(this._h[7]>>>5|this._h[8]<<8),this._h[7]=65535&(this._h[8]>>>8|this._h[9]<<5),i=this._h[0]+this._pad[0],this._h[0]=65535&i,s=1;s<8;s++)i=(this._h[s]+this._pad[s]|0)+(i>>>16)|0,this._h[s]=65535&i;return e[t+0]=this._h[0]>>>0,e[t+1]=this._h[0]>>>8,e[t+2]=this._h[1]>>>0,e[t+3]=this._h[1]>>>8,e[t+4]=this._h[2]>>>0,e[t+5]=this._h[2]>>>8,e[t+6]=this._h[3]>>>0,e[t+7]=this._h[3]>>>8,e[t+8]=this._h[4]>>>0,e[t+9]=this._h[4]>>>8,e[t+10]=this._h[5]>>>0,e[t+11]=this._h[5]>>>8,e[t+12]=this._h[6]>>>0,e[t+13]=this._h[6]>>>8,e[t+14]=this._h[7]>>>0,e[t+15]=this._h[7]>>>8,this._finished=!0,this},e.prototype.update=function(e){var t,r=0,n=e.length;if(this._leftover){(t=16-this._leftover)>n&&(t=n);for(var i=0;i<t;i++)this._buffer[this._leftover+i]=e[r+i];if(n-=t,r+=t,this._leftover+=t,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(n>=16&&(t=n-n%16,this._blocks(e,r,t),r+=t,n-=t),n){for(i=0;i<n;i++)this._buffer[this._leftover+i]=e[r+i];this._leftover+=n}return this},e.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var e=new Uint8Array(16);return this.finish(e),e},e.prototype.clean=function(){return i.wipe(this._buffer),i.wipe(this._r),i.wipe(this._h),i.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},e}();t.Poly1305=s,t.oneTimeAuth=function(e,t){var r=new s(e);r.update(t);var n=r.digest();return r.clean(),n},t.equal=function(e,r){return e.length===t.DIGEST_LENGTH&&r.length===t.DIGEST_LENGTH&&n.equal(e,r)}},1416:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.randomStringForEntropy=t.randomString=t.randomUint32=t.randomBytes=t.defaultRandomSource=void 0;const n=r(6008),i=r(8099),s=r(7309);function o(e,r=t.defaultRandomSource){return r.randomBytes(e)}t.defaultRandomSource=new n.SystemRandomSource,t.randomBytes=o,t.randomUint32=function(e=t.defaultRandomSource){const r=o(4,e),n=(0,i.readUint32LE)(r);return(0,s.wipe)(r),n};const a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function c(e,r=a,n=t.defaultRandomSource){if(r.length<2)throw new Error("randomString charset is too short");if(r.length>256)throw new Error("randomString charset is too long");let i="";const c=r.length,l=256-256%c;for(;e>0;){const t=o(Math.ceil(256*e/l),n);for(let n=0;n<t.length&&e>0;n++){const s=t[n];s<l&&(i+=r.charAt(s%c),e--)}(0,s.wipe)(t)}return i}t.randomString=c,t.randomStringForEntropy=function(e,r=a,n=t.defaultRandomSource){return c(Math.ceil(e/(Math.log(r.length)/Math.LN2)),r,n)}},5455:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserRandomSource=void 0,t.BrowserRandomSource=class{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e="undefined"!=typeof self?self.crypto||self.msCrypto:null;e&&void 0!==e.getRandomValues&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const t=new Uint8Array(e);for(let e=0;e<t.length;e+=65536)this._crypto.getRandomValues(t.subarray(e,e+Math.min(t.length-e,65536)));return t}}},8871:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NodeRandomSource=void 0;const n=r(7309);t.NodeRandomSource=class{constructor(){this.isAvailable=!1,this.isInstantiated=!1;{const e=r(5883);e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let t=this._crypto.randomBytes(e);if(t.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const r=new Uint8Array(e);for(let e=0;e<r.length;e++)r[e]=t[e];return(0,n.wipe)(t),r}}},6008:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SystemRandomSource=void 0;const n=r(5455),i=r(8871);t.SystemRandomSource=class{constructor(){return this.isAvailable=!1,this.name="",this._source=new n.BrowserRandomSource,this._source.isAvailable?(this.isAvailable=!0,void(this.name="Browser")):(this._source=new i.NodeRandomSource,this._source.isAvailable?(this.isAvailable=!0,void(this.name="Node")):void 0)}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}},3294:(e,t,r)=>{"use strict";var n=r(8099),i=r(7309);t.k=32,t.cn=64;var s=function(){function e(){this.digestLength=t.k,this.blockSize=t.cn,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return e.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},e.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},e.prototype.clean=function(){i.wipe(this._buffer),i.wipe(this._temp),this.reset()},e.prototype.update=function(e,t){if(void 0===t&&(t=e.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var r=0;if(this._bytesHashed+=t,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&t>0;)this._buffer[this._bufferLength++]=e[r++],t--;this._bufferLength===this.blockSize&&(a(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(t>=this.blockSize&&(r=a(this._temp,this._state,e,r,t),t%=this.blockSize);t>0;)this._buffer[this._bufferLength++]=e[r++],t--;return this},e.prototype.finish=function(e){if(!this._finished){var t=this._bytesHashed,r=this._bufferLength,i=t/536870912|0,s=t<<3,o=t%64<56?64:128;this._buffer[r]=128;for(var c=r+1;c<o-8;c++)this._buffer[c]=0;n.writeUint32BE(i,this._buffer,o-8),n.writeUint32BE(s,this._buffer,o-4),a(this._temp,this._state,this._buffer,0,o),this._finished=!0}for(c=0;c<this.digestLength/4;c++)n.writeUint32BE(this._state[c],e,4*c);return this},e.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},e.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},e.prototype.restoreState=function(e){return this._state.set(e.state),this._bufferLength=e.bufferLength,e.buffer&&this._buffer.set(e.buffer),this._bytesHashed=e.bytesHashed,this._finished=!1,this},e.prototype.cleanSavedState=function(e){i.wipe(e.state),e.buffer&&i.wipe(e.buffer),e.bufferLength=0,e.bytesHashed=0},e}();t.mE=s;var o=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function a(e,t,r,i,s){for(;s>=64;){for(var a=t[0],c=t[1],l=t[2],u=t[3],h=t[4],d=t[5],p=t[6],f=t[7],y=0;y<16;y++){var g=i+4*y;e[y]=n.readUint32BE(r,g)}for(y=16;y<64;y++){var m=e[y-2],w=(m>>>17|m<<15)^(m>>>19|m<<13)^m>>>10,E=((m=e[y-15])>>>7|m<<25)^(m>>>18|m<<14)^m>>>3;e[y]=(w+e[y-7]|0)+(E+e[y-16]|0)}for(y=0;y<64;y++)w=(((h>>>6|h<<26)^(h>>>11|h<<21)^(h>>>25|h<<7))+(h&d^~h&p)|0)+(f+(o[y]+e[y]|0)|0)|0,E=((a>>>2|a<<30)^(a>>>13|a<<19)^(a>>>22|a<<10))+(a&c^a&l^c&l)|0,f=p,p=d,d=h,h=u+w|0,u=l,l=c,c=a,a=w+E|0;t[0]+=a,t[1]+=c,t[2]+=l,t[3]+=u,t[4]+=h,t[5]+=d,t[6]+=p,t[7]+=f,i+=64,s-=64}return i}t.vp=function(e){var t=new s;t.update(e);var r=t.digest();return t.clean(),r}},7309:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wipe=function(e){for(var t=0;t<e.length;t++)e[t]=0;return e}},7664:(e,t,r)=>{"use strict";t.gi=t.Au=t._w=t.KS=t.kz=void 0;const n=r(1416),i=r(7309);function s(e){const t=new Float64Array(16);if(e)for(let r=0;r<e.length;r++)t[r]=e[r];return t}t.kz=32,t.KS=32;const o=new Uint8Array(32);o[0]=9;const a=s([56129,1]);function c(e){let t=1;for(let r=0;r<16;r++){let n=e[r]+t+65535;t=Math.floor(n/65536),e[r]=n-65536*t}e[0]+=t-1+37*(t-1)}function l(e,t,r){const n=~(r-1);for(let r=0;r<16;r++){const i=n&(e[r]^t[r]);e[r]^=i,t[r]^=i}}function u(e,t,r){for(let n=0;n<16;n++)e[n]=t[n]+r[n]}function h(e,t,r){for(let n=0;n<16;n++)e[n]=t[n]-r[n]}function d(e,t,r){let n,i,s=0,o=0,a=0,c=0,l=0,u=0,h=0,d=0,p=0,f=0,y=0,g=0,m=0,w=0,E=0,b=0,v=0,_=0,S=0,C=0,A=0,I=0,T=0,R=0,k=0,N=0,L=0,D=0,P=0,B=0,O=0,x=r[0],U=r[1],M=r[2],V=r[3],K=r[4],F=r[5],q=r[6],j=r[7],H=r[8],z=r[9],$=r[10],G=r[11],W=r[12],Y=r[13],Q=r[14],X=r[15];n=t[0],s+=n*x,o+=n*U,a+=n*M,c+=n*V,l+=n*K,u+=n*F,h+=n*q,d+=n*j,p+=n*H,f+=n*z,y+=n*$,g+=n*G,m+=n*W,w+=n*Y,E+=n*Q,b+=n*X,n=t[1],o+=n*x,a+=n*U,c+=n*M,l+=n*V,u+=n*K,h+=n*F,d+=n*q,p+=n*j,f+=n*H,y+=n*z,g+=n*$,m+=n*G,w+=n*W,E+=n*Y,b+=n*Q,v+=n*X,n=t[2],a+=n*x,c+=n*U,l+=n*M,u+=n*V,h+=n*K,d+=n*F,p+=n*q,f+=n*j,y+=n*H,g+=n*z,m+=n*$,w+=n*G,E+=n*W,b+=n*Y,v+=n*Q,_+=n*X,n=t[3],c+=n*x,l+=n*U,u+=n*M,h+=n*V,d+=n*K,p+=n*F,f+=n*q,y+=n*j,g+=n*H,m+=n*z,w+=n*$,E+=n*G,b+=n*W,v+=n*Y,_+=n*Q,S+=n*X,n=t[4],l+=n*x,u+=n*U,h+=n*M,d+=n*V,p+=n*K,f+=n*F,y+=n*q,g+=n*j,m+=n*H,w+=n*z,E+=n*$,b+=n*G,v+=n*W,_+=n*Y,S+=n*Q,C+=n*X,n=t[5],u+=n*x,h+=n*U,d+=n*M,p+=n*V,f+=n*K,y+=n*F,g+=n*q,m+=n*j,w+=n*H,E+=n*z,b+=n*$,v+=n*G,_+=n*W,S+=n*Y,C+=n*Q,A+=n*X,n=t[6],h+=n*x,d+=n*U,p+=n*M,f+=n*V,y+=n*K,g+=n*F,m+=n*q,w+=n*j,E+=n*H,b+=n*z,v+=n*$,_+=n*G,S+=n*W,C+=n*Y,A+=n*Q,I+=n*X,n=t[7],d+=n*x,p+=n*U,f+=n*M,y+=n*V,g+=n*K,m+=n*F,w+=n*q,E+=n*j,b+=n*H,v+=n*z,_+=n*$,S+=n*G,C+=n*W,A+=n*Y,I+=n*Q,T+=n*X,n=t[8],p+=n*x,f+=n*U,y+=n*M,g+=n*V,m+=n*K,w+=n*F,E+=n*q,b+=n*j,v+=n*H,_+=n*z,S+=n*$,C+=n*G,A+=n*W,I+=n*Y,T+=n*Q,R+=n*X,n=t[9],f+=n*x,y+=n*U,g+=n*M,m+=n*V,w+=n*K,E+=n*F,b+=n*q,v+=n*j,_+=n*H,S+=n*z,C+=n*$,A+=n*G,I+=n*W,T+=n*Y,R+=n*Q,k+=n*X,n=t[10],y+=n*x,g+=n*U,m+=n*M,w+=n*V,E+=n*K,b+=n*F,v+=n*q,_+=n*j,S+=n*H,C+=n*z,A+=n*$,I+=n*G,T+=n*W,R+=n*Y,k+=n*Q,N+=n*X,n=t[11],g+=n*x,m+=n*U,w+=n*M,E+=n*V,b+=n*K,v+=n*F,_+=n*q,S+=n*j,C+=n*H,A+=n*z,I+=n*$,T+=n*G,R+=n*W,k+=n*Y,N+=n*Q,L+=n*X,n=t[12],m+=n*x,w+=n*U,E+=n*M,b+=n*V,v+=n*K,_+=n*F,S+=n*q,C+=n*j,A+=n*H,I+=n*z,T+=n*$,R+=n*G,k+=n*W,N+=n*Y,L+=n*Q,D+=n*X,n=t[13],w+=n*x,E+=n*U,b+=n*M,v+=n*V,_+=n*K,S+=n*F,C+=n*q,A+=n*j,I+=n*H,T+=n*z,R+=n*$,k+=n*G,N+=n*W,L+=n*Y,D+=n*Q,P+=n*X,n=t[14],E+=n*x,b+=n*U,v+=n*M,_+=n*V,S+=n*K,C+=n*F,A+=n*q,I+=n*j,T+=n*H,R+=n*z,k+=n*$,N+=n*G,L+=n*W,D+=n*Y,P+=n*Q,B+=n*X,n=t[15],b+=n*x,v+=n*U,_+=n*M,S+=n*V,C+=n*K,A+=n*F,I+=n*q,T+=n*j,R+=n*H,k+=n*z,N+=n*$,L+=n*G,D+=n*W,P+=n*Y,B+=n*Q,O+=n*X,s+=38*v,o+=38*_,a+=38*S,c+=38*C,l+=38*A,u+=38*I,h+=38*T,d+=38*R,p+=38*k,f+=38*N,y+=38*L,g+=38*D,m+=38*P,w+=38*B,E+=38*O,i=1,n=s+i+65535,i=Math.floor(n/65536),s=n-65536*i,n=o+i+65535,i=Math.floor(n/65536),o=n-65536*i,n=a+i+65535,i=Math.floor(n/65536),a=n-65536*i,n=c+i+65535,i=Math.floor(n/65536),c=n-65536*i,n=l+i+65535,i=Math.floor(n/65536),l=n-65536*i,n=u+i+65535,i=Math.floor(n/65536),u=n-65536*i,n=h+i+65535,i=Math.floor(n/65536),h=n-65536*i,n=d+i+65535,i=Math.floor(n/65536),d=n-65536*i,n=p+i+65535,i=Math.floor(n/65536),p=n-65536*i,n=f+i+65535,i=Math.floor(n/65536),f=n-65536*i,n=y+i+65535,i=Math.floor(n/65536),y=n-65536*i,n=g+i+65535,i=Math.floor(n/65536),g=n-65536*i,n=m+i+65535,i=Math.floor(n/65536),m=n-65536*i,n=w+i+65535,i=Math.floor(n/65536),w=n-65536*i,n=E+i+65535,i=Math.floor(n/65536),E=n-65536*i,n=b+i+65535,i=Math.floor(n/65536),b=n-65536*i,s+=i-1+37*(i-1),i=1,n=s+i+65535,i=Math.floor(n/65536),s=n-65536*i,n=o+i+65535,i=Math.floor(n/65536),o=n-65536*i,n=a+i+65535,i=Math.floor(n/65536),a=n-65536*i,n=c+i+65535,i=Math.floor(n/65536),c=n-65536*i,n=l+i+65535,i=Math.floor(n/65536),l=n-65536*i,n=u+i+65535,i=Math.floor(n/65536),u=n-65536*i,n=h+i+65535,i=Math.floor(n/65536),h=n-65536*i,n=d+i+65535,i=Math.floor(n/65536),d=n-65536*i,n=p+i+65535,i=Math.floor(n/65536),p=n-65536*i,n=f+i+65535,i=Math.floor(n/65536),f=n-65536*i,n=y+i+65535,i=Math.floor(n/65536),y=n-65536*i,n=g+i+65535,i=Math.floor(n/65536),g=n-65536*i,n=m+i+65535,i=Math.floor(n/65536),m=n-65536*i,n=w+i+65535,i=Math.floor(n/65536),w=n-65536*i,n=E+i+65535,i=Math.floor(n/65536),E=n-65536*i,n=b+i+65535,i=Math.floor(n/65536),b=n-65536*i,s+=i-1+37*(i-1),e[0]=s,e[1]=o,e[2]=a,e[3]=c,e[4]=l,e[5]=u,e[6]=h,e[7]=d,e[8]=p,e[9]=f,e[10]=y,e[11]=g,e[12]=m,e[13]=w,e[14]=E,e[15]=b}function p(e,t){d(e,t,t)}function f(e,t){const r=new Uint8Array(32),n=new Float64Array(80),i=s(),o=s(),f=s(),y=s(),g=s(),m=s();for(let t=0;t<31;t++)r[t]=e[t];r[31]=127&e[31]|64,r[0]&=248,function(e,t){for(let r=0;r<16;r++)e[r]=t[2*r]+(t[2*r+1]<<8);e[15]&=32767}(n,t);for(let e=0;e<16;e++)o[e]=n[e];i[0]=y[0]=1;for(let e=254;e>=0;--e){const t=r[e>>>3]>>>(7&e)&1;l(i,o,t),l(f,y,t),u(g,i,f),h(i,i,f),u(f,o,y),h(o,o,y),p(y,g),p(m,i),d(i,f,i),d(f,o,g),u(g,i,f),h(i,i,f),p(o,i),h(f,y,m),d(i,f,a),u(i,i,y),d(f,f,i),d(i,y,m),d(y,o,n),p(o,g),l(i,o,t),l(f,y,t)}for(let e=0;e<16;e++)n[e+16]=i[e],n[e+32]=f[e],n[e+48]=o[e],n[e+64]=y[e];const w=n.subarray(32),E=n.subarray(16);!function(e,t){const r=s();for(let e=0;e<16;e++)r[e]=t[e];for(let e=253;e>=0;e--)p(r,r),2!==e&&4!==e&&d(r,r,t);for(let t=0;t<16;t++)e[t]=r[t]}(w,w),d(E,E,w);const b=new Uint8Array(32);return function(e,t){const r=s(),n=s();for(let e=0;e<16;e++)n[e]=t[e];c(n),c(n),c(n);for(let e=0;e<2;e++){r[0]=n[0]-65517;for(let e=1;e<15;e++)r[e]=n[e]-65535-(r[e-1]>>16&1),r[e-1]&=65535;r[15]=n[15]-32767-(r[14]>>16&1);const e=r[15]>>16&1;r[14]&=65535,l(n,r,1-e)}for(let t=0;t<16;t++)e[2*t]=255&n[t],e[2*t+1]=n[t]>>8}(b,E),b}function y(e){if(e.length!==t.KS)throw new Error(`x25519: seed must be ${t.KS} bytes`);const r=new Uint8Array(e);return{publicKey:(n=r,f(n,o)),secretKey:r};var n}t._w=y,t.Au=function(e){const t=(0,n.randomBytes)(32,e),r=y(t);return(0,i.wipe)(t),r},t.gi=function(e,r,n=!1){if(e.length!==t.kz)throw new Error("X25519: incorrect secret key length");if(r.length!==t.kz)throw new Error("X25519: incorrect public key length");const i=f(e,r);if(n){let e=0;for(let t=0;t<i.length;t++)e|=i[t];if(0===e)throw new Error("X25519: invalid shared key")}return i}},2044:e=>{function t(e){const t=new globalThis.AbortController;function r(){t.abort();for(const t of e)t&&t.removeEventListener&&t.removeEventListener("abort",r)}for(const t of e)if(t&&t.addEventListener){if(t.aborted){r();break}t.addEventListener("abort",r)}return t.signal}e.exports=t,e.exports.anySignal=t},1227:(e,t,r)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(i=n))})),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(2447)(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},2447:(e,t,r)=>{e.exports=function(e){function t(e){let r,i,s,o=null;function a(...e){if(!a.enabled)return;const n=a,i=Number(new Date),s=i-(r||i);n.diff=s,n.prev=r,n.curr=i,r=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,i)=>{if("%%"===r)return"%";o++;const s=t.formatters[i];if("function"==typeof s){const t=e[o];r=s.call(n,t),e.splice(o,1),o--}return r})),t.formatArgs.call(n,e),(n.log||t.log).apply(n,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==t.namespaces&&(i=t.namespaces,s=t.enabled(e)),s),set:e=>{o=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(i),...t.skips.map(i).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(7824),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},5780:e=>{"use strict";const t=()=>{const e=new Error("Delay aborted");return e.name="AbortError",e},r=({clearTimeout:e,setTimeout:r,willResolve:n})=>(i,{value:s,signal:o}={})=>{if(o&&o.aborted)return Promise.reject(t());let a,c,l;const u=e||clearTimeout,h=()=>{u(a),l(t())},d=new Promise(((e,t)=>{c=()=>{o&&o.removeEventListener("abort",h),n?e(s):t(s)},l=t,a=(r||setTimeout)(c,i)}));return o&&o.addEventListener("abort",h,{once:!0}),d.clear=()=>{u(a),a=null,c()},d},n=e=>{const t=r({...e,willResolve:!0});return t.reject=r({...e,willResolve:!1}),t.range=(e,r,n)=>t(((e,t)=>Math.floor(Math.random()*(t-e+1)+e))(e,r),n),t},i=n();i.createWithTimers=n,e.exports=i,e.exports.default=i},2114:e=>{"use strict";function t(e,t){for(const r in t)Object.defineProperty(e,r,{value:t[r],enumerable:!0,configurable:!0});return e}e.exports=function(e,r,n){if(!e||"string"==typeof e)throw new TypeError("Please pass an Error to err-code");n||(n={}),"object"==typeof r&&(n=r,r=""),r&&(n.code=r);try{return t(e,n)}catch(r){n.message=e.message,n.stack=e.stack;const i=function(){};return i.prototype=Object.create(Object.getPrototypeOf(e)),t(new i,n)}}},6729:e=>{"use strict";var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(e,t,n,s,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new i(n,s||e,o),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,o=new Array(s);i<s;i++)o[i]=n[i].fn;return o},a.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,i,s,o){var a=r?r+e:e;if(!this._events[a])return!1;var c,l,u=this._events[a],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,i),!0;case 5:return u.fn.call(u.context,t,n,i,s),!0;case 6:return u.fn.call(u.context,t,n,i,s,o),!0}for(l=1,c=new Array(h-1);l<h;l++)c[l-1]=arguments[l];u.fn.apply(u.context,c)}else{var d,p=u.length;for(l=0;l<p;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),h){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,n);break;case 4:u[l].fn.call(u[l].context,t,n,i);break;default:if(!c)for(d=1,c=new Array(h-1);d<h;d++)c[d-1]=arguments[d];u[l].fn.apply(u[l].context,c)}}return!0},a.prototype.on=function(e,t,r){return s(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return s(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,n,i){var s=r?r+e:e;if(!this._events[s])return this;if(!t)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==t||i&&!a.once||n&&a.context!==n||o(this,s);else{for(var c=0,l=[],u=a.length;c<u;c++)(a[c].fn!==t||i&&!a[c].once||n&&a[c].context!==n)&&l.push(a[c]);l.length?this._events[s]=1===l.length?l[0]:l:o(this,s)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a},7187:e=>{"use strict";var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(r,n){function i(r){e.removeListener(t,s),n(r)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}y(e,t,s,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&y(e,"error",t,{once:!0})}(e,i)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function l(e,t,r,n){var i,s,o,l;if(a(r),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),o=s[t]),void 0===o)o=s[t]=r,++e._eventsCount;else if("function"==typeof o?o=s[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(i=c(e))>0&&o.length>i&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,l=u,console&&console.warn&&console.warn(l)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=u.bind(n);return i.listener=r,n.wrapFn=i,i}function d(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):f(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function f(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function y(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(s){n.once&&e.removeEventListener(t,i),r(s)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,s=this._events;if(void 0!==s)i=i&&void 0===s.error;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else{var l=c.length,u=f(c,l);for(r=0;r<l;++r)n(u[r],this,t)}return!0},s.prototype.addListener=function(e,t){return l(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return l(this,e,t,!0)},s.prototype.once=function(e,t){return a(t),this.on(e,h(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,h(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,n,i,s,o;if(a(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){o=r[s].listener,i=s;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,s=Object.keys(r);for(n=0;n<s.length;++n)"removeListener"!==(i=s[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},s.prototype.listeners=function(e){return d(this,e,!0)},s.prototype.rawListeners=function(e){return d(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},3975:e=>{e.exports=class{constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return void 0===this.buffer[this.btm]}}},1607:(e,t,r)=>{const n=r(3975);e.exports=class{constructor(e){this.hwm=e||16,this.head=new n(this.hwm),this.tail=this.head}push(e){if(!this.head.push(e)){const t=this.head;this.head=t.next=new n(2*this.head.buffer.length),this.head.push(e)}}shift(){const e=this.tail.shift();if(void 0===e&&this.tail.next){const e=this.tail.next;return this.tail.next=null,this.tail=e,this.tail.shift()}return e}peek(){return this.tail.peek()}isEmpty(){return this.head.isEmpty()}}},6512:function(e){!function(t){"use strict";const r="(0?\\d+|0x[a-f0-9]+)",n={fourOctet:new RegExp(`^${r}\\.${r}\\.${r}\\.${r}$`,"i"),threeOctet:new RegExp(`^${r}\\.${r}\\.${r}$`,"i"),twoOctet:new RegExp(`^${r}\\.${r}$`,"i"),longValue:new RegExp(`^${r}$`,"i")},i=new RegExp("^0[0-7]+$","i"),s=new RegExp("^0x[a-f0-9]+$","i"),o="%[0-9a-z]{1,}",a="(?:[0-9a-f]+::?)+",c={zoneIndex:new RegExp(o,"i"),native:new RegExp(`^(::)?(${a})?([0-9a-f]+)?(::)?(${o})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${r}\\.${r}\\.${r}\\.${r}(${o})?)$`,"i"),transitional:new RegExp(`^((?:${a})|(?:::)(?:${a})?)${r}\\.${r}\\.${r}\\.${r}(${o})?$`,"i")};function l(e,t){if(e.indexOf("::")!==e.lastIndexOf("::"))return null;let r,n,i=0,s=-1,o=(e.match(c.zoneIndex)||[])[0];for(o&&(o=o.substring(1),e=e.replace(/%.+$/,""));(s=e.indexOf(":",s+1))>=0;)i++;if("::"===e.substr(0,2)&&i--,"::"===e.substr(-2,2)&&i--,i>t)return null;for(n=t-i,r=":";n--;)r+="0:";return":"===(e=e.replace("::",r))[0]&&(e=e.slice(1)),":"===e[e.length-1]&&(e=e.slice(0,-1)),{parts:t=function(){const t=e.split(":"),r=[];for(let e=0;e<t.length;e++)r.push(parseInt(t[e],16));return r}(),zoneId:o}}function u(e,t,r,n){if(e.length!==t.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let i,s=0;for(;n>0;){if(i=r-n,i<0&&(i=0),e[s]>>i!=t[s]>>i)return!1;n-=r,s+=1}return!0}function h(e){if(s.test(e))return parseInt(e,16);if("0"===e[0]&&!isNaN(parseInt(e[1],10))){if(i.test(e))return parseInt(e,8);throw new Error(`ipaddr: cannot parse ${e} as octal`)}return parseInt(e,10)}function d(e,t){for(;e.length<t;)e=`0${e}`;return e}const p={};p.IPv4=function(){function e(e){if(4!==e.length)throw new Error("ipaddr: ipv4 octet count should be 4");let t,r;for(t=0;t<e.length;t++)if(r=e[t],!(0<=r&&r<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=e}return e.prototype.SpecialRanges={unspecified:[[new e([0,0,0,0]),8]],broadcast:[[new e([255,255,255,255]),32]],multicast:[[new e([224,0,0,0]),4]],linkLocal:[[new e([169,254,0,0]),16]],loopback:[[new e([127,0,0,0]),8]],carrierGradeNat:[[new e([100,64,0,0]),10]],private:[[new e([10,0,0,0]),8],[new e([172,16,0,0]),12],[new e([192,168,0,0]),16]],reserved:[[new e([192,0,0,0]),24],[new e([192,0,2,0]),24],[new e([192,88,99,0]),24],[new e([198,51,100,0]),24],[new e([203,0,113,0]),24],[new e([240,0,0,0]),4]]},e.prototype.kind=function(){return"ipv4"},e.prototype.match=function(e,t){let r;if(void 0===t&&(r=e,e=r[0],t=r[1]),"ipv4"!==e.kind())throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return u(this.octets,e.octets,8,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const r={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0};let n,i,s;for(n=3;n>=0;n-=1){if(i=this.octets[n],!(i in r))return null;if(s=r[i],t&&0!==s)return null;8!==s&&(t=!0),e+=s}return 32-e},e.prototype.range=function(){return p.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){return this.octets.slice(0)},e.prototype.toIPv4MappedAddress=function(){return p.IPv6.parse(`::ffff:${this.toString()}`)},e.prototype.toNormalizedString=function(){return this.toString()},e.prototype.toString=function(){return this.octets.join(".")},e}(),p.IPv4.broadcastAddressFromCIDR=function(e){try{const t=this.parseCIDR(e),r=t[0].toByteArray(),n=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),i=[];let s=0;for(;s<4;)i.push(parseInt(r[s],10)|255^parseInt(n[s],10)),s++;return new this(i)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},p.IPv4.isIPv4=function(e){return null!==this.parser(e)},p.IPv4.isValid=function(e){try{return new this(this.parser(e)),!0}catch(e){return!1}},p.IPv4.isValidFourPartDecimal=function(e){return!(!p.IPv4.isValid(e)||!e.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},p.IPv4.networkAddressFromCIDR=function(e){let t,r,n,i,s;try{for(t=this.parseCIDR(e),n=t[0].toByteArray(),s=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),i=[],r=0;r<4;)i.push(parseInt(n[r],10)&parseInt(s[r],10)),r++;return new this(i)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},p.IPv4.parse=function(e){const t=this.parser(e);if(null===t)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(t)},p.IPv4.parseCIDR=function(e){let t;if(t=e.match(/^(.+)\/(\d+)$/)){const e=parseInt(t[2]);if(e>=0&&e<=32){const r=[this.parse(t[1]),e];return Object.defineProperty(r,"toString",{value:function(){return this.join("/")}}),r}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},p.IPv4.parser=function(e){let t,r,i;if(t=e.match(n.fourOctet))return function(){const e=t.slice(1,6),n=[];for(let t=0;t<e.length;t++)r=e[t],n.push(h(r));return n}();if(t=e.match(n.longValue)){if(i=h(t[1]),i>4294967295||i<0)throw new Error("ipaddr: address outside defined range");return function(){const e=[];let t;for(t=0;t<=24;t+=8)e.push(i>>t&255);return e}().reverse()}return(t=e.match(n.twoOctet))?function(){const e=t.slice(1,4),r=[];if(i=h(e[1]),i>16777215||i<0)throw new Error("ipaddr: address outside defined range");return r.push(h(e[0])),r.push(i>>16&255),r.push(i>>8&255),r.push(255&i),r}():(t=e.match(n.threeOctet))?function(){const e=t.slice(1,5),r=[];if(i=h(e[2]),i>65535||i<0)throw new Error("ipaddr: address outside defined range");return r.push(h(e[0])),r.push(h(e[1])),r.push(i>>8&255),r.push(255&i),r}():null},p.IPv4.subnetMaskFromPrefixLength=function(e){if((e=parseInt(e))<0||e>32)throw new Error("ipaddr: invalid IPv4 prefix length");const t=[0,0,0,0];let r=0;const n=Math.floor(e/8);for(;r<n;)t[r]=255,r++;return n<4&&(t[n]=Math.pow(2,e%8)-1<<8-e%8),new this(t)},p.IPv6=function(){function e(e,t){let r,n;if(16===e.length)for(this.parts=[],r=0;r<=14;r+=2)this.parts.push(e[r]<<8|e[r+1]);else{if(8!==e.length)throw new Error("ipaddr: ipv6 part count should be 8 or 16");this.parts=e}for(r=0;r<this.parts.length;r++)if(n=this.parts[r],!(0<=n&&n<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");t&&(this.zoneId=t)}return e.prototype.SpecialRanges={unspecified:[new e([0,0,0,0,0,0,0,0]),128],linkLocal:[new e([65152,0,0,0,0,0,0,0]),10],multicast:[new e([65280,0,0,0,0,0,0,0]),8],loopback:[new e([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new e([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new e([0,0,0,0,0,65535,0,0]),96],rfc6145:[new e([0,0,0,0,65535,0,0,0]),96],rfc6052:[new e([100,65435,0,0,0,0,0,0]),96],"6to4":[new e([8194,0,0,0,0,0,0,0]),16],teredo:[new e([8193,0,0,0,0,0,0,0]),32],reserved:[[new e([8193,3512,0,0,0,0,0,0]),32]]},e.prototype.isIPv4MappedAddress=function(){return"ipv4Mapped"===this.range()},e.prototype.kind=function(){return"ipv6"},e.prototype.match=function(e,t){let r;if(void 0===t&&(r=e,e=r[0],t=r[1]),"ipv6"!==e.kind())throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return u(this.parts,e.parts,16,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const r={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0};let n,i;for(let s=7;s>=0;s-=1){if(n=this.parts[s],!(n in r))return null;if(i=r[n],t&&0!==i)return null;16!==i&&(t=!0),e+=i}return 128-e},e.prototype.range=function(){return p.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){let e;const t=[],r=this.parts;for(let n=0;n<r.length;n++)e=r[n],t.push(e>>8),t.push(255&e);return t},e.prototype.toFixedLengthString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(d(this.parts[t].toString(16),4));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");const e=this.parts.slice(-2),t=e[0],r=e[1];return new p.IPv4([t>>8,255&t,r>>8,255&r])},e.prototype.toNormalizedString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(this.parts[t].toString(16));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toRFC5952String=function(){const e=/((^|:)(0(:|$)){2,})/g,t=this.toNormalizedString();let r,n=0,i=-1;for(;r=e.exec(t);)r[0].length>i&&(n=r.index,i=r[0].length);return i<0?t:`${t.substring(0,n)}::${t.substring(n+i)}`},e.prototype.toString=function(){return this.toNormalizedString().replace(/((^|:)(0(:|$))+)/,"::")},e}(),p.IPv6.broadcastAddressFromCIDR=function(e){try{const t=this.parseCIDR(e),r=t[0].toByteArray(),n=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),i=[];let s=0;for(;s<16;)i.push(parseInt(r[s],10)|255^parseInt(n[s],10)),s++;return new this(i)}catch(e){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${e})`)}},p.IPv6.isIPv6=function(e){return null!==this.parser(e)},p.IPv6.isValid=function(e){if("string"==typeof e&&-1===e.indexOf(":"))return!1;try{const t=this.parser(e);return new this(t.parts,t.zoneId),!0}catch(e){return!1}},p.IPv6.networkAddressFromCIDR=function(e){let t,r,n,i,s;try{for(t=this.parseCIDR(e),n=t[0].toByteArray(),s=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),i=[],r=0;r<16;)i.push(parseInt(n[r],10)&parseInt(s[r],10)),r++;return new this(i)}catch(e){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${e})`)}},p.IPv6.parse=function(e){const t=this.parser(e);if(null===t.parts)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(t.parts,t.zoneId)},p.IPv6.parseCIDR=function(e){let t,r,n;if((r=e.match(/^(.+)\/(\d+)$/))&&(t=parseInt(r[2]),t>=0&&t<=128))return n=[this.parse(r[1]),t],Object.defineProperty(n,"toString",{value:function(){return this.join("/")}}),n;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},p.IPv6.parser=function(e){let t,r,n,i,s,o;if(n=e.match(c.deprecatedTransitional))return this.parser(`::ffff:${n[1]}`);if(c.native.test(e))return l(e,8);if((n=e.match(c.transitional))&&(o=n[6]||"",t=l(n[1].slice(0,-1)+o,6),t.parts)){for(s=[parseInt(n[2]),parseInt(n[3]),parseInt(n[4]),parseInt(n[5])],r=0;r<s.length;r++)if(i=s[r],!(0<=i&&i<=255))return null;return t.parts.push(s[0]<<8|s[1]),t.parts.push(s[2]<<8|s[3]),{parts:t.parts,zoneId:t.zoneId}}return null},p.IPv6.subnetMaskFromPrefixLength=function(e){if((e=parseInt(e))<0||e>128)throw new Error("ipaddr: invalid IPv6 prefix length");const t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];let r=0;const n=Math.floor(e/8);for(;r<n;)t[r]=255,r++;return n<16&&(t[n]=Math.pow(2,e%8)-1<<8-e%8),new this(t)},p.fromByteArray=function(e){const t=e.length;if(4===t)return new p.IPv4(e);if(16===t)return new p.IPv6(e);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},p.isValid=function(e){return p.IPv6.isValid(e)||p.IPv4.isValid(e)},p.parse=function(e){if(p.IPv6.isValid(e))return p.IPv6.parse(e);if(p.IPv4.isValid(e))return p.IPv4.parse(e);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},p.parseCIDR=function(e){try{return p.IPv6.parseCIDR(e)}catch(t){try{return p.IPv4.parseCIDR(e)}catch(e){throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},p.process=function(e){const t=this.parse(e);return"ipv6"===t.kind()&&t.isIPv4MappedAddress()?t.toIPv4Address():t},p.subnetMatch=function(e,t,r){let n,i,s,o;for(i in null==r&&(r="unicast"),t)if(Object.prototype.hasOwnProperty.call(t,i))for(s=t[i],!s[0]||s[0]instanceof Array||(s=[s]),n=0;n<s.length;n++)if(o=s[n],e.kind()===o[0].kind()&&e.match.apply(e,o))return i;return r},e.exports?e.exports=p:t.ipaddr=p}(this)},9134:e=>{e.exports=function(){return"undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||!("undefined"==typeof process||"object"!=typeof process.versions||!process.versions.electron)||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0}},3310:e=>{"use strict";e.exports=e=>{if("[object Object]"!==Object.prototype.toString.call(e))return!1;const t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}},1914:e=>{"use strict";const t=65536;e.exports=function(e){const r=new Uint8Array(e);let n=0;if(e>0)if(e>t)for(;n<e;)n+t>e?(crypto.getRandomValues(r.subarray(n,n+(e-n))),n+=e-n):(crypto.getRandomValues(r.subarray(n,n+t)),n+=t);else crypto.getRandomValues(r);return r}},942:function(e,t,r){"use strict";const n=r(3310),{hasOwnProperty:i}=Object.prototype,{propertyIsEnumerable:s}=Object,o=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0}),a=this,c={concatArrays:!1,ignoreUndefined:!1},l=e=>{const t=[];for(const r in e)i.call(e,r)&&t.push(r);if(Object.getOwnPropertySymbols){const r=Object.getOwnPropertySymbols(e);for(const n of r)s.call(e,n)&&t.push(n)}return t};function u(e){return Array.isArray(e)?function(e){const t=e.slice(0,0);return l(e).forEach((r=>{o(t,r,u(e[r]))})),t}(e):n(e)?function(e){const t=null===Object.getPrototypeOf(e)?Object.create(null):{};return l(e).forEach((r=>{o(t,r,u(e[r]))})),t}(e):e}const h=(e,t,r,n)=>(r.forEach((r=>{void 0===t[r]&&n.ignoreUndefined||(r in e&&e[r]!==Object.getPrototypeOf(e)?o(e,r,p(e[r],t[r],n)):o(e,r,u(t[r])))})),e),d=(e,t,r)=>{let n=e.slice(0,0),s=0;return[e,t].forEach((t=>{const a=[];for(let r=0;r<t.length;r++)i.call(t,r)&&(a.push(String(r)),o(n,s++,t===e?t[r]:u(t[r])));n=h(n,t,l(t).filter((e=>!a.includes(e))),r)})),n};function p(e,t,r){return r.concatArrays&&Array.isArray(e)&&Array.isArray(t)?d(e,t,r):n(t)&&n(e)?h(e,t,l(t),r):u(t)}e.exports=function(...e){const t=p(u(c),this!==a&&this||{},c);let r={_:{}};for(const i of e)if(void 0!==i){if(!n(i))throw new TypeError("`"+i+"` is not an Option Object");r=p(r,{_:i},t)}return r._}},7824:e=>{var t=1e3,r=60*t,n=60*r,i=24*n;function s(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}e.exports=function(e,o){o=o||{};var a,c,l=typeof e;if("string"===l&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var s=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(s){var o=parseFloat(s[1]);switch((s[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*i;case"hours":case"hour":case"hrs":case"hr":case"h":return o*n;case"minutes":case"minute":case"mins":case"min":case"m":return o*r;case"seconds":case"second":case"secs":case"sec":case"s":return o*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(e);if("number"===l&&isFinite(e))return o.long?(a=e,(c=Math.abs(a))>=i?s(a,c,i,"day"):c>=n?s(a,c,n,"hour"):c>=r?s(a,c,r,"minute"):c>=t?s(a,c,t,"second"):a+" ms"):function(e){var s=Math.abs(e);return s>=i?Math.round(e/i)+"d":s>=n?Math.round(e/n)+"h":s>=r?Math.round(e/r)+"m":s>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},8951:function(e,t){(function(){var e,r,n,i,s,o,a,c;c=function(e){return[(e&255<<24)>>>24,(e&255<<16)>>>16,(65280&e)>>>8,255&e].join(".")},a=function(e){var t,n,i,s,o,a;for(t=[],i=s=0;s<=3&&0!==e.length;i=++s){if(i>0){if("."!==e[0])throw new Error("Invalid IP");e=e.substring(1)}o=(a=r(e))[0],n=a[1],e=e.substring(n),t.push(o)}if(0!==e.length)throw new Error("Invalid IP");switch(t.length){case 1:if(t[0]>4294967295)throw new Error("Invalid IP");return t[0]>>>0;case 2:if(t[0]>255||t[1]>16777215)throw new Error("Invalid IP");return(t[0]<<24|t[1])>>>0;case 3:if(t[0]>255||t[1]>255||t[2]>65535)throw new Error("Invalid IP");return(t[0]<<24|t[1]<<16|t[2])>>>0;case 4:if(t[0]>255||t[1]>255||t[2]>255||t[3]>255)throw new Error("Invalid IP");return(t[0]<<24|t[1]<<16|t[2]<<8|t[3])>>>0;default:throw new Error("Invalid IP")}},i=(n=function(e){return e.charCodeAt(0)})("0"),o=n("a"),s=n("A"),r=function(e){var t,r,a,c,l;for(c=0,t=10,r="9",a=0,e.length>1&&"0"===e[a]&&("x"===e[a+1]||"X"===e[a+1]?(a+=2,t=16):"0"<=e[a+1]&&e[a+1]<="9"&&(a++,t=8,r="7")),l=a;a<e.length;){if("0"<=e[a]&&e[a]<=r)c=c*t+(n(e[a])-i)>>>0;else{if(16!==t)break;if("a"<=e[a]&&e[a]<="f")c=c*t+(10+n(e[a])-o)>>>0;else{if(!("A"<=e[a]&&e[a]<="F"))break;c=c*t+(10+n(e[a])-s)>>>0}}if(c>4294967295)throw new Error("too large");a++}if(a===l)throw new Error("empty octet");return[c,a]},e=function(){function e(e,t){var r,n,i;if("string"!=typeof e)throw new Error("Missing `net' parameter");if(t||(i=e.split("/",2),e=i[0],t=i[1]),t||(t=32),"string"==typeof t&&t.indexOf(".")>-1){try{this.maskLong=a(t)}catch(e){throw new Error("Invalid mask: "+t)}for(r=n=32;n>=0;r=--n)if(this.maskLong===4294967295<<32-r>>>0){this.bitmask=r;break}}else{if(!t&&0!==t)throw new Error("Invalid mask: empty");this.bitmask=parseInt(t,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0)}try{this.netLong=(a(e)&this.maskLong)>>>0}catch(t){throw new Error("Invalid net address: "+e)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+t);this.size=Math.pow(2,32-this.bitmask),this.base=c(this.netLong),this.mask=c(this.maskLong),this.hostmask=c(~this.maskLong),this.first=this.bitmask<=30?c(this.netLong+1):this.base,this.last=this.bitmask<=30?c(this.netLong+this.size-2):c(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?c(this.netLong+this.size-1):void 0}return e.prototype.contains=function(t){return"string"==typeof t&&(t.indexOf("/")>0||4!==t.split(".").length)&&(t=new e(t)),t instanceof e?this.contains(t.base)&&this.contains(t.broadcast||t.last):(a(t)&this.maskLong)>>>0==(this.netLong&this.maskLong)>>>0},e.prototype.next=function(t){return null==t&&(t=1),new e(c(this.netLong+this.size*t),this.mask)},e.prototype.forEach=function(e){var t,r,n;for(n=a(this.first),r=a(this.last),t=0;n<=r;)e(c(n),n,t),t++,n++},e.prototype.toString=function(){return this.base+"/"+this.bitmask},e}(),t.ip2long=a,t.long2ip=c,t.Netmask=e}).call(this)},8925:(e,t,r)=>{var n=r(3832);function i(e,t){n.cipher.registerAlgorithm(e,(function(){return new n.aes.Algorithm(e,t)}))}r(5649),r(1967),r(7116),e.exports=n.aes=n.aes||{},n.aes.startEncrypting=function(e,t,r,n){var i=y({key:e,output:r,decrypt:!1,mode:n});return i.start(t),i},n.aes.createEncryptionCipher=function(e,t){return y({key:e,output:null,decrypt:!1,mode:t})},n.aes.startDecrypting=function(e,t,r,n){var i=y({key:e,output:r,decrypt:!0,mode:n});return i.start(t),i},n.aes.createDecryptionCipher=function(e,t){return y({key:e,output:null,decrypt:!0,mode:t})},n.aes.Algorithm=function(e,t){u||d();var r=this;r.name=e,r.mode=new t({blockSize:16,cipher:{encrypt:function(e,t){return f(r._w,e,t,!1)},decrypt:function(e,t){return f(r._w,e,t,!0)}}}),r._init=!1},n.aes.Algorithm.prototype.initialize=function(e){if(!this._init){var t,r=e.key;if("string"!=typeof r||16!==r.length&&24!==r.length&&32!==r.length){if(n.util.isArray(r)&&(16===r.length||24===r.length||32===r.length)){t=r,r=n.util.createBuffer();for(var i=0;i<t.length;++i)r.putByte(t[i])}}else r=n.util.createBuffer(r);if(!n.util.isArray(r)){t=r,r=[];var s=t.length();if(16===s||24===s||32===s)for(s>>>=2,i=0;i<s;++i)r.push(t.getInt32())}if(!n.util.isArray(r)||4!==r.length&&6!==r.length&&8!==r.length)throw new Error("Invalid key parameter.");var o=this.mode.name,a=-1!==["CFB","OFB","CTR","GCM"].indexOf(o);this._w=p(r,e.decrypt&&!a),this._init=!0}},n.aes._expandKey=function(e,t){return u||d(),p(e,t)},n.aes._updateBlock=f,i("AES-ECB",n.cipher.modes.ecb),i("AES-CBC",n.cipher.modes.cbc),i("AES-CFB",n.cipher.modes.cfb),i("AES-OFB",n.cipher.modes.ofb),i("AES-CTR",n.cipher.modes.ctr),i("AES-GCM",n.cipher.modes.gcm);var s,o,a,c,l,u=!1,h=4;function d(){u=!0,a=[0,1,2,4,8,16,32,64,128,27,54];for(var e=new Array(256),t=0;t<128;++t)e[t]=t<<1,e[t+128]=t+128<<1^283;for(s=new Array(256),o=new Array(256),c=new Array(4),l=new Array(4),t=0;t<4;++t)c[t]=new Array(256),l[t]=new Array(256);var r,n,i,h,d,p,f,y=0,g=0;for(t=0;t<256;++t){h=(h=g^g<<1^g<<2^g<<3^g<<4)>>8^255&h^99,s[y]=h,o[h]=y,p=(d=e[h])<<24^h<<16^h<<8^h^d,f=((r=e[y])^(n=e[r])^(i=e[n]))<<24^(y^i)<<16^(y^n^i)<<8^y^r^i;for(var m=0;m<4;++m)c[m][y]=p,l[m][h]=f,p=p<<24|p>>>8,f=f<<24|f>>>8;0===y?y=g=1:(y=r^e[e[e[r^i]]],g^=e[e[g]])}}function p(e,t){for(var r,n=e.slice(0),i=1,o=n.length,c=h*(o+6+1),u=o;u<c;++u)r=n[u-1],u%o==0?(r=s[r>>>16&255]<<24^s[r>>>8&255]<<16^s[255&r]<<8^s[r>>>24]^a[i]<<24,i++):o>6&&u%o==4&&(r=s[r>>>24]<<24^s[r>>>16&255]<<16^s[r>>>8&255]<<8^s[255&r]),n[u]=n[u-o]^r;if(t){for(var d,p=l[0],f=l[1],y=l[2],g=l[3],m=n.slice(0),w=(u=0,(c=n.length)-h);u<c;u+=h,w-=h)if(0===u||u===c-h)m[u]=n[w],m[u+1]=n[w+3],m[u+2]=n[w+2],m[u+3]=n[w+1];else for(var E=0;E<h;++E)d=n[w+E],m[u+(3&-E)]=p[s[d>>>24]]^f[s[d>>>16&255]]^y[s[d>>>8&255]]^g[s[255&d]];n=m}return n}function f(e,t,r,n){var i,a,u,h,d,p,f,y,g,m,w,E,b=e.length/4-1;n?(i=l[0],a=l[1],u=l[2],h=l[3],d=o):(i=c[0],a=c[1],u=c[2],h=c[3],d=s),p=t[0]^e[0],f=t[n?3:1]^e[1],y=t[2]^e[2],g=t[n?1:3]^e[3];for(var v=3,_=1;_<b;++_)m=i[p>>>24]^a[f>>>16&255]^u[y>>>8&255]^h[255&g]^e[++v],w=i[f>>>24]^a[y>>>16&255]^u[g>>>8&255]^h[255&p]^e[++v],E=i[y>>>24]^a[g>>>16&255]^u[p>>>8&255]^h[255&f]^e[++v],g=i[g>>>24]^a[p>>>16&255]^u[f>>>8&255]^h[255&y]^e[++v],p=m,f=w,y=E;r[0]=d[p>>>24]<<24^d[f>>>16&255]<<16^d[y>>>8&255]<<8^d[255&g]^e[++v],r[n?3:1]=d[f>>>24]<<24^d[y>>>16&255]<<16^d[g>>>8&255]<<8^d[255&p]^e[++v],r[2]=d[y>>>24]<<24^d[g>>>16&255]<<16^d[p>>>8&255]<<8^d[255&f]^e[++v],r[n?1:3]=d[g>>>24]<<24^d[p>>>16&255]<<16^d[f>>>8&255]<<8^d[255&y]^e[++v]}function y(e){var t,r="AES-"+((e=e||{}).mode||"CBC").toUpperCase(),i=(t=e.decrypt?n.cipher.createDecipher(r,e.key):n.cipher.createCipher(r,e.key)).start;return t.start=function(e,r){var s=null;r instanceof n.util.ByteBuffer&&(s=r,r={}),(r=r||{}).output=s,r.iv=e,i.call(t,r)},t}},3068:(e,t,r)=>{var n=r(3832);r(7116),r(6270);var i=e.exports=n.asn1=n.asn1||{};function s(e,t,r){if(r>t){var n=new Error("Too few bytes to parse DER.");throw n.available=e.length(),n.remaining=t,n.requested=r,n}}i.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192},i.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30},i.create=function(e,t,r,s,o){if(n.util.isArray(s)){for(var a=[],c=0;c<s.length;++c)void 0!==s[c]&&a.push(s[c]);s=a}var l={tagClass:e,type:t,constructed:r,composed:r||n.util.isArray(s),value:s};return o&&"bitStringContents"in o&&(l.bitStringContents=o.bitStringContents,l.original=i.copy(l)),l},i.copy=function(e,t){var r;if(n.util.isArray(e)){r=[];for(var s=0;s<e.length;++s)r.push(i.copy(e[s],t));return r}return"string"==typeof e?e:(r={tagClass:e.tagClass,type:e.type,constructed:e.constructed,composed:e.composed,value:i.copy(e.value,t)},t&&!t.excludeBitStringContents&&(r.bitStringContents=e.bitStringContents),r)},i.equals=function(e,t,r){if(n.util.isArray(e)){if(!n.util.isArray(t))return!1;if(e.length!==t.length)return!1;for(var s=0;s<e.length;++s)if(!i.equals(e[s],t[s]))return!1;return!0}if(typeof e!=typeof t)return!1;if("string"==typeof e)return e===t;var o=e.tagClass===t.tagClass&&e.type===t.type&&e.constructed===t.constructed&&e.composed===t.composed&&i.equals(e.value,t.value);return r&&r.includeBitStringContents&&(o=o&&e.bitStringContents===t.bitStringContents),o},i.getBerValueLength=function(e){var t=e.getByte();if(128!==t)return 128&t?e.getInt((127&t)<<3):t};var o=function(e,t){var r=e.getByte();if(t--,128!==r){var n;if(128&r){var i=127&r;s(e,t,i),n=e.getInt(i<<3)}else n=r;if(n<0)throw new Error("Negative length: "+n);return n}};function a(e,t,r,n){var c;s(e,t,2);var l=e.getByte();t--;var u=192&l,h=31&l;c=e.length();var d,p,f=o(e,t);if(t-=c-e.length(),void 0!==f&&f>t){if(n.strict){var y=new Error("Too few bytes to read ASN.1 value.");throw y.available=e.length(),y.remaining=t,y.requested=f,y}f=t}var g=32==(32&l);if(g)if(d=[],void 0===f)for(;;){if(s(e,t,2),e.bytes(2)===String.fromCharCode(0,0)){e.getBytes(2),t-=2;break}c=e.length(),d.push(a(e,t,r+1,n)),t-=c-e.length()}else for(;f>0;)c=e.length(),d.push(a(e,f,r+1,n)),t-=c-e.length(),f-=c-e.length();if(void 0===d&&u===i.Class.UNIVERSAL&&h===i.Type.BITSTRING&&(p=e.bytes(f)),void 0===d&&n.decodeBitStrings&&u===i.Class.UNIVERSAL&&h===i.Type.BITSTRING&&f>1){var m=e.read,w=t,E=0;if(h===i.Type.BITSTRING&&(s(e,t,1),E=e.getByte(),t--),0===E)try{c=e.length();var b=a(e,t,r+1,{strict:!0,decodeBitStrings:!0}),v=c-e.length();t-=v,h==i.Type.BITSTRING&&v++;var _=b.tagClass;v!==f||_!==i.Class.UNIVERSAL&&_!==i.Class.CONTEXT_SPECIFIC||(d=[b])}catch(e){}void 0===d&&(e.read=m,t=w)}if(void 0===d){if(void 0===f){if(n.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");f=t}if(h===i.Type.BMPSTRING)for(d="";f>0;f-=2)s(e,t,2),d+=String.fromCharCode(e.getInt16()),t-=2;else d=e.getBytes(f),t-=f}var S=void 0===p?null:{bitStringContents:p};return i.create(u,h,g,d,S)}i.fromDer=function(e,t){void 0===t&&(t={strict:!0,parseAllBytes:!0,decodeBitStrings:!0}),"boolean"==typeof t&&(t={strict:t,parseAllBytes:!0,decodeBitStrings:!0}),"strict"in t||(t.strict=!0),"parseAllBytes"in t||(t.parseAllBytes=!0),"decodeBitStrings"in t||(t.decodeBitStrings=!0),"string"==typeof e&&(e=n.util.createBuffer(e));var r=e.length(),i=a(e,e.length(),0,t);if(t.parseAllBytes&&0!==e.length()){var s=new Error("Unparsed DER bytes remain after ASN.1 parsing.");throw s.byteCount=r,s.remaining=e.length(),s}return i},i.toDer=function(e){var t=n.util.createBuffer(),r=e.tagClass|e.type,s=n.util.createBuffer(),o=!1;if("bitStringContents"in e&&(o=!0,e.original&&(o=i.equals(e,e.original))),o)s.putBytes(e.bitStringContents);else if(e.composed){e.constructed?r|=32:s.putByte(0);for(var a=0;a<e.value.length;++a)void 0!==e.value[a]&&s.putBuffer(i.toDer(e.value[a]))}else if(e.type===i.Type.BMPSTRING)for(a=0;a<e.value.length;++a)s.putInt16(e.value.charCodeAt(a));else e.type===i.Type.INTEGER&&e.value.length>1&&(0===e.value.charCodeAt(0)&&0==(128&e.value.charCodeAt(1))||255===e.value.charCodeAt(0)&&128==(128&e.value.charCodeAt(1)))?s.putBytes(e.value.substr(1)):s.putBytes(e.value);if(t.putByte(r),s.length()<=127)t.putByte(127&s.length());else{var c=s.length(),l="";do{l+=String.fromCharCode(255&c),c>>>=8}while(c>0);for(t.putByte(128|l.length),a=l.length-1;a>=0;--a)t.putByte(l.charCodeAt(a))}return t.putBuffer(s),t},i.oidToDer=function(e){var t,r,i,s,o=e.split("."),a=n.util.createBuffer();a.putByte(40*parseInt(o[0],10)+parseInt(o[1],10));for(var c=2;c<o.length;++c){t=!0,r=[],i=parseInt(o[c],10);do{s=127&i,i>>>=7,t||(s|=128),r.push(s),t=!1}while(i>0);for(var l=r.length-1;l>=0;--l)a.putByte(r[l])}return a},i.derToOid=function(e){var t;"string"==typeof e&&(e=n.util.createBuffer(e));var r=e.getByte();t=Math.floor(r/40)+"."+r%40;for(var i=0;e.length()>0;)i<<=7,128&(r=e.getByte())?i+=127&r:(t+="."+(i+r),i=0);return t},i.utcTimeToDate=function(e){var t=new Date,r=parseInt(e.substr(0,2),10);r=r>=50?1900+r:2e3+r;var n=parseInt(e.substr(2,2),10)-1,i=parseInt(e.substr(4,2),10),s=parseInt(e.substr(6,2),10),o=parseInt(e.substr(8,2),10),a=0;if(e.length>11){var c=e.charAt(10),l=10;"+"!==c&&"-"!==c&&(a=parseInt(e.substr(10,2),10),l+=2)}if(t.setUTCFullYear(r,n,i),t.setUTCHours(s,o,a,0),l&&("+"===(c=e.charAt(l))||"-"===c)){var u=60*parseInt(e.substr(l+1,2),10)+parseInt(e.substr(l+4,2),10);u*=6e4,"+"===c?t.setTime(+t-u):t.setTime(+t+u)}return t},i.generalizedTimeToDate=function(e){var t=new Date,r=parseInt(e.substr(0,4),10),n=parseInt(e.substr(4,2),10)-1,i=parseInt(e.substr(6,2),10),s=parseInt(e.substr(8,2),10),o=parseInt(e.substr(10,2),10),a=parseInt(e.substr(12,2),10),c=0,l=0,u=!1;"Z"===e.charAt(e.length-1)&&(u=!0);var h=e.length-5,d=e.charAt(h);return"+"!==d&&"-"!==d||(l=60*parseInt(e.substr(h+1,2),10)+parseInt(e.substr(h+4,2),10),l*=6e4,"+"===d&&(l*=-1),u=!0),"."===e.charAt(14)&&(c=1e3*parseFloat(e.substr(14),10)),u?(t.setUTCFullYear(r,n,i),t.setUTCHours(s,o,a,c),t.setTime(+t+l)):(t.setFullYear(r,n,i),t.setHours(s,o,a,c)),t},i.dateToUtcTime=function(e){if("string"==typeof e)return e;var t="",r=[];r.push((""+e.getUTCFullYear()).substr(2)),r.push(""+(e.getUTCMonth()+1)),r.push(""+e.getUTCDate()),r.push(""+e.getUTCHours()),r.push(""+e.getUTCMinutes()),r.push(""+e.getUTCSeconds());for(var n=0;n<r.length;++n)r[n].length<2&&(t+="0"),t+=r[n];return t+"Z"},i.dateToGeneralizedTime=function(e){if("string"==typeof e)return e;var t="",r=[];r.push(""+e.getUTCFullYear()),r.push(""+(e.getUTCMonth()+1)),r.push(""+e.getUTCDate()),r.push(""+e.getUTCHours()),r.push(""+e.getUTCMinutes()),r.push(""+e.getUTCSeconds());for(var n=0;n<r.length;++n)r[n].length<2&&(t+="0"),t+=r[n];return t+"Z"},i.integerToDer=function(e){var t=n.util.createBuffer();if(e>=-128&&e<128)return t.putSignedInt(e,8);if(e>=-32768&&e<32768)return t.putSignedInt(e,16);if(e>=-8388608&&e<8388608)return t.putSignedInt(e,24);if(e>=-2147483648&&e<2147483648)return t.putSignedInt(e,32);var r=new Error("Integer too large; max is 32-bits.");throw r.integer=e,r},i.derToInteger=function(e){"string"==typeof e&&(e=n.util.createBuffer(e));var t=8*e.length();if(t>32)throw new Error("Integer too large; max is 32-bits.");return e.getSignedInt(t)},i.validate=function(e,t,r,s){var o=!1;if(e.tagClass!==t.tagClass&&void 0!==t.tagClass||e.type!==t.type&&void 0!==t.type)s&&(e.tagClass!==t.tagClass&&s.push("["+t.name+'] Expected tag class "'+t.tagClass+'", got "'+e.tagClass+'"'),e.type!==t.type&&s.push("["+t.name+'] Expected type "'+t.type+'", got "'+e.type+'"'));else if(e.constructed===t.constructed||void 0===t.constructed){if(o=!0,t.value&&n.util.isArray(t.value))for(var a=0,c=0;o&&c<t.value.length;++c)o=t.value[c].optional||!1,e.value[a]&&((o=i.validate(e.value[a],t.value[c],r,s))?++a:t.value[c].optional&&(o=!0)),!o&&s&&s.push("["+t.name+'] Tag class "'+t.tagClass+'", type "'+t.type+'" expected value length "'+t.value.length+'", got "'+e.value.length+'"');if(o&&r&&(t.capture&&(r[t.capture]=e.value),t.captureAsn1&&(r[t.captureAsn1]=e),t.captureBitStringContents&&"bitStringContents"in e&&(r[t.captureBitStringContents]=e.bitStringContents),t.captureBitStringValue&&"bitStringContents"in e))if(e.bitStringContents.length<2)r[t.captureBitStringValue]="";else{if(0!==e.bitStringContents.charCodeAt(0))throw new Error("captureBitStringValue only supported for zero unused bits");r[t.captureBitStringValue]=e.bitStringContents.slice(1)}}else s&&s.push("["+t.name+'] Expected constructed "'+t.constructed+'", got "'+e.constructed+'"');return o};var c=/[^\\u0000-\\u00ff]/;i.prettyPrint=function(e,t,r){var s="";r=r||2,(t=t||0)>0&&(s+="\n");for(var o="",a=0;a<t*r;++a)o+=" ";switch(s+=o+"Tag: ",e.tagClass){case i.Class.UNIVERSAL:s+="Universal:";break;case i.Class.APPLICATION:s+="Application:";break;case i.Class.CONTEXT_SPECIFIC:s+="Context-Specific:";break;case i.Class.PRIVATE:s+="Private:"}if(e.tagClass===i.Class.UNIVERSAL)switch(s+=e.type,e.type){case i.Type.NONE:s+=" (None)";break;case i.Type.BOOLEAN:s+=" (Boolean)";break;case i.Type.INTEGER:s+=" (Integer)";break;case i.Type.BITSTRING:s+=" (Bit string)";break;case i.Type.OCTETSTRING:s+=" (Octet string)";break;case i.Type.NULL:s+=" (Null)";break;case i.Type.OID:s+=" (Object Identifier)";break;case i.Type.ODESC:s+=" (Object Descriptor)";break;case i.Type.EXTERNAL:s+=" (External or Instance of)";break;case i.Type.REAL:s+=" (Real)";break;case i.Type.ENUMERATED:s+=" (Enumerated)";break;case i.Type.EMBEDDED:s+=" (Embedded PDV)";break;case i.Type.UTF8:s+=" (UTF8)";break;case i.Type.ROID:s+=" (Relative Object Identifier)";break;case i.Type.SEQUENCE:s+=" (Sequence)";break;case i.Type.SET:s+=" (Set)";break;case i.Type.PRINTABLESTRING:s+=" (Printable String)";break;case i.Type.IA5String:s+=" (IA5String (ASCII))";break;case i.Type.UTCTIME:s+=" (UTC time)";break;case i.Type.GENERALIZEDTIME:s+=" (Generalized time)";break;case i.Type.BMPSTRING:s+=" (BMP String)"}else s+=e.type;if(s+="\n",s+=o+"Constructed: "+e.constructed+"\n",e.composed){var l=0,u="";for(a=0;a<e.value.length;++a)void 0!==e.value[a]&&(l+=1,u+=i.prettyPrint(e.value[a],t+1,r),a+1<e.value.length&&(u+=","));s+=o+"Sub values: "+l+u}else{if(s+=o+"Value: ",e.type===i.Type.OID){var h=i.derToOid(e.value);s+=h,n.pki&&n.pki.oids&&h in n.pki.oids&&(s+=" ("+n.pki.oids[h]+") ")}if(e.type===i.Type.INTEGER)try{s+=i.derToInteger(e.value)}catch(t){s+="0x"+n.util.bytesToHex(e.value)}else if(e.type===i.Type.BITSTRING){if(e.value.length>1?s+="0x"+n.util.bytesToHex(e.value.slice(1)):s+="(none)",e.value.length>0){var d=e.value.charCodeAt(0);1==d?s+=" (1 unused bit shown)":d>1&&(s+=" ("+d+" unused bits shown)")}}else if(e.type===i.Type.OCTETSTRING)c.test(e.value)||(s+="("+e.value+") "),s+="0x"+n.util.bytesToHex(e.value);else if(e.type===i.Type.UTF8)try{s+=n.util.decodeUtf8(e.value)}catch(t){if("URI malformed"!==t.message)throw t;s+="0x"+n.util.bytesToHex(e.value)+" (malformed UTF8)"}else e.type===i.Type.PRINTABLESTRING||e.type===i.Type.IA5String?s+=e.value:c.test(e.value)?s+="0x"+n.util.bytesToHex(e.value):0===e.value.length?s+="[null]":s+=e.value}return s}},8807:e=>{var t={};e.exports=t;var r={};t.encode=function(e,t,r){if("string"!=typeof t)throw new TypeError('"alphabet" must be a string.');if(void 0!==r&&"number"!=typeof r)throw new TypeError('"maxline" must be a number.');var n="";if(e instanceof Uint8Array){var i=0,s=t.length,o=t.charAt(0),a=[0];for(i=0;i<e.length;++i){for(var c=0,l=e[i];c<a.length;++c)l+=a[c]<<8,a[c]=l%s,l=l/s|0;for(;l>0;)a.push(l%s),l=l/s|0}for(i=0;0===e[i]&&i<e.length-1;++i)n+=o;for(i=a.length-1;i>=0;--i)n+=t[a[i]]}else n=function(e,t){var r=0,n=t.length,i=t.charAt(0),s=[0];for(r=0;r<e.length();++r){for(var o=0,a=e.at(r);o<s.length;++o)a+=s[o]<<8,s[o]=a%n,a=a/n|0;for(;a>0;)s.push(a%n),a=a/n|0}var c="";for(r=0;0===e.at(r)&&r<e.length()-1;++r)c+=i;for(r=s.length-1;r>=0;--r)c+=t[s[r]];return c}(e,t);if(r){var u=new RegExp(".{1,"+r+"}","g");n=n.match(u).join("\r\n")}return n},t.decode=function(e,t){if("string"!=typeof e)throw new TypeError('"input" must be a string.');if("string"!=typeof t)throw new TypeError('"alphabet" must be a string.');var n=r[t];if(!n){n=r[t]=[];for(var i=0;i<t.length;++i)n[t.charCodeAt(i)]=i}e=e.replace(/\s/g,"");var s=t.length,o=t.charAt(0),a=[0];for(i=0;i<e.length;i++){var c=n[e.charCodeAt(i)];if(void 0===c)return;for(var l=0,u=c;l<a.length;++l)u+=a[l]*s,a[l]=255&u,u>>=8;for(;u>0;)a.push(255&u),u>>=8}for(var h=0;e[h]===o&&h<e.length-1;++h)a.push(0);return"undefined"!=typeof Buffer?Buffer.from(a.reverse()):new Uint8Array(a.reverse())}},5649:(e,t,r)=>{var n=r(3832);r(7116),e.exports=n.cipher=n.cipher||{},n.cipher.algorithms=n.cipher.algorithms||{},n.cipher.createCipher=function(e,t){var r=e;if("string"==typeof r&&(r=n.cipher.getAlgorithm(r))&&(r=r()),!r)throw new Error("Unsupported algorithm: "+e);return new n.cipher.BlockCipher({algorithm:r,key:t,decrypt:!1})},n.cipher.createDecipher=function(e,t){var r=e;if("string"==typeof r&&(r=n.cipher.getAlgorithm(r))&&(r=r()),!r)throw new Error("Unsupported algorithm: "+e);return new n.cipher.BlockCipher({algorithm:r,key:t,decrypt:!0})},n.cipher.registerAlgorithm=function(e,t){e=e.toUpperCase(),n.cipher.algorithms[e]=t},n.cipher.getAlgorithm=function(e){return(e=e.toUpperCase())in n.cipher.algorithms?n.cipher.algorithms[e]:null};var i=n.cipher.BlockCipher=function(e){this.algorithm=e.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=e.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=e.decrypt,this.algorithm.initialize(e)};i.prototype.start=function(e){e=e||{};var t={};for(var r in e)t[r]=e[r];t.decrypt=this._decrypt,this._finish=!1,this._input=n.util.createBuffer(),this.output=e.output||n.util.createBuffer(),this.mode.start(t)},i.prototype.update=function(e){for(e&&this._input.putBuffer(e);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()},i.prototype.finish=function(e){!e||"ECB"!==this.mode.name&&"CBC"!==this.mode.name||(this.mode.pad=function(t){return e(this.blockSize,t,!1)},this.mode.unpad=function(t){return e(this.blockSize,t,!0)});var t={};return t.decrypt=this._decrypt,t.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,t)||(this._finish=!0,this.update(),this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,t)||this.mode.afterFinish&&!this.mode.afterFinish(this.output,t)))}},1967:(e,t,r)=>{var n=r(3832);r(7116),n.cipher=n.cipher||{};var i=e.exports=n.cipher.modes=n.cipher.modes||{};function s(e,t){if("string"==typeof e&&(e=n.util.createBuffer(e)),n.util.isArray(e)&&e.length>4){var r=e;e=n.util.createBuffer();for(var i=0;i<r.length;++i)e.putByte(r[i])}if(e.length()<t)throw new Error("Invalid IV length; got "+e.length()+" bytes and expected "+t+" bytes.");if(!n.util.isArray(e)){var s=[],o=t/4;for(i=0;i<o;++i)s.push(e.getInt32());e=s}return e}function o(e){e[e.length-1]=e[e.length-1]+1&4294967295}function a(e){return[e/4294967296|0,4294967295&e]}i.ecb=function(e){e=e||{},this.name="ECB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},i.ecb.prototype.start=function(e){},i.ecb.prototype.encrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=e.getInt32();for(this.cipher.encrypt(this._inBlock,this._outBlock),n=0;n<this._ints;++n)t.putInt32(this._outBlock[n])},i.ecb.prototype.decrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=e.getInt32();for(this.cipher.decrypt(this._inBlock,this._outBlock),n=0;n<this._ints;++n)t.putInt32(this._outBlock[n])},i.ecb.prototype.pad=function(e,t){var r=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(r,r),!0},i.ecb.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var r=e.length(),n=e.at(r-1);return!(n>this.blockSize<<2||(e.truncate(n),0))},i.cbc=function(e){e=e||{},this.name="CBC",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},i.cbc.prototype.start=function(e){if(null===e.iv){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else{if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=s(e.iv,this.blockSize),this._prev=this._iv.slice(0)}},i.cbc.prototype.encrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=this._prev[n]^e.getInt32();for(this.cipher.encrypt(this._inBlock,this._outBlock),n=0;n<this._ints;++n)t.putInt32(this._outBlock[n]);this._prev=this._outBlock},i.cbc.prototype.decrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=e.getInt32();for(this.cipher.decrypt(this._inBlock,this._outBlock),n=0;n<this._ints;++n)t.putInt32(this._prev[n]^this._outBlock[n]);this._prev=this._inBlock.slice(0)},i.cbc.prototype.pad=function(e,t){var r=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(r,r),!0},i.cbc.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var r=e.length(),n=e.at(r-1);return!(n>this.blockSize<<2||(e.truncate(n),0))},i.cfb=function(e){e=e||{},this.name="CFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=n.util.createBuffer(),this._partialBytes=0},i.cfb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=s(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},i.cfb.prototype.encrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var i=0;i<this._ints;++i)this._inBlock[i]=e.getInt32()^this._outBlock[i],t.putInt32(this._inBlock[i]);else{var s=(this.blockSize-n)%this.blockSize;for(s>0&&(s=this.blockSize-s),this._partialOutput.clear(),i=0;i<this._ints;++i)this._partialBlock[i]=e.getInt32()^this._outBlock[i],this._partialOutput.putInt32(this._partialBlock[i]);if(s>0)e.read-=this.blockSize;else for(i=0;i<this._ints;++i)this._inBlock[i]=this._partialBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return t.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}},i.cfb.prototype.decrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var i=0;i<this._ints;++i)this._inBlock[i]=e.getInt32(),t.putInt32(this._inBlock[i]^this._outBlock[i]);else{var s=(this.blockSize-n)%this.blockSize;for(s>0&&(s=this.blockSize-s),this._partialOutput.clear(),i=0;i<this._ints;++i)this._partialBlock[i]=e.getInt32(),this._partialOutput.putInt32(this._partialBlock[i]^this._outBlock[i]);if(s>0)e.read-=this.blockSize;else for(i=0;i<this._ints;++i)this._inBlock[i]=this._partialBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return t.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}},i.ofb=function(e){e=e||{},this.name="OFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=n.util.createBuffer(),this._partialBytes=0},i.ofb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=s(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},i.ofb.prototype.encrypt=function(e,t,r){var n=e.length();if(0===e.length())return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var i=0;i<this._ints;++i)t.putInt32(e.getInt32()^this._outBlock[i]),this._inBlock[i]=this._outBlock[i];else{var s=(this.blockSize-n)%this.blockSize;for(s>0&&(s=this.blockSize-s),this._partialOutput.clear(),i=0;i<this._ints;++i)this._partialOutput.putInt32(e.getInt32()^this._outBlock[i]);if(s>0)e.read-=this.blockSize;else for(i=0;i<this._ints;++i)this._inBlock[i]=this._outBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return t.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}},i.ofb.prototype.decrypt=i.ofb.prototype.encrypt,i.ctr=function(e){e=e||{},this.name="CTR",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=n.util.createBuffer(),this._partialBytes=0},i.ctr.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=s(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},i.ctr.prototype.encrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var i=0;i<this._ints;++i)t.putInt32(e.getInt32()^this._outBlock[i]);else{var s=(this.blockSize-n)%this.blockSize;for(s>0&&(s=this.blockSize-s),this._partialOutput.clear(),i=0;i<this._ints;++i)this._partialOutput.putInt32(e.getInt32()^this._outBlock[i]);if(s>0&&(e.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return t.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}o(this._inBlock)},i.ctr.prototype.decrypt=i.ctr.prototype.encrypt,i.gcm=function(e){e=e||{},this.name="GCM",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=n.util.createBuffer(),this._partialBytes=0,this._R=3774873600},i.gcm.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");var t,r=n.util.createBuffer(e.iv);if(this._cipherLength=0,t="additionalData"in e?n.util.createBuffer(e.additionalData):n.util.createBuffer(),this._tagLength="tagLength"in e?e.tagLength:128,this._tag=null,e.decrypt&&(this._tag=n.util.createBuffer(e.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var i=r.length();if(12===i)this._j0=[r.getInt32(),r.getInt32(),r.getInt32(),1];else{for(this._j0=[0,0,0,0];r.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[r.getInt32(),r.getInt32(),r.getInt32(),r.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(a(8*i)))}this._inBlock=this._j0.slice(0),o(this._inBlock),this._partialBytes=0,t=n.util.createBuffer(t),this._aDataLength=a(8*t.length());var s=t.length()%this.blockSize;for(s&&t.fillWithByte(0,this.blockSize-s),this._s=[0,0,0,0];t.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[t.getInt32(),t.getInt32(),t.getInt32(),t.getInt32()])},i.gcm.prototype.encrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize){for(var i=0;i<this._ints;++i)t.putInt32(this._outBlock[i]^=e.getInt32());this._cipherLength+=this.blockSize}else{var s=(this.blockSize-n)%this.blockSize;for(s>0&&(s=this.blockSize-s),this._partialOutput.clear(),i=0;i<this._ints;++i)this._partialOutput.putInt32(e.getInt32()^this._outBlock[i]);if(s<=0||r){if(r){var a=n%this.blockSize;this._cipherLength+=a,this._partialOutput.truncate(this.blockSize-a)}else this._cipherLength+=this.blockSize;for(i=0;i<this._ints;++i)this._outBlock[i]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return e.read-=this.blockSize,t.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),o(this._inBlock)},i.gcm.prototype.decrypt=function(e,t,r){var n=e.length();if(n<this.blockSize&&!(r&&n>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),o(this._inBlock),this._hashBlock[0]=e.getInt32(),this._hashBlock[1]=e.getInt32(),this._hashBlock[2]=e.getInt32(),this._hashBlock[3]=e.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var i=0;i<this._ints;++i)t.putInt32(this._outBlock[i]^this._hashBlock[i]);n<this.blockSize?this._cipherLength+=n%this.blockSize:this._cipherLength+=this.blockSize},i.gcm.prototype.afterFinish=function(e,t){var r=!0;t.decrypt&&t.overflow&&e.truncate(this.blockSize-t.overflow),this.tag=n.util.createBuffer();var i=this._aDataLength.concat(a(8*this._cipherLength));this._s=this.ghash(this._hashSubkey,this._s,i);var s=[];this.cipher.encrypt(this._j0,s);for(var o=0;o<this._ints;++o)this.tag.putInt32(this._s[o]^s[o]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),t.decrypt&&this.tag.bytes()!==this._tag&&(r=!1),r},i.gcm.prototype.multiply=function(e,t){for(var r=[0,0,0,0],n=t.slice(0),i=0;i<128;++i)e[i/32|0]&1<<31-i%32&&(r[0]^=n[0],r[1]^=n[1],r[2]^=n[2],r[3]^=n[3]),this.pow(n,n);return r},i.gcm.prototype.pow=function(e,t){for(var r=1&e[3],n=3;n>0;--n)t[n]=e[n]>>>1|(1&e[n-1])<<31;t[0]=e[0]>>>1,r&&(t[0]^=this._R)},i.gcm.prototype.tableMultiply=function(e){for(var t=[0,0,0,0],r=0;r<32;++r){var n=e[r/8|0]>>>4*(7-r%8)&15,i=this._m[r][n];t[0]^=i[0],t[1]^=i[1],t[2]^=i[2],t[3]^=i[3]}return t},i.gcm.prototype.ghash=function(e,t,r){return t[0]^=r[0],t[1]^=r[1],t[2]^=r[2],t[3]^=r[3],this.tableMultiply(t)},i.gcm.prototype.generateHashTable=function(e,t){for(var r=8/t,n=4*r,i=16*r,s=new Array(i),o=0;o<i;++o){var a=[0,0,0,0],c=(n-1-o%n)*t;a[o/n|0]=1<<t-1<<c,s[o]=this.generateSubHashTable(this.multiply(a,e),t)}return s},i.gcm.prototype.generateSubHashTable=function(e,t){var r=1<<t,n=r>>>1,i=new Array(r);i[n]=e.slice(0);for(var s=n>>>1;s>0;)this.pow(i[2*s],i[s]=[]),s>>=1;for(s=2;s<n;){for(var o=1;o<s;++o){var a=i[s],c=i[o];i[s+o]=[a[0]^c[0],a[1]^c[1],a[2]^c[2],a[3]^c[3]]}s*=2}for(i[0]=[0,0,0,0],s=n+1;s<r;++s){var l=i[s^n];i[s]=[e[0]^l[0],e[1]^l[1],e[2]^l[2],e[3]^l[3]]}return i}},3480:(e,t,r)=>{var n=r(3832);function i(e,t){n.cipher.registerAlgorithm(e,(function(){return new n.des.Algorithm(e,t)}))}r(5649),r(1967),r(7116),e.exports=n.des=n.des||{},n.des.startEncrypting=function(e,t,r,n){var i=f({key:e,output:r,decrypt:!1,mode:n||(null===t?"ECB":"CBC")});return i.start(t),i},n.des.createEncryptionCipher=function(e,t){return f({key:e,output:null,decrypt:!1,mode:t})},n.des.startDecrypting=function(e,t,r,n){var i=f({key:e,output:r,decrypt:!0,mode:n||(null===t?"ECB":"CBC")});return i.start(t),i},n.des.createDecryptionCipher=function(e,t){return f({key:e,output:null,decrypt:!0,mode:t})},n.des.Algorithm=function(e,t){var r=this;r.name=e,r.mode=new t({blockSize:8,cipher:{encrypt:function(e,t){return p(r._keys,e,t,!1)},decrypt:function(e,t){return p(r._keys,e,t,!0)}}}),r._init=!1},n.des.Algorithm.prototype.initialize=function(e){if(!this._init){var t=n.util.createBuffer(e.key);if(0===this.name.indexOf("3DES")&&24!==t.length())throw new Error("Invalid Triple-DES key size: "+8*t.length());this._keys=function(e){for(var t,r=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],n=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],i=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],s=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],o=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],a=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],c=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],l=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],u=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],h=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],d=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],p=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],f=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],y=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],g=e.length()>8?3:1,m=[],w=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],E=0,b=0;b<g;b++){var v=e.getInt32(),_=e.getInt32();v^=(t=252645135&(v>>>4^_))<<4,v^=t=65535&((_^=t)>>>-16^v),v^=(t=858993459&(v>>>2^(_^=t<<-16)))<<2,v^=t=65535&((_^=t)>>>-16^v),v^=(t=1431655765&(v>>>1^(_^=t<<-16)))<<1,v^=t=16711935&((_^=t)>>>8^v),t=(v^=(t=1431655765&(v>>>1^(_^=t<<8)))<<1)<<8|(_^=t)>>>20&240,v=_<<24|_<<8&16711680|_>>>8&65280|_>>>24&240,_=t;for(var S=0;S<w.length;++S){w[S]?(v=v<<2|v>>>26,_=_<<2|_>>>26):(v=v<<1|v>>>27,_=_<<1|_>>>27);var C=r[(v&=-15)>>>28]|n[v>>>24&15]|i[v>>>20&15]|s[v>>>16&15]|o[v>>>12&15]|a[v>>>8&15]|c[v>>>4&15],A=l[(_&=-15)>>>28]|u[_>>>24&15]|h[_>>>20&15]|d[_>>>16&15]|p[_>>>12&15]|f[_>>>8&15]|y[_>>>4&15];t=65535&(A>>>16^C),m[E++]=C^t,m[E++]=A^t<<16}}return m}(t),this._init=!0}},i("DES-ECB",n.cipher.modes.ecb),i("DES-CBC",n.cipher.modes.cbc),i("DES-CFB",n.cipher.modes.cfb),i("DES-OFB",n.cipher.modes.ofb),i("DES-CTR",n.cipher.modes.ctr),i("3DES-ECB",n.cipher.modes.ecb),i("3DES-CBC",n.cipher.modes.cbc),i("3DES-CFB",n.cipher.modes.cfb),i("3DES-OFB",n.cipher.modes.ofb),i("3DES-CTR",n.cipher.modes.ctr);var s=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],o=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],a=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],c=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],l=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],u=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],h=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],d=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function p(e,t,r,n){var i,p,f=32===e.length?3:9;i=3===f?n?[30,-2,-2]:[0,32,2]:n?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var y=t[0],g=t[1];y^=(p=252645135&(y>>>4^g))<<4,y^=(p=65535&(y>>>16^(g^=p)))<<16,y^=p=858993459&((g^=p)>>>2^y),y^=p=16711935&((g^=p<<2)>>>8^y),y=(y^=(p=1431655765&(y>>>1^(g^=p<<8)))<<1)<<1|y>>>31,g=(g^=p)<<1|g>>>31;for(var m=0;m<f;m+=3){for(var w=i[m+1],E=i[m+2],b=i[m];b!=w;b+=E){var v=g^e[b],_=(g>>>4|g<<28)^e[b+1];p=y,y=g,g=p^(o[v>>>24&63]|c[v>>>16&63]|u[v>>>8&63]|d[63&v]|s[_>>>24&63]|a[_>>>16&63]|l[_>>>8&63]|h[63&_])}p=y,y=g,g=p}g=g>>>1|g<<31,g^=p=1431655765&((y=y>>>1|y<<31)>>>1^g),g^=(p=16711935&(g>>>8^(y^=p<<1)))<<8,g^=(p=858993459&(g>>>2^(y^=p)))<<2,g^=p=65535&((y^=p)>>>16^g),g^=p=252645135&((y^=p<<16)>>>4^g),y^=p<<4,r[0]=y,r[1]=g}function f(e){var t,r="DES-"+((e=e||{}).mode||"CBC").toUpperCase(),i=(t=e.decrypt?n.cipher.createDecipher(r,e.key):n.cipher.createCipher(r,e.key)).start;return t.start=function(e,r){var s=null;r instanceof n.util.ByteBuffer&&(s=r,r={}),(r=r||{}).output=s,r.iv=e,i.call(t,r)},t}},3832:e=>{e.exports={options:{usePureJavaScript:!1}}},6607:(e,t,r)=>{var n=r(3832);r(8991),r(7116),(e.exports=n.hmac=n.hmac||{}).create=function(){var e=null,t=null,r=null,i=null,s={start:function(s,o){if(null!==s)if("string"==typeof s){if(!((s=s.toLowerCase())in n.md.algorithms))throw new Error('Unknown hash algorithm "'+s+'"');t=n.md.algorithms[s].create()}else t=s;if(null===o)o=e;else{if("string"==typeof o)o=n.util.createBuffer(o);else if(n.util.isArray(o)){var a=o;o=n.util.createBuffer();for(var c=0;c<a.length;++c)o.putByte(a[c])}var l=o.length();for(l>t.blockLength&&(t.start(),t.update(o.bytes()),o=t.digest()),r=n.util.createBuffer(),i=n.util.createBuffer(),l=o.length(),c=0;c<l;++c)a=o.at(c),r.putByte(54^a),i.putByte(92^a);if(l<t.blockLength)for(a=t.blockLength-l,c=0;c<a;++c)r.putByte(54),i.putByte(92);e=o,r=r.bytes(),i=i.bytes()}t.start(),t.update(r)},update:function(e){t.update(e)},getMac:function(){var e=t.digest().bytes();return t.start(),t.update(i),t.update(e),t.digest()}};return s.digest=s.getMac,s}},5764:(e,t,r)=>{var n,i=r(3832);function s(e,t,r){this.data=[],null!=e&&("number"==typeof e?this.fromNumber(e,t,r):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function o(){return new s(null)}function a(e,t,r,n,i,s){for(var o=16383&t,a=t>>14;--s>=0;){var c=16383&this.data[e],l=this.data[e++]>>14,u=a*c+l*o;i=((c=o*c+((16383&u)<<14)+r.data[n]+i)>>28)+(u>>14)+a*l,r.data[n++]=268435455&c}return i}e.exports=i.jsbn=i.jsbn||{},i.jsbn.BigInteger=s,"undefined"==typeof navigator?(s.prototype.am=a,n=28):"Microsoft Internet Explorer"==navigator.appName?(s.prototype.am=function(e,t,r,n,i,s){for(var o=32767&t,a=t>>15;--s>=0;){var c=32767&this.data[e],l=this.data[e++]>>15,u=a*c+l*o;i=((c=o*c+((32767&u)<<15)+r.data[n]+(1073741823&i))>>>30)+(u>>>15)+a*l+(i>>>30),r.data[n++]=1073741823&c}return i},n=30):"Netscape"!=navigator.appName?(s.prototype.am=function(e,t,r,n,i,s){for(;--s>=0;){var o=t*this.data[e++]+r.data[n]+i;i=Math.floor(o/67108864),r.data[n++]=67108863&o}return i},n=26):(s.prototype.am=a,n=28),s.prototype.DB=n,s.prototype.DM=(1<<n)-1,s.prototype.DV=1<<n,s.prototype.FV=Math.pow(2,52),s.prototype.F1=52-n,s.prototype.F2=2*n-52;var c,l,u="0123456789abcdefghijklmnopqrstuvwxyz",h=new Array;for(c="0".charCodeAt(0),l=0;l<=9;++l)h[c++]=l;for(c="a".charCodeAt(0),l=10;l<36;++l)h[c++]=l;for(c="A".charCodeAt(0),l=10;l<36;++l)h[c++]=l;function d(e){return u.charAt(e)}function p(e,t){var r=h[e.charCodeAt(t)];return null==r?-1:r}function f(e){var t=o();return t.fromInt(e),t}function y(e){var t,r=1;return 0!=(t=e>>>16)&&(e=t,r+=16),0!=(t=e>>8)&&(e=t,r+=8),0!=(t=e>>4)&&(e=t,r+=4),0!=(t=e>>2)&&(e=t,r+=2),0!=(t=e>>1)&&(e=t,r+=1),r}function g(e){this.m=e}function m(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function w(e,t){return e&t}function E(e,t){return e|t}function b(e,t){return e^t}function v(e,t){return e&~t}function _(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function S(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function C(){}function A(e){return e}function I(e){this.r2=o(),this.q3=o(),s.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}g.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},g.prototype.revert=function(e){return e},g.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},g.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},g.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},m.prototype.convert=function(e){var t=o();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(s.ZERO)>0&&this.m.subTo(t,t),t},m.prototype.revert=function(e){var t=o();return e.copyTo(t),this.reduce(t),t},m.prototype.reduce=function(e){for(;e.t<=this.mt2;)e.data[e.t++]=0;for(var t=0;t<this.m.t;++t){var r=32767&e.data[t],n=r*this.mpl+((r*this.mph+(e.data[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(r=t+this.m.t,e.data[r]+=this.m.am(0,n,e,t,0,this.m.t);e.data[r]>=e.DV;)e.data[r]-=e.DV,e.data[++r]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},m.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},m.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},s.prototype.copyTo=function(e){for(var t=this.t-1;t>=0;--t)e.data[t]=this.data[t];e.t=this.t,e.s=this.s},s.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this.data[0]=e:e<-1?this.data[0]=e+this.DV:this.t=0},s.prototype.fromString=function(e,t){var r;if(16==t)r=4;else if(8==t)r=3;else if(256==t)r=8;else if(2==t)r=1;else if(32==t)r=5;else{if(4!=t)return void this.fromRadix(e,t);r=2}this.t=0,this.s=0;for(var n=e.length,i=!1,o=0;--n>=0;){var a=8==r?255&e[n]:p(e,n);a<0?"-"==e.charAt(n)&&(i=!0):(i=!1,0==o?this.data[this.t++]=a:o+r>this.DB?(this.data[this.t-1]|=(a&(1<<this.DB-o)-1)<<o,this.data[this.t++]=a>>this.DB-o):this.data[this.t-1]|=a<<o,(o+=r)>=this.DB&&(o-=this.DB))}8==r&&0!=(128&e[0])&&(this.s=-1,o>0&&(this.data[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),i&&s.ZERO.subTo(this,this)},s.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this.data[this.t-1]==e;)--this.t},s.prototype.dlShiftTo=function(e,t){var r;for(r=this.t-1;r>=0;--r)t.data[r+e]=this.data[r];for(r=e-1;r>=0;--r)t.data[r]=0;t.t=this.t+e,t.s=this.s},s.prototype.drShiftTo=function(e,t){for(var r=e;r<this.t;++r)t.data[r-e]=this.data[r];t.t=Math.max(this.t-e,0),t.s=this.s},s.prototype.lShiftTo=function(e,t){var r,n=e%this.DB,i=this.DB-n,s=(1<<i)-1,o=Math.floor(e/this.DB),a=this.s<<n&this.DM;for(r=this.t-1;r>=0;--r)t.data[r+o+1]=this.data[r]>>i|a,a=(this.data[r]&s)<<n;for(r=o-1;r>=0;--r)t.data[r]=0;t.data[o]=a,t.t=this.t+o+1,t.s=this.s,t.clamp()},s.prototype.rShiftTo=function(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t)t.t=0;else{var n=e%this.DB,i=this.DB-n,s=(1<<n)-1;t.data[0]=this.data[r]>>n;for(var o=r+1;o<this.t;++o)t.data[o-r-1]|=(this.data[o]&s)<<i,t.data[o-r]=this.data[o]>>n;n>0&&(t.data[this.t-r-1]|=(this.s&s)<<i),t.t=this.t-r,t.clamp()}},s.prototype.subTo=function(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;)n+=this.data[r]-e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n-=e.s;r<this.t;)n+=this.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n-=e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n-=e.s}t.s=n<0?-1:0,n<-1?t.data[r++]=this.DV+n:n>0&&(t.data[r++]=n),t.t=r,t.clamp()},s.prototype.multiplyTo=function(e,t){var r=this.abs(),n=e.abs(),i=r.t;for(t.t=i+n.t;--i>=0;)t.data[i]=0;for(i=0;i<n.t;++i)t.data[i+r.t]=r.am(0,n.data[i],t,i,0,r.t);t.s=0,t.clamp(),this.s!=e.s&&s.ZERO.subTo(t,t)},s.prototype.squareTo=function(e){for(var t=this.abs(),r=e.t=2*t.t;--r>=0;)e.data[r]=0;for(r=0;r<t.t-1;++r){var n=t.am(r,t.data[r],e,2*r,0,1);(e.data[r+t.t]+=t.am(r+1,2*t.data[r],e,2*r+1,n,t.t-r-1))>=t.DV&&(e.data[r+t.t]-=t.DV,e.data[r+t.t+1]=1)}e.t>0&&(e.data[e.t-1]+=t.am(r,t.data[r],e,2*r,0,1)),e.s=0,e.clamp()},s.prototype.divRemTo=function(e,t,r){var n=e.abs();if(!(n.t<=0)){var i=this.abs();if(i.t<n.t)return null!=t&&t.fromInt(0),void(null!=r&&this.copyTo(r));null==r&&(r=o());var a=o(),c=this.s,l=e.s,u=this.DB-y(n.data[n.t-1]);u>0?(n.lShiftTo(u,a),i.lShiftTo(u,r)):(n.copyTo(a),i.copyTo(r));var h=a.t,d=a.data[h-1];if(0!=d){var p=d*(1<<this.F1)+(h>1?a.data[h-2]>>this.F2:0),f=this.FV/p,g=(1<<this.F1)/p,m=1<<this.F2,w=r.t,E=w-h,b=null==t?o():t;for(a.dlShiftTo(E,b),r.compareTo(b)>=0&&(r.data[r.t++]=1,r.subTo(b,r)),s.ONE.dlShiftTo(h,b),b.subTo(a,a);a.t<h;)a.data[a.t++]=0;for(;--E>=0;){var v=r.data[--w]==d?this.DM:Math.floor(r.data[w]*f+(r.data[w-1]+m)*g);if((r.data[w]+=a.am(0,v,r,E,0,h))<v)for(a.dlShiftTo(E,b),r.subTo(b,r);r.data[w]<--v;)r.subTo(b,r)}null!=t&&(r.drShiftTo(h,t),c!=l&&s.ZERO.subTo(t,t)),r.t=h,r.clamp(),u>0&&r.rShiftTo(u,r),c<0&&s.ZERO.subTo(r,r)}}},s.prototype.invDigit=function(){if(this.t<1)return 0;var e=this.data[0];if(0==(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t},s.prototype.isEven=function(){return 0==(this.t>0?1&this.data[0]:this.s)},s.prototype.exp=function(e,t){if(e>4294967295||e<1)return s.ONE;var r=o(),n=o(),i=t.convert(this),a=y(e)-1;for(i.copyTo(r);--a>=0;)if(t.sqrTo(r,n),(e&1<<a)>0)t.mulTo(n,i,r);else{var c=r;r=n,n=c}return t.revert(r)},s.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var r,n=(1<<t)-1,i=!1,s="",o=this.t,a=this.DB-o*this.DB%t;if(o-- >0)for(a<this.DB&&(r=this.data[o]>>a)>0&&(i=!0,s=d(r));o>=0;)a<t?(r=(this.data[o]&(1<<a)-1)<<t-a,r|=this.data[--o]>>(a+=this.DB-t)):(r=this.data[o]>>(a-=t)&n,a<=0&&(a+=this.DB,--o)),r>0&&(i=!0),i&&(s+=d(r));return i?s:"0"},s.prototype.negate=function(){var e=o();return s.ZERO.subTo(this,e),e},s.prototype.abs=function(){return this.s<0?this.negate():this},s.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var r=this.t;if(0!=(t=r-e.t))return this.s<0?-t:t;for(;--r>=0;)if(0!=(t=this.data[r]-e.data[r]))return t;return 0},s.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+y(this.data[this.t-1]^this.s&this.DM)},s.prototype.mod=function(e){var t=o();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(s.ZERO)>0&&e.subTo(t,t),t},s.prototype.modPowInt=function(e,t){var r;return r=e<256||t.isEven()?new g(t):new m(t),this.exp(e,r)},s.ZERO=f(0),s.ONE=f(1),C.prototype.convert=A,C.prototype.revert=A,C.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r)},C.prototype.sqrTo=function(e,t){e.squareTo(t)},I.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=o();return e.copyTo(t),this.reduce(t),t},I.prototype.revert=function(e){return e},I.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},I.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},I.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var T=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],R=(1<<26)/T[T.length-1];s.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},s.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),r=Math.pow(e,t),n=f(r),i=o(),s=o(),a="";for(this.divRemTo(n,i,s);i.signum()>0;)a=(r+s.intValue()).toString(e).substr(1)+a,i.divRemTo(n,i,s);return s.intValue().toString(e)+a},s.prototype.fromRadix=function(e,t){this.fromInt(0),null==t&&(t=10);for(var r=this.chunkSize(t),n=Math.pow(t,r),i=!1,o=0,a=0,c=0;c<e.length;++c){var l=p(e,c);l<0?"-"==e.charAt(c)&&0==this.signum()&&(i=!0):(a=t*a+l,++o>=r&&(this.dMultiply(n),this.dAddOffset(a,0),o=0,a=0))}o>0&&(this.dMultiply(Math.pow(t,o)),this.dAddOffset(a,0)),i&&s.ZERO.subTo(this,this)},s.prototype.fromNumber=function(e,t,r){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,r),this.testBit(e-1)||this.bitwiseTo(s.ONE.shiftLeft(e-1),E,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(s.ONE.shiftLeft(e-1),this);else{var n=new Array,i=7&e;n.length=1+(e>>3),t.nextBytes(n),i>0?n[0]&=(1<<i)-1:n[0]=0,this.fromString(n,256)}},s.prototype.bitwiseTo=function(e,t,r){var n,i,s=Math.min(e.t,this.t);for(n=0;n<s;++n)r.data[n]=t(this.data[n],e.data[n]);if(e.t<this.t){for(i=e.s&this.DM,n=s;n<this.t;++n)r.data[n]=t(this.data[n],i);r.t=this.t}else{for(i=this.s&this.DM,n=s;n<e.t;++n)r.data[n]=t(i,e.data[n]);r.t=e.t}r.s=t(this.s,e.s),r.clamp()},s.prototype.changeBit=function(e,t){var r=s.ONE.shiftLeft(e);return this.bitwiseTo(r,t,r),r},s.prototype.addTo=function(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;)n+=this.data[r]+e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n+=e.s;r<this.t;)n+=this.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n+=e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n+=e.s}t.s=n<0?-1:0,n>0?t.data[r++]=n:n<-1&&(t.data[r++]=this.DV+n),t.t=r,t.clamp()},s.prototype.dMultiply=function(e){this.data[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},s.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this.data[this.t++]=0;for(this.data[t]+=e;this.data[t]>=this.DV;)this.data[t]-=this.DV,++t>=this.t&&(this.data[this.t++]=0),++this.data[t]}},s.prototype.multiplyLowerTo=function(e,t,r){var n,i=Math.min(this.t+e.t,t);for(r.s=0,r.t=i;i>0;)r.data[--i]=0;for(n=r.t-this.t;i<n;++i)r.data[i+this.t]=this.am(0,e.data[i],r,i,0,this.t);for(n=Math.min(e.t,t);i<n;++i)this.am(0,e.data[i],r,i,0,t-i);r.clamp()},s.prototype.multiplyUpperTo=function(e,t,r){--t;var n=r.t=this.t+e.t-t;for(r.s=0;--n>=0;)r.data[n]=0;for(n=Math.max(t-this.t,0);n<e.t;++n)r.data[this.t+n-t]=this.am(t-n,e.data[n],r,0,0,this.t+n-t);r.clamp(),r.drShiftTo(1,r)},s.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,r=this.s<0?e-1:0;if(this.t>0)if(0==t)r=this.data[0]%e;else for(var n=this.t-1;n>=0;--n)r=(t*r+this.data[n])%e;return r},s.prototype.millerRabin=function(e){var t=this.subtract(s.ONE),r=t.getLowestSetBit();if(r<=0)return!1;for(var n,i=t.shiftRight(r),o={nextBytes:function(e){for(var t=0;t<e.length;++t)e[t]=Math.floor(256*Math.random())}},a=0;a<e;++a){do{n=new s(this.bitLength(),o)}while(n.compareTo(s.ONE)<=0||n.compareTo(t)>=0);var c=n.modPow(i,this);if(0!=c.compareTo(s.ONE)&&0!=c.compareTo(t)){for(var l=1;l++<r&&0!=c.compareTo(t);)if(0==(c=c.modPowInt(2,this)).compareTo(s.ONE))return!1;if(0!=c.compareTo(t))return!1}}return!0},s.prototype.clone=function(){var e=o();return this.copyTo(e),e},s.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this.data[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this.data[0];if(0==this.t)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]},s.prototype.byteValue=function(){return 0==this.t?this.s:this.data[0]<<24>>24},s.prototype.shortValue=function(){return 0==this.t?this.s:this.data[0]<<16>>16},s.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this.data[0]<=0?0:1},s.prototype.toByteArray=function(){var e=this.t,t=new Array;t[0]=this.s;var r,n=this.DB-e*this.DB%8,i=0;if(e-- >0)for(n<this.DB&&(r=this.data[e]>>n)!=(this.s&this.DM)>>n&&(t[i++]=r|this.s<<this.DB-n);e>=0;)n<8?(r=(this.data[e]&(1<<n)-1)<<8-n,r|=this.data[--e]>>(n+=this.DB-8)):(r=this.data[e]>>(n-=8)&255,n<=0&&(n+=this.DB,--e)),0!=(128&r)&&(r|=-256),0==i&&(128&this.s)!=(128&r)&&++i,(i>0||r!=this.s)&&(t[i++]=r);return t},s.prototype.equals=function(e){return 0==this.compareTo(e)},s.prototype.min=function(e){return this.compareTo(e)<0?this:e},s.prototype.max=function(e){return this.compareTo(e)>0?this:e},s.prototype.and=function(e){var t=o();return this.bitwiseTo(e,w,t),t},s.prototype.or=function(e){var t=o();return this.bitwiseTo(e,E,t),t},s.prototype.xor=function(e){var t=o();return this.bitwiseTo(e,b,t),t},s.prototype.andNot=function(e){var t=o();return this.bitwiseTo(e,v,t),t},s.prototype.not=function(){for(var e=o(),t=0;t<this.t;++t)e.data[t]=this.DM&~this.data[t];return e.t=this.t,e.s=~this.s,e},s.prototype.shiftLeft=function(e){var t=o();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},s.prototype.shiftRight=function(e){var t=o();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},s.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this.data[e])return e*this.DB+_(this.data[e]);return this.s<0?this.t*this.DB:-1},s.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,r=0;r<this.t;++r)e+=S(this.data[r]^t);return e},s.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this.data[t]&1<<e%this.DB)},s.prototype.setBit=function(e){return this.changeBit(e,E)},s.prototype.clearBit=function(e){return this.changeBit(e,v)},s.prototype.flipBit=function(e){return this.changeBit(e,b)},s.prototype.add=function(e){var t=o();return this.addTo(e,t),t},s.prototype.subtract=function(e){var t=o();return this.subTo(e,t),t},s.prototype.multiply=function(e){var t=o();return this.multiplyTo(e,t),t},s.prototype.divide=function(e){var t=o();return this.divRemTo(e,t,null),t},s.prototype.remainder=function(e){var t=o();return this.divRemTo(e,null,t),t},s.prototype.divideAndRemainder=function(e){var t=o(),r=o();return this.divRemTo(e,t,r),new Array(t,r)},s.prototype.modPow=function(e,t){var r,n,i=e.bitLength(),s=f(1);if(i<=0)return s;r=i<18?1:i<48?3:i<144?4:i<768?5:6,n=i<8?new g(t):t.isEven()?new I(t):new m(t);var a=new Array,c=3,l=r-1,u=(1<<r)-1;if(a[1]=n.convert(this),r>1){var h=o();for(n.sqrTo(a[1],h);c<=u;)a[c]=o(),n.mulTo(h,a[c-2],a[c]),c+=2}var d,p,w=e.t-1,E=!0,b=o();for(i=y(e.data[w])-1;w>=0;){for(i>=l?d=e.data[w]>>i-l&u:(d=(e.data[w]&(1<<i+1)-1)<<l-i,w>0&&(d|=e.data[w-1]>>this.DB+i-l)),c=r;0==(1&d);)d>>=1,--c;if((i-=c)<0&&(i+=this.DB,--w),E)a[d].copyTo(s),E=!1;else{for(;c>1;)n.sqrTo(s,b),n.sqrTo(b,s),c-=2;c>0?n.sqrTo(s,b):(p=s,s=b,b=p),n.mulTo(b,a[d],s)}for(;w>=0&&0==(e.data[w]&1<<i);)n.sqrTo(s,b),p=s,s=b,b=p,--i<0&&(i=this.DB-1,--w)}return n.revert(s)},s.prototype.modInverse=function(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return s.ZERO;for(var r=e.clone(),n=this.clone(),i=f(1),o=f(0),a=f(0),c=f(1);0!=r.signum();){for(;r.isEven();)r.rShiftTo(1,r),t?(i.isEven()&&o.isEven()||(i.addTo(this,i),o.subTo(e,o)),i.rShiftTo(1,i)):o.isEven()||o.subTo(e,o),o.rShiftTo(1,o);for(;n.isEven();)n.rShiftTo(1,n),t?(a.isEven()&&c.isEven()||(a.addTo(this,a),c.subTo(e,c)),a.rShiftTo(1,a)):c.isEven()||c.subTo(e,c),c.rShiftTo(1,c);r.compareTo(n)>=0?(r.subTo(n,r),t&&i.subTo(a,i),o.subTo(c,o)):(n.subTo(r,n),t&&a.subTo(i,a),c.subTo(o,c))}return 0!=n.compareTo(s.ONE)?s.ZERO:c.compareTo(e)>=0?c.subtract(e):c.signum()<0?(c.addTo(e,c),c.signum()<0?c.add(e):c):c},s.prototype.pow=function(e){return this.exp(e,new C)},s.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),r=e.s<0?e.negate():e.clone();if(t.compareTo(r)<0){var n=t;t=r,r=n}var i=t.getLowestSetBit(),s=r.getLowestSetBit();if(s<0)return t;for(i<s&&(s=i),s>0&&(t.rShiftTo(s,t),r.rShiftTo(s,r));t.signum()>0;)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=r.getLowestSetBit())>0&&r.rShiftTo(i,r),t.compareTo(r)>=0?(t.subTo(r,t),t.rShiftTo(1,t)):(r.subTo(t,r),r.rShiftTo(1,r));return s>0&&r.lShiftTo(s,r),r},s.prototype.isProbablePrime=function(e){var t,r=this.abs();if(1==r.t&&r.data[0]<=T[T.length-1]){for(t=0;t<T.length;++t)if(r.data[0]==T[t])return!0;return!1}if(r.isEven())return!1;for(t=1;t<T.length;){for(var n=T[t],i=t+1;i<T.length&&n<R;)n*=T[i++];for(n=r.modInt(n);t<i;)if(n%T[t++]==0)return!1}return r.millerRabin(e)}},8991:(e,t,r)=>{var n=r(3832);e.exports=n.md=n.md||{},n.md.algorithms=n.md.algorithms||{}},6971:(e,t,r)=>{var n=r(3832);r(3453),e.exports=n.mgf=n.mgf||{},n.mgf.mgf1=n.mgf1},3453:(e,t,r)=>{var n=r(3832);r(7116),n.mgf=n.mgf||{},(e.exports=n.mgf.mgf1=n.mgf1=n.mgf1||{}).create=function(e){return{generate:function(t,r){for(var i=new n.util.ByteBuffer,s=Math.ceil(r/e.digestLength),o=0;o<s;o++){var a=new n.util.ByteBuffer;a.putInt32(o),e.start(),e.update(t+a.getBytes()),i.putBuffer(e.digest())}return i.truncate(i.length()-r),i.getBytes()}}}},6270:(e,t,r)=>{var n=r(3832);n.pki=n.pki||{};var i=e.exports=n.pki.oids=n.oids=n.oids||{};function s(e,t){i[e]=t,i[t]=e}function o(e,t){i[e]=t}s("1.2.840.113549.1.1.1","rsaEncryption"),s("1.2.840.113549.1.1.4","md5WithRSAEncryption"),s("1.2.840.113549.1.1.5","sha1WithRSAEncryption"),s("1.2.840.113549.1.1.7","RSAES-OAEP"),s("1.2.840.113549.1.1.8","mgf1"),s("1.2.840.113549.1.1.9","pSpecified"),s("1.2.840.113549.1.1.10","RSASSA-PSS"),s("1.2.840.113549.1.1.11","sha256WithRSAEncryption"),s("1.2.840.113549.1.1.12","sha384WithRSAEncryption"),s("1.2.840.113549.1.1.13","sha512WithRSAEncryption"),s("1.3.101.112","EdDSA25519"),s("1.2.840.10040.4.3","dsa-with-sha1"),s("1.3.14.3.2.7","desCBC"),s("1.3.14.3.2.26","sha1"),s("1.3.14.3.2.29","sha1WithRSASignature"),s("2.16.840.1.101.3.4.2.1","sha256"),s("2.16.840.1.101.3.4.2.2","sha384"),s("2.16.840.1.101.3.4.2.3","sha512"),s("2.16.840.1.101.3.4.2.4","sha224"),s("2.16.840.1.101.3.4.2.5","sha512-224"),s("2.16.840.1.101.3.4.2.6","sha512-256"),s("1.2.840.113549.2.2","md2"),s("1.2.840.113549.2.5","md5"),s("1.2.840.113549.1.7.1","data"),s("1.2.840.113549.1.7.2","signedData"),s("1.2.840.113549.1.7.3","envelopedData"),s("1.2.840.113549.1.7.4","signedAndEnvelopedData"),s("1.2.840.113549.1.7.5","digestedData"),s("1.2.840.113549.1.7.6","encryptedData"),s("1.2.840.113549.1.9.1","emailAddress"),s("1.2.840.113549.1.9.2","unstructuredName"),s("1.2.840.113549.1.9.3","contentType"),s("1.2.840.113549.1.9.4","messageDigest"),s("1.2.840.113549.1.9.5","signingTime"),s("1.2.840.113549.1.9.6","counterSignature"),s("1.2.840.113549.1.9.7","challengePassword"),s("1.2.840.113549.1.9.8","unstructuredAddress"),s("1.2.840.113549.1.9.14","extensionRequest"),s("1.2.840.113549.1.9.20","friendlyName"),s("1.2.840.113549.1.9.21","localKeyId"),s("1.2.840.113549.1.9.22.1","x509Certificate"),s("1.2.840.113549.1.12.10.1.1","keyBag"),s("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag"),s("1.2.840.113549.1.12.10.1.3","certBag"),s("1.2.840.113549.1.12.10.1.4","crlBag"),s("1.2.840.113549.1.12.10.1.5","secretBag"),s("1.2.840.113549.1.12.10.1.6","safeContentsBag"),s("1.2.840.113549.1.5.13","pkcs5PBES2"),s("1.2.840.113549.1.5.12","pkcs5PBKDF2"),s("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4"),s("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4"),s("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC"),s("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC"),s("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC"),s("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC"),s("1.2.840.113549.2.7","hmacWithSHA1"),s("1.2.840.113549.2.8","hmacWithSHA224"),s("1.2.840.113549.2.9","hmacWithSHA256"),s("1.2.840.113549.2.10","hmacWithSHA384"),s("1.2.840.113549.2.11","hmacWithSHA512"),s("1.2.840.113549.3.7","des-EDE3-CBC"),s("2.16.840.1.101.3.4.1.2","aes128-CBC"),s("2.16.840.1.101.3.4.1.22","aes192-CBC"),s("2.16.840.1.101.3.4.1.42","aes256-CBC"),s("2.5.4.3","commonName"),s("2.5.4.4","surname"),s("2.5.4.5","serialNumber"),s("2.5.4.6","countryName"),s("2.5.4.7","localityName"),s("2.5.4.8","stateOrProvinceName"),s("2.5.4.9","streetAddress"),s("2.5.4.10","organizationName"),s("2.5.4.11","organizationalUnitName"),s("2.5.4.12","title"),s("2.5.4.13","description"),s("2.5.4.15","businessCategory"),s("2.5.4.17","postalCode"),s("2.5.4.42","givenName"),s("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName"),s("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName"),s("2.16.840.1.113730.1.1","nsCertType"),s("2.16.840.1.113730.1.13","nsComment"),o("2.5.29.1","authorityKeyIdentifier"),o("2.5.29.2","keyAttributes"),o("2.5.29.3","certificatePolicies"),o("2.5.29.4","keyUsageRestriction"),o("2.5.29.5","policyMapping"),o("2.5.29.6","subtreesConstraint"),o("2.5.29.7","subjectAltName"),o("2.5.29.8","issuerAltName"),o("2.5.29.9","subjectDirectoryAttributes"),o("2.5.29.10","basicConstraints"),o("2.5.29.11","nameConstraints"),o("2.5.29.12","policyConstraints"),o("2.5.29.13","basicConstraints"),s("2.5.29.14","subjectKeyIdentifier"),s("2.5.29.15","keyUsage"),o("2.5.29.16","privateKeyUsagePeriod"),s("2.5.29.17","subjectAltName"),s("2.5.29.18","issuerAltName"),s("2.5.29.19","basicConstraints"),o("2.5.29.20","cRLNumber"),o("2.5.29.21","cRLReason"),o("2.5.29.22","expirationDate"),o("2.5.29.23","instructionCode"),o("2.5.29.24","invalidityDate"),o("2.5.29.25","cRLDistributionPoints"),o("2.5.29.26","issuingDistributionPoint"),o("2.5.29.27","deltaCRLIndicator"),o("2.5.29.28","issuingDistributionPoint"),o("2.5.29.29","certificateIssuer"),o("2.5.29.30","nameConstraints"),s("2.5.29.31","cRLDistributionPoints"),s("2.5.29.32","certificatePolicies"),o("2.5.29.33","policyMappings"),o("2.5.29.34","policyConstraints"),s("2.5.29.35","authorityKeyIdentifier"),o("2.5.29.36","policyConstraints"),s("2.5.29.37","extKeyUsage"),o("2.5.29.46","freshestCRL"),o("2.5.29.54","inhibitAnyPolicy"),s("1.3.6.1.4.1.11129.2.4.2","timestampList"),s("1.3.6.1.5.5.7.1.1","authorityInfoAccess"),s("1.3.6.1.5.5.7.3.1","serverAuth"),s("1.3.6.1.5.5.7.3.2","clientAuth"),s("1.3.6.1.5.5.7.3.3","codeSigning"),s("1.3.6.1.5.5.7.3.4","emailProtection"),s("1.3.6.1.5.5.7.3.8","timeStamping")},7450:(e,t,r)=>{var n=r(3832);if(r(8925),r(3068),r(3480),r(8991),r(6270),r(8960),r(6953),r(9563),r(9372),r(8095),r(7116),void 0===i)var i=n.jsbn.BigInteger;var s=n.asn1,o=n.pki=n.pki||{};e.exports=o.pbe=n.pbe=n.pbe||{};var a=o.oids,c={name:"EncryptedPrivateKeyInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:s.Class.UNIVERSAL,type:s.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},l={name:"PBES2Algorithms",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:s.Class.UNIVERSAL,type:s.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:s.Class.UNIVERSAL,type:s.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},u={name:"pkcs-12PbeParams",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:s.Class.UNIVERSAL,type:s.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"iterations"}]};function h(e,t){return e.start().update(t).digest().getBytes()}function d(e){var t;if(e){if(!(t=o.oids[s.derToOid(e)])){var r=new Error("Unsupported PRF OID.");throw r.oid=e,r.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],r}}else t="hmacWithSHA1";return p(t)}function p(e){var t=n.md;switch(e){case"hmacWithSHA224":t=n.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":e=e.substr(8).toLowerCase();break;default:var r=new Error("Unsupported PRF algorithm.");throw r.algorithm=e,r.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],r}if(!t||!(e in t))throw new Error("Unknown hash algorithm: "+e);return t[e].create()}o.encryptPrivateKeyInfo=function(e,t,r){(r=r||{}).saltSize=r.saltSize||8,r.count=r.count||2048,r.algorithm=r.algorithm||"aes128",r.prfAlgorithm=r.prfAlgorithm||"sha1";var i,c,l,u=n.random.getBytesSync(r.saltSize),h=r.count,d=s.integerToDer(h);if(0===r.algorithm.indexOf("aes")||"des"===r.algorithm){var f,y,g;switch(r.algorithm){case"aes128":i=16,f=16,y=a["aes128-CBC"],g=n.aes.createEncryptionCipher;break;case"aes192":i=24,f=16,y=a["aes192-CBC"],g=n.aes.createEncryptionCipher;break;case"aes256":i=32,f=16,y=a["aes256-CBC"],g=n.aes.createEncryptionCipher;break;case"des":i=8,f=8,y=a.desCBC,g=n.des.createEncryptionCipher;break;default:throw(_=new Error("Cannot encrypt private key. Unknown encryption algorithm.")).algorithm=r.algorithm,_}var m="hmacWith"+r.prfAlgorithm.toUpperCase(),w=p(m),E=n.pkcs5.pbkdf2(t,u,h,i,w),b=n.random.getBytesSync(f);(S=g(E)).start(b),S.update(s.toDer(e)),S.finish(),l=S.output.getBytes();var v=function(e,t,r,i){var a=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,e),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,t.getBytes())]);return"hmacWithSHA1"!==i&&a.value.push(s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,n.util.hexToBytes(r.toString(16))),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(o.oids[i]).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")])),a}(u,d,i,m);c=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(a.pkcs5PBES2).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(a.pkcs5PBKDF2).getBytes()),v]),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(y).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,b)])])])}else{var _;if("3des"!==r.algorithm)throw(_=new Error("Cannot encrypt private key. Unknown encryption algorithm.")).algorithm=r.algorithm,_;i=24;var S,C=new n.util.ByteBuffer(u);E=o.pbe.generatePkcs12Key(t,C,1,h,i),b=o.pbe.generatePkcs12Key(t,C,2,h,i),(S=n.des.createEncryptionCipher(E)).start(b),S.update(s.toDer(e)),S.finish(),l=S.output.getBytes(),c=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(a["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,u),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,d.getBytes())])])}return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[c,s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,l)])},o.decryptPrivateKeyInfo=function(e,t){var r=null,i={},a=[];if(!s.validate(e,c,i,a)){var l=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw l.errors=a,l}var u=s.derToOid(i.encryptionOid),h=o.pbe.getCipher(u,i.encryptionParams,t),d=n.util.createBuffer(i.encryptedData);return h.update(d),h.finish()&&(r=s.fromDer(h.output)),r},o.encryptedPrivateKeyToPem=function(e,t){var r={type:"ENCRYPTED PRIVATE KEY",body:s.toDer(e).getBytes()};return n.pem.encode(r,{maxline:t})},o.encryptedPrivateKeyFromPem=function(e){var t=n.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==t.type){var r=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw r.headerType=t.type,r}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return s.fromDer(t.body)},o.encryptRsaPrivateKey=function(e,t,r){if(!(r=r||{}).legacy){var i=o.wrapRsaPrivateKey(o.privateKeyToAsn1(e));return i=o.encryptPrivateKeyInfo(i,t,r),o.encryptedPrivateKeyToPem(i)}var a,c,l,u;switch(r.algorithm){case"aes128":a="AES-128-CBC",l=16,c=n.random.getBytesSync(16),u=n.aes.createEncryptionCipher;break;case"aes192":a="AES-192-CBC",l=24,c=n.random.getBytesSync(16),u=n.aes.createEncryptionCipher;break;case"aes256":a="AES-256-CBC",l=32,c=n.random.getBytesSync(16),u=n.aes.createEncryptionCipher;break;case"3des":a="DES-EDE3-CBC",l=24,c=n.random.getBytesSync(8),u=n.des.createEncryptionCipher;break;case"des":a="DES-CBC",l=8,c=n.random.getBytesSync(8),u=n.des.createEncryptionCipher;break;default:var h=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+r.algorithm+'".');throw h.algorithm=r.algorithm,h}var d=u(n.pbe.opensslDeriveBytes(t,c.substr(0,8),l));d.start(c),d.update(s.toDer(o.privateKeyToAsn1(e))),d.finish();var p={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:a,parameters:n.util.bytesToHex(c).toUpperCase()},body:d.output.getBytes()};return n.pem.encode(p)},o.decryptRsaPrivateKey=function(e,t){var r=null,i=n.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==i.type&&"PRIVATE KEY"!==i.type&&"RSA PRIVATE KEY"!==i.type)throw(l=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".')).headerType=l,l;if(i.procType&&"ENCRYPTED"===i.procType.type){var a,c;switch(i.dekInfo.algorithm){case"DES-CBC":a=8,c=n.des.createDecryptionCipher;break;case"DES-EDE3-CBC":a=24,c=n.des.createDecryptionCipher;break;case"AES-128-CBC":a=16,c=n.aes.createDecryptionCipher;break;case"AES-192-CBC":a=24,c=n.aes.createDecryptionCipher;break;case"AES-256-CBC":a=32,c=n.aes.createDecryptionCipher;break;case"RC2-40-CBC":a=5,c=function(e){return n.rc2.createDecryptionCipher(e,40)};break;case"RC2-64-CBC":a=8,c=function(e){return n.rc2.createDecryptionCipher(e,64)};break;case"RC2-128-CBC":a=16,c=function(e){return n.rc2.createDecryptionCipher(e,128)};break;default:var l;throw(l=new Error('Could not decrypt private key; unsupported encryption algorithm "'+i.dekInfo.algorithm+'".')).algorithm=i.dekInfo.algorithm,l}var u=n.util.hexToBytes(i.dekInfo.parameters),h=c(n.pbe.opensslDeriveBytes(t,u.substr(0,8),a));if(h.start(u),h.update(n.util.createBuffer(i.body)),!h.finish())return r;r=h.output.getBytes()}else r=i.body;return null!==(r="ENCRYPTED PRIVATE KEY"===i.type?o.decryptPrivateKeyInfo(s.fromDer(r),t):s.fromDer(r))&&(r=o.privateKeyFromAsn1(r)),r},o.pbe.generatePkcs12Key=function(e,t,r,i,s,o){var a,c;if(null==o){if(!("sha1"in n.md))throw new Error('"sha1" hash algorithm unavailable.');o=n.md.sha1.create()}var l=o.digestLength,u=o.blockLength,h=new n.util.ByteBuffer,d=new n.util.ByteBuffer;if(null!=e){for(c=0;c<e.length;c++)d.putInt16(e.charCodeAt(c));d.putInt16(0)}var p=d.length(),f=t.length(),y=new n.util.ByteBuffer;y.fillWithByte(r,u);var g=u*Math.ceil(f/u),m=new n.util.ByteBuffer;for(c=0;c<g;c++)m.putByte(t.at(c%f));var w=u*Math.ceil(p/u),E=new n.util.ByteBuffer;for(c=0;c<w;c++)E.putByte(d.at(c%p));var b=m;b.putBuffer(E);for(var v=Math.ceil(s/l),_=1;_<=v;_++){var S=new n.util.ByteBuffer;S.putBytes(y.bytes()),S.putBytes(b.bytes());for(var C=0;C<i;C++)o.start(),o.update(S.getBytes()),S=o.digest();var A=new n.util.ByteBuffer;for(c=0;c<u;c++)A.putByte(S.at(c%l));var I=Math.ceil(f/u)+Math.ceil(p/u),T=new n.util.ByteBuffer;for(a=0;a<I;a++){var R=new n.util.ByteBuffer(b.getBytes(u)),k=511;for(c=A.length()-1;c>=0;c--)k>>=8,k+=A.at(c)+R.at(c),R.setAt(c,255&k);T.putBuffer(R)}b=T,h.putBuffer(S)}return h.truncate(h.length()-s),h},o.pbe.getCipher=function(e,t,r){switch(e){case o.oids.pkcs5PBES2:return o.pbe.getCipherForPBES2(e,t,r);case o.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case o.oids["pbewithSHAAnd40BitRC2-CBC"]:return o.pbe.getCipherForPKCS12PBE(e,t,r);default:var n=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw n.oid=e,n.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],n}},o.pbe.getCipherForPBES2=function(e,t,r){var i,a={},c=[];if(!s.validate(t,l,a,c))throw(i=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=c,i;if((e=s.derToOid(a.kdfOid))!==o.oids.pkcs5PBKDF2)throw(i=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.")).oid=e,i.supportedOids=["pkcs5PBKDF2"],i;if((e=s.derToOid(a.encOid))!==o.oids["aes128-CBC"]&&e!==o.oids["aes192-CBC"]&&e!==o.oids["aes256-CBC"]&&e!==o.oids["des-EDE3-CBC"]&&e!==o.oids.desCBC)throw(i=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.")).oid=e,i.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],i;var u,h,p=a.kdfSalt,f=n.util.createBuffer(a.kdfIterationCount);switch(f=f.getInt(f.length()<<3),o.oids[e]){case"aes128-CBC":u=16,h=n.aes.createDecryptionCipher;break;case"aes192-CBC":u=24,h=n.aes.createDecryptionCipher;break;case"aes256-CBC":u=32,h=n.aes.createDecryptionCipher;break;case"des-EDE3-CBC":u=24,h=n.des.createDecryptionCipher;break;case"desCBC":u=8,h=n.des.createDecryptionCipher}var y=d(a.prfOid),g=n.pkcs5.pbkdf2(r,p,f,u,y),m=a.encIv,w=h(g);return w.start(m),w},o.pbe.getCipherForPKCS12PBE=function(e,t,r){var i={},a=[];if(!s.validate(t,u,i,a))throw(y=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=a,y;var c,l,h,p=n.util.createBuffer(i.salt),f=n.util.createBuffer(i.iterations);switch(f=f.getInt(f.length()<<3),e){case o.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:c=24,l=8,h=n.des.startDecrypting;break;case o.oids["pbewithSHAAnd40BitRC2-CBC"]:c=5,l=8,h=function(e,t){var r=n.rc2.createDecryptionCipher(e,40);return r.start(t,null),r};break;default:var y;throw(y=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.")).oid=e,y}var g=d(i.prfOid),m=o.pbe.generatePkcs12Key(r,p,1,f,c,g);return g.start(),h(m,o.pbe.generatePkcs12Key(r,p,2,f,l,g))},o.pbe.opensslDeriveBytes=function(e,t,r,i){if(null==i){if(!("md5"in n.md))throw new Error('"md5" hash algorithm unavailable.');i=n.md.md5.create()}null===t&&(t="");for(var s=[h(i,e+t)],o=16,a=1;o<r;++a,o+=16)s.push(h(i,s[a-1]+e+t));return s.join("").substr(0,r)}},8960:(e,t,r)=>{var n=r(3832);r(6607),r(8991),r(7116);var i,s=n.pkcs5=n.pkcs5||{};n.util.isNodejs&&!n.options.usePureJavaScript&&(i=r(5819)),e.exports=n.pbkdf2=s.pbkdf2=function(e,t,r,s,o,a){if("function"==typeof o&&(a=o,o=null),n.util.isNodejs&&!n.options.usePureJavaScript&&i.pbkdf2&&(null===o||"object"!=typeof o)&&(i.pbkdf2Sync.length>4||!o||"sha1"===o))return"string"!=typeof o&&(o="sha1"),e=Buffer.from(e,"binary"),t=Buffer.from(t,"binary"),a?4===i.pbkdf2Sync.length?i.pbkdf2(e,t,r,s,(function(e,t){if(e)return a(e);a(null,t.toString("binary"))})):i.pbkdf2(e,t,r,s,o,(function(e,t){if(e)return a(e);a(null,t.toString("binary"))})):4===i.pbkdf2Sync.length?i.pbkdf2Sync(e,t,r,s).toString("binary"):i.pbkdf2Sync(e,t,r,s,o).toString("binary");if(null==o&&(o="sha1"),"string"==typeof o){if(!(o in n.md.algorithms))throw new Error("Unknown hash algorithm: "+o);o=n.md[o].create()}var c=o.digestLength;if(s>4294967295*c){var l=new Error("Derived key is too long.");if(a)return a(l);throw l}var u=Math.ceil(s/c),h=s-(u-1)*c,d=n.hmac.create();d.start(o,e);var p,f,y,g="";if(!a){for(var m=1;m<=u;++m){d.start(null,null),d.update(t),d.update(n.util.int32ToBytes(m)),p=y=d.digest().getBytes();for(var w=2;w<=r;++w)d.start(null,null),d.update(y),f=d.digest().getBytes(),p=n.util.xorBytes(p,f,c),y=f;g+=m<u?p:p.substr(0,h)}return g}function E(){if(m>u)return a(null,g);d.start(null,null),d.update(t),d.update(n.util.int32ToBytes(m)),p=y=d.digest().getBytes(),w=2,b()}function b(){if(w<=r)return d.start(null,null),d.update(y),f=d.digest().getBytes(),p=n.util.xorBytes(p,f,c),y=f,++w,n.util.setImmediate(b);g+=m<u?p:p.substr(0,h),++m,E()}m=1,E()}},6953:(e,t,r)=>{var n=r(3832);r(7116);var i=e.exports=n.pem=n.pem||{};function s(e){for(var t=e.name+": ",r=[],n=function(e,t){return" "+t},i=0;i<e.values.length;++i)r.push(e.values[i].replace(/^(\S+\r\n)/,n));t+=r.join(",")+"\r\n";var s=0,o=-1;for(i=0;i<t.length;++i,++s)if(s>65&&-1!==o){var a=t[o];","===a?(++o,t=t.substr(0,o)+"\r\n "+t.substr(o)):t=t.substr(0,o)+"\r\n"+a+t.substr(o+1),s=i-o-1,o=-1,++i}else" "!==t[i]&&"\t"!==t[i]&&","!==t[i]||(o=i);return t}function o(e){return e.replace(/^\s+/,"")}i.encode=function(e,t){t=t||{};var r,i="-----BEGIN "+e.type+"-----\r\n";if(e.procType&&(i+=s(r={name:"Proc-Type",values:[String(e.procType.version),e.procType.type]})),e.contentDomain&&(i+=s(r={name:"Content-Domain",values:[e.contentDomain]})),e.dekInfo&&(r={name:"DEK-Info",values:[e.dekInfo.algorithm]},e.dekInfo.parameters&&r.values.push(e.dekInfo.parameters),i+=s(r)),e.headers)for(var o=0;o<e.headers.length;++o)i+=s(e.headers[o]);return e.procType&&(i+="\r\n"),(i+=n.util.encode64(e.body,t.maxline||64)+"\r\n")+"-----END "+e.type+"-----\r\n"},i.decode=function(e){for(var t,r=[],i=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,s=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,a=/\r?\n/;t=i.exec(e);){var c=t[1];"NEW CERTIFICATE REQUEST"===c&&(c="CERTIFICATE REQUEST");var l={type:c,procType:null,contentDomain:null,dekInfo:null,headers:[],body:n.util.decode64(t[3])};if(r.push(l),t[2]){for(var u=t[2].split(a),h=0;t&&h<u.length;){for(var d=u[h].replace(/\s+$/,""),p=h+1;p<u.length;++p){var f=u[p];if(!/\s/.test(f[0]))break;d+=f,h=p}if(t=d.match(s)){for(var y={name:t[1],values:[]},g=t[2].split(","),m=0;m<g.length;++m)y.values.push(o(g[m]));if(l.procType)if(l.contentDomain||"Content-Domain"!==y.name)if(l.dekInfo||"DEK-Info"!==y.name)l.headers.push(y);else{if(0===y.values.length)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');l.dekInfo={algorithm:g[0],parameters:g[1]||null}}else l.contentDomain=g[0]||"";else{if("Proc-Type"!==y.name)throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(2!==y.values.length)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');l.procType={version:g[0],type:g[1]}}}++h}if("ENCRYPTED"===l.procType&&!l.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(0===r.length)throw new Error("Invalid PEM formatted message.");return r}},8936:(e,t,r)=>{var n=r(3832);r(7116),r(9563),r(137);var i=e.exports=n.pkcs1=n.pkcs1||{};function s(e,t,r){r||(r=n.md.sha1.create());for(var i="",s=Math.ceil(t/r.digestLength),o=0;o<s;++o){var a=String.fromCharCode(o>>24&255,o>>16&255,o>>8&255,255&o);r.start(),r.update(e+a),i+=r.digest().getBytes()}return i.substring(0,t)}i.encode_rsa_oaep=function(e,t,r){var i,o,a,c;"string"==typeof r?(i=r,o=arguments[3]||void 0,a=arguments[4]||void 0):r&&(i=r.label||void 0,o=r.seed||void 0,a=r.md||void 0,r.mgf1&&r.mgf1.md&&(c=r.mgf1.md)),a?a.start():a=n.md.sha1.create(),c||(c=a);var l=Math.ceil(e.n.bitLength()/8),u=l-2*a.digestLength-2;if(t.length>u)throw(g=new Error("RSAES-OAEP input message length is too long.")).length=t.length,g.maxLength=u,g;i||(i=""),a.update(i,"raw");for(var h=a.digest(),d="",p=u-t.length,f=0;f<p;f++)d+="\0";var y=h.getBytes()+d+""+t;if(o){if(o.length!==a.digestLength){var g;throw(g=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.")).seedLength=o.length,g.digestLength=a.digestLength,g}}else o=n.random.getBytes(a.digestLength);var m=s(o,l-a.digestLength-1,c),w=n.util.xorBytes(y,m,y.length),E=s(w,a.digestLength,c);return"\0"+n.util.xorBytes(o,E,o.length)+w},i.decode_rsa_oaep=function(e,t,r){var i,o,a;"string"==typeof r?(i=r,o=arguments[3]||void 0):r&&(i=r.label||void 0,o=r.md||void 0,r.mgf1&&r.mgf1.md&&(a=r.mgf1.md));var c=Math.ceil(e.n.bitLength()/8);if(t.length!==c)throw(m=new Error("RSAES-OAEP encoded message length is invalid.")).length=t.length,m.expectedLength=c,m;if(void 0===o?o=n.md.sha1.create():o.start(),a||(a=o),c<2*o.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");i||(i=""),o.update(i,"raw");for(var l=o.digest().getBytes(),u=t.charAt(0),h=t.substring(1,o.digestLength+1),d=t.substring(1+o.digestLength),p=s(d,o.digestLength,a),f=s(n.util.xorBytes(h,p,h.length),c-o.digestLength-1,a),y=n.util.xorBytes(d,f,d.length),g=y.substring(0,o.digestLength),m="\0"!==u,w=0;w<o.digestLength;++w)m|=l.charAt(w)!==g.charAt(w);for(var E=1,b=o.digestLength,v=o.digestLength;v<y.length;v++){var _=y.charCodeAt(v);m|=_&(E?65534:0),b+=E&=1&_^1}if(m||1!==y.charCodeAt(b))throw new Error("Invalid RSAES-OAEP padding.");return y.substring(b+1)}},9437:(e,t,r)=>{var n=r(3832);r(8925),r(3068),r(3480),r(6270),r(6953),r(5496),r(9563),r(7116),r(5414);var i=n.asn1,s=e.exports=n.pkcs7=n.pkcs7||{};function o(e){var t={},r=[];if(!i.validate(e,s.asn1.recipientInfoValidator,t,r)){var o=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw o.errors=r,o}return{version:t.version.charCodeAt(0),issuer:n.pki.RDNAttributesAsArray(t.issuer),serialNumber:n.util.createBuffer(t.serial).toHex(),encryptedContent:{algorithm:i.derToOid(t.encAlgorithm),parameter:t.encParameter?t.encParameter.value:void 0,content:t.encKey}}}function a(e){for(var t,r=[],s=0;s<e.length;++s)r.push((t=e[s],i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(t.version).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[n.pki.distinguishedNameToAsn1({attributes:t.issuer}),i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,n.util.hexToBytes(t.serialNumber))]),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.encryptedContent.algorithm).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")]),i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,t.encryptedContent.content)])));return r}function c(e){var t=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(e.version).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[n.pki.distinguishedNameToAsn1({attributes:e.issuer}),i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,n.util.hexToBytes(e.serialNumber))]),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.digestAlgorithm).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")])]);if(e.authenticatedAttributesAsn1&&t.value.push(e.authenticatedAttributesAsn1),t.value.push(i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.signatureAlgorithm).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")])),t.value.push(i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,e.signature)),e.unauthenticatedAttributes.length>0){for(var r=i.create(i.Class.CONTEXT_SPECIFIC,1,!0,[]),s=0;s<e.unauthenticatedAttributes.length;++s){var o=e.unauthenticatedAttributes[s];r.values.push(l(o))}t.value.push(r)}return t}function l(e){var t;if(e.type===n.pki.oids.contentType)t=i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.value).getBytes());else if(e.type===n.pki.oids.messageDigest)t=i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,e.value.bytes());else if(e.type===n.pki.oids.signingTime){var r=new Date("1950-01-01T00:00:00Z"),s=new Date("2050-01-01T00:00:00Z"),o=e.value;if("string"==typeof o){var a=Date.parse(o);o=isNaN(a)?13===o.length?i.utcTimeToDate(o):i.generalizedTimeToDate(o):new Date(a)}t=o>=r&&o<s?i.create(i.Class.UNIVERSAL,i.Type.UTCTIME,!1,i.dateToUtcTime(o)):i.create(i.Class.UNIVERSAL,i.Type.GENERALIZEDTIME,!1,i.dateToGeneralizedTime(o))}return i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.type).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SET,!0,[t])])}function u(e,t,r){var s={};if(!i.validate(t,r,s,[])){var o=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw o.errors=o,o}if(i.derToOid(s.contentType)!==n.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(s.encryptedContent){var a="";if(n.util.isArray(s.encryptedContent))for(var c=0;c<s.encryptedContent.length;++c){if(s.encryptedContent[c].type!==i.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");a+=s.encryptedContent[c].value}else a=s.encryptedContent;e.encryptedContent={algorithm:i.derToOid(s.encAlgorithm),parameter:n.util.createBuffer(s.encParameter.value),content:n.util.createBuffer(a)}}if(s.content){if(a="",n.util.isArray(s.content))for(c=0;c<s.content.length;++c){if(s.content[c].type!==i.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");a+=s.content[c].value}else a=s.content;e.content=n.util.createBuffer(a)}return e.version=s.version.charCodeAt(0),e.rawCapture=s,s}function h(e){if(void 0===e.encryptedContent.key)throw new Error("Symmetric key not available.");if(void 0===e.content){var t;switch(e.encryptedContent.algorithm){case n.pki.oids["aes128-CBC"]:case n.pki.oids["aes192-CBC"]:case n.pki.oids["aes256-CBC"]:t=n.aes.createDecryptionCipher(e.encryptedContent.key);break;case n.pki.oids.desCBC:case n.pki.oids["des-EDE3-CBC"]:t=n.des.createDecryptionCipher(e.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+e.encryptedContent.algorithm)}if(t.start(e.encryptedContent.parameter),t.update(e.encryptedContent.content),!t.finish())throw new Error("Symmetric decryption failed.");e.content=t.output}}s.messageFromPem=function(e){var t=n.pem.decode(e)[0];if("PKCS7"!==t.type){var r=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw r.headerType=t.type,r}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var o=i.fromDer(t.body);return s.messageFromAsn1(o)},s.messageToPem=function(e,t){var r={type:"PKCS7",body:i.toDer(e.toAsn1()).getBytes()};return n.pem.encode(r,{maxline:t})},s.messageFromAsn1=function(e){var t={},r=[];if(!i.validate(e,s.asn1.contentInfoValidator,t,r)){var o=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw o.errors=r,o}var a,c=i.derToOid(t.contentType);switch(c){case n.pki.oids.envelopedData:a=s.createEnvelopedData();break;case n.pki.oids.encryptedData:a=s.createEncryptedData();break;case n.pki.oids.signedData:a=s.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+c+" is not (yet) supported.")}return a.fromAsn1(t.content.value[0]),a},s.createSignedData=function(){var e=null;return e={type:n.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(t){if(u(e,t,s.asn1.signedDataValidator),e.certificates=[],e.crls=[],e.digestAlgorithmIdentifiers=[],e.contentInfo=null,e.signerInfos=[],e.rawCapture.certificates)for(var r=e.rawCapture.certificates.value,i=0;i<r.length;++i)e.certificates.push(n.pki.certificateFromAsn1(r[i]))},toAsn1:function(){e.contentInfo||e.sign();for(var t=[],r=0;r<e.certificates.length;++r)t.push(n.pki.certificateToAsn1(e.certificates[r]));var s=[],o=i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(e.version).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SET,!0,e.digestAlgorithmIdentifiers),e.contentInfo])]);return t.length>0&&o.value[0].value.push(i.create(i.Class.CONTEXT_SPECIFIC,0,!0,t)),s.length>0&&o.value[0].value.push(i.create(i.Class.CONTEXT_SPECIFIC,1,!0,s)),o.value[0].value.push(i.create(i.Class.UNIVERSAL,i.Type.SET,!0,e.signerInfos)),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.type).getBytes()),o])},addSigner:function(t){var r=t.issuer,i=t.serialNumber;if(t.certificate){var s=t.certificate;"string"==typeof s&&(s=n.pki.certificateFromPem(s)),r=s.issuer.attributes,i=s.serialNumber}var o=t.key;if(!o)throw new Error("Could not add PKCS#7 signer; no private key specified.");"string"==typeof o&&(o=n.pki.privateKeyFromPem(o));var a=t.digestAlgorithm||n.pki.oids.sha1;switch(a){case n.pki.oids.sha1:case n.pki.oids.sha256:case n.pki.oids.sha384:case n.pki.oids.sha512:case n.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+a)}var c=t.authenticatedAttributes||[];if(c.length>0){for(var l=!1,u=!1,h=0;h<c.length;++h){var d=c[h];if(l||d.type!==n.pki.oids.contentType){if(u||d.type!==n.pki.oids.messageDigest);else if(u=!0,l)break}else if(l=!0,u)break}if(!l||!u)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}e.signers.push({key:o,version:1,issuer:r,serialNumber:i,digestAlgorithm:a,signatureAlgorithm:n.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:c,unauthenticatedAttributes:[]})},sign:function(t){var r;t=t||{},("object"!=typeof e.content||null===e.contentInfo)&&(e.contentInfo=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(n.pki.oids.data).getBytes())]),"content"in e&&(e.content instanceof n.util.ByteBuffer?r=e.content.bytes():"string"==typeof e.content&&(r=n.util.encodeUtf8(e.content)),t.detached?e.detachedContent=i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,r):e.contentInfo.value.push(i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,r)])))),0!==e.signers.length&&function(t){var r;if(!(r=e.detachedContent?e.detachedContent:(r=e.contentInfo.value[1]).value[0]))throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var s=i.derToOid(e.contentInfo.value[0].value),o=i.toDer(r);for(var a in o.getByte(),i.getBerValueLength(o),o=o.getBytes(),t)t[a].start().update(o);for(var u=new Date,h=0;h<e.signers.length;++h){var d=e.signers[h];if(0===d.authenticatedAttributes.length){if(s!==n.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{d.authenticatedAttributesAsn1=i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var p=i.create(i.Class.UNIVERSAL,i.Type.SET,!0,[]),f=0;f<d.authenticatedAttributes.length;++f){var y=d.authenticatedAttributes[f];y.type===n.pki.oids.messageDigest?y.value=t[d.digestAlgorithm].digest():y.type===n.pki.oids.signingTime&&(y.value||(y.value=u)),p.value.push(l(y)),d.authenticatedAttributesAsn1.value.push(l(y))}o=i.toDer(p).getBytes(),d.md.start().update(o)}d.signature=d.key.sign(d.md,"RSASSA-PKCS1-V1_5")}e.signerInfos=function(e){for(var t=[],r=0;r<e.length;++r)t.push(c(e[r]));return t}(e.signers)}(function(){for(var t={},r=0;r<e.signers.length;++r){var s=e.signers[r];(o=s.digestAlgorithm)in t||(t[o]=n.md[n.pki.oids[o]].create()),0===s.authenticatedAttributes.length?s.md=t[o]:s.md=n.md[n.pki.oids[o]].create()}for(var o in e.digestAlgorithmIdentifiers=[],t)e.digestAlgorithmIdentifiers.push(i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(o).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")]));return t}())},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(t){"string"==typeof t&&(t=n.pki.certificateFromPem(t)),e.certificates.push(t)},addCertificateRevokationList:function(e){throw new Error("PKCS#7 CRL support not yet implemented.")}}},s.createEncryptedData=function(){var e=null;return e={type:n.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:n.pki.oids["aes256-CBC"]},fromAsn1:function(t){u(e,t,s.asn1.encryptedDataValidator)},decrypt:function(t){void 0!==t&&(e.encryptedContent.key=t),h(e)}}},s.createEnvelopedData=function(){var e=null;return e={type:n.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:n.pki.oids["aes256-CBC"]},fromAsn1:function(t){var r=u(e,t,s.asn1.envelopedDataValidator);e.recipients=function(e){for(var t=[],r=0;r<e.length;++r)t.push(o(e[r]));return t}(r.recipientInfos.value)},toAsn1:function(){return i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.type).getBytes()),i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(e.version).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SET,!0,a(e.recipients)),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,(t=e.encryptedContent,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(n.pki.oids.data).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.algorithm).getBytes()),t.parameter?i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,t.parameter.getBytes()):void 0]),i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,t.content.getBytes())])]))])])]);var t},findRecipient:function(t){for(var r=t.issuer.attributes,n=0;n<e.recipients.length;++n){var i=e.recipients[n],s=i.issuer;if(i.serialNumber===t.serialNumber&&s.length===r.length){for(var o=!0,a=0;a<r.length;++a)if(s[a].type!==r[a].type||s[a].value!==r[a].value){o=!1;break}if(o)return i}}return null},decrypt:function(t,r){if(void 0===e.encryptedContent.key&&void 0!==t&&void 0!==r)switch(t.encryptedContent.algorithm){case n.pki.oids.rsaEncryption:case n.pki.oids.desCBC:var i=r.decrypt(t.encryptedContent.content);e.encryptedContent.key=n.util.createBuffer(i);break;default:throw new Error("Unsupported asymmetric cipher, OID "+t.encryptedContent.algorithm)}h(e)},addRecipient:function(t){e.recipients.push({version:0,issuer:t.issuer.attributes,serialNumber:t.serialNumber,encryptedContent:{algorithm:n.pki.oids.rsaEncryption,key:t.publicKey}})},encrypt:function(t,r){if(void 0===e.encryptedContent.content){var i,s,o;switch(r=r||e.encryptedContent.algorithm,t=t||e.encryptedContent.key,r){case n.pki.oids["aes128-CBC"]:i=16,s=16,o=n.aes.createEncryptionCipher;break;case n.pki.oids["aes192-CBC"]:i=24,s=16,o=n.aes.createEncryptionCipher;break;case n.pki.oids["aes256-CBC"]:i=32,s=16,o=n.aes.createEncryptionCipher;break;case n.pki.oids["des-EDE3-CBC"]:i=24,s=8,o=n.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+r)}if(void 0===t)t=n.util.createBuffer(n.random.getBytes(i));else if(t.length()!=i)throw new Error("Symmetric key has wrong length; got "+t.length()+" bytes, expected "+i+".");e.encryptedContent.algorithm=r,e.encryptedContent.key=t,e.encryptedContent.parameter=n.util.createBuffer(n.random.getBytes(s));var a=o(t);if(a.start(e.encryptedContent.parameter.copy()),a.update(e.content),!a.finish())throw new Error("Symmetric encryption failed.");e.encryptedContent.content=a.output}for(var c=0;c<e.recipients.length;++c){var l=e.recipients[c];if(void 0===l.encryptedContent.content){if(l.encryptedContent.algorithm!==n.pki.oids.rsaEncryption)throw new Error("Unsupported asymmetric cipher, OID "+l.encryptedContent.algorithm);l.encryptedContent.content=l.encryptedContent.key.encrypt(e.encryptedContent.key.data)}}}}}},5496:(e,t,r)=>{var n=r(3832);r(3068),r(7116);var i=n.asn1,s=e.exports=n.pkcs7asn1=n.pkcs7asn1||{};n.pkcs7=n.pkcs7||{},n.pkcs7.asn1=s;var o={name:"ContentInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:i.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};s.contentInfoValidator=o;var a={name:"EncryptedContentInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:i.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:i.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};s.envelopedDataValidator={name:"EnvelopedData",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:i.Class.UNIVERSAL,type:i.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(a)},s.encryptedDataValidator={name:"EncryptedData",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"version"}].concat(a)};var c={name:"SignerInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:i.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:i.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:i.Class.UNIVERSAL,type:i.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:i.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};s.signedDataValidator={name:"SignedData",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:i.Class.UNIVERSAL,type:i.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},o,{name:"SignedData.Certificates",tagClass:i.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:i.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:i.Class.UNIVERSAL,type:i.Type.SET,capture:"signerInfos",optional:!0,value:[c]}]},s.recipientInfoValidator={name:"RecipientInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:i.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter",optional:!0}]},{name:"RecipientInfo.encryptedKey",tagClass:i.Class.UNIVERSAL,type:i.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]}},9654:(e,t,r)=>{var n=r(3832);r(7116),r(5764),r(9563),function(){if(n.prime)e.exports=n.prime;else{var t=e.exports=n.prime=n.prime||{},r=n.jsbn.BigInteger,i=[6,4,2,4,2,4,6,2],s=new r(null);s.fromInt(30);var o=function(e,t){return e|t};t.generateProbablePrime=function(e,t,i){"function"==typeof t&&(i=t,t={});var s=(t=t||{}).algorithm||"PRIMEINC";"string"==typeof s&&(s={name:s}),s.options=s.options||{};var o=t.prng||n.random,c={nextBytes:function(e){for(var t=o.getBytesSync(e.length),r=0;r<e.length;++r)e[r]=t.charCodeAt(r)}};if("PRIMEINC"===s.name)return function(e,t,i,s){return"workers"in i?function(e,t,i,s){if("undefined"==typeof Worker)return a(e,t,i,s);var o=l(e,t),c=i.workers,u=i.workLoad||100,h=30*u/8,d=i.workerScript||"forge/prime.worker.js";if(-1===c)return n.util.estimateCores((function(e,t){e&&(t=2),c=t-1,p()}));function p(){c=Math.max(1,c);for(var n=[],i=0;i<c;++i)n[i]=new Worker(d);for(i=0;i<c;++i)n[i].addEventListener("message",p);var a=!1;function p(i){if(!a){var c=i.data;if(c.found){for(var d=0;d<n.length;++d)n[d].terminate();return a=!0,s(null,new r(c.prime,16))}o.bitLength()>e&&(o=l(e,t));var p=o.toString(16);i.target.postMessage({hex:p,workLoad:u}),o.dAddOffset(h,0)}}}p()}(e,t,i,s):a(e,t,i,s)}(e,c,s.options,i);throw new Error("Invalid prime generation algorithm: "+s.name)}}function a(e,t,r,n){var i=l(e,t),s=function(e){return e<=100?27:e<=150?18:e<=200?15:e<=250?12:e<=300?9:e<=350?8:e<=400?7:e<=500?6:e<=600?5:e<=800?4:e<=1250?3:2}(i.bitLength());"millerRabinTests"in r&&(s=r.millerRabinTests);var o=10;"maxBlockTime"in r&&(o=r.maxBlockTime),c(i,e,t,0,s,o,n)}function c(e,t,r,s,o,a,u){var h=+new Date;do{if(e.bitLength()>t&&(e=l(t,r)),e.isProbablePrime(o))return u(null,e);e.dAddOffset(i[s++%8],0)}while(a<0||+new Date-h<a);n.util.setImmediate((function(){c(e,t,r,s,o,a,u)}))}function l(e,t){var n=new r(e,t),i=e-1;return n.testBit(i)||n.bitwiseTo(r.ONE.shiftLeft(i),o,n),n.dAddOffset(31-n.mod(s).byteValue(),0),n}}()},4933:(e,t,r)=>{var n=r(3832);r(7116);var i=null;!n.util.isNodejs||n.options.usePureJavaScript||process.versions["node-webkit"]||(i=r(5819)),(e.exports=n.prng=n.prng||{}).create=function(e){for(var t={plugin:e,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},r=e.md,s=new Array(32),o=0;o<32;++o)s[o]=r.create();function a(){if(t.pools[0].messageLength>=32)return c();var e=32-t.pools[0].messageLength<<5;t.collect(t.seedFileSync(e)),c()}function c(){t.reseeds=4294967295===t.reseeds?0:t.reseeds+1;var e=t.plugin.md.create();e.update(t.keyBytes);for(var r=1,n=0;n<32;++n)t.reseeds%r==0&&(e.update(t.pools[n].digest().getBytes()),t.pools[n].start()),r<<=1;t.keyBytes=e.digest().getBytes(),e.start(),e.update(t.keyBytes);var i=e.digest().getBytes();t.key=t.plugin.formatKey(t.keyBytes),t.seed=t.plugin.formatSeed(i),t.generated=0}function l(e){var t=null,r=n.util.globalScope,i=r.crypto||r.msCrypto;i&&i.getRandomValues&&(t=function(e){return i.getRandomValues(e)});var s=n.util.createBuffer();if(t)for(;s.length()<e;){var o=Math.max(1,Math.min(e-s.length(),65536)/4),a=new Uint32Array(Math.floor(o));try{t(a);for(var c=0;c<a.length;++c)s.putInt32(a[c])}catch(e){if(!("undefined"!=typeof QuotaExceededError&&e instanceof QuotaExceededError))throw e}}if(s.length()<e)for(var l,u,h,d=Math.floor(65536*Math.random());s.length()<e;)for(u=16807*(65535&d),u+=(32767&(l=16807*(d>>16)))<<16,d=4294967295&(u=(2147483647&(u+=l>>15))+(u>>31)),c=0;c<3;++c)h=d>>>(c<<3),h^=Math.floor(256*Math.random()),s.putByte(255&h);return s.getBytes(e)}return t.pools=s,t.pool=0,t.generate=function(e,r){if(!r)return t.generateSync(e);var i=t.plugin.cipher,s=t.plugin.increment,o=t.plugin.formatKey,a=t.plugin.formatSeed,l=n.util.createBuffer();t.key=null,function u(h){if(h)return r(h);if(l.length()>=e)return r(null,l.getBytes(e));if(t.generated>1048575&&(t.key=null),null===t.key)return n.util.nextTick((function(){!function(e){if(t.pools[0].messageLength>=32)return c(),e();var r=32-t.pools[0].messageLength<<5;t.seedFile(r,(function(r,n){if(r)return e(r);t.collect(n),c(),e()}))}(u)}));var d=i(t.key,t.seed);t.generated+=d.length,l.putBytes(d),t.key=o(i(t.key,s(t.seed))),t.seed=a(i(t.key,t.seed)),n.util.setImmediate(u)}()},t.generateSync=function(e){var r=t.plugin.cipher,i=t.plugin.increment,s=t.plugin.formatKey,o=t.plugin.formatSeed;t.key=null;for(var c=n.util.createBuffer();c.length()<e;){t.generated>1048575&&(t.key=null),null===t.key&&a();var l=r(t.key,t.seed);t.generated+=l.length,c.putBytes(l),t.key=s(r(t.key,i(t.seed))),t.seed=o(r(t.key,t.seed))}return c.getBytes(e)},i?(t.seedFile=function(e,t){i.randomBytes(e,(function(e,r){if(e)return t(e);t(null,r.toString())}))},t.seedFileSync=function(e){return i.randomBytes(e).toString()}):(t.seedFile=function(e,t){try{t(null,l(e))}catch(e){t(e)}},t.seedFileSync=l),t.collect=function(e){for(var r=e.length,n=0;n<r;++n)t.pools[t.pool].update(e.substr(n,1)),t.pool=31===t.pool?0:t.pool+1},t.collectInt=function(e,r){for(var n="",i=0;i<r;i+=8)n+=String.fromCharCode(e>>i&255);t.collect(n)},t.registerWorker=function(e){e===self?t.seedFile=function(e,t){self.addEventListener("message",(function e(r){var n=r.data;n.forge&&n.forge.prng&&(self.removeEventListener("message",e),t(n.forge.prng.err,n.forge.prng.bytes))})),self.postMessage({forge:{prng:{needed:e}}})}:e.addEventListener("message",(function(r){var n=r.data;n.forge&&n.forge.prng&&t.seedFile(n.forge.prng.needed,(function(t,r){e.postMessage({forge:{prng:{err:t,bytes:r}}})}))}))},t}},6007:(e,t,r)=>{var n=r(3832);r(9563),r(7116),(e.exports=n.pss=n.pss||{}).create=function(e){3===arguments.length&&(e={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var t,r=e.md,i=e.mgf,s=r.digestLength,o=e.salt||null;if("string"==typeof o&&(o=n.util.createBuffer(o)),"saltLength"in e)t=e.saltLength;else{if(null===o)throw new Error("Salt length not specified or specific salt not given.");t=o.length()}if(null!==o&&o.length()!==t)throw new Error("Given salt length does not match length of given salt.");var a=e.prng||n.random;return{encode:function(e,c){var l,u,h=c-1,d=Math.ceil(h/8),p=e.digest().getBytes();if(d<s+t+2)throw new Error("Message is too long to encrypt.");u=null===o?a.getBytesSync(t):o.bytes();var f=new n.util.ByteBuffer;f.fillWithByte(0,8),f.putBytes(p),f.putBytes(u),r.start(),r.update(f.getBytes());var y=r.digest().getBytes(),g=new n.util.ByteBuffer;g.fillWithByte(0,d-t-s-2),g.putByte(1),g.putBytes(u);var m=g.getBytes(),w=d-s-1,E=i.generate(y,w),b="";for(l=0;l<w;l++)b+=String.fromCharCode(m.charCodeAt(l)^E.charCodeAt(l));var v=65280>>8*d-h&255;return(b=String.fromCharCode(b.charCodeAt(0)&~v)+b.substr(1))+y+String.fromCharCode(188)},verify:function(e,o,a){var c,l=a-1,u=Math.ceil(l/8);if(o=o.substr(-u),u<s+t+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(188!==o.charCodeAt(u-1))throw new Error("Encoded message does not end in 0xBC.");var h=u-s-1,d=o.substr(0,h),p=o.substr(h,s),f=65280>>8*u-l&255;if(0!=(d.charCodeAt(0)&f))throw new Error("Bits beyond keysize not zero as expected.");var y=i.generate(p,h),g="";for(c=0;c<h;c++)g+=String.fromCharCode(d.charCodeAt(c)^y.charCodeAt(c));g=String.fromCharCode(g.charCodeAt(0)&~f)+g.substr(1);var m=u-s-t-2;for(c=0;c<m;c++)if(0!==g.charCodeAt(c))throw new Error("Leftmost octets not zero as expected");if(1!==g.charCodeAt(m))throw new Error("Inconsistent PSS signature, 0x01 marker not found");var w=g.substr(-t),E=new n.util.ByteBuffer;return E.fillWithByte(0,8),E.putBytes(e),E.putBytes(w),r.start(),r.update(E.getBytes()),p===r.digest().getBytes()}}}},9563:(e,t,r)=>{var n=r(3832);r(8925),r(1668),r(4933),r(7116),n.random&&n.random.getBytes?e.exports=n.random:function(t){var r={},i=new Array(4),s=n.util.createBuffer();function o(){var e=n.prng.create(r);return e.getBytes=function(t,r){return e.generate(t,r)},e.getBytesSync=function(t){return e.generate(t)},e}r.formatKey=function(e){var t=n.util.createBuffer(e);return(e=new Array(4))[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),n.aes._expandKey(e,!1)},r.formatSeed=function(e){var t=n.util.createBuffer(e);return(e=new Array(4))[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),e},r.cipher=function(e,t){return n.aes._updateBlock(e,t,i,!1),s.putInt32(i[0]),s.putInt32(i[1]),s.putInt32(i[2]),s.putInt32(i[3]),s.getBytes()},r.increment=function(e){return++e[3],e},r.md=n.md.sha256;var a=o(),c=null,l=n.util.globalScope,u=l.crypto||l.msCrypto;if(u&&u.getRandomValues&&(c=function(e){return u.getRandomValues(e)}),n.options.usePureJavaScript||!n.util.isNodejs&&!c){if("undefined"==typeof window||window.document,a.collectInt(+new Date,32),"undefined"!=typeof navigator){var h="";for(var d in navigator)try{"string"==typeof navigator[d]&&(h+=navigator[d])}catch(e){}a.collect(h),h=null}t&&(t().mousemove((function(e){a.collectInt(e.clientX,16),a.collectInt(e.clientY,16)})),t().keypress((function(e){a.collectInt(e.charCode,8)})))}if(n.random)for(var d in a)n.random[d]=a[d];else n.random=a;n.random.createInstance=o,e.exports=n.random}("undefined"!=typeof jQuery?jQuery:null)},9372:(e,t,r)=>{var n=r(3832);r(7116);var i=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],s=[1,2,3,5],o=function(e,t){return e<<t&65535|(65535&e)>>16-t},a=function(e,t){return(65535&e)>>t|e<<16-t&65535};e.exports=n.rc2=n.rc2||{},n.rc2.expandKey=function(e,t){"string"==typeof e&&(e=n.util.createBuffer(e)),t=t||128;var r,s=e,o=e.length(),a=t,c=Math.ceil(a/8),l=255>>(7&a);for(r=o;r<128;r++)s.putByte(i[s.at(r-1)+s.at(r-o)&255]);for(s.setAt(128-c,i[s.at(128-c)&l]),r=127-c;r>=0;r--)s.setAt(r,i[s.at(r+1)^s.at(r+c)]);return s};var c=function(e,t,r){var i,c,l,u,h=!1,d=null,p=null,f=null,y=[];for(e=n.rc2.expandKey(e,t),l=0;l<64;l++)y.push(e.getInt16Le());r?(i=function(e){for(l=0;l<4;l++)e[l]+=y[u]+(e[(l+3)%4]&e[(l+2)%4])+(~e[(l+3)%4]&e[(l+1)%4]),e[l]=o(e[l],s[l]),u++},c=function(e){for(l=0;l<4;l++)e[l]+=y[63&e[(l+3)%4]]}):(i=function(e){for(l=3;l>=0;l--)e[l]=a(e[l],s[l]),e[l]-=y[u]+(e[(l+3)%4]&e[(l+2)%4])+(~e[(l+3)%4]&e[(l+1)%4]),u--},c=function(e){for(l=3;l>=0;l--)e[l]-=y[63&e[(l+3)%4]]});var g=function(e){var t=[];for(l=0;l<4;l++){var n=d.getInt16Le();null!==f&&(r?n^=f.getInt16Le():f.putInt16Le(n)),t.push(65535&n)}u=r?0:63;for(var i=0;i<e.length;i++)for(var s=0;s<e[i][0];s++)e[i][1](t);for(l=0;l<4;l++)null!==f&&(r?f.putInt16Le(t[l]):t[l]^=f.getInt16Le()),p.putInt16Le(t[l])},m=null;return m={start:function(e,t){e&&"string"==typeof e&&(e=n.util.createBuffer(e)),h=!1,d=n.util.createBuffer(),p=t||new n.util.createBuffer,f=e,m.output=p},update:function(e){for(h||d.putBuffer(e);d.length()>=8;)g([[5,i],[1,c],[6,i],[1,c],[5,i]])},finish:function(e){var t=!0;if(r)if(e)t=e(8,d,!r);else{var n=8===d.length()?8:8-d.length();d.fillWithByte(n,n)}if(t&&(h=!0,m.update()),!r&&(t=0===d.length()))if(e)t=e(8,p,!r);else{var i=p.length(),s=p.at(i-1);s>i?t=!1:p.truncate(s)}return t}}};n.rc2.startEncrypting=function(e,t,r){var i=n.rc2.createEncryptionCipher(e,128);return i.start(t,r),i},n.rc2.createEncryptionCipher=function(e,t){return c(e,t,!0)},n.rc2.startDecrypting=function(e,t,r){var i=n.rc2.createDecryptionCipher(e,128);return i.start(t,r),i},n.rc2.createDecryptionCipher=function(e,t){return c(e,t,!1)}},8095:(e,t,r)=>{var n=r(3832);if(r(3068),r(5764),r(6270),r(8936),r(9654),r(9563),r(7116),void 0===i)var i=n.jsbn.BigInteger;var s=n.util.isNodejs?r(5819):null,o=n.asn1,a=n.util;n.pki=n.pki||{},e.exports=n.pki.rsa=n.rsa=n.rsa||{};var c=n.pki,l=[6,4,2,4,2,4,6,2],u={name:"PrivateKeyInfo",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:o.Class.UNIVERSAL,type:o.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:o.Class.UNIVERSAL,type:o.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},h={name:"RSAPrivateKey",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},d={name:"RSAPublicKey",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},p=n.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:o.Class.UNIVERSAL,type:o.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:o.Class.UNIVERSAL,type:o.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},f={name:"DigestInfo",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm.algorithmIdentifier",tagClass:o.Class.UNIVERSAL,type:o.Type.OID,constructed:!1,capture:"algorithmIdentifier"},{name:"DigestInfo.DigestAlgorithm.parameters",tagClass:o.Class.UNIVERSAL,type:o.Type.NULL,capture:"parameters",optional:!0,constructed:!1}]},{name:"DigestInfo.digest",tagClass:o.Class.UNIVERSAL,type:o.Type.OCTETSTRING,constructed:!1,capture:"digest"}]},y=function(e){var t;if(!(e.algorithm in c.oids)){var r=new Error("Unknown message digest algorithm.");throw r.algorithm=e.algorithm,r}t=c.oids[e.algorithm];var n=o.oidToDer(t).getBytes(),i=o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[]),s=o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[]);s.value.push(o.create(o.Class.UNIVERSAL,o.Type.OID,!1,n)),s.value.push(o.create(o.Class.UNIVERSAL,o.Type.NULL,!1,""));var a=o.create(o.Class.UNIVERSAL,o.Type.OCTETSTRING,!1,e.digest().getBytes());return i.value.push(s),i.value.push(a),o.toDer(i).getBytes()},g=function(e,t,r){if(r)return e.modPow(t.e,t.n);if(!t.p||!t.q)return e.modPow(t.d,t.n);var s;t.dP||(t.dP=t.d.mod(t.p.subtract(i.ONE))),t.dQ||(t.dQ=t.d.mod(t.q.subtract(i.ONE))),t.qInv||(t.qInv=t.q.modInverse(t.p));do{s=new i(n.util.bytesToHex(n.random.getBytes(t.n.bitLength()/8)),16)}while(s.compareTo(t.n)>=0||!s.gcd(t.n).equals(i.ONE));for(var o=(e=e.multiply(s.modPow(t.e,t.n)).mod(t.n)).mod(t.p).modPow(t.dP,t.p),a=e.mod(t.q).modPow(t.dQ,t.q);o.compareTo(a)<0;)o=o.add(t.p);var c=o.subtract(a).multiply(t.qInv).mod(t.p).multiply(t.q).add(a);return c.multiply(s.modInverse(t.n)).mod(t.n)};function m(e,t,r){var i=n.util.createBuffer(),s=Math.ceil(t.n.bitLength()/8);if(e.length>s-11){var o=new Error("Message is too long for PKCS#1 v1.5 padding.");throw o.length=e.length,o.max=s-11,o}i.putByte(0),i.putByte(r);var a,c=s-3-e.length;if(0===r||1===r){a=0===r?0:255;for(var l=0;l<c;++l)i.putByte(a)}else for(;c>0;){var u=0,h=n.random.getBytes(c);for(l=0;l<c;++l)0===(a=h.charCodeAt(l))?++u:i.putByte(a);c=u}return i.putByte(0),i.putBytes(e),i}function w(e,t,r,i){var s=Math.ceil(t.n.bitLength()/8),o=n.util.createBuffer(e),a=o.getByte(),c=o.getByte();if(0!==a||r&&0!==c&&1!==c||!r&&2!=c||r&&0===c&&void 0===i)throw new Error("Encryption block is invalid.");var l=0;if(0===c){l=s-3-i;for(var u=0;u<l;++u)if(0!==o.getByte())throw new Error("Encryption block is invalid.")}else if(1===c)for(l=0;o.length()>1;){if(255!==o.getByte()){--o.read;break}++l}else if(2===c)for(l=0;o.length()>1;){if(0===o.getByte()){--o.read;break}++l}if(0!==o.getByte()||l!==s-3-o.length())throw new Error("Encryption block is invalid.");return o.getBytes()}function E(e){var t=e.toString(16);t[0]>="8"&&(t="00"+t);var r=n.util.hexToBytes(t);return r.length>1&&(0===r.charCodeAt(0)&&0==(128&r.charCodeAt(1))||255===r.charCodeAt(0)&&128==(128&r.charCodeAt(1)))?r.substr(1):r}function b(e){return e<=100?27:e<=150?18:e<=200?15:e<=250?12:e<=300?9:e<=350?8:e<=400?7:e<=500?6:e<=600?5:e<=800?4:e<=1250?3:2}function v(e){return n.util.isNodejs&&"function"==typeof s[e]}function _(e){return void 0!==a.globalScope&&"object"==typeof a.globalScope.crypto&&"object"==typeof a.globalScope.crypto.subtle&&"function"==typeof a.globalScope.crypto.subtle[e]}function S(e){return void 0!==a.globalScope&&"object"==typeof a.globalScope.msCrypto&&"object"==typeof a.globalScope.msCrypto.subtle&&"function"==typeof a.globalScope.msCrypto.subtle[e]}function C(e){for(var t=n.util.hexToBytes(e.toString(16)),r=new Uint8Array(t.length),i=0;i<t.length;++i)r[i]=t.charCodeAt(i);return r}c.rsa.encrypt=function(e,t,r){var s,o=r,a=Math.ceil(t.n.bitLength()/8);!1!==r&&!0!==r?(o=2===r,s=m(e,t,r)):(s=n.util.createBuffer()).putBytes(e);for(var c=new i(s.toHex(),16),l=g(c,t,o).toString(16),u=n.util.createBuffer(),h=a-Math.ceil(l.length/2);h>0;)u.putByte(0),--h;return u.putBytes(n.util.hexToBytes(l)),u.getBytes()},c.rsa.decrypt=function(e,t,r,s){var o=Math.ceil(t.n.bitLength()/8);if(e.length!==o){var a=new Error("Encrypted message length is invalid.");throw a.length=e.length,a.expected=o,a}var c=new i(n.util.createBuffer(e).toHex(),16);if(c.compareTo(t.n)>=0)throw new Error("Encrypted message is invalid.");for(var l=g(c,t,r).toString(16),u=n.util.createBuffer(),h=o-Math.ceil(l.length/2);h>0;)u.putByte(0),--h;return u.putBytes(n.util.hexToBytes(l)),!1!==s?w(u.getBytes(),t,r):u.getBytes()},c.rsa.createKeyPairGenerationState=function(e,t,r){"string"==typeof e&&(e=parseInt(e,10)),e=e||2048;var s,o=(r=r||{}).prng||n.random,a={nextBytes:function(e){for(var t=o.getBytesSync(e.length),r=0;r<e.length;++r)e[r]=t.charCodeAt(r)}},c=r.algorithm||"PRIMEINC";if("PRIMEINC"!==c)throw new Error("Invalid key generation algorithm: "+c);return(s={algorithm:c,state:0,bits:e,rng:a,eInt:t||65537,e:new i(null),p:null,q:null,qBits:e>>1,pBits:e-(e>>1),pqState:0,num:null,keys:null}).e.fromInt(s.eInt),s},c.rsa.stepKeyPairGenerationState=function(e,t){"algorithm"in e||(e.algorithm="PRIMEINC");var r=new i(null);r.fromInt(30);for(var n,s=0,o=function(e,t){return e|t},a=+new Date,u=0;null===e.keys&&(t<=0||u<t);){if(0===e.state){var h=null===e.p?e.pBits:e.qBits,d=h-1;0===e.pqState?(e.num=new i(h,e.rng),e.num.testBit(d)||e.num.bitwiseTo(i.ONE.shiftLeft(d),o,e.num),e.num.dAddOffset(31-e.num.mod(r).byteValue(),0),s=0,++e.pqState):1===e.pqState?e.num.bitLength()>h?e.pqState=0:e.num.isProbablePrime(b(e.num.bitLength()))?++e.pqState:e.num.dAddOffset(l[s++%8],0):2===e.pqState?e.pqState=0===e.num.subtract(i.ONE).gcd(e.e).compareTo(i.ONE)?3:0:3===e.pqState&&(e.pqState=0,null===e.p?e.p=e.num:e.q=e.num,null!==e.p&&null!==e.q&&++e.state,e.num=null)}else if(1===e.state)e.p.compareTo(e.q)<0&&(e.num=e.p,e.p=e.q,e.q=e.num),++e.state;else if(2===e.state)e.p1=e.p.subtract(i.ONE),e.q1=e.q.subtract(i.ONE),e.phi=e.p1.multiply(e.q1),++e.state;else if(3===e.state)0===e.phi.gcd(e.e).compareTo(i.ONE)?++e.state:(e.p=null,e.q=null,e.state=0);else if(4===e.state)e.n=e.p.multiply(e.q),e.n.bitLength()===e.bits?++e.state:(e.q=null,e.state=0);else if(5===e.state){var p=e.e.modInverse(e.phi);e.keys={privateKey:c.rsa.setPrivateKey(e.n,e.e,p,e.p,e.q,p.mod(e.p1),p.mod(e.q1),e.q.modInverse(e.p)),publicKey:c.rsa.setPublicKey(e.n,e.e)}}u+=(n=+new Date)-a,a=n}return null!==e.keys},c.rsa.generateKeyPair=function(e,t,r,l){if(1===arguments.length?"object"==typeof e?(r=e,e=void 0):"function"==typeof e&&(l=e,e=void 0):2===arguments.length?"number"==typeof e?"function"==typeof t?(l=t,t=void 0):"number"!=typeof t&&(r=t,t=void 0):(r=e,l=t,e=void 0,t=void 0):3===arguments.length&&("number"==typeof t?"function"==typeof r&&(l=r,r=void 0):(l=r,r=t,t=void 0)),r=r||{},void 0===e&&(e=r.bits||2048),void 0===t&&(t=r.e||65537),!n.options.usePureJavaScript&&!r.prng&&e>=256&&e<=16384&&(65537===t||3===t))if(l){if(v("generateKeyPair"))return s.generateKeyPair("rsa",{modulusLength:e,publicExponent:t,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},(function(e,t,r){if(e)return l(e);l(null,{privateKey:c.privateKeyFromPem(r),publicKey:c.publicKeyFromPem(t)})}));if(_("generateKey")&&_("exportKey"))return a.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:C(t),hash:{name:"SHA-256"}},!0,["sign","verify"]).then((function(e){return a.globalScope.crypto.subtle.exportKey("pkcs8",e.privateKey)})).then(void 0,(function(e){l(e)})).then((function(e){if(e){var t=c.privateKeyFromAsn1(o.fromDer(n.util.createBuffer(e)));l(null,{privateKey:t,publicKey:c.setRsaPublicKey(t.n,t.e)})}}));if(S("generateKey")&&S("exportKey")){var u=a.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:C(t),hash:{name:"SHA-256"}},!0,["sign","verify"]);return u.oncomplete=function(e){var t=e.target.result,r=a.globalScope.msCrypto.subtle.exportKey("pkcs8",t.privateKey);r.oncomplete=function(e){var t=e.target.result,r=c.privateKeyFromAsn1(o.fromDer(n.util.createBuffer(t)));l(null,{privateKey:r,publicKey:c.setRsaPublicKey(r.n,r.e)})},r.onerror=function(e){l(e)}},void(u.onerror=function(e){l(e)})}}else if(v("generateKeyPairSync")){var h=s.generateKeyPairSync("rsa",{modulusLength:e,publicExponent:t,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:c.privateKeyFromPem(h.privateKey),publicKey:c.publicKeyFromPem(h.publicKey)}}var d=c.rsa.createKeyPairGenerationState(e,t,r);if(!l)return c.rsa.stepKeyPairGenerationState(d,0),d.keys;!function(e,t,r){"function"==typeof t&&(r=t,t={});var s={algorithm:{name:(t=t||{}).algorithm||"PRIMEINC",options:{workers:t.workers||2,workLoad:t.workLoad||100,workerScript:t.workerScript}}};function o(){a(e.pBits,(function(t,n){return t?r(t):(e.p=n,null!==e.q?l(t,e.q):void a(e.qBits,l))}))}function a(e,t){n.prime.generateProbablePrime(e,s,t)}function l(t,n){if(t)return r(t);if(e.q=n,e.p.compareTo(e.q)<0){var s=e.p;e.p=e.q,e.q=s}if(0!==e.p.subtract(i.ONE).gcd(e.e).compareTo(i.ONE))return e.p=null,void o();if(0!==e.q.subtract(i.ONE).gcd(e.e).compareTo(i.ONE))return e.q=null,void a(e.qBits,l);if(e.p1=e.p.subtract(i.ONE),e.q1=e.q.subtract(i.ONE),e.phi=e.p1.multiply(e.q1),0!==e.phi.gcd(e.e).compareTo(i.ONE))return e.p=e.q=null,void o();if(e.n=e.p.multiply(e.q),e.n.bitLength()!==e.bits)return e.q=null,void a(e.qBits,l);var u=e.e.modInverse(e.phi);e.keys={privateKey:c.rsa.setPrivateKey(e.n,e.e,u,e.p,e.q,u.mod(e.p1),u.mod(e.q1),e.q.modInverse(e.p)),publicKey:c.rsa.setPublicKey(e.n,e.e)},r(null,e.keys)}"prng"in t&&(s.prng=t.prng),o()}(d,r,l)},c.setRsaPublicKey=c.rsa.setPublicKey=function(e,t){var r={n:e,e:t,encrypt:function(e,t,i){if("string"==typeof t?t=t.toUpperCase():void 0===t&&(t="RSAES-PKCS1-V1_5"),"RSAES-PKCS1-V1_5"===t)t={encode:function(e,t,r){return m(e,t,2).getBytes()}};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={encode:function(e,t){return n.pkcs1.encode_rsa_oaep(t,e,i)}};else if(-1!==["RAW","NONE","NULL",null].indexOf(t))t={encode:function(e){return e}};else if("string"==typeof t)throw new Error('Unsupported encryption scheme: "'+t+'".');var s=t.encode(e,r,!0);return c.rsa.encrypt(s,r,!0)},verify:function(e,t,i,s){"string"==typeof i?i=i.toUpperCase():void 0===i&&(i="RSASSA-PKCS1-V1_5"),void 0===s&&(s={_parseAllDigestBytes:!0}),"_parseAllDigestBytes"in s||(s._parseAllDigestBytes=!0),"RSASSA-PKCS1-V1_5"===i?i={verify:function(e,t){t=w(t,r,!0);var i=o.fromDer(t,{parseAllBytes:s._parseAllDigestBytes}),a={},c=[];if(!o.validate(i,f,a,c))throw(l=new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value.")).errors=c,l;var l,u=o.derToOid(a.algorithmIdentifier);if(u!==n.oids.md2&&u!==n.oids.md5&&u!==n.oids.sha1&&u!==n.oids.sha224&&u!==n.oids.sha256&&u!==n.oids.sha384&&u!==n.oids.sha512&&u!==n.oids["sha512-224"]&&u!==n.oids["sha512-256"])throw(l=new Error("Unknown RSASSA-PKCS1-v1_5 DigestAlgorithm identifier.")).oid=u,l;if((u===n.oids.md2||u===n.oids.md5)&&!("parameters"in a))throw new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value. Missing algorithm identifer NULL parameters.");return e===a.digest}}:"NONE"!==i&&"NULL"!==i&&null!==i||(i={verify:function(e,t){return e===w(t,r,!0)}});var a=c.rsa.decrypt(t,r,!0,!1);return i.verify(e,a,r.n.bitLength())}};return r},c.setRsaPrivateKey=c.rsa.setPrivateKey=function(e,t,r,i,s,o,a,l){var u={n:e,e:t,d:r,p:i,q:s,dP:o,dQ:a,qInv:l,decrypt:function(e,t,r){"string"==typeof t?t=t.toUpperCase():void 0===t&&(t="RSAES-PKCS1-V1_5");var i=c.rsa.decrypt(e,u,!1,!1);if("RSAES-PKCS1-V1_5"===t)t={decode:w};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={decode:function(e,t){return n.pkcs1.decode_rsa_oaep(t,e,r)}};else{if(-1===["RAW","NONE","NULL",null].indexOf(t))throw new Error('Unsupported encryption scheme: "'+t+'".');t={decode:function(e){return e}}}return t.decode(i,u,!1)},sign:function(e,t){var r=!1;"string"==typeof t&&(t=t.toUpperCase()),void 0===t||"RSASSA-PKCS1-V1_5"===t?(t={encode:y},r=1):"NONE"!==t&&"NULL"!==t&&null!==t||(t={encode:function(){return e}},r=1);var n=t.encode(e,u.n.bitLength());return c.rsa.encrypt(n,u,r)}};return u},c.wrapRsaPrivateKey=function(e){return o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,o.integerToDer(0).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.OID,!1,o.oidToDer(c.oids.rsaEncryption).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.NULL,!1,"")]),o.create(o.Class.UNIVERSAL,o.Type.OCTETSTRING,!1,o.toDer(e).getBytes())])},c.privateKeyFromAsn1=function(e){var t,r,s,a,l,d,p,f,y={},g=[];if(o.validate(e,u,y,g)&&(e=o.fromDer(n.util.createBuffer(y.privateKey))),y={},g=[],!o.validate(e,h,y,g)){var m=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw m.errors=g,m}return t=n.util.createBuffer(y.privateKeyModulus).toHex(),r=n.util.createBuffer(y.privateKeyPublicExponent).toHex(),s=n.util.createBuffer(y.privateKeyPrivateExponent).toHex(),a=n.util.createBuffer(y.privateKeyPrime1).toHex(),l=n.util.createBuffer(y.privateKeyPrime2).toHex(),d=n.util.createBuffer(y.privateKeyExponent1).toHex(),p=n.util.createBuffer(y.privateKeyExponent2).toHex(),f=n.util.createBuffer(y.privateKeyCoefficient).toHex(),c.setRsaPrivateKey(new i(t,16),new i(r,16),new i(s,16),new i(a,16),new i(l,16),new i(d,16),new i(p,16),new i(f,16))},c.privateKeyToAsn1=c.privateKeyToRSAPrivateKey=function(e){return o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,o.integerToDer(0).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,E(e.n)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,E(e.e)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,E(e.d)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,E(e.p)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,E(e.q)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,E(e.dP)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,E(e.dQ)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,E(e.qInv))])},c.publicKeyFromAsn1=function(e){var t={},r=[];if(o.validate(e,p,t,r)){var s,a=o.derToOid(t.publicKeyOid);if(a!==c.oids.rsaEncryption)throw(s=new Error("Cannot read public key. Unknown OID.")).oid=a,s;e=t.rsaPublicKey}if(r=[],!o.validate(e,d,t,r))throw(s=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.")).errors=r,s;var l=n.util.createBuffer(t.publicKeyModulus).toHex(),u=n.util.createBuffer(t.publicKeyExponent).toHex();return c.setRsaPublicKey(new i(l,16),new i(u,16))},c.publicKeyToAsn1=c.publicKeyToSubjectPublicKeyInfo=function(e){return o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.OID,!1,o.oidToDer(c.oids.rsaEncryption).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.NULL,!1,"")]),o.create(o.Class.UNIVERSAL,o.Type.BITSTRING,!1,[c.publicKeyToRSAPublicKey(e)])])},c.publicKeyToRSAPublicKey=function(e){return o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,E(e.n)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,E(e.e))])}},137:(e,t,r)=>{var n=r(3832);r(8991),r(7116);var i=e.exports=n.sha1=n.sha1||{};n.md.sha1=n.md.algorithms.sha1=i,i.create=function(){o||(s=String.fromCharCode(128),s+=n.util.fillString(String.fromCharCode(0),64),o=!0);var e=null,t=n.util.createBuffer(),r=new Array(80),i={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){i.messageLength=0,i.fullMessageLength=i.messageLength64=[];for(var r=i.messageLengthSize/4,s=0;s<r;++s)i.fullMessageLength.push(0);return t=n.util.createBuffer(),e={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},i}};return i.start(),i.update=function(s,o){"utf8"===o&&(s=n.util.encodeUtf8(s));var c=s.length;i.messageLength+=c,c=[c/4294967296>>>0,c>>>0];for(var l=i.fullMessageLength.length-1;l>=0;--l)i.fullMessageLength[l]+=c[1],c[1]=c[0]+(i.fullMessageLength[l]/4294967296>>>0),i.fullMessageLength[l]=i.fullMessageLength[l]>>>0,c[0]=c[1]/4294967296>>>0;return t.putBytes(s),a(e,r,t),(t.read>2048||0===t.length())&&t.compact(),i},i.digest=function(){var o=n.util.createBuffer();o.putBytes(t.bytes());var c,l=i.fullMessageLength[i.fullMessageLength.length-1]+i.messageLengthSize&i.blockLength-1;o.putBytes(s.substr(0,i.blockLength-l));for(var u=8*i.fullMessageLength[0],h=0;h<i.fullMessageLength.length-1;++h)u+=(c=8*i.fullMessageLength[h+1])/4294967296>>>0,o.putInt32(u>>>0),u=c>>>0;o.putInt32(u);var d={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4};a(d,r,o);var p=n.util.createBuffer();return p.putInt32(d.h0),p.putInt32(d.h1),p.putInt32(d.h2),p.putInt32(d.h3),p.putInt32(d.h4),p},i};var s=null,o=!1;function a(e,t,r){for(var n,i,s,o,a,c,l,u=r.length();u>=64;){for(i=e.h0,s=e.h1,o=e.h2,a=e.h3,c=e.h4,l=0;l<16;++l)n=r.getInt32(),t[l]=n,n=(i<<5|i>>>27)+(a^s&(o^a))+c+1518500249+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;l<20;++l)n=(n=t[l-3]^t[l-8]^t[l-14]^t[l-16])<<1|n>>>31,t[l]=n,n=(i<<5|i>>>27)+(a^s&(o^a))+c+1518500249+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;l<32;++l)n=(n=t[l-3]^t[l-8]^t[l-14]^t[l-16])<<1|n>>>31,t[l]=n,n=(i<<5|i>>>27)+(s^o^a)+c+1859775393+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;l<40;++l)n=(n=t[l-6]^t[l-16]^t[l-28]^t[l-32])<<2|n>>>30,t[l]=n,n=(i<<5|i>>>27)+(s^o^a)+c+1859775393+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;l<60;++l)n=(n=t[l-6]^t[l-16]^t[l-28]^t[l-32])<<2|n>>>30,t[l]=n,n=(i<<5|i>>>27)+(s&o|a&(s^o))+c+2400959708+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;l<80;++l)n=(n=t[l-6]^t[l-16]^t[l-28]^t[l-32])<<2|n>>>30,t[l]=n,n=(i<<5|i>>>27)+(s^o^a)+c+3395469782+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;e.h0=e.h0+i|0,e.h1=e.h1+s|0,e.h2=e.h2+o|0,e.h3=e.h3+a|0,e.h4=e.h4+c|0,u-=64}}},1668:(e,t,r)=>{var n=r(3832);r(8991),r(7116);var i=e.exports=n.sha256=n.sha256||{};n.md.sha256=n.md.algorithms.sha256=i,i.create=function(){o||(s=String.fromCharCode(128),s+=n.util.fillString(String.fromCharCode(0),64),a=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],o=!0);var e=null,t=n.util.createBuffer(),r=new Array(64),i={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){i.messageLength=0,i.fullMessageLength=i.messageLength64=[];for(var r=i.messageLengthSize/4,s=0;s<r;++s)i.fullMessageLength.push(0);return t=n.util.createBuffer(),e={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},i}};return i.start(),i.update=function(s,o){"utf8"===o&&(s=n.util.encodeUtf8(s));var a=s.length;i.messageLength+=a,a=[a/4294967296>>>0,a>>>0];for(var l=i.fullMessageLength.length-1;l>=0;--l)i.fullMessageLength[l]+=a[1],a[1]=a[0]+(i.fullMessageLength[l]/4294967296>>>0),i.fullMessageLength[l]=i.fullMessageLength[l]>>>0,a[0]=a[1]/4294967296>>>0;return t.putBytes(s),c(e,r,t),(t.read>2048||0===t.length())&&t.compact(),i},i.digest=function(){var o=n.util.createBuffer();o.putBytes(t.bytes());var a,l=i.fullMessageLength[i.fullMessageLength.length-1]+i.messageLengthSize&i.blockLength-1;o.putBytes(s.substr(0,i.blockLength-l));for(var u=8*i.fullMessageLength[0],h=0;h<i.fullMessageLength.length-1;++h)u+=(a=8*i.fullMessageLength[h+1])/4294967296>>>0,o.putInt32(u>>>0),u=a>>>0;o.putInt32(u);var d={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4,h5:e.h5,h6:e.h6,h7:e.h7};c(d,r,o);var p=n.util.createBuffer();return p.putInt32(d.h0),p.putInt32(d.h1),p.putInt32(d.h2),p.putInt32(d.h3),p.putInt32(d.h4),p.putInt32(d.h5),p.putInt32(d.h6),p.putInt32(d.h7),p},i};var s=null,o=!1,a=null;function c(e,t,r){for(var n,i,s,o,c,l,u,h,d,p,f,y,g,m=r.length();m>=64;){for(c=0;c<16;++c)t[c]=r.getInt32();for(;c<64;++c)n=((n=t[c-2])>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,i=((i=t[c-15])>>>7|i<<25)^(i>>>18|i<<14)^i>>>3,t[c]=n+t[c-7]+i+t[c-16]|0;for(l=e.h0,u=e.h1,h=e.h2,d=e.h3,p=e.h4,f=e.h5,y=e.h6,g=e.h7,c=0;c<64;++c)s=(l>>>2|l<<30)^(l>>>13|l<<19)^(l>>>22|l<<10),o=l&u|h&(l^u),n=g+((p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7))+(y^p&(f^y))+a[c]+t[c],g=y,y=f,f=p,p=d+n>>>0,d=h,h=u,u=l,l=n+(i=s+o)>>>0;e.h0=e.h0+l|0,e.h1=e.h1+u|0,e.h2=e.h2+h|0,e.h3=e.h3+d|0,e.h4=e.h4+p|0,e.h5=e.h5+f|0,e.h6=e.h6+y|0,e.h7=e.h7+g|0,m-=64}}},3219:(e,t,r)=>{var n=r(3832);r(8991),r(7116);var i=e.exports=n.sha512=n.sha512||{};n.md.sha512=n.md.algorithms.sha512=i;var s=n.sha384=n.sha512.sha384=n.sha512.sha384||{};s.create=function(){return i.create("SHA-384")},n.md.sha384=n.md.algorithms.sha384=s,n.sha512.sha256=n.sha512.sha256||{create:function(){return i.create("SHA-512/256")}},n.md["sha512/256"]=n.md.algorithms["sha512/256"]=n.sha512.sha256,n.sha512.sha224=n.sha512.sha224||{create:function(){return i.create("SHA-512/224")}},n.md["sha512/224"]=n.md.algorithms["sha512/224"]=n.sha512.sha224,i.create=function(e){if(a||(o=String.fromCharCode(128),o+=n.util.fillString(String.fromCharCode(0),128),c=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],(l={})["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],l["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],l["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],l["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],a=!0),void 0===e&&(e="SHA-512"),!(e in l))throw new Error("Invalid SHA-512 algorithm: "+e);for(var t=l[e],r=null,i=n.util.createBuffer(),s=new Array(80),h=0;h<80;++h)s[h]=new Array(2);var d=64;switch(e){case"SHA-384":d=48;break;case"SHA-512/256":d=32;break;case"SHA-512/224":d=28}var p={algorithm:e.replace("-","").toLowerCase(),blockLength:128,digestLength:d,messageLength:0,fullMessageLength:null,messageLengthSize:16,start:function(){p.messageLength=0,p.fullMessageLength=p.messageLength128=[];for(var e=p.messageLengthSize/4,s=0;s<e;++s)p.fullMessageLength.push(0);for(i=n.util.createBuffer(),r=new Array(t.length),s=0;s<t.length;++s)r[s]=t[s].slice(0);return p}};return p.start(),p.update=function(e,t){"utf8"===t&&(e=n.util.encodeUtf8(e));var o=e.length;p.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var a=p.fullMessageLength.length-1;a>=0;--a)p.fullMessageLength[a]+=o[1],o[1]=o[0]+(p.fullMessageLength[a]/4294967296>>>0),p.fullMessageLength[a]=p.fullMessageLength[a]>>>0,o[0]=o[1]/4294967296>>>0;return i.putBytes(e),u(r,s,i),(i.read>2048||0===i.length())&&i.compact(),p},p.digest=function(){var t=n.util.createBuffer();t.putBytes(i.bytes());var a,c=p.fullMessageLength[p.fullMessageLength.length-1]+p.messageLengthSize&p.blockLength-1;t.putBytes(o.substr(0,p.blockLength-c));for(var l=8*p.fullMessageLength[0],h=0;h<p.fullMessageLength.length-1;++h)l+=(a=8*p.fullMessageLength[h+1])/4294967296>>>0,t.putInt32(l>>>0),l=a>>>0;t.putInt32(l);var d=new Array(r.length);for(h=0;h<r.length;++h)d[h]=r[h].slice(0);u(d,s,t);var f,y=n.util.createBuffer();for(f="SHA-512"===e?d.length:"SHA-384"===e?d.length-2:d.length-4,h=0;h<f;++h)y.putInt32(d[h][0]),h===f-1&&"SHA-512/224"===e||y.putInt32(d[h][1]);return y},p};var o=null,a=!1,c=null,l=null;function u(e,t,r){for(var n,i,s,o,a,l,u,h,d,p,f,y,g,m,w,E,b,v,_,S,C,A,I,T,R,k,N,L,D,P,B,O,x,U=r.length();U>=128;){for(N=0;N<16;++N)t[N][0]=r.getInt32()>>>0,t[N][1]=r.getInt32()>>>0;for(;N<80;++N)n=(((L=(P=t[N-2])[0])>>>19|(D=P[1])<<13)^(D>>>29|L<<3)^L>>>6)>>>0,i=((L<<13|D>>>19)^(D<<3|L>>>29)^(L<<26|D>>>6))>>>0,s=(((L=(O=t[N-15])[0])>>>1|(D=O[1])<<31)^(L>>>8|D<<24)^L>>>7)>>>0,o=((L<<31|D>>>1)^(L<<24|D>>>8)^(L<<25|D>>>7))>>>0,B=t[N-7],x=t[N-16],D=i+B[1]+o+x[1],t[N][0]=n+B[0]+s+x[0]+(D/4294967296>>>0)>>>0,t[N][1]=D>>>0;for(f=e[0][0],y=e[0][1],g=e[1][0],m=e[1][1],w=e[2][0],E=e[2][1],b=e[3][0],v=e[3][1],_=e[4][0],S=e[4][1],C=e[5][0],A=e[5][1],I=e[6][0],T=e[6][1],R=e[7][0],k=e[7][1],N=0;N<80;++N)u=((_>>>14|S<<18)^(_>>>18|S<<14)^(S>>>9|_<<23))>>>0,h=(I^_&(C^I))>>>0,a=((f>>>28|y<<4)^(y>>>2|f<<30)^(y>>>7|f<<25))>>>0,l=((f<<4|y>>>28)^(y<<30|f>>>2)^(y<<25|f>>>7))>>>0,d=(f&g|w&(f^g))>>>0,p=(y&m|E&(y^m))>>>0,D=k+(((_<<18|S>>>14)^(_<<14|S>>>18)^(S<<23|_>>>9))>>>0)+((T^S&(A^T))>>>0)+c[N][1]+t[N][1],n=R+u+h+c[N][0]+t[N][0]+(D/4294967296>>>0)>>>0,i=D>>>0,s=a+d+((D=l+p)/4294967296>>>0)>>>0,o=D>>>0,R=I,k=T,I=C,T=A,C=_,A=S,_=b+n+((D=v+i)/4294967296>>>0)>>>0,S=D>>>0,b=w,v=E,w=g,E=m,g=f,m=y,f=n+s+((D=i+o)/4294967296>>>0)>>>0,y=D>>>0;D=e[0][1]+y,e[0][0]=e[0][0]+f+(D/4294967296>>>0)>>>0,e[0][1]=D>>>0,D=e[1][1]+m,e[1][0]=e[1][0]+g+(D/4294967296>>>0)>>>0,e[1][1]=D>>>0,D=e[2][1]+E,e[2][0]=e[2][0]+w+(D/4294967296>>>0)>>>0,e[2][1]=D>>>0,D=e[3][1]+v,e[3][0]=e[3][0]+b+(D/4294967296>>>0)>>>0,e[3][1]=D>>>0,D=e[4][1]+S,e[4][0]=e[4][0]+_+(D/4294967296>>>0)>>>0,e[4][1]=D>>>0,D=e[5][1]+A,e[5][0]=e[5][0]+C+(D/4294967296>>>0)>>>0,e[5][1]=D>>>0,D=e[6][1]+T,e[6][0]=e[6][0]+I+(D/4294967296>>>0)>>>0,e[6][1]=D>>>0,D=e[7][1]+k,e[7][0]=e[7][0]+R+(D/4294967296>>>0)>>>0,e[7][1]=D>>>0,U-=128}}},7116:(e,t,r)=>{var n=r(3832),i=r(8807),s=e.exports=n.util=n.util||{};function o(e){if(8!==e&&16!==e&&24!==e&&32!==e)throw new Error("Only 8, 16, 24, or 32 bits supported: "+e)}function a(e){if(this.data="",this.read=0,"string"==typeof e)this.data=e;else if(s.isArrayBuffer(e)||s.isArrayBufferView(e))if("undefined"!=typeof Buffer&&e instanceof Buffer)this.data=e.toString("binary");else{var t=new Uint8Array(e);try{this.data=String.fromCharCode.apply(null,t)}catch(e){for(var r=0;r<t.length;++r)this.putByte(t[r])}}else(e instanceof a||"object"==typeof e&&"string"==typeof e.data&&"number"==typeof e.read)&&(this.data=e.data,this.read=e.read);this._constructedStringLength=0}!function(){if("undefined"!=typeof process&&process.nextTick&&!process.browser)return s.nextTick=process.nextTick,void("function"==typeof setImmediate?s.setImmediate=setImmediate:s.setImmediate=s.nextTick);if("function"==typeof setImmediate)return s.setImmediate=function(){return setImmediate.apply(void 0,arguments)},void(s.nextTick=function(e){return setImmediate(e)});if(s.setImmediate=function(e){setTimeout(e,0)},"undefined"!=typeof window&&"function"==typeof window.postMessage){var e="forge.setImmediate",t=[];s.setImmediate=function(r){t.push(r),1===t.length&&window.postMessage(e,"*")},window.addEventListener("message",(function(r){if(r.source===window&&r.data===e){r.stopPropagation();var n=t.slice();t.length=0,n.forEach((function(e){e()}))}}),!0)}if("undefined"!=typeof MutationObserver){var r=Date.now(),n=!0,i=document.createElement("div");t=[],new MutationObserver((function(){var e=t.slice();t.length=0,e.forEach((function(e){e()}))})).observe(i,{attributes:!0});var o=s.setImmediate;s.setImmediate=function(e){Date.now()-r>15?(r=Date.now(),o(e)):(t.push(e),1===t.length&&i.setAttribute("a",n=!n))}}s.nextTick=s.setImmediate}(),s.isNodejs="undefined"!=typeof process&&process.versions&&process.versions.node,s.globalScope=s.isNodejs?r.g:"undefined"==typeof self?window:self,s.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},s.isArrayBuffer=function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer},s.isArrayBufferView=function(e){return e&&s.isArrayBuffer(e.buffer)&&void 0!==e.byteLength},s.ByteBuffer=a,s.ByteStringBuffer=a,s.ByteStringBuffer.prototype._optimizeConstructedString=function(e){this._constructedStringLength+=e,this._constructedStringLength>4096&&(this.data.substr(0,1),this._constructedStringLength=0)},s.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read},s.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0},s.ByteStringBuffer.prototype.putByte=function(e){return this.putBytes(String.fromCharCode(e))},s.ByteStringBuffer.prototype.fillWithByte=function(e,t){e=String.fromCharCode(e);for(var r=this.data;t>0;)1&t&&(r+=e),(t>>>=1)>0&&(e+=e);return this.data=r,this._optimizeConstructedString(t),this},s.ByteStringBuffer.prototype.putBytes=function(e){return this.data+=e,this._optimizeConstructedString(e.length),this},s.ByteStringBuffer.prototype.putString=function(e){return this.putBytes(s.encodeUtf8(e))},s.ByteStringBuffer.prototype.putInt16=function(e){return this.putBytes(String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},s.ByteStringBuffer.prototype.putInt24=function(e){return this.putBytes(String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},s.ByteStringBuffer.prototype.putInt32=function(e){return this.putBytes(String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},s.ByteStringBuffer.prototype.putInt16Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255))},s.ByteStringBuffer.prototype.putInt24Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255))},s.ByteStringBuffer.prototype.putInt32Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>24&255))},s.ByteStringBuffer.prototype.putInt=function(e,t){o(t);var r="";do{t-=8,r+=String.fromCharCode(e>>t&255)}while(t>0);return this.putBytes(r)},s.ByteStringBuffer.prototype.putSignedInt=function(e,t){return e<0&&(e+=2<<t-1),this.putInt(e,t)},s.ByteStringBuffer.prototype.putBuffer=function(e){return this.putBytes(e.getBytes())},s.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)},s.ByteStringBuffer.prototype.getInt16=function(){var e=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,e},s.ByteStringBuffer.prototype.getInt24=function(){var e=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,e},s.ByteStringBuffer.prototype.getInt32=function(){var e=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,e},s.ByteStringBuffer.prototype.getInt16Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,e},s.ByteStringBuffer.prototype.getInt24Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,e},s.ByteStringBuffer.prototype.getInt32Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,e},s.ByteStringBuffer.prototype.getInt=function(e){o(e);var t=0;do{t=(t<<8)+this.data.charCodeAt(this.read++),e-=8}while(e>0);return t},s.ByteStringBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),r=2<<e-2;return t>=r&&(t-=r<<1),t},s.ByteStringBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},s.ByteStringBuffer.prototype.bytes=function(e){return void 0===e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},s.ByteStringBuffer.prototype.at=function(e){return this.data.charCodeAt(this.read+e)},s.ByteStringBuffer.prototype.setAt=function(e,t){return this.data=this.data.substr(0,this.read+e)+String.fromCharCode(t)+this.data.substr(this.read+e+1),this},s.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)},s.ByteStringBuffer.prototype.copy=function(){var e=s.createBuffer(this.data);return e.read=this.read,e},s.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this},s.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this},s.ByteStringBuffer.prototype.truncate=function(e){var t=Math.max(0,this.length()-e);return this.data=this.data.substr(this.read,t),this.read=0,this},s.ByteStringBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.length;++t){var r=this.data.charCodeAt(t);r<16&&(e+="0"),e+=r.toString(16)}return e},s.ByteStringBuffer.prototype.toString=function(){return s.decodeUtf8(this.bytes())},s.DataBuffer=function(e,t){t=t||{},this.read=t.readOffset||0,this.growSize=t.growSize||1024;var r=s.isArrayBuffer(e),n=s.isArrayBufferView(e);if(r||n)return this.data=r?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),void(this.write="writeOffset"in t?t.writeOffset:this.data.byteLength);this.data=new DataView(new ArrayBuffer(0)),this.write=0,null!=e&&this.putBytes(e),"writeOffset"in t&&(this.write=t.writeOffset)},s.DataBuffer.prototype.length=function(){return this.write-this.read},s.DataBuffer.prototype.isEmpty=function(){return this.length()<=0},s.DataBuffer.prototype.accommodate=function(e,t){if(this.length()>=e)return this;t=Math.max(t||this.growSize,e);var r=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),n=new Uint8Array(this.length()+t);return n.set(r),this.data=new DataView(n.buffer),this},s.DataBuffer.prototype.putByte=function(e){return this.accommodate(1),this.data.setUint8(this.write++,e),this},s.DataBuffer.prototype.fillWithByte=function(e,t){this.accommodate(t);for(var r=0;r<t;++r)this.data.setUint8(e);return this},s.DataBuffer.prototype.putBytes=function(e,t){if(s.isArrayBufferView(e)){var r=(n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)).byteLength-n.byteOffset;return this.accommodate(r),new Uint8Array(this.data.buffer,this.write).set(n),this.write+=r,this}if(s.isArrayBuffer(e)){var n=new Uint8Array(e);return this.accommodate(n.byteLength),new Uint8Array(this.data.buffer).set(n,this.write),this.write+=n.byteLength,this}if(e instanceof s.DataBuffer||"object"==typeof e&&"number"==typeof e.read&&"number"==typeof e.write&&s.isArrayBufferView(e.data))return n=new Uint8Array(e.data.byteLength,e.read,e.length()),this.accommodate(n.byteLength),new Uint8Array(e.data.byteLength,this.write).set(n),this.write+=n.byteLength,this;if(e instanceof s.ByteStringBuffer&&(e=e.data,t="binary"),t=t||"binary","string"==typeof e){var i;if("hex"===t)return this.accommodate(Math.ceil(e.length/2)),i=new Uint8Array(this.data.buffer,this.write),this.write+=s.binary.hex.decode(e,i,this.write),this;if("base64"===t)return this.accommodate(3*Math.ceil(e.length/4)),i=new Uint8Array(this.data.buffer,this.write),this.write+=s.binary.base64.decode(e,i,this.write),this;if("utf8"===t&&(e=s.encodeUtf8(e),t="binary"),"binary"===t||"raw"===t)return this.accommodate(e.length),i=new Uint8Array(this.data.buffer,this.write),this.write+=s.binary.raw.decode(i),this;if("utf16"===t)return this.accommodate(2*e.length),i=new Uint16Array(this.data.buffer,this.write),this.write+=s.text.utf16.encode(i),this;throw new Error("Invalid encoding: "+t)}throw Error("Invalid parameter: "+e)},s.DataBuffer.prototype.putBuffer=function(e){return this.putBytes(e),e.clear(),this},s.DataBuffer.prototype.putString=function(e){return this.putBytes(e,"utf16")},s.DataBuffer.prototype.putInt16=function(e){return this.accommodate(2),this.data.setInt16(this.write,e),this.write+=2,this},s.DataBuffer.prototype.putInt24=function(e){return this.accommodate(3),this.data.setInt16(this.write,e>>8&65535),this.data.setInt8(this.write,e>>16&255),this.write+=3,this},s.DataBuffer.prototype.putInt32=function(e){return this.accommodate(4),this.data.setInt32(this.write,e),this.write+=4,this},s.DataBuffer.prototype.putInt16Le=function(e){return this.accommodate(2),this.data.setInt16(this.write,e,!0),this.write+=2,this},s.DataBuffer.prototype.putInt24Le=function(e){return this.accommodate(3),this.data.setInt8(this.write,e>>16&255),this.data.setInt16(this.write,e>>8&65535,!0),this.write+=3,this},s.DataBuffer.prototype.putInt32Le=function(e){return this.accommodate(4),this.data.setInt32(this.write,e,!0),this.write+=4,this},s.DataBuffer.prototype.putInt=function(e,t){o(t),this.accommodate(t/8);do{t-=8,this.data.setInt8(this.write++,e>>t&255)}while(t>0);return this},s.DataBuffer.prototype.putSignedInt=function(e,t){return o(t),this.accommodate(t/8),e<0&&(e+=2<<t-1),this.putInt(e,t)},s.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)},s.DataBuffer.prototype.getInt16=function(){var e=this.data.getInt16(this.read);return this.read+=2,e},s.DataBuffer.prototype.getInt24=function(){var e=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,e},s.DataBuffer.prototype.getInt32=function(){var e=this.data.getInt32(this.read);return this.read+=4,e},s.DataBuffer.prototype.getInt16Le=function(){var e=this.data.getInt16(this.read,!0);return this.read+=2,e},s.DataBuffer.prototype.getInt24Le=function(){var e=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,e},s.DataBuffer.prototype.getInt32Le=function(){var e=this.data.getInt32(this.read,!0);return this.read+=4,e},s.DataBuffer.prototype.getInt=function(e){o(e);var t=0;do{t=(t<<8)+this.data.getInt8(this.read++),e-=8}while(e>0);return t},s.DataBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),r=2<<e-2;return t>=r&&(t-=r<<1),t},s.DataBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},s.DataBuffer.prototype.bytes=function(e){return void 0===e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},s.DataBuffer.prototype.at=function(e){return this.data.getUint8(this.read+e)},s.DataBuffer.prototype.setAt=function(e,t){return this.data.setUint8(e,t),this},s.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)},s.DataBuffer.prototype.copy=function(){return new s.DataBuffer(this)},s.DataBuffer.prototype.compact=function(){if(this.read>0){var e=new Uint8Array(this.data.buffer,this.read),t=new Uint8Array(e.byteLength);t.set(e),this.data=new DataView(t),this.write-=this.read,this.read=0}return this},s.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this},s.DataBuffer.prototype.truncate=function(e){return this.write=Math.max(0,this.length()-e),this.read=Math.min(this.read,this.write),this},s.DataBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.byteLength;++t){var r=this.data.getUint8(t);r<16&&(e+="0"),e+=r.toString(16)}return e},s.DataBuffer.prototype.toString=function(e){var t=new Uint8Array(this.data,this.read,this.length());if("binary"===(e=e||"utf8")||"raw"===e)return s.binary.raw.encode(t);if("hex"===e)return s.binary.hex.encode(t);if("base64"===e)return s.binary.base64.encode(t);if("utf8"===e)return s.text.utf8.decode(t);if("utf16"===e)return s.text.utf16.decode(t);throw new Error("Invalid encoding: "+e)},s.createBuffer=function(e,t){return t=t||"raw",void 0!==e&&"utf8"===t&&(e=s.encodeUtf8(e)),new s.ByteBuffer(e)},s.fillString=function(e,t){for(var r="";t>0;)1&t&&(r+=e),(t>>>=1)>0&&(e+=e);return r},s.xorBytes=function(e,t,r){for(var n="",i="",s="",o=0,a=0;r>0;--r,++o)i=e.charCodeAt(o)^t.charCodeAt(o),a>=10&&(n+=s,s="",a=0),s+=String.fromCharCode(i),++a;return n+s},s.hexToBytes=function(e){var t="",r=0;for(!0&e.length&&(r=1,t+=String.fromCharCode(parseInt(e[0],16)));r<e.length;r+=2)t+=String.fromCharCode(parseInt(e.substr(r,2),16));return t},s.bytesToHex=function(e){return s.createBuffer(e).toHex()},s.int32ToBytes=function(e){return String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e)};var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],u="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";s.encode64=function(e,t){for(var r,n,i,s="",o="",a=0;a<e.length;)r=e.charCodeAt(a++),n=e.charCodeAt(a++),i=e.charCodeAt(a++),s+=c.charAt(r>>2),s+=c.charAt((3&r)<<4|n>>4),isNaN(n)?s+="==":(s+=c.charAt((15&n)<<2|i>>6),s+=isNaN(i)?"=":c.charAt(63&i)),t&&s.length>t&&(o+=s.substr(0,t)+"\r\n",s=s.substr(t));return o+s},s.decode64=function(e){e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var t,r,n,i,s="",o=0;o<e.length;)t=l[e.charCodeAt(o++)-43],r=l[e.charCodeAt(o++)-43],n=l[e.charCodeAt(o++)-43],i=l[e.charCodeAt(o++)-43],s+=String.fromCharCode(t<<2|r>>4),64!==n&&(s+=String.fromCharCode((15&r)<<4|n>>2),64!==i&&(s+=String.fromCharCode((3&n)<<6|i)));return s},s.encodeUtf8=function(e){return unescape(encodeURIComponent(e))},s.decodeUtf8=function(e){return decodeURIComponent(escape(e))},s.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:i.encode,decode:i.decode}},s.binary.raw.encode=function(e){return String.fromCharCode.apply(null,e)},s.binary.raw.decode=function(e,t,r){var n=t;n||(n=new Uint8Array(e.length));for(var i=r=r||0,s=0;s<e.length;++s)n[i++]=e.charCodeAt(s);return t?i-r:n},s.binary.hex.encode=s.bytesToHex,s.binary.hex.decode=function(e,t,r){var n=t;n||(n=new Uint8Array(Math.ceil(e.length/2)));var i=0,s=r=r||0;for(1&e.length&&(i=1,n[s++]=parseInt(e[0],16));i<e.length;i+=2)n[s++]=parseInt(e.substr(i,2),16);return t?s-r:n},s.binary.base64.encode=function(e,t){for(var r,n,i,s="",o="",a=0;a<e.byteLength;)r=e[a++],n=e[a++],i=e[a++],s+=c.charAt(r>>2),s+=c.charAt((3&r)<<4|n>>4),isNaN(n)?s+="==":(s+=c.charAt((15&n)<<2|i>>6),s+=isNaN(i)?"=":c.charAt(63&i)),t&&s.length>t&&(o+=s.substr(0,t)+"\r\n",s=s.substr(t));return o+s},s.binary.base64.decode=function(e,t,r){var n,i,s,o,a=t;a||(a=new Uint8Array(3*Math.ceil(e.length/4))),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var c=0,u=r=r||0;c<e.length;)n=l[e.charCodeAt(c++)-43],i=l[e.charCodeAt(c++)-43],s=l[e.charCodeAt(c++)-43],o=l[e.charCodeAt(c++)-43],a[u++]=n<<2|i>>4,64!==s&&(a[u++]=(15&i)<<4|s>>2,64!==o&&(a[u++]=(3&s)<<6|o));return t?u-r:a.subarray(0,u)},s.binary.base58.encode=function(e,t){return s.binary.baseN.encode(e,u,t)},s.binary.base58.decode=function(e,t){return s.binary.baseN.decode(e,u,t)},s.text={utf8:{},utf16:{}},s.text.utf8.encode=function(e,t,r){e=s.encodeUtf8(e);var n=t;n||(n=new Uint8Array(e.length));for(var i=r=r||0,o=0;o<e.length;++o)n[i++]=e.charCodeAt(o);return t?i-r:n},s.text.utf8.decode=function(e){return s.decodeUtf8(String.fromCharCode.apply(null,e))},s.text.utf16.encode=function(e,t,r){var n=t;n||(n=new Uint8Array(2*e.length));for(var i=new Uint16Array(n.buffer),s=r=r||0,o=r,a=0;a<e.length;++a)i[o++]=e.charCodeAt(a),s+=2;return t?s-r:n},s.text.utf16.decode=function(e){return String.fromCharCode.apply(null,new Uint16Array(e.buffer))},s.deflate=function(e,t,r){if(t=s.decode64(e.deflate(s.encode64(t)).rval),r){var n=2;32&t.charCodeAt(1)&&(n=6),t=t.substring(n,t.length-4)}return t},s.inflate=function(e,t,r){var n=e.inflate(s.encode64(t)).rval;return null===n?null:s.decode64(n)};var h=function(e,t,r){if(!e)throw new Error("WebStorage not available.");var n;if(null===r?n=e.removeItem(t):(r=s.encode64(JSON.stringify(r)),n=e.setItem(t,r)),void 0!==n&&!0!==n.rval){var i=new Error(n.error.message);throw i.id=n.error.id,i.name=n.error.name,i}},d=function(e,t){if(!e)throw new Error("WebStorage not available.");var r=e.getItem(t);if(e.init)if(null===r.rval){if(r.error){var n=new Error(r.error.message);throw n.id=r.error.id,n.name=r.error.name,n}r=null}else r=r.rval;return null!==r&&(r=JSON.parse(s.decode64(r))),r},p=function(e,t,r,n){var i=d(e,t);null===i&&(i={}),i[r]=n,h(e,t,i)},f=function(e,t,r){var n=d(e,t);return null!==n&&(n=r in n?n[r]:null),n},y=function(e,t,r){var n=d(e,t);if(null!==n&&r in n){delete n[r];var i=!0;for(var s in n){i=!1;break}i&&(n=null),h(e,t,n)}},g=function(e,t){h(e,t,null)},m=function(e,t,r){var n,i=null;void 0===r&&(r=["web","flash"]);var s=!1,o=null;for(var a in r){n=r[a];try{if("flash"===n||"both"===n){if(null===t[0])throw new Error("Flash local storage not available.");i=e.apply(this,t),s="flash"===n}"web"!==n&&"both"!==n||(t[0]=localStorage,i=e.apply(this,t),s=!0)}catch(e){o=e}if(s)break}if(!s)throw o;return i};s.setItem=function(e,t,r,n,i){m(p,arguments,i)},s.getItem=function(e,t,r,n){return m(f,arguments,n)},s.removeItem=function(e,t,r,n){m(y,arguments,n)},s.clearItems=function(e,t,r){m(g,arguments,r)},s.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},s.format=function(e){for(var t,r,n=/%./g,i=0,s=[],o=0;t=n.exec(e);){(r=e.substring(o,n.lastIndex-2)).length>0&&s.push(r),o=n.lastIndex;var a=t[0][1];switch(a){case"s":case"o":i<arguments.length?s.push(arguments[1+i++]):s.push("<?>");break;case"%":s.push("%");break;default:s.push("<%"+a+"?>")}}return s.push(e.substring(o)),s.join("")},s.formatNumber=function(e,t,r,n){var i=e,s=isNaN(t=Math.abs(t))?2:t,o=void 0===r?",":r,a=void 0===n?".":n,c=i<0?"-":"",l=parseInt(i=Math.abs(+i||0).toFixed(s),10)+"",u=l.length>3?l.length%3:0;return c+(u?l.substr(0,u)+a:"")+l.substr(u).replace(/(\d{3})(?=\d)/g,"$1"+a)+(s?o+Math.abs(i-l).toFixed(s).slice(2):"")},s.formatSize=function(e){return e>=1073741824?s.formatNumber(e/1073741824,2,".","")+" GiB":e>=1048576?s.formatNumber(e/1048576,2,".","")+" MiB":e>=1024?s.formatNumber(e/1024,0)+" KiB":s.formatNumber(e,0)+" bytes"},s.bytesFromIP=function(e){return-1!==e.indexOf(".")?s.bytesFromIPv4(e):-1!==e.indexOf(":")?s.bytesFromIPv6(e):null},s.bytesFromIPv4=function(e){if(4!==(e=e.split(".")).length)return null;for(var t=s.createBuffer(),r=0;r<e.length;++r){var n=parseInt(e[r],10);if(isNaN(n))return null;t.putByte(n)}return t.getBytes()},s.bytesFromIPv6=function(e){for(var t=0,r=2*(8-(e=e.split(":").filter((function(e){return 0===e.length&&++t,!0}))).length+t),n=s.createBuffer(),i=0;i<8;++i)if(e[i]&&0!==e[i].length){var o=s.hexToBytes(e[i]);o.length<2&&n.putByte(0),n.putBytes(o)}else n.fillWithByte(0,r),r=0;return n.getBytes()},s.bytesToIP=function(e){return 4===e.length?s.bytesToIPv4(e):16===e.length?s.bytesToIPv6(e):null},s.bytesToIPv4=function(e){if(4!==e.length)return null;for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t.join(".")},s.bytesToIPv6=function(e){if(16!==e.length)return null;for(var t=[],r=[],n=0,i=0;i<e.length;i+=2){for(var o=s.bytesToHex(e[i]+e[i+1]);"0"===o[0]&&"0"!==o;)o=o.substr(1);if("0"===o){var a=r[r.length-1],c=t.length;a&&c===a.end+1?(a.end=c,a.end-a.start>r[n].end-r[n].start&&(n=r.length-1)):r.push({start:c,end:c})}t.push(o)}if(r.length>0){var l=r[n];l.end-l.start>0&&(t.splice(l.start,l.end-l.start+1,""),0===l.start&&t.unshift(""),7===l.end&&t.push(""))}return t.join(":")},s.estimateCores=function(e,t){if("function"==typeof e&&(t=e,e={}),e=e||{},"cores"in s&&!e.update)return t(null,s.cores);if("undefined"!=typeof navigator&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return s.cores=navigator.hardwareConcurrency,t(null,s.cores);if("undefined"==typeof Worker)return s.cores=1,t(null,s.cores);if("undefined"==typeof Blob)return s.cores=2,t(null,s.cores);var r=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",(function(e){for(var t=Date.now(),r=t+4;Date.now()<r;);self.postMessage({st:t,et:r})}))}.toString(),")()"],{type:"application/javascript"}));!function e(n,i,o){if(0===i){var a=Math.floor(n.reduce((function(e,t){return e+t}),0)/n.length);return s.cores=Math.max(1,a),URL.revokeObjectURL(r),t(null,s.cores)}!function(e,t){for(var n=[],i=[],s=0;s<e;++s){var o=new Worker(r);o.addEventListener("message",(function(r){if(i.push(r.data),i.length===e){for(var s=0;s<e;++s)n[s].terminate();t(0,i)}})),n.push(o)}for(s=0;s<e;++s)n[s].postMessage(s)}(o,(function(t,r){n.push(function(e,t){for(var r=[],n=0;n<e;++n)for(var i=t[n],s=r[n]=[],o=0;o<e;++o)if(n!==o){var a=t[o];(i.st>a.st&&i.st<a.et||a.st>i.st&&a.st<i.et)&&s.push(o)}return r.reduce((function(e,t){return Math.max(e,t.length)}),0)}(o,r)),e(n,i-1,o)}))}([],5,16)}},5414:(e,t,r)=>{var n=r(3832);r(8925),r(3068),r(3480),r(8991),r(6971),r(6270),r(6953),r(6007),r(8095),r(7116);var i=n.asn1,s=e.exports=n.pki=n.pki||{},o=s.oids,a={};a.CN=o.commonName,a.commonName="CN",a.C=o.countryName,a.countryName="C",a.L=o.localityName,a.localityName="L",a.ST=o.stateOrProvinceName,a.stateOrProvinceName="ST",a.O=o.organizationName,a.organizationName="O",a.OU=o.organizationalUnitName,a.organizationalUnitName="OU",a.E=o.emailAddress,a.emailAddress="E";var c=n.pki.rsa.publicKeyValidator,l={name:"Certificate",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:i.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:i.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:i.Class.UNIVERSAL,type:i.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:i.Class.UNIVERSAL,type:i.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:i.Class.UNIVERSAL,type:i.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:i.Class.UNIVERSAL,type:i.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},c,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:i.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:i.Class.UNIVERSAL,type:i.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:i.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:i.Class.UNIVERSAL,type:i.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:i.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:i.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:i.Class.UNIVERSAL,type:i.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},u={name:"rsapss",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:i.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:i.Class.UNIVERSAL,type:i.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:i.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:i.Class.UNIVERSAL,type:i.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:i.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:i.Class.UNIVERSAL,type:i.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:i.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:i.Class.UNIVERSAL,type:i.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},h={name:"CertificationRequestInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},c,{name:"CertificationRequestInfo.attributes",tagClass:i.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:i.Class.UNIVERSAL,type:i.Type.SET,constructed:!0}]}]}]},d={name:"CertificationRequest",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[h,{name:"CertificationRequest.signatureAlgorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:i.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:i.Class.UNIVERSAL,type:i.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};function p(e,t){"string"==typeof t&&(t={shortName:t});for(var r,n=null,i=0;null===n&&i<e.attributes.length;++i)r=e.attributes[i],(t.type&&t.type===r.type||t.name&&t.name===r.name||t.shortName&&t.shortName===r.shortName)&&(n=r);return n}s.RDNAttributesAsArray=function(e,t){for(var r,n,s,c=[],l=0;l<e.value.length;++l){r=e.value[l];for(var u=0;u<r.value.length;++u)s={},n=r.value[u],s.type=i.derToOid(n.value[0].value),s.value=n.value[1].value,s.valueTagClass=n.value[1].type,s.type in o&&(s.name=o[s.type],s.name in a&&(s.shortName=a[s.name])),t&&(t.update(s.type),t.update(s.value)),c.push(s)}return c},s.CRIAttributesAsArray=function(e){for(var t=[],r=0;r<e.length;++r)for(var n=e[r],c=i.derToOid(n.value[0].value),l=n.value[1].value,u=0;u<l.length;++u){var h={};if(h.type=c,h.value=l[u].value,h.valueTagClass=l[u].type,h.type in o&&(h.name=o[h.type],h.name in a&&(h.shortName=a[h.name])),h.type===o.extensionRequest){h.extensions=[];for(var d=0;d<h.value.length;++d)h.extensions.push(s.certificateExtensionFromAsn1(h.value[d]))}t.push(h)}return t};var f=function(e,t,r){var n={};if(e!==o["RSASSA-PSS"])return n;r&&(n={hash:{algorithmOid:o.sha1},mgf:{algorithmOid:o.mgf1,hash:{algorithmOid:o.sha1}},saltLength:20});var s={},a=[];if(!i.validate(t,u,s,a)){var c=new Error("Cannot read RSASSA-PSS parameter block.");throw c.errors=a,c}return void 0!==s.hashOid&&(n.hash=n.hash||{},n.hash.algorithmOid=i.derToOid(s.hashOid)),void 0!==s.maskGenOid&&(n.mgf=n.mgf||{},n.mgf.algorithmOid=i.derToOid(s.maskGenOid),n.mgf.hash=n.mgf.hash||{},n.mgf.hash.algorithmOid=i.derToOid(s.maskGenHashOid)),void 0!==s.saltLength&&(n.saltLength=s.saltLength.charCodeAt(0)),n},y=function(e){switch(o[e.signatureOid]){case"sha1WithRSAEncryption":case"sha1WithRSASignature":return n.md.sha1.create();case"md5WithRSAEncryption":return n.md.md5.create();case"sha256WithRSAEncryption":case"RSASSA-PSS":return n.md.sha256.create();case"sha384WithRSAEncryption":return n.md.sha384.create();case"sha512WithRSAEncryption":return n.md.sha512.create();default:var t=new Error("Could not compute "+e.type+" digest. Unknown signature OID.");throw t.signatureOid=e.signatureOid,t}},g=function(e){var t,r=e.certificate;switch(r.signatureOid){case o.sha1WithRSAEncryption:case o.sha1WithRSASignature:break;case o["RSASSA-PSS"]:var i,s,a;if(void 0===(i=o[r.signatureParameters.mgf.hash.algorithmOid])||void 0===n.md[i])throw(a=new Error("Unsupported MGF hash function.")).oid=r.signatureParameters.mgf.hash.algorithmOid,a.name=i,a;if(void 0===(s=o[r.signatureParameters.mgf.algorithmOid])||void 0===n.mgf[s])throw(a=new Error("Unsupported MGF function.")).oid=r.signatureParameters.mgf.algorithmOid,a.name=s,a;if(s=n.mgf[s].create(n.md[i].create()),void 0===(i=o[r.signatureParameters.hash.algorithmOid])||void 0===n.md[i])throw(a=new Error("Unsupported RSASSA-PSS hash function.")).oid=r.signatureParameters.hash.algorithmOid,a.name=i,a;t=n.pss.create(n.md[i].create(),s,r.signatureParameters.saltLength)}return r.publicKey.verify(e.md.digest().getBytes(),e.signature,t)};function m(e){for(var t,r,s=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]),o=e.attributes,a=0;a<o.length;++a){var c=(t=o[a]).value,l=i.Type.PRINTABLESTRING;"valueTagClass"in t&&(l=t.valueTagClass)===i.Type.UTF8&&(c=n.util.encodeUtf8(c)),r=i.create(i.Class.UNIVERSAL,i.Type.SET,!0,[i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.type).getBytes()),i.create(i.Class.UNIVERSAL,l,!1,c)])]),s.value.push(r)}return s}function w(e){for(var t,r=0;r<e.length;++r){if(void 0===(t=e[r]).name&&(t.type&&t.type in s.oids?t.name=s.oids[t.type]:t.shortName&&t.shortName in a&&(t.name=s.oids[a[t.shortName]])),void 0===t.type){if(!t.name||!(t.name in s.oids))throw(c=new Error("Attribute type not specified.")).attribute=t,c;t.type=s.oids[t.name]}if(void 0===t.shortName&&t.name&&t.name in a&&(t.shortName=a[t.name]),t.type===o.extensionRequest&&(t.valueConstructed=!0,t.valueTagClass=i.Type.SEQUENCE,!t.value&&t.extensions)){t.value=[];for(var n=0;n<t.extensions.length;++n)t.value.push(s.certificateExtensionToAsn1(E(t.extensions[n])))}var c;if(void 0===t.value)throw(c=new Error("Attribute value not specified.")).attribute=t,c}}function E(e,t){if(t=t||{},void 0===e.name&&e.id&&e.id in s.oids&&(e.name=s.oids[e.id]),void 0===e.id){if(!e.name||!(e.name in s.oids))throw(v=new Error("Extension ID not specified.")).extension=e,v;e.id=s.oids[e.name]}if(void 0!==e.value)return e;if("keyUsage"===e.name){var r=0,a=0,c=0;e.digitalSignature&&(a|=128,r=7),e.nonRepudiation&&(a|=64,r=6),e.keyEncipherment&&(a|=32,r=5),e.dataEncipherment&&(a|=16,r=4),e.keyAgreement&&(a|=8,r=3),e.keyCertSign&&(a|=4,r=2),e.cRLSign&&(a|=2,r=1),e.encipherOnly&&(a|=1,r=0),e.decipherOnly&&(c|=128,r=7);var l=String.fromCharCode(r);0!==c?l+=String.fromCharCode(a)+String.fromCharCode(c):0!==a&&(l+=String.fromCharCode(a)),e.value=i.create(i.Class.UNIVERSAL,i.Type.BITSTRING,!1,l)}else if("basicConstraints"===e.name)e.value=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]),e.cA&&e.value.value.push(i.create(i.Class.UNIVERSAL,i.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in e&&e.value.value.push(i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(e.pathLenConstraint).getBytes()));else if("extKeyUsage"===e.name){e.value=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]);var u=e.value.value;for(var h in e)!0===e[h]&&(h in o?u.push(i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(o[h]).getBytes())):-1!==h.indexOf(".")&&u.push(i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(h).getBytes())))}else if("nsCertType"===e.name)r=0,a=0,e.client&&(a|=128,r=7),e.server&&(a|=64,r=6),e.email&&(a|=32,r=5),e.objsign&&(a|=16,r=4),e.reserved&&(a|=8,r=3),e.sslCA&&(a|=4,r=2),e.emailCA&&(a|=2,r=1),e.objCA&&(a|=1,r=0),l=String.fromCharCode(r),0!==a&&(l+=String.fromCharCode(a)),e.value=i.create(i.Class.UNIVERSAL,i.Type.BITSTRING,!1,l);else if("subjectAltName"===e.name||"issuerAltName"===e.name){e.value=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]);for(var d=0;d<e.altNames.length;++d){if(l=(w=e.altNames[d]).value,7===w.type&&w.ip){if(null===(l=n.util.bytesFromIP(w.ip)))throw(v=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.')).extension=e,v}else 8===w.type&&(l=w.oid?i.oidToDer(i.oidToDer(w.oid)):i.oidToDer(l));e.value.value.push(i.create(i.Class.CONTEXT_SPECIFIC,w.type,!1,l))}}else if("nsComment"===e.name&&t.cert){if(!/^[\x00-\x7F]*$/.test(e.comment)||e.comment.length<1||e.comment.length>128)throw new Error('Invalid "nsComment" content.');e.value=i.create(i.Class.UNIVERSAL,i.Type.IA5STRING,!1,e.comment)}else if("subjectKeyIdentifier"===e.name&&t.cert){var p=t.cert.generateSubjectKeyIdentifier();e.subjectKeyIdentifier=p.toHex(),e.value=i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,p.getBytes())}else if("authorityKeyIdentifier"===e.name&&t.cert){if(e.value=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]),u=e.value.value,e.keyIdentifier){var f=!0===e.keyIdentifier?t.cert.generateSubjectKeyIdentifier().getBytes():e.keyIdentifier;u.push(i.create(i.Class.CONTEXT_SPECIFIC,0,!1,f))}if(e.authorityCertIssuer){var y=[i.create(i.Class.CONTEXT_SPECIFIC,4,!0,[m(!0===e.authorityCertIssuer?t.cert.issuer:e.authorityCertIssuer)])];u.push(i.create(i.Class.CONTEXT_SPECIFIC,1,!0,y))}if(e.serialNumber){var g=n.util.hexToBytes(!0===e.serialNumber?t.cert.serialNumber:e.serialNumber);u.push(i.create(i.Class.CONTEXT_SPECIFIC,2,!1,g))}}else if("cRLDistributionPoints"===e.name){e.value=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]),u=e.value.value;var w,E=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]),b=i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[]);for(d=0;d<e.altNames.length;++d){if(l=(w=e.altNames[d]).value,7===w.type&&w.ip){if(null===(l=n.util.bytesFromIP(w.ip)))throw(v=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.')).extension=e,v}else 8===w.type&&(l=w.oid?i.oidToDer(i.oidToDer(w.oid)):i.oidToDer(l));b.value.push(i.create(i.Class.CONTEXT_SPECIFIC,w.type,!1,l))}E.value.push(i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[b])),u.push(E)}var v;if(void 0===e.value)throw(v=new Error("Extension value not specified.")).extension=e,v;return e}function b(e,t){if(e===o["RSASSA-PSS"]){var r=[];return void 0!==t.hash.algorithmOid&&r.push(i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.hash.algorithmOid).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")])])),void 0!==t.mgf.algorithmOid&&r.push(i.create(i.Class.CONTEXT_SPECIFIC,1,!0,[i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.mgf.algorithmOid).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.mgf.hash.algorithmOid).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")])])])),void 0!==t.saltLength&&r.push(i.create(i.Class.CONTEXT_SPECIFIC,2,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(t.saltLength).getBytes())])),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,r)}return i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")}function v(e){var t=i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[]);if(0===e.attributes.length)return t;for(var r=e.attributes,s=0;s<r.length;++s){var o=r[s],a=o.value,c=i.Type.UTF8;"valueTagClass"in o&&(c=o.valueTagClass),c===i.Type.UTF8&&(a=n.util.encodeUtf8(a));var l=!1;"valueConstructed"in o&&(l=o.valueConstructed);var u=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(o.type).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SET,!0,[i.create(i.Class.UNIVERSAL,c,l,a)])]);t.value.push(u)}return t}s.certificateFromPem=function(e,t,r){var o=n.pem.decode(e)[0];if("CERTIFICATE"!==o.type&&"X509 CERTIFICATE"!==o.type&&"TRUSTED CERTIFICATE"!==o.type){var a=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw a.headerType=o.type,a}if(o.procType&&"ENCRYPTED"===o.procType.type)throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var c=i.fromDer(o.body,r);return s.certificateFromAsn1(c,t)},s.certificateToPem=function(e,t){var r={type:"CERTIFICATE",body:i.toDer(s.certificateToAsn1(e)).getBytes()};return n.pem.encode(r,{maxline:t})},s.publicKeyFromPem=function(e){var t=n.pem.decode(e)[0];if("PUBLIC KEY"!==t.type&&"RSA PUBLIC KEY"!==t.type){var r=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw r.headerType=t.type,r}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert public key from PEM; PEM is encrypted.");var o=i.fromDer(t.body);return s.publicKeyFromAsn1(o)},s.publicKeyToPem=function(e,t){var r={type:"PUBLIC KEY",body:i.toDer(s.publicKeyToAsn1(e)).getBytes()};return n.pem.encode(r,{maxline:t})},s.publicKeyToRSAPublicKeyPem=function(e,t){var r={type:"RSA PUBLIC KEY",body:i.toDer(s.publicKeyToRSAPublicKey(e)).getBytes()};return n.pem.encode(r,{maxline:t})},s.getPublicKeyFingerprint=function(e,t){var r,o=(t=t||{}).md||n.md.sha1.create();switch(t.type||"RSAPublicKey"){case"RSAPublicKey":r=i.toDer(s.publicKeyToRSAPublicKey(e)).getBytes();break;case"SubjectPublicKeyInfo":r=i.toDer(s.publicKeyToAsn1(e)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+t.type+'".')}o.start(),o.update(r);var a=o.digest();if("hex"===t.encoding){var c=a.toHex();return t.delimiter?c.match(/.{2}/g).join(t.delimiter):c}if("binary"===t.encoding)return a.getBytes();if(t.encoding)throw new Error('Unknown encoding "'+t.encoding+'".');return a},s.certificationRequestFromPem=function(e,t,r){var o=n.pem.decode(e)[0];if("CERTIFICATE REQUEST"!==o.type){var a=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw a.headerType=o.type,a}if(o.procType&&"ENCRYPTED"===o.procType.type)throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var c=i.fromDer(o.body,r);return s.certificationRequestFromAsn1(c,t)},s.certificationRequestToPem=function(e,t){var r={type:"CERTIFICATE REQUEST",body:i.toDer(s.certificationRequestToAsn1(e)).getBytes()};return n.pem.encode(r,{maxline:t})},s.createCertificate=function(){var e={version:2,serialNumber:"00",signatureOid:null,signature:null,siginfo:{}};return e.siginfo.algorithmOid=null,e.validity={},e.validity.notBefore=new Date,e.validity.notAfter=new Date,e.issuer={},e.issuer.getField=function(t){return p(e.issuer,t)},e.issuer.addField=function(t){w([t]),e.issuer.attributes.push(t)},e.issuer.attributes=[],e.issuer.hash=null,e.subject={},e.subject.getField=function(t){return p(e.subject,t)},e.subject.addField=function(t){w([t]),e.subject.attributes.push(t)},e.subject.attributes=[],e.subject.hash=null,e.extensions=[],e.publicKey=null,e.md=null,e.setSubject=function(t,r){w(t),e.subject.attributes=t,delete e.subject.uniqueId,r&&(e.subject.uniqueId=r),e.subject.hash=null},e.setIssuer=function(t,r){w(t),e.issuer.attributes=t,delete e.issuer.uniqueId,r&&(e.issuer.uniqueId=r),e.issuer.hash=null},e.setExtensions=function(t){for(var r=0;r<t.length;++r)E(t[r],{cert:e});e.extensions=t},e.getExtension=function(t){"string"==typeof t&&(t={name:t});for(var r,n=null,i=0;null===n&&i<e.extensions.length;++i)r=e.extensions[i],(t.id&&r.id===t.id||t.name&&r.name===t.name)&&(n=r);return n},e.sign=function(t,r){e.md=r||n.md.sha1.create();var a=o[e.md.algorithm+"WithRSAEncryption"];if(!a){var c=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw c.algorithm=e.md.algorithm,c}e.signatureOid=e.siginfo.algorithmOid=a,e.tbsCertificate=s.getTBSCertificate(e);var l=i.toDer(e.tbsCertificate);e.md.update(l.getBytes()),e.signature=t.sign(e.md)},e.verify=function(t){var r=!1;if(!e.issued(t)){var n=t.issuer,o=e.subject,a=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.");throw a.expectedIssuer=o.attributes,a.actualIssuer=n.attributes,a}var c=t.md;if(null===c){c=y({signatureOid:t.signatureOid,type:"certificate"});var l=t.tbsCertificate||s.getTBSCertificate(t),u=i.toDer(l);c.update(u.getBytes())}return null!==c&&(r=g({certificate:e,md:c,signature:t.signature})),r},e.isIssuer=function(t){var r=!1,n=e.issuer,i=t.subject;if(n.hash&&i.hash)r=n.hash===i.hash;else if(n.attributes.length===i.attributes.length){var s,o;r=!0;for(var a=0;r&&a<n.attributes.length;++a)s=n.attributes[a],o=i.attributes[a],s.type===o.type&&s.value===o.value||(r=!1)}return r},e.issued=function(t){return t.isIssuer(e)},e.generateSubjectKeyIdentifier=function(){return s.getPublicKeyFingerprint(e.publicKey,{type:"RSAPublicKey"})},e.verifySubjectKeyIdentifier=function(){for(var t=o.subjectKeyIdentifier,r=0;r<e.extensions.length;++r){var i=e.extensions[r];if(i.id===t){var s=e.generateSubjectKeyIdentifier().getBytes();return n.util.hexToBytes(i.subjectKeyIdentifier)===s}}return!1},e},s.certificateFromAsn1=function(e,t){var r={},o=[];if(!i.validate(e,l,r,o)){var a=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.");throw a.errors=o,a}if(i.derToOid(r.publicKeyOid)!==s.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var c=s.createCertificate();c.version=r.certVersion?r.certVersion.charCodeAt(0):0;var u=n.util.createBuffer(r.certSerialNumber);c.serialNumber=u.toHex(),c.signatureOid=n.asn1.derToOid(r.certSignatureOid),c.signatureParameters=f(c.signatureOid,r.certSignatureParams,!0),c.siginfo.algorithmOid=n.asn1.derToOid(r.certinfoSignatureOid),c.siginfo.parameters=f(c.siginfo.algorithmOid,r.certinfoSignatureParams,!1),c.signature=r.certSignature;var h=[];if(void 0!==r.certValidity1UTCTime&&h.push(i.utcTimeToDate(r.certValidity1UTCTime)),void 0!==r.certValidity2GeneralizedTime&&h.push(i.generalizedTimeToDate(r.certValidity2GeneralizedTime)),void 0!==r.certValidity3UTCTime&&h.push(i.utcTimeToDate(r.certValidity3UTCTime)),void 0!==r.certValidity4GeneralizedTime&&h.push(i.generalizedTimeToDate(r.certValidity4GeneralizedTime)),h.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(h.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(c.validity.notBefore=h[0],c.validity.notAfter=h[1],c.tbsCertificate=r.tbsCertificate,t){c.md=y({signatureOid:c.signatureOid,type:"certificate"});var d=i.toDer(c.tbsCertificate);c.md.update(d.getBytes())}var g=n.md.sha1.create(),m=i.toDer(r.certIssuer);g.update(m.getBytes()),c.issuer.getField=function(e){return p(c.issuer,e)},c.issuer.addField=function(e){w([e]),c.issuer.attributes.push(e)},c.issuer.attributes=s.RDNAttributesAsArray(r.certIssuer),r.certIssuerUniqueId&&(c.issuer.uniqueId=r.certIssuerUniqueId),c.issuer.hash=g.digest().toHex();var E=n.md.sha1.create(),b=i.toDer(r.certSubject);return E.update(b.getBytes()),c.subject.getField=function(e){return p(c.subject,e)},c.subject.addField=function(e){w([e]),c.subject.attributes.push(e)},c.subject.attributes=s.RDNAttributesAsArray(r.certSubject),r.certSubjectUniqueId&&(c.subject.uniqueId=r.certSubjectUniqueId),c.subject.hash=E.digest().toHex(),r.certExtensions?c.extensions=s.certificateExtensionsFromAsn1(r.certExtensions):c.extensions=[],c.publicKey=s.publicKeyFromAsn1(r.subjectPublicKeyInfo),c},s.certificateExtensionsFromAsn1=function(e){for(var t=[],r=0;r<e.value.length;++r)for(var n=e.value[r],i=0;i<n.value.length;++i)t.push(s.certificateExtensionFromAsn1(n.value[i]));return t},s.certificateExtensionFromAsn1=function(e){var t={};if(t.id=i.derToOid(e.value[0].value),t.critical=!1,e.value[1].type===i.Type.BOOLEAN?(t.critical=0!==e.value[1].value.charCodeAt(0),t.value=e.value[2].value):t.value=e.value[1].value,t.id in o)if(t.name=o[t.id],"keyUsage"===t.name){var r=0,s=0;(c=i.fromDer(t.value)).value.length>1&&(r=c.value.charCodeAt(1),s=c.value.length>2?c.value.charCodeAt(2):0),t.digitalSignature=128==(128&r),t.nonRepudiation=64==(64&r),t.keyEncipherment=32==(32&r),t.dataEncipherment=16==(16&r),t.keyAgreement=8==(8&r),t.keyCertSign=4==(4&r),t.cRLSign=2==(2&r),t.encipherOnly=1==(1&r),t.decipherOnly=128==(128&s)}else if("basicConstraints"===t.name){(c=i.fromDer(t.value)).value.length>0&&c.value[0].type===i.Type.BOOLEAN?t.cA=0!==c.value[0].value.charCodeAt(0):t.cA=!1;var a=null;c.value.length>0&&c.value[0].type===i.Type.INTEGER?a=c.value[0].value:c.value.length>1&&(a=c.value[1].value),null!==a&&(t.pathLenConstraint=i.derToInteger(a))}else if("extKeyUsage"===t.name)for(var c=i.fromDer(t.value),l=0;l<c.value.length;++l){var u=i.derToOid(c.value[l].value);u in o?t[o[u]]=!0:t[u]=!0}else if("nsCertType"===t.name)r=0,(c=i.fromDer(t.value)).value.length>1&&(r=c.value.charCodeAt(1)),t.client=128==(128&r),t.server=64==(64&r),t.email=32==(32&r),t.objsign=16==(16&r),t.reserved=8==(8&r),t.sslCA=4==(4&r),t.emailCA=2==(2&r),t.objCA=1==(1&r);else if("subjectAltName"===t.name||"issuerAltName"===t.name){var h;t.altNames=[],c=i.fromDer(t.value);for(var d=0;d<c.value.length;++d){var p={type:(h=c.value[d]).type,value:h.value};switch(t.altNames.push(p),h.type){case 1:case 2:case 6:break;case 7:p.ip=n.util.bytesToIP(h.value);break;case 8:p.oid=i.derToOid(h.value)}}}else"subjectKeyIdentifier"===t.name&&(c=i.fromDer(t.value),t.subjectKeyIdentifier=n.util.bytesToHex(c.value));return t},s.certificationRequestFromAsn1=function(e,t){var r={},o=[];if(!i.validate(e,d,r,o)){var a=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.");throw a.errors=o,a}if(i.derToOid(r.publicKeyOid)!==s.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var c=s.createCertificationRequest();if(c.version=r.csrVersion?r.csrVersion.charCodeAt(0):0,c.signatureOid=n.asn1.derToOid(r.csrSignatureOid),c.signatureParameters=f(c.signatureOid,r.csrSignatureParams,!0),c.siginfo.algorithmOid=n.asn1.derToOid(r.csrSignatureOid),c.siginfo.parameters=f(c.siginfo.algorithmOid,r.csrSignatureParams,!1),c.signature=r.csrSignature,c.certificationRequestInfo=r.certificationRequestInfo,t){c.md=y({signatureOid:c.signatureOid,type:"certification request"});var l=i.toDer(c.certificationRequestInfo);c.md.update(l.getBytes())}var u=n.md.sha1.create();return c.subject.getField=function(e){return p(c.subject,e)},c.subject.addField=function(e){w([e]),c.subject.attributes.push(e)},c.subject.attributes=s.RDNAttributesAsArray(r.certificationRequestInfoSubject,u),c.subject.hash=u.digest().toHex(),c.publicKey=s.publicKeyFromAsn1(r.subjectPublicKeyInfo),c.getAttribute=function(e){return p(c,e)},c.addAttribute=function(e){w([e]),c.attributes.push(e)},c.attributes=s.CRIAttributesAsArray(r.certificationRequestInfoAttributes||[]),c},s.createCertificationRequest=function(){var e={version:0,signatureOid:null,signature:null,siginfo:{}};return e.siginfo.algorithmOid=null,e.subject={},e.subject.getField=function(t){return p(e.subject,t)},e.subject.addField=function(t){w([t]),e.subject.attributes.push(t)},e.subject.attributes=[],e.subject.hash=null,e.publicKey=null,e.attributes=[],e.getAttribute=function(t){return p(e,t)},e.addAttribute=function(t){w([t]),e.attributes.push(t)},e.md=null,e.setSubject=function(t){w(t),e.subject.attributes=t,e.subject.hash=null},e.setAttributes=function(t){w(t),e.attributes=t},e.sign=function(t,r){e.md=r||n.md.sha1.create();var a=o[e.md.algorithm+"WithRSAEncryption"];if(!a){var c=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw c.algorithm=e.md.algorithm,c}e.signatureOid=e.siginfo.algorithmOid=a,e.certificationRequestInfo=s.getCertificationRequestInfo(e);var l=i.toDer(e.certificationRequestInfo);e.md.update(l.getBytes()),e.signature=t.sign(e.md)},e.verify=function(){var t=!1,r=e.md;if(null===r){r=y({signatureOid:e.signatureOid,type:"certification request"});var n=e.certificationRequestInfo||s.getCertificationRequestInfo(e),o=i.toDer(n);r.update(o.getBytes())}return null!==r&&(t=g({certificate:e,md:r,signature:e.signature})),t},e};var _=new Date("1950-01-01T00:00:00Z"),S=new Date("2050-01-01T00:00:00Z");function C(e){return e>=_&&e<S?i.create(i.Class.UNIVERSAL,i.Type.UTCTIME,!1,i.dateToUtcTime(e)):i.create(i.Class.UNIVERSAL,i.Type.GENERALIZEDTIME,!1,i.dateToGeneralizedTime(e))}s.getTBSCertificate=function(e){var t=C(e.validity.notBefore),r=C(e.validity.notAfter),o=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(e.version).getBytes())]),i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,n.util.hexToBytes(e.serialNumber)),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.siginfo.algorithmOid).getBytes()),b(e.siginfo.algorithmOid,e.siginfo.parameters)]),m(e.issuer),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[t,r]),m(e.subject),s.publicKeyToAsn1(e.publicKey)]);return e.issuer.uniqueId&&o.value.push(i.create(i.Class.CONTEXT_SPECIFIC,1,!0,[i.create(i.Class.UNIVERSAL,i.Type.BITSTRING,!1,String.fromCharCode(0)+e.issuer.uniqueId)])),e.subject.uniqueId&&o.value.push(i.create(i.Class.CONTEXT_SPECIFIC,2,!0,[i.create(i.Class.UNIVERSAL,i.Type.BITSTRING,!1,String.fromCharCode(0)+e.subject.uniqueId)])),e.extensions.length>0&&o.value.push(s.certificateExtensionsToAsn1(e.extensions)),o},s.getCertificationRequestInfo=function(e){return i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(e.version).getBytes()),m(e.subject),s.publicKeyToAsn1(e.publicKey),v(e)])},s.distinguishedNameToAsn1=function(e){return m(e)},s.certificateToAsn1=function(e){var t=e.tbsCertificate||s.getTBSCertificate(e);return i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[t,i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.signatureOid).getBytes()),b(e.signatureOid,e.signatureParameters)]),i.create(i.Class.UNIVERSAL,i.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},s.certificateExtensionsToAsn1=function(e){var t=i.create(i.Class.CONTEXT_SPECIFIC,3,!0,[]),r=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]);t.value.push(r);for(var n=0;n<e.length;++n)r.value.push(s.certificateExtensionToAsn1(e[n]));return t},s.certificateExtensionToAsn1=function(e){var t=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]);t.value.push(i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.id).getBytes())),e.critical&&t.value.push(i.create(i.Class.UNIVERSAL,i.Type.BOOLEAN,!1,String.fromCharCode(255)));var r=e.value;return"string"!=typeof e.value&&(r=i.toDer(r).getBytes()),t.value.push(i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,r)),t},s.certificationRequestToAsn1=function(e){var t=e.certificationRequestInfo||s.getCertificationRequestInfo(e);return i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[t,i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.signatureOid).getBytes()),b(e.signatureOid,e.signatureParameters)]),i.create(i.Class.UNIVERSAL,i.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},s.createCaStore=function(e){var t={certs:{}};function r(e){return o(e),t.certs[e.hash]||null}function o(e){if(!e.hash){var t=n.md.sha1.create();e.attributes=s.RDNAttributesAsArray(m(e),t),e.hash=t.digest().toHex()}}if(t.getIssuer=function(e){return r(e.issuer)},t.addCertificate=function(e){if("string"==typeof e&&(e=n.pki.certificateFromPem(e)),o(e.subject),!t.hasCertificate(e))if(e.subject.hash in t.certs){var r=t.certs[e.subject.hash];n.util.isArray(r)||(r=[r]),r.push(e),t.certs[e.subject.hash]=r}else t.certs[e.subject.hash]=e},t.hasCertificate=function(e){"string"==typeof e&&(e=n.pki.certificateFromPem(e));var t=r(e.subject);if(!t)return!1;n.util.isArray(t)||(t=[t]);for(var o=i.toDer(s.certificateToAsn1(e)).getBytes(),a=0;a<t.length;++a)if(o===i.toDer(s.certificateToAsn1(t[a])).getBytes())return!0;return!1},t.listAllCertificates=function(){var e=[];for(var r in t.certs)if(t.certs.hasOwnProperty(r)){var i=t.certs[r];if(n.util.isArray(i))for(var s=0;s<i.length;++s)e.push(i[s]);else e.push(i)}return e},t.removeCertificate=function(e){var a;if("string"==typeof e&&(e=n.pki.certificateFromPem(e)),o(e.subject),!t.hasCertificate(e))return null;var c=r(e.subject);if(!n.util.isArray(c))return a=t.certs[e.subject.hash],delete t.certs[e.subject.hash],a;for(var l=i.toDer(s.certificateToAsn1(e)).getBytes(),u=0;u<c.length;++u)l===i.toDer(s.certificateToAsn1(c[u])).getBytes()&&(a=c[u],c.splice(u,1));return 0===c.length&&delete t.certs[e.subject.hash],a},e)for(var a=0;a<e.length;++a){var c=e[a];t.addCertificate(c)}return t},s.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"},s.verifyCertificateChain=function(e,t,r){"function"==typeof r&&(r={verify:r}),r=r||{};var i=(t=t.slice(0)).slice(0),o=r.validityCheckDate;void 0===o&&(o=new Date);var a=!0,c=null,l=0;do{var u=t.shift(),h=null,d=!1;if(o&&(o<u.validity.notBefore||o>u.validity.notAfter)&&(c={message:"Certificate is not valid yet or has expired.",error:s.certificateError.certificate_expired,notBefore:u.validity.notBefore,notAfter:u.validity.notAfter,now:o}),null===c){if(null===(h=t[0]||e.getIssuer(u))&&u.isIssuer(u)&&(d=!0,h=u),h){var p=h;n.util.isArray(p)||(p=[p]);for(var f=!1;!f&&p.length>0;){h=p.shift();try{f=h.verify(u)}catch(e){}}f||(c={message:"Certificate signature is invalid.",error:s.certificateError.bad_certificate})}null!==c||h&&!d||e.hasCertificate(u)||(c={message:"Certificate is not trusted.",error:s.certificateError.unknown_ca})}if(null===c&&h&&!u.isIssuer(h)&&(c={message:"Certificate issuer is invalid.",error:s.certificateError.bad_certificate}),null===c)for(var y={keyUsage:!0,basicConstraints:!0},g=0;null===c&&g<u.extensions.length;++g){var m=u.extensions[g];m.critical&&!(m.name in y)&&(c={message:"Certificate has an unsupported critical extension.",error:s.certificateError.unsupported_certificate})}if(null===c&&(!a||0===t.length&&(!h||d))){var w=u.getExtension("basicConstraints"),E=u.getExtension("keyUsage");null!==E&&(E.keyCertSign&&null!==w||(c={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:s.certificateError.bad_certificate})),null!==c||null===w||w.cA||(c={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:s.certificateError.bad_certificate}),null===c&&null!==E&&"pathLenConstraint"in w&&l-1>w.pathLenConstraint&&(c={message:"Certificate basicConstraints pathLenConstraint violated.",error:s.certificateError.bad_certificate})}var b=null===c||c.error,v=r.verify?r.verify(b,l,i):b;if(!0!==v)throw!0===b&&(c={message:"The application rejected the certificate.",error:s.certificateError.bad_certificate}),(v||0===v)&&("object"!=typeof v||n.util.isArray(v)?"string"==typeof v&&(c.error=v):(v.message&&(c.message=v.message),v.error&&(c.error=v.error))),c;c=null,a=!1,++l}while(t.length>0);return!0}},5103:(e,t,r)=>{const n=r(1607),i=r(603);e.exports=class{constructor(){this._buffer=new n,this._waitingConsumers=new n}push(e){const{promise:t,resolve:r}=i();return this._buffer.push({chunk:e,resolve:r}),this._consume(),t}_consume(){for(;!this._waitingConsumers.isEmpty()&&!this._buffer.isEmpty();){const e=this._waitingConsumers.shift(),t=this._buffer.shift();e.resolve(t.chunk),t.resolve()}}shift(){const{promise:e,resolve:t}=i();return this._waitingConsumers.push({resolve:t}),this._consume(),e}isEmpty(){return this._buffer.isEmpty()}}},603:e=>{"use strict";e.exports=()=>{const e={};return e.promise=new Promise(((t,r)=>{e.resolve=t,e.reject=r})),e}},1408:(e,t,r)=>{"use strict";e.exports=c;var n,i=r(9693),s=i.LongBits,o=i.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var l,u="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")},h=function(){return i.Buffer?function(e){return(c.create=function(e){return i.Buffer.isBuffer(e)?new n(e):u(e)})(e)}:u};function d(){var e=new s(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function p(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw a(this,8);return new s(p(this.buf,this.pos+=4),p(this.buf,this.pos+=4))}c.create=h(),c.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,c.prototype.uint32=(l=4294967295,function(){if(l=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return l;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return l}),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return p(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|p(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},c.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},c.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){n=e,c.create=h(),n._configure();var t=i.Long?"toLong":"toNumber";i.merge(c.prototype,{int64:function(){return d.call(this)[t](!1)},uint64:function(){return d.call(this)[t](!0)},sint64:function(){return d.call(this).zzDecode()[t](!1)},fixed64:function(){return f.call(this)[t](!0)},sfixed64:function(){return f.call(this)[t](!1)}})}},593:(e,t,r)=>{"use strict";e.exports=s;var n=r(1408);(s.prototype=Object.create(n.prototype)).constructor=s;var i=r(9693);function s(e){n.call(this,e)}s._configure=function(){i.Buffer&&(s.prototype._slice=i.Buffer.prototype.slice)},s.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},s._configure()},1945:(e,t,r)=>{"use strict";e.exports=i;var n=r(9693);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var s=i.zero=new i(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var o=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return s;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new i(r,n)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(n.isString(e)){if(!n.Long)return i.fromNumber(parseInt(e,10));e=n.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):s},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;i.fromHash=function(e){return e===o?s:new i((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},9693:function(e,t,r){"use strict";var n=t;function i(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)void 0!==e[n[i]]&&r||(e[n[i]]=t[n[i]]);return e}function s(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&i(this,r)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}n.asPromise=r(4537),n.base64=r(7419),n.EventEmitter=r(9211),n.float=r(945),n.inquire=r(7199),n.utf8=r(4997),n.pool=r(6662),n.LongBits=r(1945),n.isNode=Boolean(void 0!==r.g&&r.g&&r.g.process&&r.g.process.versions&&r.g.process.versions.node),n.global=n.isNode&&r.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},n.merge=i,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=s,n.ProtocolError=s("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;e?(n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):n._Buffer_from=n._Buffer_allocUnsafe=null}},1173:(e,t,r)=>{"use strict";e.exports=h;var n,i=r(9693),s=i.LongBits,o=i.base64,a=i.utf8;function c(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function l(){}function u(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new c(l,0,0),this.tail=this.head,this.states=null}var d=function(){return i.Buffer?function(){return(h.create=function(){return new n})()}:function(){return new h}};function p(e,t,r){t[r]=255&e}function f(e,t){this.len=e,this.next=void 0,this.val=t}function y(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function g(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}h.create=d(),h.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(h.alloc=i.pool(h.alloc,i.Array.prototype.subarray)),h.prototype._push=function(e,t,r){return this.tail=this.tail.next=new c(e,t,r),this.len+=t,this},f.prototype=Object.create(c.prototype),f.prototype.fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new f((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(y,10,s.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=s.from(e);return this._push(y,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=s.from(e).zzEncode();return this._push(y,t.length(),t)},h.prototype.bool=function(e){return this._push(p,1,e?1:0)},h.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=s.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var m=i.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(i.isString(e)){var r=h.alloc(t=o.length(e));o.decode(e,r,0),e=r}return this.uint32(t)._push(m,t,e)},h.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(p,1,0)},h.prototype.fork=function(){return this.states=new u(this),this.head=this.tail=new c(l,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(l,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},h._configure=function(e){n=e,h.create=d(),n._configure()}},3155:(e,t,r)=>{"use strict";e.exports=s;var n=r(1173);(s.prototype=Object.create(n.prototype)).constructor=s;var i=r(9693);function s(){n.call(this)}function o(e,t,r){e.length<40?i.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}s._configure=function(){s.alloc=i._Buffer_allocUnsafe,s.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},s.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s.writeBytesBuffer,t,e),this},s.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},s._configure()},8558:(e,t,r)=>{const n=r(4636),i=r(1391),s=r(4156),o=r(4832),{RateLimiterClusterMaster:a,RateLimiterClusterMasterPM2:c,RateLimiterCluster:l}=r(1713),u=r(2288),h=r(5105),d=r(911),p=r(3766),f=r(8686),y=r(3328),g=r(5155);e.exports={RateLimiterRedis:n,RateLimiterMongo:i,RateLimiterMySQL:s,RateLimiterPostgres:o,RateLimiterMemory:u,RateLimiterMemcache:h,RateLimiterClusterMaster:a,RateLimiterClusterMasterPM2:c,RateLimiterCluster:l,RLWrapperBlackAndWhite:d,RateLimiterUnion:p,RateLimiterQueue:f,BurstyRateLimiter:y,RateLimiterRes:g}},3328:(e,t,r)=>{const n=r(5155);e.exports=class{constructor(e,t){this._rateLimiter=e,this._burstLimiter=t}_combineRes(e,t){return new n(e.remainingPoints,Math.min(e.msBeforeNext,t.msBeforeNext),e.consumedPoints,e.isFirstInDuration)}consume(e,t=1,r={}){return this._rateLimiter.consume(e,t,r).catch((i=>i instanceof n?this._burstLimiter.consume(e,t,r).then((e=>Promise.resolve(this._combineRes(i,e)))).catch((e=>e instanceof n?Promise.reject(this._combineRes(i,e)):Promise.reject(e))):Promise.reject(i)))}get(e){return Promise.all([this._rateLimiter.get(e),this._burstLimiter.get(e)]).then((([e,t])=>this._combineRes(e,t)))}get points(){return this._rateLimiter.points}}},911:(e,t,r)=>{const n=r(5155);e.exports=class{constructor(e={}){this.limiter=e.limiter,this.blackList=e.blackList,this.whiteList=e.whiteList,this.isBlackListed=e.isBlackListed,this.isWhiteListed=e.isWhiteListed,this.runActionAnyway=e.runActionAnyway}get limiter(){return this._limiter}set limiter(e){if(void 0===e)throw new Error("limiter is not set");this._limiter=e}get runActionAnyway(){return this._runActionAnyway}set runActionAnyway(e){this._runActionAnyway=void 0!==e&&e}get blackList(){return this._blackList}set blackList(e){this._blackList=Array.isArray(e)?e:[]}get isBlackListed(){return this._isBlackListed}set isBlackListed(e){if(void 0===e&&(e=()=>!1),"function"!=typeof e)throw new Error("isBlackListed must be function");this._isBlackListed=e}get whiteList(){return this._whiteList}set whiteList(e){this._whiteList=Array.isArray(e)?e:[]}get isWhiteListed(){return this._isWhiteListed}set isWhiteListed(e){if(void 0===e&&(e=()=>!1),"function"!=typeof e)throw new Error("isWhiteListed must be function");this._isWhiteListed=e}isBlackListedSomewhere(e){return this.blackList.indexOf(e)>=0||this.isBlackListed(e)}isWhiteListedSomewhere(e){return this.whiteList.indexOf(e)>=0||this.isWhiteListed(e)}getBlackRes(){return new n(0,Number.MAX_SAFE_INTEGER,0,!1)}getWhiteRes(){return new n(Number.MAX_SAFE_INTEGER,0,0,!1)}rejectBlack(){return Promise.reject(this.getBlackRes())}resolveBlack(){return Promise.resolve(this.getBlackRes())}resolveWhite(){return Promise.resolve(this.getWhiteRes())}consume(e,t=1){let r;return this.isWhiteListedSomewhere(e)?r=this.resolveWhite():this.isBlackListedSomewhere(e)&&(r=this.rejectBlack()),void 0===r?this.limiter.consume(e,t):(this.runActionAnyway&&this.limiter.consume(e,t).catch((()=>{})),r)}block(e,t){let r;return this.isWhiteListedSomewhere(e)?r=this.resolveWhite():this.isBlackListedSomewhere(e)&&(r=this.resolveBlack()),void 0===r?this.limiter.block(e,t):(this.runActionAnyway&&this.limiter.block(e,t).catch((()=>{})),r)}penalty(e,t){let r;return this.isWhiteListedSomewhere(e)?r=this.resolveWhite():this.isBlackListedSomewhere(e)&&(r=this.resolveBlack()),void 0===r?this.limiter.penalty(e,t):(this.runActionAnyway&&this.limiter.penalty(e,t).catch((()=>{})),r)}reward(e,t){let r;return this.isWhiteListedSomewhere(e)?r=this.resolveWhite():this.isBlackListedSomewhere(e)&&(r=this.resolveBlack()),void 0===r?this.limiter.reward(e,t):(this.runActionAnyway&&this.limiter.reward(e,t).catch((()=>{})),r)}get(e){let t;return this.isWhiteListedSomewhere(e)?t=this.resolveWhite():this.isBlackListedSomewhere(e)&&(t=this.resolveBlack()),void 0===t||this.runActionAnyway?this.limiter.get(e):t}delete(e){return this.limiter.delete(e)}}},1352:e=>{e.exports=class{constructor(e={}){this.points=e.points,this.duration=e.duration,this.blockDuration=e.blockDuration,this.execEvenly=e.execEvenly,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs,this.keyPrefix=e.keyPrefix}get points(){return this._points}set points(e){this._points=e>=0?e:4}get duration(){return this._duration}set duration(e){this._duration=void 0===e?1:e}get msDuration(){return 1e3*this.duration}get blockDuration(){return this._blockDuration}set blockDuration(e){this._blockDuration=void 0===e?0:e}get msBlockDuration(){return 1e3*this.blockDuration}get execEvenly(){return this._execEvenly}set execEvenly(e){this._execEvenly=void 0!==e&&Boolean(e)}get execEvenlyMinDelayMs(){return this._execEvenlyMinDelayMs}set execEvenlyMinDelayMs(e){this._execEvenlyMinDelayMs=void 0===e?Math.ceil(this.msDuration/this.points):e}get keyPrefix(){return this._keyPrefix}set keyPrefix(e){if(void 0===e&&(e="rlflx"),"string"!=typeof e)throw new Error("keyPrefix must be string");this._keyPrefix=e}_getKeySecDuration(e={}){return e&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}consume(){throw new Error("You have to implement the method 'consume'!")}penalty(){throw new Error("You have to implement the method 'penalty'!")}reward(){throw new Error("You have to implement the method 'reward'!")}get(){throw new Error("You have to implement the method 'get'!")}set(){throw new Error("You have to implement the method 'set'!")}block(){throw new Error("You have to implement the method 'block'!")}delete(){throw new Error("You have to implement the method 'delete'!")}}},1713:(e,t,r)=>{const n=r(1265),i=r(5539),s=r(1352),o=r(2288),a=r(5155),c="rate_limiter_flexible";let l=null;const u=function(e,t,r,n){let i;i=null===n||!0===n||!1===n?n:{remainingPoints:n.remainingPoints,msBeforeNext:n.msBeforeNext,consumedPoints:n.consumedPoints,isFirstInDuration:n.isFirstInDuration},e.send({channel:c,keyPrefix:t.keyPrefix,promiseId:t.promiseId,type:r,data:i})},h=function(e){setTimeout((()=>{this._initiated?process.send(e):void 0!==this._promises[e.promiseId]&&h.call(this,e)}),30)},d=function(e,t,r,n,i){const s={channel:c,keyPrefix:this.keyPrefix,func:e,promiseId:t,data:{key:r,arg:n,opts:i}};this._initiated?process.send(s):h.call(this,s)},p=function(e,t){if(!t||t.channel!==c||void 0===this._rateLimiters[t.keyPrefix])return!1;let r;switch(t.func){case"consume":r=this._rateLimiters[t.keyPrefix].consume(t.data.key,t.data.arg,t.data.opts);break;case"penalty":r=this._rateLimiters[t.keyPrefix].penalty(t.data.key,t.data.arg,t.data.opts);break;case"reward":r=this._rateLimiters[t.keyPrefix].reward(t.data.key,t.data.arg,t.data.opts);break;case"block":r=this._rateLimiters[t.keyPrefix].block(t.data.key,t.data.arg,t.data.opts);break;case"get":r=this._rateLimiters[t.keyPrefix].get(t.data.key,t.data.opts);break;case"delete":r=this._rateLimiters[t.keyPrefix].delete(t.data.key,t.data.opts);break;default:return!1}r&&r.then((r=>{u(e,t,"resolve",r)})).catch((r=>{u(e,t,"reject",r)}))},f=function(e){if(!e||e.channel!==c||e.keyPrefix!==this.keyPrefix)return!1;if(this._promises[e.promiseId]){let t;switch(clearTimeout(this._promises[e.promiseId].timeoutId),t=null===e.data||!0===e.data||!1===e.data?e.data:new a(e.data.remainingPoints,e.data.msBeforeNext,e.data.consumedPoints,e.data.isFirstInDuration),e.type){case"resolve":this._promises[e.promiseId].resolve(t);break;case"reject":this._promises[e.promiseId].reject(t);break;default:throw new Error(`RateLimiterCluster: no such message type '${e.type}'`)}delete this._promises[e.promiseId]}},y=function(){return{points:this.points,duration:this.duration,blockDuration:this.blockDuration,execEvenly:this.execEvenly,execEvenlyMinDelayMs:this.execEvenlyMinDelayMs,keyPrefix:this.keyPrefix}},g=function(e,t){const r=process.hrtime();let n=r[0].toString()+r[1].toString();return void 0!==this._promises[n]&&(n+=i.randomBytes(12).toString("base64")),this._promises[n]={resolve:e,reject:t,timeoutId:setTimeout((()=>{delete this._promises[n],t(new Error("RateLimiterCluster timeout: no answer from master in time"))}),this.timeoutMs)},n};e.exports={RateLimiterClusterMaster:class{constructor(){if(l)return l;this._rateLimiters={},n.setMaxListeners(0),n.on("message",((e,t)=>{t&&t.channel===c&&"init"===t.type?(void 0===this._rateLimiters[t.opts.keyPrefix]&&(this._rateLimiters[t.opts.keyPrefix]=new o(t.opts)),e.send({channel:c,type:"init",keyPrefix:t.opts.keyPrefix})):p.call(this,e,t)})),l=this}},RateLimiterClusterMasterPM2:class{constructor(e){if(l)return l;this._rateLimiters={},e.launchBus(((t,r)=>{r.on("process:msg",(t=>{const r=t.raw;r&&r.channel===c&&"init"===r.type?(void 0===this._rateLimiters[r.opts.keyPrefix]&&(this._rateLimiters[r.opts.keyPrefix]=new o(r.opts)),e.sendDataToProcessId(t.process.pm_id,{data:{},topic:c,channel:c,type:"init",keyPrefix:r.opts.keyPrefix},((e,t)=>{e&&console.log(e,t)}))):p.call(this,{send:r=>{const n=r;n.topic=c,void 0===n.data&&(n.data={}),e.sendDataToProcessId(t.process.pm_id,n,((e,t)=>{e&&console.log(e,t)}))}},r)}))})),l=this}},RateLimiterCluster:class extends s{get timeoutMs(){return this._timeoutMs}set timeoutMs(e){this._timeoutMs=void 0===e?5e3:Math.abs(parseInt(e))}constructor(e={}){super(e),process.setMaxListeners(0),this.timeoutMs=e.timeoutMs,this._initiated=!1,process.on("message",(e=>{e&&e.channel===c&&"init"===e.type&&e.keyPrefix===this.keyPrefix?this._initiated=!0:f.call(this,e)})),process.send({channel:c,type:"init",opts:y.call(this)}),this._promises={}}consume(e,t=1,r={}){return new Promise(((n,i)=>{const s=g.call(this,n,i);d.call(this,"consume",s,e,t,r)}))}penalty(e,t=1,r={}){return new Promise(((n,i)=>{const s=g.call(this,n,i);d.call(this,"penalty",s,e,t,r)}))}reward(e,t=1,r={}){return new Promise(((n,i)=>{const s=g.call(this,n,i);d.call(this,"reward",s,e,t,r)}))}block(e,t,r={}){return new Promise(((n,i)=>{const s=g.call(this,n,i);d.call(this,"block",s,e,t,r)}))}get(e,t={}){return new Promise(((r,n)=>{const i=g.call(this,r,n);d.call(this,"get",i,e,t)}))}delete(e,t={}){return new Promise(((r,n)=>{const i=g.call(this,r,n);d.call(this,"delete",i,e,t)}))}}}},5105:(e,t,r)=>{const n=r(1090),i=r(5155);e.exports=class extends n{constructor(e){super(e),this.client=e.storeClient}_getRateLimiterRes(e,t,r){const n=new i;return n.consumedPoints=parseInt(r.consumedPoints),n.isFirstInDuration=r.consumedPoints===t,n.remainingPoints=Math.max(this.points-n.consumedPoints,0),n.msBeforeNext=r.msBeforeNext,n}_upsert(e,t,r,n=!1,i={}){return new Promise(((s,o)=>{const a=Date.now(),c=Math.floor(r/1e3);n?this.client.set(e,t,c,(r=>{r?o(r):this.client.set(`${e}_expire`,c>0?a+1e3*c:-1,c,(()=>{s({consumedPoints:t,msBeforeNext:c>0?1e3*c:-1})}))})):this.client.incr(e,t,((l,u)=>{l||!1===u?this.client.add(e,t,c,((l,u)=>{if(l||!u)if(void 0===i.attemptNumber||i.attemptNumber<3){const a=Object.assign({},i);a.attemptNumber=a.attemptNumber?a.attemptNumber+1:1,this._upsert(e,t,r,n,a).then((e=>s(e))).catch((e=>o(e)))}else o(new Error("Can not add key"));else this.client.add(`${e}_expire`,c>0?a+1e3*c:-1,c,(()=>{s({consumedPoints:t,msBeforeNext:c>0?1e3*c:-1})}))})):this.client.get(`${e}_expire`,((e,t)=>{if(e)o(e);else{const e=!1===t?0:t,r={consumedPoints:u,msBeforeNext:e>=0?Math.max(e-a,0):-1};s(r)}}))}))}))}_get(e){return new Promise(((t,r)=>{const n=Date.now();this.client.get(e,((i,s)=>{s?this.client.get(`${e}_expire`,((e,i)=>{if(e)r(e);else{const e=!1===i?0:i,r={consumedPoints:s,msBeforeNext:e>=0?Math.max(e-n,0):-1};t(r)}})):t(null)}))}))}_delete(e){return new Promise(((t,r)=>{this.client.del(e,((n,i)=>{n?r(n):!1===i?t(i):this.client.del(`${e}_expire`,(e=>{e?r(e):t(i)}))}))}))}}},2288:(e,t,r)=>{const n=r(1352),i=r(8425),s=r(5155);e.exports=class extends n{constructor(e={}){super(e),this._memoryStorage=new i}consume(e,t=1,r={}){return new Promise(((n,i)=>{const s=this.getKey(e),o=this._getKeySecDuration(r);let a=this._memoryStorage.incrby(s,t,o);if(a.remainingPoints=Math.max(this.points-a.consumedPoints,0),a.consumedPoints>this.points)this.blockDuration>0&&a.consumedPoints<=this.points+t&&(a=this._memoryStorage.set(s,a.consumedPoints,this.blockDuration)),i(a);else if(this.execEvenly&&a.msBeforeNext>0&&!a.isFirstInDuration){let e=Math.ceil(a.msBeforeNext/(a.remainingPoints+2));e<this.execEvenlyMinDelayMs&&(e=a.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(n,e,a)}else n(a)}))}penalty(e,t=1,r={}){const n=this.getKey(e);return new Promise((e=>{const i=this._getKeySecDuration(r),s=this._memoryStorage.incrby(n,t,i);s.remainingPoints=Math.max(this.points-s.consumedPoints,0),e(s)}))}reward(e,t=1,r={}){const n=this.getKey(e);return new Promise((e=>{const i=this._getKeySecDuration(r),s=this._memoryStorage.incrby(n,-t,i);s.remainingPoints=Math.max(this.points-s.consumedPoints,0),e(s)}))}block(e,t){const r=1e3*t,n=this.points+1;return this._memoryStorage.set(this.getKey(e),n,t),Promise.resolve(new s(0,0===r?-1:r,n))}set(e,t,r){const n=1e3*(r>=0?r:this.duration);return this._memoryStorage.set(this.getKey(e),t,r),Promise.resolve(new s(0,0===n?-1:n,t))}get(e){const t=this._memoryStorage.get(this.getKey(e));return null!==t&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),Promise.resolve(t)}delete(e){return Promise.resolve(this._memoryStorage.delete(this.getKey(e)))}}},1391:(e,t,r)=>{const n=r(1090),i=r(5155);function s(e){try{const t=e.client?e.client:e,{version:r}=t.topology.s.options.metadata.driver,n=r.split(".").map((e=>parseInt(e)));return{major:n[0],feature:n[1],patch:n[2]}}catch(e){return{major:0,feature:0,patch:0}}}class o extends n{constructor(e){super(e),this.dbName=e.dbName,this.tableName=e.tableName,this.indexKeyPrefix=e.indexKeyPrefix,e.mongo?this.client=e.mongo:this.client=e.storeClient,"function"==typeof this.client.then?this.client.then((e=>{this.client=e,this._initCollection(),this._driverVersion=s(this.client)})):(this._initCollection(),this._driverVersion=s(this.client))}get dbName(){return this._dbName}set dbName(e){this._dbName=void 0===e?o.getDbName():e}static getDbName(){return"node-rate-limiter-flexible"}get tableName(){return this._tableName}set tableName(e){this._tableName=void 0===e?this.keyPrefix:e}get client(){return this._client}set client(e){if(void 0===e)throw new Error("mongo is not set");this._client=e}get indexKeyPrefix(){return this._indexKeyPrefix}set indexKeyPrefix(e){this._indexKeyPrefix=e||{}}_initCollection(){const e=("function"==typeof this.client.db?this.client.db(this.dbName):this.client).collection(this.tableName);e.createIndex({expire:-1},{expireAfterSeconds:0}),e.createIndex(Object.assign({},this.indexKeyPrefix,{key:1}),{unique:!0}),this._collection=e}_getRateLimiterRes(e,t,r){const n=new i;let s;return s=void 0===r.value?r:r.value,n.isFirstInDuration=s.points===t,n.consumedPoints=s.points,n.remainingPoints=Math.max(this.points-n.consumedPoints,0),n.msBeforeNext=null!==s.expire?Math.max(new Date(s.expire).getTime()-Date.now(),0):-1,n}_upsert(e,t,r,n=!1,i={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const s=i.attrs||{};let o,a;n?(o={key:e},o=Object.assign(o,s),a={$set:{key:e,points:t,expire:r>0?new Date(Date.now()+r):null}},a.$set=Object.assign(a.$set,s)):(o={$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}],key:e},o=Object.assign(o,s),a={$setOnInsert:{key:e,expire:r>0?new Date(Date.now()+r):null},$inc:{points:t}},a.$setOnInsert=Object.assign(a.$setOnInsert,s));const c={upsert:!0};return this._driverVersion.major>=4||3===this._driverVersion.major&&this._driverVersion.feature>=7||this._driverVersion.feature>=6&&this._driverVersion.patch>=7?c.returnDocument="after":c.returnOriginal=!1,new Promise(((i,l)=>{this._collection.findOneAndUpdate(o,a,c).then((e=>{i(e)})).catch((o=>{if(o&&11e3===o.code){const o=Object.assign({$or:[{expire:{$lte:new Date}},{expire:{$eq:null}}],key:e},s),a={$set:Object.assign({key:e,points:t,expire:r>0?new Date(Date.now()+r):null},s)};this._collection.findOneAndUpdate(o,a,c).then((e=>{i(e)})).catch((s=>{s&&11e3===s.code?this._upsert(e,t,r,n).then((e=>i(e))).catch((e=>l(e))):l(s)}))}else l(o)}))}))}_get(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const r=t.attrs||{},n=Object.assign({key:e,$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}]},r);return this._collection.findOne(n)}_delete(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const r=t.attrs||{},n=Object.assign({key:e},r);return this._collection.deleteOne(n).then((e=>e.deletedCount>0))}}e.exports=o},4156:(e,t,r)=>{const n=r(1090),i=r(5155);e.exports=class extends n{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.dbName=e.dbName,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?(this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"==typeof t&&t()):this._createDbAndTable().then((()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"==typeof t&&t()})).catch((e=>{if("function"!=typeof t)throw e;t(e)}))}clearExpired(e){return new Promise((t=>{this._getConnection().then((r=>{r.query("DELETE FROM ??.?? WHERE expire < ?",[this.dbName,this.tableName,e],(()=>{this._releaseConnection(r),t()}))})).catch((()=>{t()}))}))}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout((()=>{this.clearExpired(Date.now()-36e5).then((()=>{this._clearExpiredHourAgo()}))}),3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return new Promise(((e,t)=>{this.client.getConnection(((r,n)=>{if(r)return t(r);e(n)}))}));case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();default:return Promise.resolve(this.client)}}_releaseConnection(e){switch(this.clientType){case"pool":return e.release();case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e);default:return!0}}_createDbAndTable(){return new Promise(((e,t)=>{this._getConnection().then((r=>{r.query(`CREATE DATABASE IF NOT EXISTS \`${this.dbName}\`;`,(n=>{if(n)return this._releaseConnection(r),t(n);r.query(this._getCreateTableStmt(),(n=>{if(n)return this._releaseConnection(r),t(n);this._releaseConnection(r),e()}))}))})).catch((e=>{t(e)}))}))}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS \`${this.dbName}\`.\`${this.tableName}\` (\`key\` VARCHAR(255) CHARACTER SET utf8 NOT NULL,\`points\` INT(9) NOT NULL default 0,\`expire\` BIGINT UNSIGNED,PRIMARY KEY (\`key\`)) ENGINE = INNODB;`}get clientType(){return this._clientType}set clientType(e){if(void 0===e)if("Connection"===this.client.constructor.name)e="connection";else if("Pool"===this.client.constructor.name)e="pool";else{if("Sequelize"!==this.client.constructor.name)throw new Error("storeType is not defined");e="sequelize"}this._clientType=e.toLowerCase()}get dbName(){return this._dbName}set dbName(e){this._dbName=void 0===e?"rtlmtrflx":e}get tableName(){return this._tableName}set tableName(e){this._tableName=void 0===e?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=void 0!==e&&!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=void 0===e||Boolean(e)}_getRateLimiterRes(e,t,r){const n=new i,[s]=r;return n.isFirstInDuration=t===s.points,n.consumedPoints=n.isFirstInDuration?t:s.points,n.remainingPoints=Math.max(this.points-n.consumedPoints,0),n.msBeforeNext=s.expire?Math.max(s.expire-Date.now(),0):-1,n}_upsertTransaction(e,t,r,n,i){return new Promise(((s,o)=>{e.query("BEGIN",(a=>{if(a)return e.rollback(),o(a);const c=Date.now(),l=n>0?c+n:null;let u,h;i?(u="INSERT INTO ??.?? VALUES (?, ?, ?)\n          ON DUPLICATE KEY UPDATE \n            points = ?, \n            expire = ?;",h=[this.dbName,this.tableName,t,r,l,r,l]):(u="INSERT INTO ??.?? VALUES (?, ?, ?)\n          ON DUPLICATE KEY UPDATE \n            points = IF(expire <= ?, ?, points + (?)), \n            expire = IF(expire <= ?, ?, expire);",h=[this.dbName,this.tableName,t,r,l,c,r,r,c,l]),e.query(u,h,(r=>{if(r)return e.rollback(),o(r);e.query("SELECT points, expire FROM ??.?? WHERE `key` = ?;",[this.dbName,this.tableName,t],((t,r)=>{if(t)return e.rollback(),o(t);e.query("COMMIT",(t=>{if(t)return e.rollback(),o(t);s(r)}))}))}))}))}))}_upsert(e,t,r,n=!1){return this.tableCreated?new Promise(((i,s)=>{this._getConnection().then((o=>{this._upsertTransaction(o,e,t,r,n).then((e=>{i(e),this._releaseConnection(o)})).catch((e=>{s(e),this._releaseConnection(o)}))})).catch((e=>{s(e)}))})):Promise.reject(Error("Table is not created yet"))}_get(e){return this.tableCreated?new Promise(((t,r)=>{this._getConnection().then((n=>{n.query("SELECT points, expire FROM ??.?? WHERE `key` = ? AND (`expire` > ? OR `expire` IS NULL)",[this.dbName,this.tableName,e,Date.now()],((e,i)=>{e?r(e):0===i.length?t(null):t(i),this._releaseConnection(n)}))})).catch((e=>{r(e)}))})):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?new Promise(((t,r)=>{this._getConnection().then((n=>{n.query("DELETE FROM ??.?? WHERE `key` = ?",[this.dbName,this.tableName,e],((e,i)=>{e?r(e):t(i.affectedRows>0),this._releaseConnection(n)}))})).catch((e=>{r(e)}))})):Promise.reject(Error("Table is not created yet"))}}},4832:(e,t,r)=>{const n=r(1090),i=r(5155);e.exports=class extends n{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?"function"==typeof t&&t():this._createTable().then((()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"==typeof t&&t()})).catch((e=>{if("function"!=typeof t)throw e;t(e)}))}clearExpired(e){return new Promise((t=>{const r={name:"rlflx-clear-expired",text:`DELETE FROM ${this.tableName} WHERE expire < $1`,values:[e]};this._query(r).then((()=>{t()})).catch((()=>{t()}))}))}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout((()=>{this.clearExpired(Date.now()-36e5).then((()=>{this._clearExpiredHourAgo()}))}),3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":default:return Promise.resolve(this.client);case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();case"typeorm":return Promise.resolve(this.client.driver.master)}}_releaseConnection(e){switch(this.clientType){case"pool":case"typeorm":default:return!0;case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e)}}_createTable(){return new Promise(((e,t)=>{this._query({text:this._getCreateTableStmt()}).then((()=>{e()})).catch((r=>{"23505"===r.code?e():t(r)}))}))}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS ${this.tableName} ( \n      key varchar(255) PRIMARY KEY,\n      points integer NOT NULL DEFAULT 0,\n      expire bigint\n    );`}get clientType(){return this._clientType}set clientType(e){const t=this.client.constructor.name;if(void 0===e)if("Client"===t)e="client";else if("Pool"===t||"BoundPool"===t)e="pool";else{if("Sequelize"!==t)throw new Error("storeType is not defined");e="sequelize"}this._clientType=e.toLowerCase()}get tableName(){return this._tableName}set tableName(e){this._tableName=void 0===e?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=void 0!==e&&!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=void 0===e||Boolean(e)}_getRateLimiterRes(e,t,r){const n=new i,s=r.rows[0];return n.isFirstInDuration=t===s.points,n.consumedPoints=n.isFirstInDuration?t:s.points,n.remainingPoints=Math.max(this.points-n.consumedPoints,0),n.msBeforeNext=s.expire?Math.max(s.expire-Date.now(),0):-1,n}_query(e){const t={name:`${this.tableName.toLowerCase()}:${e.name}`,text:e.text,values:e.values};return new Promise(((e,r)=>{this._getConnection().then((n=>{n.query(t).then((t=>{e(t),this._releaseConnection(n)})).catch((e=>{r(e),this._releaseConnection(n)}))})).catch((e=>{r(e)}))}))}_upsert(e,t,r,n=!1){if(!this.tableCreated)return Promise.reject(Error("Table is not created yet"));const i=r>0?Date.now()+r:null,s=n?" $3 ":` CASE\n             WHEN ${this.tableName}.expire <= $4 THEN $3\n             ELSE ${this.tableName}.expire\n            END `;return this._query({name:n?"rlflx-upsert-force":"rlflx-upsert",text:`\n            INSERT INTO ${this.tableName} VALUES ($1, $2, $3)\n              ON CONFLICT(key) DO UPDATE SET\n                points = CASE\n                          WHEN (${this.tableName}.expire <= $4 OR 1=${n?1:0}) THEN $2\n                          ELSE ${this.tableName}.points + ($2)\n                         END,\n                expire = ${s}\n            RETURNING points, expire;`,values:[e,t,i,Date.now()]})}_get(e){return this.tableCreated?new Promise(((t,r)=>{this._query({name:"rlflx-get",text:`\n            SELECT points, expire FROM ${this.tableName} WHERE key = $1 AND (expire > $2 OR expire IS NULL);`,values:[e,Date.now()]}).then((e=>{0===e.rowCount&&(e=null),t(e)})).catch((e=>{r(e)}))})):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?this._query({name:"rlflx-delete",text:`DELETE FROM ${this.tableName} WHERE key = $1`,values:[e]}).then((e=>e.rowCount>0)):Promise.reject(Error("Table is not created yet"))}}},8686:(e,t,r)=>{const n=r(5255),i=4294967295,s="limiter";e.exports=class{constructor(e,t={maxQueueSize:i}){this._queueLimiters={KEY_DEFAULT:new o(e,t)},this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(e=s){return this._queueLimiters[e]?this._queueLimiters[e].getTokensRemaining():Promise.resolve(this._limiterFlexible.points)}removeTokens(e,t=s){return this._queueLimiters[t]||(this._queueLimiters[t]=new o(this._limiterFlexible,{key:t,maxQueueSize:this._maxQueueSize})),this._queueLimiters[t].removeTokens(e)}};class o{constructor(e,t={maxQueueSize:i,key:s}){this._key=t.key,this._waitTimeout=null,this._queue=[],this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(){return this._limiterFlexible.get(this._key).then((e=>null!==e?e.remainingPoints:this._limiterFlexible.points))}removeTokens(e){const t=this;return new Promise(((r,i)=>{e>t._limiterFlexible.points?i(new n(`Requested tokens ${e} exceeds maximum ${t._limiterFlexible.points} tokens per interval`)):t._queue.length>0?t._queueRequest.call(t,r,i,e):t._limiterFlexible.consume(t._key,e).then((e=>{r(e.remainingPoints)})).catch((n=>{n instanceof Error?i(n):(t._queueRequest.call(t,r,i,e),null===t._waitTimeout&&(t._waitTimeout=setTimeout(t._processFIFO.bind(t),n.msBeforeNext)))}))}))}_queueRequest(e,t,r){const i=this;i._queue.length<i._maxQueueSize?i._queue.push({resolve:e,reject:t,tokens:r}):t(new n(`Number of requests reached it's maximum ${i._maxQueueSize}`))}_processFIFO(){const e=this;if(null!==e._waitTimeout&&(clearTimeout(e._waitTimeout),e._waitTimeout=null),0===e._queue.length)return;const t=e._queue.shift();e._limiterFlexible.consume(e._key,t.tokens).then((r=>{t.resolve(r.remainingPoints),e._processFIFO.call(e)})).catch((r=>{r instanceof Error?(t.reject(r),e._processFIFO.call(e)):(e._queue.unshift(t),null===e._waitTimeout&&(e._waitTimeout=setTimeout(e._processFIFO.bind(e),r.msBeforeNext)))}))}}},4636:(e,t,r)=>{const n=r(1090),i=r(5155),s="redis.call('set', KEYS[1], 0, 'EX', ARGV[2], 'NX') local consumed = redis.call('incrby', KEYS[1], ARGV[1]) local ttl = redis.call('pttl', KEYS[1]) if ttl == -1 then   redis.call('expire', KEYS[1], ARGV[2])   ttl = 1000 * ARGV[2] end return {consumed, ttl} ";e.exports=class extends n{constructor(e){super(e),e.redis?this.client=e.redis:this.client=e.storeClient,this._rejectIfRedisNotReady=!!e.rejectIfRedisNotReady,"function"==typeof this.client.defineCommand&&this.client.defineCommand("rlflxIncr",{numberOfKeys:1,lua:s})}_isRedisReady(){return!(this._rejectIfRedisNotReady&&(this.client.status&&"ready"!==this.client.status||"function"==typeof this.client.isReady&&!this.client.isReady()))}_getRateLimiterRes(e,t,r){let[n,s]=r;Array.isArray(n)&&([,n]=n,[,s]=s);const o=new i;return o.consumedPoints=parseInt(n),o.isFirstInDuration=o.consumedPoints===t,o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.msBeforeNext=s,o}_upsert(e,t,r,n=!1){return new Promise(((i,o)=>{if(!this._isRedisReady())return o(new Error("Redis connection is not ready"));const a=Math.floor(r/1e3),c=this.client.multi();if(n)a>0?c.set(e,t,"EX",a):c.set(e,t),c.pttl(e).exec(((e,t)=>e?o(e):i(t)));else if(a>0){const r=function(e,t){return e?o(e):i(t)};"function"==typeof this.client.rlflxIncr?this.client.rlflxIncr(e,t,a,r):this.client.eval(s,1,e,t,a,r)}else c.incrby(e,t).pttl(e).exec(((e,t)=>e?o(e):i(t)))}))}_get(e){return new Promise(((t,r)=>{if(!this._isRedisReady())return r(new Error("Redis connection is not ready"));this.client.multi().get(e).pttl(e).exec(((e,n)=>{if(e)r(e);else{const[e]=n;if(null===e)return t(null);t(n)}}))}))}_delete(e){return new Promise(((t,r)=>{this.client.del(e,((e,n)=>{e?r(e):t(n>0)}))}))}}},5155:e=>{e.exports=class{constructor(e,t,r,n){this.remainingPoints=void 0===e?0:e,this.msBeforeNext=void 0===t?0:t,this.consumedPoints=void 0===r?0:r,this.isFirstInDuration=void 0!==n&&n}get msBeforeNext(){return this._msBeforeNext}set msBeforeNext(e){return this._msBeforeNext=e,this}get remainingPoints(){return this._remainingPoints}set remainingPoints(e){return this._remainingPoints=e,this}get consumedPoints(){return this._consumedPoints}set consumedPoints(e){return this._consumedPoints=e,this}get isFirstInDuration(){return this._isFirstInDuration}set isFirstInDuration(e){this._isFirstInDuration=Boolean(e)}_getDecoratedProperties(){return{remainingPoints:this.remainingPoints,msBeforeNext:this.msBeforeNext,consumedPoints:this.consumedPoints,isFirstInDuration:this.isFirstInDuration}}[Symbol.for("nodejs.util.inspect.custom")](){return this._getDecoratedProperties()}toString(){return JSON.stringify(this._getDecoratedProperties())}toJSON(){return this._getDecoratedProperties()}}},1090:(e,t,r)=>{const n=r(1352),i=r(2423),s=r(5155);e.exports=class extends n{constructor(e={}){super(e),this.inMemoryBlockOnConsumed=e.inMemoryBlockOnConsumed||e.inmemoryBlockOnConsumed,this.inMemoryBlockDuration=e.inMemoryBlockDuration||e.inmemoryBlockDuration,this.insuranceLimiter=e.insuranceLimiter,this._inMemoryBlockedKeys=new i}get client(){return this._client}set client(e){if(void 0===e)throw new Error("storeClient is not set");this._client=e}_afterConsume(e,t,r,n,i,s={}){const o=this._getRateLimiterRes(r,n,i);if(this.inMemoryBlockOnConsumed>0&&!(this.inMemoryBlockDuration>0)&&o.consumedPoints>=this.inMemoryBlockOnConsumed)return this._inMemoryBlockedKeys.addMs(r,o.msBeforeNext),o.consumedPoints>this.points?t(o):e(o);if(o.consumedPoints>this.points){let e=Promise.resolve();this.blockDuration>0&&o.consumedPoints<=this.points+n&&(o.msBeforeNext=this.msBlockDuration,e=this._block(r,o.consumedPoints,this.msBlockDuration,s)),this.inMemoryBlockOnConsumed>0&&o.consumedPoints>=this.inMemoryBlockOnConsumed&&(this._inMemoryBlockedKeys.add(r,this.inMemoryBlockDuration),o.msBeforeNext=this.msInMemoryBlockDuration),e.then((()=>{t(o)})).catch((e=>{t(e)}))}else if(this.execEvenly&&o.msBeforeNext>0&&!o.isFirstInDuration){let t=Math.ceil(o.msBeforeNext/(o.remainingPoints+2));t<this.execEvenlyMinDelayMs&&(t=o.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(e,t,o)}else e(o)}_handleError(e,t,r,i,s,o=!1,a={}){this.insuranceLimiter instanceof n?this.insuranceLimiter[t](s,o,a).then((e=>{r(e)})).catch((e=>{i(e)})):i(e)}get _inmemoryBlockedKeys(){return this._inMemoryBlockedKeys}getInmemoryBlockMsBeforeExpire(e){return this.getInMemoryBlockMsBeforeExpire(e)}get inmemoryBlockOnConsumed(){return this.inMemoryBlockOnConsumed}set inmemoryBlockOnConsumed(e){this.inMemoryBlockOnConsumed=e}get inmemoryBlockDuration(){return this.inMemoryBlockDuration}set inmemoryBlockDuration(e){this.inMemoryBlockDuration=e}get msInmemoryBlockDuration(){return 1e3*this.inMemoryBlockDuration}getInMemoryBlockMsBeforeExpire(e){return this.inMemoryBlockOnConsumed>0?this._inMemoryBlockedKeys.msBeforeExpire(e):0}get inMemoryBlockOnConsumed(){return this._inMemoryBlockOnConsumed}set inMemoryBlockOnConsumed(e){if(this._inMemoryBlockOnConsumed=e?parseInt(e):0,this.inMemoryBlockOnConsumed>0&&this.points>this.inMemoryBlockOnConsumed)throw new Error('inMemoryBlockOnConsumed option must be greater or equal "points" option')}get inMemoryBlockDuration(){return this._inMemoryBlockDuration}set inMemoryBlockDuration(e){if(this._inMemoryBlockDuration=e?parseInt(e):0,this.inMemoryBlockDuration>0&&0===this.inMemoryBlockOnConsumed)throw new Error("inMemoryBlockOnConsumed option must be set up")}get msInMemoryBlockDuration(){return 1e3*this._inMemoryBlockDuration}get insuranceLimiter(){return this._insuranceLimiter}set insuranceLimiter(e){if(void 0!==e&&!(e instanceof n))throw new Error("insuranceLimiter must be instance of RateLimiterAbstract");this._insuranceLimiter=e,this._insuranceLimiter&&(this._insuranceLimiter.blockDuration=this.blockDuration,this._insuranceLimiter.execEvenly=this.execEvenly)}block(e,t,r={}){const n=1e3*t;return this._block(this.getKey(e),this.points+1,n,r)}set(e,t,r,n={}){const i=1e3*(r>=0?r:this.duration);return this._block(this.getKey(e),t,i,n)}consume(e,t=1,r={}){return new Promise(((n,i)=>{const o=this.getKey(e),a=this.getInMemoryBlockMsBeforeExpire(o);if(a>0)return i(new s(0,a));this._upsert(o,t,1e3*this._getKeySecDuration(r),!1,r).then((e=>{this._afterConsume(n,i,o,t,e)})).catch((s=>{this._handleError(s,"consume",n,i,e,t,r)}))}))}penalty(e,t=1,r={}){const n=this.getKey(e);return new Promise(((i,s)=>{this._upsert(n,t,1e3*this._getKeySecDuration(r),!1,r).then((e=>{i(this._getRateLimiterRes(n,t,e))})).catch((n=>{this._handleError(n,"penalty",i,s,e,t,r)}))}))}reward(e,t=1,r={}){const n=this.getKey(e);return new Promise(((i,s)=>{this._upsert(n,-t,1e3*this._getKeySecDuration(r),!1,r).then((e=>{i(this._getRateLimiterRes(n,-t,e))})).catch((n=>{this._handleError(n,"reward",i,s,e,t,r)}))}))}get(e,t={}){const r=this.getKey(e);return new Promise(((n,i)=>{this._get(r,t).then((e=>{n(null==e?null:this._getRateLimiterRes(r,0,e))})).catch((r=>{this._handleError(r,"get",n,i,e,t)}))}))}delete(e,t={}){const r=this.getKey(e);return new Promise(((n,i)=>{this._delete(r,t).then((e=>{this._inMemoryBlockedKeys.delete(r),n(e)})).catch((r=>{this._handleError(r,"delete",n,i,e,t)}))}))}deleteInMemoryBlockedAll(){this._inMemoryBlockedKeys.delete()}_getRateLimiterRes(e,t,r){throw new Error("You have to implement the method '_getRateLimiterRes'!")}_block(e,t,r,n={}){return new Promise(((i,o)=>{this._upsert(e,t,r,!0,n).then((()=>{i(new s(0,r>0?r:-1,t))})).catch((t=>{this._handleError(t,"block",i,o,this.parseKey(e),r/1e3,n)}))}))}_get(e,t={}){throw new Error("You have to implement the method '_get'!")}_delete(e,t={}){throw new Error("You have to implement the method '_delete'!")}_upsert(e,t,r,n=!1,i={}){throw new Error("You have to implement the method '_upsert'!")}}},3766:(e,t,r)=>{const n=r(1352);e.exports=class{constructor(...e){if(e.length<1)throw new Error("RateLimiterUnion: at least one limiter have to be passed");e.forEach((e=>{if(!(e instanceof n))throw new Error("RateLimiterUnion: all limiters have to be instance of RateLimiterAbstract")})),this._limiters=e}consume(e,t=1){return new Promise(((r,n)=>{const i=[];this._limiters.forEach((r=>{i.push(r.consume(e,t).catch((e=>({rejected:!0,rej:e}))))})),Promise.all(i).then((e=>{const t={};let i=!1;e.forEach((e=>{!0===e.rejected&&(i=!0)}));for(let r=0;r<e.length;r++)i&&!0===e[r].rejected?t[this._limiters[r].keyPrefix]=e[r].rej:i||(t[this._limiters[r].keyPrefix]=e[r]);i?n(t):r(t)}))}))}}},8894:e=>{e.exports=class{constructor(){this._keys={},this._addedKeysAmount=0}collectExpired(){const e=Date.now();Object.keys(this._keys).forEach((t=>{this._keys[t]<=e&&delete this._keys[t]})),this._addedKeysAmount=Object.keys(this._keys).length}add(e,t){this.addMs(e,1e3*t)}addMs(e,t){this._keys[e]=Date.now()+t,this._addedKeysAmount++,this._addedKeysAmount>999&&this.collectExpired()}msBeforeExpire(e){const t=this._keys[e];if(t&&t>=Date.now()){this.collectExpired();const e=Date.now();return t>=e?t-e:0}return 0}delete(e){e?delete this._keys[e]:Object.keys(this._keys).forEach((e=>{delete this._keys[e]}))}}},2423:(e,t,r)=>{const n=r(8894);e.exports=n},8425:(e,t,r)=>{const n=r(9250),i=r(5155);e.exports=class{constructor(){this._storage={}}incrby(e,t,r){if(this._storage[e]){const n=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-(new Date).getTime():-1;return 0!==n?(this._storage[e].value=this._storage[e].value+t,new i(0,n,this._storage[e].value,!1)):this.set(e,t,r)}return this.set(e,t,r)}set(e,t,r){const s=1e3*r;return this._storage[e]&&this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),this._storage[e]=new n(t,s>0?new Date(Date.now()+s):null),s>0&&(this._storage[e].timeoutId=setTimeout((()=>{delete this._storage[e]}),s),this._storage[e].timeoutId.unref&&this._storage[e].timeoutId.unref()),new i(0,0===s?-1:s,this._storage[e].value,!0)}get(e){if(this._storage[e]){const t=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-(new Date).getTime():-1;return new i(0,t,this._storage[e].value,!1)}return null}delete(e){return!!this._storage[e]&&(this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),delete this._storage[e],!0)}}},9250:e=>{e.exports=class{constructor(e,t,r=null){this.value=e,this.expiresAt=t,this.timeoutId=r}get value(){return this._value}set value(e){this._value=parseInt(e)}get expiresAt(){return this._expiresAt}set expiresAt(e){e instanceof Date||!Number.isInteger(e)||(e=new Date(e)),this._expiresAt=e}get timeoutId(){return this._timeoutId}set timeoutId(e){this._timeoutId=e}}},5255:e=>{e.exports=class extends Error{constructor(e,t){super(),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="CustomError",this.message=e,t&&(this.extra=t)}}},3692:(e,t,r)=>{"use strict";e.exports=o;var n=r(7824),i=o.prototype,s=new Date%1e9;function o(e){e=e||{},this.id=e.id||(1e9*Math.random()>>>0)+s++,this.max=e.max||1/0,this.items=e.items||[],this._lookup={},this.size=this.items.length,this.lastModified=new Date(e.lastModified||new Date);for(var t,r,n=this.items.length;n--;)t=this.items[n],r=new Date(t.expires)-new Date,this._lookup[t.key]=t,r>0?this.expire(t.key,r):r<=0&&this.delete(t.key)}i.has=function(e){return e in this._lookup},i.get=function(e){if(!this.has(e))return null;var t=this._lookup[e];return t.refresh&&this.expire(e,t.refresh),this.items.splice(this.items.indexOf(t),1),this.items.push(t),t.value},i.meta=function(e){if(!this.has(e))return null;var t=this._lookup[e];return"meta"in t?t.meta:null},i.set=function(e,t,r){var n=this._lookup[e],i=this._lookup[e]={key:e,value:t};return this.lastModified=new Date,n?(clearTimeout(n.timeout),this.items.splice(this.items.indexOf(n),1,i)):(this.size>=this.max&&this.delete(this.items[0].key),this.items.push(i),this.size++),r&&("ttl"in r&&this.expire(e,r.ttl),"meta"in r&&(i.meta=r.meta),r.refresh&&(i.refresh=r.ttl)),this},i.delete=function(e){var t=this._lookup[e];return!!t&&(this.lastModified=new Date,this.items.splice(this.items.indexOf(t),1),clearTimeout(t.timeout),delete this._lookup[e],this.size--,this)},i.expire=function(e,t){var r=t||0,i=this._lookup[e];if(!i)return this;if("string"==typeof r&&(r=n(t)),"number"!=typeof r)throw new TypeError("Expiration time must be a string or number.");return clearTimeout(i.timeout),i.timeout=setTimeout(this.delete.bind(this,i.key),r),i.expires=Number(new Date)+r,this},i.clear=function(){for(var e=this.items.length;e--;)this.delete(this.items[e].key);return this},i.toJSON=function(){for(var e,t=new Array(this.items.length),r=t.length;r--;)e=this.items[r],t[r]={key:e.key,meta:e.meta,value:e.value,expires:e.expires,refresh:e.refresh};return{id:this.id,max:isFinite(this.max)?this.max:void 0,lastModified:this.lastModified,items:t}}},2916:(e,t,r)=>{"use strict";const n=r(1807);class i{constructor(e,t,r){const i=this;this._started=n(),this._rescheduled=0,this._scheduled=t,this._args=r,this._triggered=!1,this._timerWrapper=()=>{i._rescheduled>0?(i._scheduled=i._rescheduled-(n()-i._started),i._schedule(i._scheduled)):(i._triggered=!0,e.apply(null,i._args))},this._timer=setTimeout(this._timerWrapper,t)}reschedule(e){e||(e=this._scheduled);const t=n();t+e-(this._started+this._scheduled)<0?(clearTimeout(this._timer),this._schedule(e)):this._triggered?this._schedule(e):(this._started=t,this._rescheduled=e)}_schedule(e){this._triggered=!1,this._started=n(),this._rescheduled=0,this._scheduled=e,this._timer=setTimeout(this._timerWrapper,e)}clear(){clearTimeout(this._timer)}}e.exports=function(){if("function"!=typeof arguments[0])throw new Error("callback needed");if("number"!=typeof arguments[1])throw new Error("timeout needed");let e;if(arguments.length>0){e=new Array(arguments.length-2);for(var t=0;t<e.length;t++)e[t]=arguments[t+2]}return new i(arguments[0],arguments[1],e)}},1807:e=>{"use strict";e.exports=function(){return Date.now()}},202:(e,t,r)=>{"use strict";var n=r(3700),i=/[\/\?<>\\:\*\|"]/g,s=/[\x00-\x1f\x80-\x9f]/g,o=/^\.+$/,a=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,c=/[\. ]+$/;function l(e,t){if("string"!=typeof e)throw new Error("Input must be string");var r=e.replace(i,t).replace(s,t).replace(o,t).replace(a,t).replace(c,t);return n(r,255)}e.exports=function(e,t){var r=t&&t.replacement||"",n=l(e,r);return""===r?n:l(n,"")}},7695:e=>{"use strict";const t=new Map;e.exports={setDelayedInterval:function(e,r,n){n=n||r;const i=`${Date.now()}:${Math.floor(1e6*Math.random())}`,s=setTimeout((()=>{!async function(e,r,n){for(;t.get(n);){try{await e()}catch(e){setTimeout((()=>{throw e}),1);break}if(!t.get(n))break;await new Promise((e=>{const i=setTimeout(e,r);t.set(n,i)}))}}(e,r,i)}),n);return t.set(i,s),i},clearDelayedInterval:function(e){const r=t.get(e);r&&(clearTimeout(r),t.delete(e))}}},715:(e,t,r)=>{"use strict";const{AbortController:n}=globalThis,i=r(2916);class s extends n{constructor(e){super(),this._ms=e,this._timer=i((()=>this.abort()),e),Object.setPrototypeOf(this,s.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=i((()=>this.abort()),this._ms)}}e.exports={TimeoutController:s}},3700:(e,t,r)=>{"use strict";var n=r(1156),i=r(793);e.exports=n.bind(null,i)},1156:e=>{"use strict";function t(e){return e>=55296&&e<=56319}function r(e){return e>=56320&&e<=57343}e.exports=function(e,n,i){if("string"!=typeof n)throw new Error("Input must be string");for(var s,o,a=n.length,c=0,l=0;l<a;l+=1){if(s=n.charCodeAt(l),o=n[l],t(s)&&r(n.charCodeAt(l+1))&&(o+=n[l+=1]),(c+=e(o))===i)return n.slice(0,l+1);if(c>i)return n.slice(0,l-o.length+1)}return n}},793:e=>{"use strict";function t(e){return e>=55296&&e<=56319}function r(e){return e>=56320&&e<=57343}e.exports=function(e){if("string"!=typeof e)throw new Error("Input must be string");for(var n=e.length,i=0,s=null,o=null,a=0;a<n;a++)r(s=e.charCodeAt(a))?null!=o&&t(o)?i+=1:i+=3:s<=127?i+=1:s>=128&&s<=2047?i+=2:s>=2048&&s<=65535&&(i+=3),o=s;return i}},6988:e=>{e.exports=function e(n,i){var s,o=0,a=0,c=i=i||0,l=n.length;do{if(c>=l||a>49)throw e.bytes=0,new RangeError("Could not decode varint");s=n[c++],o+=a<28?(s&r)<<a:(s&r)*Math.pow(2,a),a+=7}while(s>=t);return e.bytes=c-i,o};var t=128,r=127},1312:e=>{e.exports=function e(i,s,o){if(Number.MAX_SAFE_INTEGER&&i>Number.MAX_SAFE_INTEGER)throw e.bytes=0,new RangeError("Could not encode varint");s=s||[];for(var a=o=o||0;i>=n;)s[o++]=255&i|t,i/=128;for(;i&r;)s[o++]=255&i|t,i>>>=7;return s[o]=0|i,e.bytes=o-a+1,s};var t=128,r=-128,n=Math.pow(2,31)},4676:(e,t,r)=>{e.exports={encode:r(1312),decode:r(6988),encodingLength:r(82)}},82:e=>{var t=Math.pow(2,7),r=Math.pow(2,14),n=Math.pow(2,21),i=Math.pow(2,28),s=Math.pow(2,35),o=Math.pow(2,42),a=Math.pow(2,49),c=Math.pow(2,56),l=Math.pow(2,63);e.exports=function(e){return e<t?1:e<r?2:e<n?3:e<i?4:e<s?5:e<o?6:e<a?7:e<c?8:e<l?9:10}},7420:()=>{},5856:()=>{},5883:()=>{},5819:()=>{},1265:()=>{},5539:()=>{}},__webpack_module_cache__={},leafPrototypes,getProto;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(r.exports,r,r.exports,__webpack_require__),r.exports}getProto=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var r=Object.create(null);__webpack_require__.r(r);var n={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var i=2&t&&e;"object"==typeof i&&!~leafPrototypes.indexOf(i);i=getProto(i))Object.getOwnPropertyNames(i).forEach((t=>n[t]=()=>e[t]));return n.default=()=>e,__webpack_require__.d(r,n),r},__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};(()=>{"use strict";var e={};__webpack_require__.r(e),__webpack_require__.d(e,{base58btc:()=>q,base58flickr:()=>j});var t={};__webpack_require__.r(t),__webpack_require__.d(t,{base32:()=>H,base32hex:()=>W,base32hexpad:()=>Q,base32hexpadupper:()=>X,base32hexupper:()=>Y,base32pad:()=>$,base32padupper:()=>G,base32upper:()=>z,base32z:()=>Z});var r={};__webpack_require__.r(r),__webpack_require__.d(r,{base64:()=>J,base64pad:()=>ee,base64url:()=>te,base64urlpad:()=>re});var n={};__webpack_require__.r(n),__webpack_require__.d(n,{identity:()=>ce});var i={};__webpack_require__.r(i),__webpack_require__.d(i,{base2:()=>le});var s={};__webpack_require__.r(s),__webpack_require__.d(s,{base8:()=>ue});var o={};__webpack_require__.r(o),__webpack_require__.d(o,{base10:()=>he});var a={};__webpack_require__.r(a),__webpack_require__.d(a,{base16:()=>de,base16upper:()=>pe});var c={};__webpack_require__.r(c),__webpack_require__.d(c,{base36:()=>fe,base36upper:()=>ye});var l={};__webpack_require__.r(l),__webpack_require__.d(l,{base256emoji:()=>Ee});var u={};__webpack_require__.r(u),__webpack_require__.d(u,{sha256:()=>He,sha512:()=>ze});var h={};__webpack_require__.r(h),__webpack_require__.d(h,{identity:()=>Ge});var d={};__webpack_require__.r(d),__webpack_require__.d(d,{code:()=>Ye,decode:()=>Xe,encode:()=>Qe,name:()=>We});var p={};__webpack_require__.r(p),__webpack_require__.d(p,{code:()=>tt,decode:()=>nt,encode:()=>rt,name:()=>et});var f={};__webpack_require__.r(f),__webpack_require__.d(f,{RsaPrivateKey:()=>vo,RsaPublicKey:()=>bo,fromJwk:()=>Co,generateKeyPair:()=>Ao,unmarshalRsaPrivateKey:()=>_o,unmarshalRsaPublicKey:()=>So});var y={};__webpack_require__.r(y),__webpack_require__.d(y,{Ed25519PrivateKey:()=>Ca,Ed25519PublicKey:()=>Sa,generateKeyPair:()=>Ta,generateKeyPairFromSeed:()=>Ra,unmarshalEd25519PrivateKey:()=>Aa,unmarshalEd25519PublicKey:()=>Ia});var g={};__webpack_require__.r(g),__webpack_require__.d(g,{Secp256k1PrivateKey:()=>Ba,Secp256k1PublicKey:()=>Pa,generateKeyPair:()=>Ua,unmarshalSecp256k1PrivateKey:()=>Oa,unmarshalSecp256k1PublicKey:()=>xa});var m={};__webpack_require__.r(m),__webpack_require__.d(m,{base58btc:()=>el,base58flickr:()=>tl});var w={};__webpack_require__.r(w),__webpack_require__.d(w,{base32:()=>rl,base32hex:()=>ol,base32hexpad:()=>cl,base32hexpadupper:()=>ll,base32hexupper:()=>al,base32pad:()=>il,base32padupper:()=>sl,base32upper:()=>nl,base32z:()=>ul});var E={};__webpack_require__.r(E),__webpack_require__.d(E,{identity:()=>vl});var b={};__webpack_require__.r(b),__webpack_require__.d(b,{base2:()=>_l});var v={};__webpack_require__.r(v),__webpack_require__.d(v,{base8:()=>Sl});var _={};__webpack_require__.r(_),__webpack_require__.d(_,{base10:()=>Cl});var S={};__webpack_require__.r(S),__webpack_require__.d(S,{base16:()=>Al,base16upper:()=>Il});var C={};__webpack_require__.r(C),__webpack_require__.d(C,{base36:()=>Tl,base36upper:()=>Rl});var A={};__webpack_require__.r(A),__webpack_require__.d(A,{base64:()=>kl,base64pad:()=>Nl,base64url:()=>Ll,base64urlpad:()=>Dl});var I={};__webpack_require__.r(I),__webpack_require__.d(I,{base256emoji:()=>xl});var T={};__webpack_require__.r(T),__webpack_require__.d(T,{sha256:()=>Kl,sha512:()=>Fl});var R={};__webpack_require__.r(R),__webpack_require__.d(R,{identity:()=>jl});var k={};__webpack_require__.r(k),__webpack_require__.d(k,{code:()=>zl,decode:()=>Gl,encode:()=>$l,name:()=>Hl});var N={};__webpack_require__.r(N),__webpack_require__.d(N,{code:()=>Xl,decode:()=>Jl,encode:()=>Zl,name:()=>Ql});var L=__webpack_require__(1227);const D=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*l+1>>>0,o=new Uint8Array(s);e[t];){var u=r[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=s-1;(0!==u||h<i)&&-1!==d;d--,h++)u+=a*o[d]>>>0,o[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var p=s-i;p!==s&&0===o[p];)p++;for(var f=new Uint8Array(n+(s-p)),y=n;p!==s;)f[y++]=o[p++];return f}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*u+1>>>0,l=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,p=o-1;(0!==h||d<n)&&-1!==p;p--,d++)h+=256*l[p]>>>0,l[p]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,i++}for(var f=o-n;f!==o&&0===l[f];)f++;for(var y=c.repeat(r);f<o;++f)y+=e.charAt(l[f]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}},P=(new Uint8Array(0),e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")});class B{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class O{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return U(this,e)}}class x{constructor(e){this.decoders=e}or(e){return U(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const U=(e,t)=>new x({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class M{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new B(e,t,r),this.decoder=new O(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const V=({name:e,prefix:t,encode:r,decode:n})=>new M(e,t,r,n),K=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=D(r,t);return V({prefix:e,name:t,encode:n,decode:e=>P(i(e))})},F=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>V({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,l=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),q=K({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),j=K({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),H=F({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),z=F({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),$=F({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),G=F({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),W=F({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Y=F({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Q=F({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),X=F({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Z=F({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),J=F({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ee=F({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),te=F({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),re=F({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function ne(e){return Object.assign(L(e),{error:L(`${e}:error`),trace:L(`${e}:trace`)})}L.formatters.b=e=>null==e?"undefined":q.baseEncode(e),L.formatters.t=e=>null==e?"undefined":H.baseEncode(e),L.formatters.m=e=>null==e?"undefined":J.baseEncode(e),L.formatters.p=e=>null==e?"undefined":e.toString(),L.formatters.c=e=>null==e?"undefined":e.toString(),L.formatters.k=e=>null==e?"undefined":e.toString();const ie=45,se=15,oe=new class{index=0;input="";new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,r=e();return void 0===r&&(this.index=t),r}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically((()=>{const t=this.readChar();if(t===e)return t}))}readSeparator(e,t,r){return this.readAtomically((()=>{if(!(t>0&&void 0===this.readGivenChar(e)))return r()}))}readNumber(e,t,r,n){return this.readAtomically((()=>{let i=0,s=0;const o=this.peekChar();if(void 0===o)return;const a="0"===o,c=2**(8*n)-1;for(;;){const r=this.readAtomically((()=>{const t=this.readChar();if(void 0===t)return;const r=Number.parseInt(t,e);return Number.isNaN(r)?void 0:r}));if(void 0===r)break;if(i*=e,i+=r,i>c)return;if(s+=1,void 0!==t&&s>t)return}return 0===s||!r&&a&&s>1?void 0:i}))}readIPv4Addr(){return this.readAtomically((()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const r=this.readSeparator(".",t,(()=>this.readNumber(10,3,!1,1)));if(void 0===r)return;e[t]=r}return e}))}readIPv6Addr(){const e=e=>{for(let t=0;t<e.length/2;t++){const r=2*t;if(t<e.length-3){const n=this.readSeparator(":",t,(()=>this.readIPv4Addr()));if(void 0!==n)return e[r]=n[0],e[r+1]=n[1],e[r+2]=n[2],e[r+3]=n[3],[r+4,!0]}const n=this.readSeparator(":",t,(()=>this.readNumber(16,4,!0,2)));if(void 0===n)return[r,!1];e[r]=n>>8,e[r+1]=255&n}return[e.length,!1]};return this.readAtomically((()=>{const t=new Uint8Array(16),[r,n]=e(t);if(16===r)return t;if(n)return;if(void 0===this.readGivenChar(":"))return;if(void 0===this.readGivenChar(":"))return;const i=new Uint8Array(14),s=16-(r+2),[o]=e(i.subarray(0,s));return t.set(i.subarray(0,o),16-o),t}))}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};function ae(e){return Boolean(function(e){if(!(e.length>ie))return oe.new(e).parseWith((()=>oe.readIPAddr()))}(e))}const ce=V({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),le=F({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),ue=F({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),he=K({prefix:"9",name:"base10",alphabet:"0123456789"}),de=F({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),pe=F({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),fe=K({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ye=K({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),ge=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),me=ge.reduce(((e,t,r)=>(e[r]=t,e)),[]),we=ge.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]),Ee=V({prefix:"🚀",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+me[t]),"")},decode:function(e){const t=[];for(const r of e){const e=we[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}});var be=128,ve=-128,_e=Math.pow(2,31),Se=128,Ce=127,Ae=Math.pow(2,7),Ie=Math.pow(2,14),Te=Math.pow(2,21),Re=Math.pow(2,28),ke=Math.pow(2,35),Ne=Math.pow(2,42),Le=Math.pow(2,49),De=Math.pow(2,56),Pe=Math.pow(2,63);const Be={encode:function e(t,r,n){r=r||[];for(var i=n=n||0;t>=_e;)r[n++]=255&t|be,t/=128;for(;t&ve;)r[n++]=255&t|be,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},decode:function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&Ce)<<s:(n&Ce)*Math.pow(2,s),s+=7}while(n>=Se);return e.bytes=o-r,i},encodingLength:function(e){return e<Ae?1:e<Ie?2:e<Te?3:e<Re?4:e<ke?5:e<Ne?6:e<Le?7:e<De?8:e<Pe?9:10}},Oe=(e,t=0)=>[Be.decode(e,t),Be.decode.bytes],xe=(e,t,r=0)=>(Be.encode(e,t,r),t),Ue=e=>Be.encodingLength(e),Me=(e,t)=>{const r=t.byteLength,n=Ue(e),i=n+Ue(r),s=new Uint8Array(i+r);return xe(e,s,0),xe(r,s,n),s.set(t,i),new Ke(e,r,t,s)},Ve=e=>{const t=P(e),[r,n]=Oe(t),[i,s]=Oe(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Ke(r,i,o,t)};class Ke{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const Fe=({name:e,code:t,encode:r})=>new qe(e,t,r);class qe{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Me(this.code,t):t.then((e=>Me(this.code,e)))}throw Error("Unknown type, must be binary type")}}const je=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),He=Fe({name:"sha2-256",code:18,encode:je("SHA-256")}),ze=Fe({name:"sha2-512",code:19,encode:je("SHA-512")}),$e=P,Ge={code:0,name:"identity",encode:$e,digest:e=>Me(0,$e(e))},We="raw",Ye=85,Qe=e=>P(e),Xe=e=>P(e),Ze=new TextEncoder,Je=new TextDecoder,et="json",tt=512,rt=e=>Ze.encode(JSON.stringify(e)),nt=e=>JSON.parse(Je.decode(e)),it=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?lt(r,ot(e),t||q.encoder):ut(r,ot(e),t||H.encoder)},st=new WeakMap,ot=e=>{const t=st.get(e);if(null==t){const t=new Map;return st.set(e,t),t}return t};class at{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==ht)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==dt)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return at.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Me(e,t);return at.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return at.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return it(this,e)}toJSON(){return{"/":it(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof at)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new at(e,r,n,i||pt(e,r,n.bytes))}if(!0===t[ft]){const{version:e,multihash:r,code:n}=t,i=Ve(r);return at.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==ht)throw new Error(`Version 0 CID must use dag-pb (code: ${ht}) block encoding`);return new at(e,t,r,r.bytes);case 1:{const n=pt(e,t,r.bytes);return new at(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return at.create(0,ht,e)}static createV1(e,t){return at.create(1,e,t)}static decode(e){const[t,r]=at.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=at.inspectBytes(e),r=t.size-t.multihashSize,n=P(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Ke(t.multihashCode,t.digestSize,i,n);return[0===t.version?at.createV0(s):at.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=Oe(e.subarray(t));return t+=n,r};let n=r(),i=ht;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=ct(e,t),i=at.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return ot(i).set(r,e),i}}const ct=(e,t)=>{switch(e[0]){case"Q":{const r=t||q;return[q.prefix,r.decode(`${q.prefix}${e}`)]}case q.prefix:{const r=t||q;return[q.prefix,r.decode(e)]}case H.prefix:{const r=t||H;return[H.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},lt=(e,t,r)=>{const{prefix:n}=r;if(n!==q.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const i=r.encode(e).slice(1);return t.set(n,i),i}return i},ut=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},ht=112,dt=18,pt=(e,t,r)=>{const n=Ue(e),i=n+Ue(t),s=new Uint8Array(i+r.byteLength);return xe(e,s,0),xe(t,s,n),s.set(r,i),s},ft=Symbol.for("@ipld/js-cid/CID"),yt={...n,...i,...s,...o,...a,...t,...c,...e,...r,...l};function gt(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function mt(e=0){return null!=globalThis.Buffer?.alloc?gt(globalThis.Buffer.alloc(e)):new Uint8Array(e)}function wt(e=0){return null!=globalThis.Buffer?.allocUnsafe?gt(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function Et(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const bt=Et("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),vt=Et("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=wt((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t})),_t={utf8:bt,"utf-8":bt,hex:yt.base16,latin1:vt,ascii:vt,binary:vt,...yt};function St(e,t="utf8"){const r=_t[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}const Ct=function(e){return Boolean(function(e){if(!(e.length>se))return oe.new(e).parseWith((()=>oe.readIPv4Addr()))}(e))},At=function(e){return Boolean(function(e){if(!(e.length>ie))return oe.new(e).parseWith((()=>oe.readIPv6Addr()))}(e))},It=function(e){let t=0;if(e=e.toString().trim(),Ct(e)){const r=new Uint8Array(t+4);return e.split(/\./g).forEach((e=>{r[t++]=255&parseInt(e,10)})),r}if(At(e)){const r=e.split(":",8);let n;for(n=0;n<r.length;n++){let e;Ct(r[n])&&(e=It(r[n]),r[n]=St(e.slice(0,2),"base16")),null!=e&&++n<8&&r.splice(n,0,St(e.slice(2,4),"base16"))}if(""===r[0])for(;r.length<8;)r.unshift("0");else if(""===r[r.length-1])for(;r.length<8;)r.push("0");else if(r.length<8){for(n=0;n<r.length&&""!==r[n];n++);const e=[n,1];for(n=9-r.length;n>0;n--)e.push("0");r.splice.apply(r,e)}const i=new Uint8Array(t+16);for(n=0;n<r.length;n++){const e=parseInt(r[n],16);i[t++]=e>>8&255,i[t++]=255&e}return i}throw new Error("invalid ip address")},Tt=function(e,t=0,r){t=~~t,r=r??e.length-t;const n=new DataView(e.buffer);if(4===r){const n=[];for(let i=0;i<r;i++)n.push(e[t+i]);return n.join(".")}if(16===r){const e=[];for(let i=0;i<r;i+=2)e.push(n.getUint16(t+i).toString(16));return e.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},Rt=-1,kt={},Nt={};function Lt(e){if("number"==typeof e){if(null!=Nt[e])return Nt[e];throw new Error(`no protocol with code: ${e}`)}if("string"==typeof e){if(null!=kt[e])return kt[e];throw new Error(`no protocol with name: ${e}`)}throw new Error("invalid protocol id type: "+typeof e)}[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Rt,"ip6zone"],[43,8,"ipcidr"],[53,Rt,"dns",!0],[54,Rt,"dns4",!0],[55,Rt,"dns6",!0],[56,Rt,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc"],[281,0,"webrtc-w3c"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Rt,"unix",!1,!0],[421,Rt,"ipfs"],[421,Rt,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Rt,"garlic64"],[448,0,"tls"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,Rt,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,Rt,"memory"]].forEach((e=>{const t=function(e,t,r,n,i){return{code:e,size:t,name:r,resolvable:Boolean(n),path:Boolean(i)}}(...e);Nt[t.code]=t,kt[t.name]=t}));var Dt=__webpack_require__(4676);function Pt(e,t="utf8"){const r=_t[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):gt(globalThis.Buffer.from(e,"utf-8"))}function Bt(e,t){null==t&&(t=e.reduce(((e,t)=>e+t.length),0));const r=wt(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return gt(r)}function Ot(e,t){switch(Lt(e).code){case 4:case 41:return function(e){const t=Tt(e,0,e.length);if(null==t)throw new Error("ipBuff is required");if(!ae(t))throw new Error("invalid ip address");return t}(t);case 42:case 53:case 54:case 55:case 56:case 400:case 777:return function(e){const t=Dt.decode(e);if((e=e.slice(Dt.decode.bytes)).length!==t)throw new Error("inconsistent lengths");return St(e)}(t);case 6:case 273:case 33:case 132:return Kt(t).toString();case 421:return function(e){const t=Dt.decode(e),r=e.slice(Dt.decode.bytes);if(r.length!==t)throw new Error("inconsistent lengths");return St(r,"base58btc")}(t);case 444:case 445:return function(e){const t=e.slice(0,e.length-2),r=e.slice(e.length-2);return`${St(t,"base32")}:${Kt(r)}`}(t);case 466:return function(e){const t=Dt.decode(e),r=e.slice(Dt.decode.bytes);if(r.length!==t)throw new Error("inconsistent lengths");return"u"+St(r,"base64url")}(t);default:return St(t,"base16")}}function xt(e,t){switch(Lt(e).code){case 4:case 41:return function(e){if(!ae(e))throw new Error("invalid ip address");return It(e)}(t);case 42:case 53:case 54:case 55:case 56:case 400:case 777:return function(e){const t=Pt(e),r=Uint8Array.from(Dt.encode(t.length));return Bt([r,t],r.length+t.length)}(t);case 6:case 273:case 33:case 132:return Vt(parseInt(t,10));case 421:return function(e){let t;t="Q"===e[0]||"1"===e[0]?Ve(q.decode(`z${e}`)).bytes:at.parse(e).multihash.bytes;const r=Uint8Array.from(Dt.encode(t.length));return Bt([r,t],r.length+t.length)}(t);case 444:return function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(16!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);const r=H.decode("b"+t[0]),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=Vt(n);return Bt([r,i],r.length+i.length)}(t);case 445:return function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(56!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);const r=H.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=Vt(n);return Bt([r,i],r.length+i.length)}(t);case 466:return function(e){const t=Mt.decode(e),r=Uint8Array.from(Dt.encode(t.length));return Bt([r,t],r.length+t.length)}(t);default:return Pt(t,"base16")}}const Ut=Object.values(yt).map((e=>e.decoder)),Mt=function(){let e=Ut[0].or(Ut[1]);return Ut.slice(2).forEach((t=>e=e.or(t))),e}();function Vt(e){const t=new ArrayBuffer(2);return new DataView(t).setUint16(0,e),new Uint8Array(t)}function Kt(e){return new DataView(e.buffer).getUint16(e.byteOffset)}function Ft(e){return e.map((e=>{const t=Yt(e);return null!=e[1]?[t.code,Ot(t.code,e[1])]:[t.code]}))}function qt(e){return $t(Bt(e.map((e=>{const t=Yt(e);let r=Uint8Array.from(Dt.encode(t.code));return e.length>1&&null!=e[1]&&(r=Bt([r,e[1]])),r}))))}function jt(e,t){return e.size>0?e.size/8:0===e.size?0:Dt.decode(t)+(Dt.decode.bytes??0)}function Ht(e){const t=[];let r=0;for(;r<e.length;){const n=Dt.decode(e,r),i=Dt.decode.bytes??0,s=jt(Lt(n),e.slice(r+i));if(0===s){t.push([n]),r+=i;continue}const o=e.slice(r+i,r+i+s);if(r+=s+i,r>e.length)throw Wt("Invalid address Uint8Array: "+St(e,"base16"));t.push([n,o])}return t}function zt(e){return function(e){const t=[];return e.map((e=>{const r=Yt(e);return t.push(r.name),e.length>1&&null!=e[1]&&t.push(e[1]),null})),Gt(t.join("/"))}(Ft(Ht(e)))}function $t(e){const t=function(e){try{Ht(e)}catch(e){return e}}(e);if(null!=t)throw t;return Uint8Array.from(e)}function Gt(e){return"/"+e.trim().split("/").filter((e=>e)).join("/")}function Wt(e){return new Error("Error parsing address: "+e)}function Yt(e){return Lt(e[0])}var Qt=__webpack_require__(2114);function Xt(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}var Zt,Jt,er,tr,rr=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},nr=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r};const ir=Symbol.for("nodejs.util.inspect.custom"),sr=[Lt("dns").code,Lt("dns4").code,Lt("dns6").code,Lt("dnsaddr").code],or=new Map,ar=Symbol.for("@multiformats/js-multiaddr/multiaddr");function cr(e,t){if(null==e)throw new Error("requires node address object");if(null==t)throw new Error("requires transport protocol");let r,n=e.address;switch(e.family){case 4:r="ip4";break;case 6:if(r="ip6",n.includes("%")){const e=n.split("%");if(2!==e.length)throw Error("Multiple ip6 zones in multiaddr");n=e[0],r=`/ip6zone/${e[1]}/ip6`}break;default:throw Error("Invalid addr family, should be 4 or 6.")}return new ur("/"+[r,n,t,e.port].join("/"))}function lr(e){return Boolean(e?.[ar])}class ur{constructor(e){if(Zt.set(this,void 0),Jt.set(this,void 0),er.set(this,void 0),this[tr]=!0,null==e&&(e=""),e instanceof Uint8Array)this.bytes=$t(e);else if("string"==typeof e){if(e.length>0&&"/"!==e.charAt(0))throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=qt(function(e){const t=[],r=e.split("/").slice(1);if(1===r.length&&""===r[0])return[];for(let n=0;n<r.length;n++){const i=r[n],s=Lt(i);if(0!==s.size){if(n++,n>=r.length)throw Wt("invalid address: "+e);if(!0===s.path){t.push([i,Gt(r.slice(n).join("/"))]);break}t.push([i,r[n]])}else t.push([i])}return t}(Gt(e)).map((e=>{Array.isArray(e)||(e=[e]);const t=Yt(e);return e.length>1?[t.code,xt(t.code,e[1])]:[t.code]})))}else{if(!lr(e))throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=$t(e.bytes)}}toString(){return null==rr(this,Zt,"f")&&nr(this,Zt,zt(this.bytes),"f"),rr(this,Zt,"f")}toJSON(){return this.toString()}toOptions(){let e,t,r,n,i="";const s=Lt("tcp"),o=Lt("udp"),a=Lt("ip4"),c=Lt("ip6"),l=Lt("dns6"),u=Lt("ip6zone");for(const[h,d]of this.stringTuples())h===u.code&&(i=`%${d??""}`),sr.includes(h)&&(t=s.name,n=443,r=`${d??""}${i}`,e=h===l.code?6:4),h!==s.code&&h!==o.code||(t=Lt(h).name,n=parseInt(d??"")),h!==a.code&&h!==c.code||(t=Lt(h).name,r=`${d??""}${i}`,e=h===c.code?6:4);if(null==e||null==t||null==r||null==n)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:r,transport:t,port:n}}protos(){return this.protoCodes().map((e=>Object.assign({},Lt(e))))}protoCodes(){const e=[],t=this.bytes;let r=0;for(;r<t.length;){const n=Dt.decode(t,r),i=Dt.decode.bytes??0;r+=jt(Lt(n),t.slice(r+i))+i,e.push(n)}return e}protoNames(){return this.protos().map((e=>e.name))}tuples(){return null==rr(this,Jt,"f")&&nr(this,Jt,Ht(this.bytes),"f"),rr(this,Jt,"f")}stringTuples(){return null==rr(this,er,"f")&&nr(this,er,Ft(this.tuples()),"f"),rr(this,er,"f")}encapsulate(e){return e=new ur(e),new ur(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),r=this.toString(),n=r.lastIndexOf(t);if(n<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new ur(r.slice(0,n))}decapsulateCode(e){const t=this.tuples();for(let r=t.length-1;r>=0;r--)if(t[r][0]===e)return new ur(qt(t.slice(0,r)));return this}getPeerId(){try{const e=this.stringTuples().filter((e=>e[0]===kt.ipfs.code)),t=e.pop();if(null!=t?.[1]){const e=t[1];return"Q"===e[0]||"1"===e[0]?St(q.decode(`z${e}`),"base58btc"):St(at.parse(e).multihash.bytes,"base58btc")}return null}catch(e){return null}}getPath(){let e=null;try{e=this.stringTuples().filter((e=>!0===Lt(e[0]).path))[0][1],null==e&&(e=null)}catch{e=null}return e}equals(e){return Xt(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find((e=>e.resolvable));if(null==t)return[this];const r=or.get(t.name);if(null==r)throw Qt(new Error(`no available resolver for ${t.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await r(this,e)).map((e=>new ur(e)))}nodeAddress(){const e=this.toOptions();if("tcp"!==e.transport&&"udp"!==e.transport)throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(2!==t.length||4!==t[0].code&&41!==t[0].code||6!==t[1].code&&273!==t[1].code)}[(Zt=new WeakMap,Jt=new WeakMap,er=new WeakMap,tr=ar,ir)](){return`Multiaddr(${zt(this.bytes)})`}}function hr(e){return new ur(e)}const dr=Mr("dns4"),pr=Mr("dns6"),fr=Mr("dnsaddr"),yr=Ur(Mr("dns"),fr,dr,pr),gr=Ur(Mr("ip4"),Mr("ip6")),mr=Ur(xr(gr,Mr("tcp")),xr(yr,Mr("tcp"))),wr=xr(gr,Mr("udp")),Er=xr(wr,Mr("utp")),br=xr(wr,Mr("quic")),vr=Ur(xr(mr,Mr("ws")),xr(yr,Mr("ws"))),_r=Ur(xr(mr,Mr("wss")),xr(yr,Mr("wss")),xr(mr,Mr("tls"),Mr("ws")),xr(yr,Mr("tls"),Mr("ws"))),Sr=Ur(xr(mr,Mr("http")),xr(gr,Mr("http")),xr(yr,Mr("http"))),Cr=Ur(xr(mr,Mr("https")),xr(gr,Mr("https")),xr(yr,Mr("https"))),Ar=xr(wr,Mr("webrtc"),Mr("certhash")),Ir=Ur(xr(Ar,Mr("p2p")),Ar),Tr=Ur(xr(vr,Mr("p2p-webrtc-star"),Mr("p2p")),xr(_r,Mr("p2p-webrtc-star"),Mr("p2p")),xr(vr,Mr("p2p-webrtc-star")),xr(_r,Mr("p2p-webrtc-star"))),Rr=(Ur(xr(vr,Mr("p2p-websocket-star"),Mr("p2p")),xr(_r,Mr("p2p-websocket-star"),Mr("p2p")),xr(vr,Mr("p2p-websocket-star")),xr(_r,Mr("p2p-websocket-star"))),Ur(xr(Sr,Mr("p2p-webrtc-direct"),Mr("p2p")),xr(Cr,Mr("p2p-webrtc-direct"),Mr("p2p")),xr(Sr,Mr("p2p-webrtc-direct")),xr(Cr,Mr("p2p-webrtc-direct")))),kr=Ur(vr,_r,Sr,Cr,Tr,Rr,mr,Er,br,yr,Ir),Nr=(Ur(xr(kr,Mr("p2p-stardust"),Mr("p2p")),xr(kr,Mr("p2p-stardust"))),Ur(xr(kr,Mr("p2p")),Tr,Rr,Ir,Mr("p2p"))),Lr=Ur(xr(Nr,Mr("p2p-circuit"),Nr),xr(Nr,Mr("p2p-circuit")),xr(Mr("p2p-circuit"),Nr),xr(kr,Mr("p2p-circuit")),xr(Mr("p2p-circuit"),kr),Mr("p2p-circuit")),Dr=()=>Ur(xr(Lr,Dr),Lr),Pr=Dr(),Br=Ur(xr(Pr,Nr,Pr),xr(Nr,Pr),xr(Pr,Nr),Pr,Nr);function Or(e){return function(t){let r;try{r=hr(t)}catch(e){return!1}const n=e(r.protoNames());return null!==n&&(!0===n||!1===n?n:0===n.length)}}function xr(...e){function t(t){if(t.length<e.length)return null;let r=t;return e.some((e=>(r="function"==typeof e?e().partialMatch(t):e.partialMatch(t),Array.isArray(r)&&(t=r),null===r))),r}return{toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:Or(t),partialMatch:t}}function Ur(...e){function t(t){let r=null;return e.some((e=>{const n="function"==typeof e?e().partialMatch(t):e.partialMatch(t);return null!=n&&(r=n,!0)})),r}return{toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:Or(t),partialMatch:t}}function Mr(e){const t=e;return{toString:function(){return t},matches:function(e){let r;try{r=hr(e)}catch(e){return!1}const n=r.protoNames();return 1===n.length&&n[0]===t},partialMatch:function(e){return 0===e.length?null:e[0]===t?e.slice(1):null}}}const Vr=globalThis.fetch,Kr=globalThis.Headers;globalThis.Request,globalThis.Response;class Fr extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function qr(e,t,r){const n=r??{},i=function(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}(e);return async function*(){let r;const s=()=>{null!=r&&r()};for(t.addEventListener("abort",s);;){let o;try{if(t.aborted){const{abortMessage:e,abortCode:t}=n;throw new Fr(e,t)}const e=new Promise(((e,t)=>{r=()=>{const{abortMessage:e,abortCode:r}=n;t(new Fr(e,r))}}));o=await Promise.race([e,i.next()]),r=null}catch(r){t.removeEventListener("abort",s);const o="aborted"===r.type&&t.aborted;if(o&&null!=n.onAbort&&await n.onAbort(e),"function"==typeof i.return)try{const e=i.return();e instanceof Promise&&e.catch((e=>{null!=n.onReturnError&&n.onReturnError(e)}))}catch(e){null!=n.onReturnError&&n.onReturnError(e)}if(o&&!0===n.returnOnAbort)return;throw r}if(!0===o.done)break;yield o.value}t.removeEventListener("abort",s)}()}function jr(e,t,r){return n=>e(qr(n,t,r))}function Hr(e,t,r){return{sink:jr(e.sink,t,{...r,onAbort:void 0}),source:qr(e.source,t,r)}}const zr=ne("libp2p:webrtc-direct:socket");var $r,Gr=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class Wr extends EventTarget{constructor(){super(...arguments),$r.set(this,new Map)}listenerCount(e){const t=Gr(this,$r,"f").get(e);return null==t?0:t.length}addEventListener(e,t,r){super.addEventListener(e,t,r);let n=Gr(this,$r,"f").get(e);null==n&&(n=[],Gr(this,$r,"f").set(e,n)),n.push({callback:t,once:(!0!==r&&!1!==r&&r?.once)??!1})}removeEventListener(e,t,r){super.removeEventListener(e.toString(),t??null,r);let n=Gr(this,$r,"f").get(e);null!=n&&(n=n.filter((({callback:e})=>e!==t)),Gr(this,$r,"f").set(e,n))}dispatchEvent(e){const t=super.dispatchEvent(e);let r=Gr(this,$r,"f").get(e.type);return null==r||(r=r.filter((({once:e})=>!e)),Gr(this,$r,"f").set(e.type,r)),t}safeDispatchEvent(e,t){return this.dispatchEvent(new Qr(e,t))}}$r=new WeakMap;class Yr extends Event{constructor(e,t){super(e,t),this.detail=t?.detail}}const Qr=globalThis.CustomEvent??Yr;var Xr=__webpack_require__(1914);class Zr{constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class Jr{constructor(e={}){this.hwm=e.splitLimit??16,this.head=new Zr(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=e?.byteLength?e.byteLength:1}push(e){if(null!=e?.value&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new Zr(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return null!=e?.value&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}function en(e={}){return tn((e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}}),e)}function tn(e,t){let r,n,i,s=(t=t??{}).onEnd,o=new Jr;const a=e=>null!=n?n(e):(o.push(e),r),c=e=>{if(i)return r;if(!0!==t?.objectMode&&null==e?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return a({done:!1,value:e})},l=e=>i?r:(i=!0,null!=e?(e=>(o=new Jr,null!=n?n({error:e}):(o.push({error:e}),r)))(e):a({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>o.isEmpty()?i?{done:!0}:await new Promise(((t,i)=>{n=s=>{n=null,o.push(s);try{t(e(o))}catch(e){i(e)}return r}})):e(o),return:()=>(o=new Jr,l(),{done:!0}),throw:e=>(l(e),{done:!0}),push:c,end:l,get readableLength(){return o.size}},null==s)return r;const u=r;return r={[Symbol.asyncIterator](){return this},next:()=>u.next(),throw:e=>(u.throw(e),null!=s&&(s(e),s=void 0),{done:!0}),return:()=>(u.return(),null!=s&&(s(),s=void 0),{done:!0}),push:c,end:e=>(u.end(e),null!=s&&(s(e),s=void 0),r),get readableLength(){return u.readableLength}},r}function rn(){const e={};return e.promise=new Promise(((t,r)=>{e.resolve=t,e.reject=r})),e}class nn{constructor(e,t){this.label=e.label,this.open=rn(),this.channel=e,this.channel.binaryType="arraybuffer",this.log=t.log,"number"==typeof this.channel.bufferedAmountLowThreshold&&(this.channel.bufferedAmountLowThreshold=65536),e.addEventListener("message",(e=>{t.onMessage(e)})),e.addEventListener("bufferedamountlow",(()=>{this.log("stop backpressure: bufferedAmount %d",this.channel.bufferedAmount),this.open.resolve()})),e.addEventListener("open",(()=>{this.open.resolve(),t.onOpen()})),e.addEventListener("close",(()=>{t.onClose()})),e.addEventListener("error",(r=>{if("Transport channel closed"===r.error?.message)return this.close();t.log.error('channel encounter an error in state "%s" message: "%s" detail: "%s',e.readyState,r.error?.message,r.error?.errorDetail);const n=r.error instanceof Error?r.error:new Error(`datachannel error: ${r.error?.message} ${r.error?.errorDetail}`);t.onError(Qt(n,"ERR_DATA_CHANNEL"))}));let r=!1;this.closingInterval=setInterval((()=>{"closing"===e.readyState?(r&&t.onClose(),r=!0):r=!1}),5e3)}async send(e){await this.open.promise,this.channel.send(e),this.channel.bufferedAmount>65536&&(this.log("start backpressure: bufferedAmount %d",this.channel.bufferedAmount),this.open=rn())}close(){clearInterval(this.closingInterval),this.channel.close()}get bufferedAmount(){return this.channel.bufferedAmount}}var sn=__webpack_require__(5780);const on={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}]};class an extends Wr{constructor(e){super(),this.id=e.id??St(Xr(4),"hex").slice(0,7),this.log=ne(`libp2p:webrtc-peer:${e.logPrefix}:${this.id}`),this.wrtc=e.wrtc??function(){if("undefined"==typeof globalThis)throw Qt(new Error("No WebRTC support detected"),"ERR_WEBRTC_SUPPORT");const e={RTCPeerConnection:globalThis.RTCPeerConnection??globalThis.mozRTCPeerConnection??globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription??globalThis.mozRTCSessionDescription??globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate??globalThis.mozRTCIceCandidate??globalThis.webkitRTCIceCandidate};if(null==e.RTCPeerConnection)throw Qt(new Error("No WebRTC support detected"),"ERR_WEBRTC_SUPPORT");return e}(),this.peerConnection=new this.wrtc.RTCPeerConnection(Object.assign({},on,e.peerConnectionConfig)),this.closed=!1,this.connected=rn(),this.source=en(),this.sink=async e=>{if(await this.connected.promise,null==this.channel)throw Qt(new Error("Connected but no channel?!"),"ERR_DATA_CHANNEL");for await(const t of e)await this.channel.send(t);await this.close()}}handleDataChannelEvent(e){const t=e.channel;null!=t?this.channel=new nn(t,{log:this.log,onMessage:e=>{this.source.push(new Uint8Array(e.data))},onOpen:()=>{this.connected.resolve(),this.dispatchEvent(new Qr("ready"))},onClose:()=>{this.close().catch((e=>{this.log("error closing connection after channel close",e)}))},onError:e=>{this.close(e).catch((e=>{this.log("error closing connection after channel error",e)}))}}):this.close(Qt(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL")).catch((e=>{this.log("Error closing after event channel was found to be null",e)}))}async close(e){if(this.closed=!0,null==e&&null!=this.channel)for(;this.channel.bufferedAmount>0;)await sn(100);this.channel?.close(),this.peerConnection.close(),this.source.end(e),this.dispatchEvent(new Qr("close"))}}class cn extends Wr{constructor(e){super(),this.log=e.log,this.peerConnection=e.peerConnection,this.wrtc=e.wrtc,this.status="idle",this.peerConnection.addEventListener("negotiationneeded",(()=>{this.log("peer connection negotiation needed"),this.handleRenegotiate({type:"renegotiate"}).catch((e=>{this.log.error("could not renegotiate %o",e)}))}))}async handleSignal(e){return this.log('incoming signal "%s"',e.type),"offer"===e.type?await this.handleOffer(e):"answer"===e.type?await this.handleAnswer(e):"candidate"===e.type?await this.handleCandidate(e):"renegotiate"===e.type?await this.handleRenegotiate(e):"goodbye"===e.type?await this.handleGoodye(e):void this.log(`Unknown signal type ${e.type}`)}async handleOffer(e){}async handleAnswer(e){}async handleRenegotiate(e){}async handleGoodye(e){this.peerConnection.close()}async handleCandidate(e){const t=new this.wrtc.RTCIceCandidate(e.candidate);try{await this.peerConnection.addIceCandidate(t)}catch(e){if(null!=t.address&&!t.address.endsWith(".local"))throw Qt(e,"ERR_ADD_ICE_CANDIDATE");this.log("ignoring unsupported ICE candidate.")}}}ne("libp2p:webrtc-peer:receiver");class ln extends Error{constructor(e){super(e),this.name="TimeoutError"}}class un extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const hn=e=>void 0===globalThis.DOMException?new un(e):new DOMException(e),dn=e=>{const t=void 0===e.reason?hn("This operation was aborted."):e.reason;return t instanceof Error?t:hn(t)};function pn(e,t,r,n){let i;const s=new Promise(((s,o)=>{if("number"!=typeof t||1!==Math.sign(t))throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(t!==Number.POSITIVE_INFINITY){if((n={customTimers:{setTimeout,clearTimeout},...n}).signal){const{signal:e}=n;e.aborted&&o(dn(e)),e.addEventListener("abort",(()=>{o(dn(e))}))}i=n.customTimers.setTimeout.call(void 0,(()=>{if("function"==typeof r){try{s(r())}catch(e){o(e)}return}const n=r instanceof Error?r:new ln("string"==typeof r?r:`Promise timed out after ${t} milliseconds`);"function"==typeof e.cancel&&e.cancel(),o(n)}),t),(async()=>{try{s(await e)}catch(e){o(e)}finally{n.customTimers.clearTimeout.call(void 0,i)}})()}else s(e)}));return s.clear=()=>{clearTimeout(i),i=void 0},s}const fn=e=>{const t=e.on||e.addListener||e.addEventListener,r=e.off||e.removeListener||e.removeEventListener;if(!t||!r)throw new TypeError("Emitter is not compatible");return{addListener:t.bind(e),removeListener:r.bind(e)}};const yn=ne("libp2p:webrtc-peer:initator");class gn extends an{constructor(e={}){super({...e,logPrefix:"initiator"}),this.handleDataChannelEvent({channel:this.peerConnection.createDataChannel(e.dataChannelLabel??St(Xr(20),"hex").slice(0,7),e.dataChannelInit)}),this.handshake=new mn({log:this.log,peerConnection:this.peerConnection,wrtc:this.wrtc,offerOptions:e.offerOptions}),this.handshake.addEventListener("signal",(e=>{this.dispatchEvent(new Qr("signal",{detail:e.detail}))}))}handleSignal(e){this.handshake.handleSignal(e).catch((t=>{this.log("error handling signal %o %o",e,t)}))}}class mn extends cn{constructor(e){super(e),this.options=e,this.status="idle",this.peerConnection.addEventListener("icecandidate",(e=>{if(null==e.candidate)return;const t={type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}};yn.trace("create candidate",t),this.dispatchEvent(new Qr("signal",{detail:t})),this.dispatchEvent(new Qr("ice-candidate"))}))}async handleRenegotiate(){if("negotiating"===this.status)return void this.log("already negotiating, queueing");this.status="negotiating";const e=await this.peerConnection.createOffer(this.options.offerOptions);await this.peerConnection.setLocalDescription(e),await function(e,t,r){"function"==typeof r&&(r={filter:r});const n=function(e,t,r){let n;const i=new Promise(((i,s)=>{if(!((r={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...r}).count>=0)||r.count!==Number.POSITIVE_INFINITY&&!Number.isInteger(r.count))throw new TypeError("The `count` option should be at least 0 or more");const o=[t].flat(),a=[],{addListener:c,removeListener:l}=fn(e),u=(...e)=>{const t=r.multiArgs?e:e[0];r.filter&&!r.filter(t)||(a.push(t),r.count===a.length&&(n(),i(a)))},h=e=>{n(),s(e)};n=()=>{for(const e of o)l(e,u);for(const e of r.rejectionEvents)l(e,h)};for(const e of o)c(e,u);for(const e of r.rejectionEvents)c(e,h);r.resolveImmediately&&i(a)}));if(i.cancel=n,"number"==typeof r.timeout){const e=pn(i,r.timeout);return e.cancel=n,e}return i}(e,t,r={...r,count:1,resolveImmediately:!1}),i=n.then((e=>e[0]));return i.cancel=n.cancel,i}(this,"ice-candidate"),await sn(1e3),yn.trace("renegotiate",this.peerConnection.localDescription),this.dispatchEvent(new Qr("signal",{detail:this.peerConnection.localDescription??e}))}async handleAnswer(e){yn.trace("handle answer",e),await this.peerConnection.setRemoteDescription(new this.wrtc.RTCSessionDescription(e)),this.status="idle"}}const wn=Symbol.for("@libp2p/transport");var En;!function(e){e[e.FATAL_ALL=0]="FATAL_ALL",e[e.NO_FATAL=1]="NO_FATAL"}(En||(En={}));const bn=ne("libp2p:webrtc-direct");class vn{constructor(e){this.initiatorOptions=e?.initiatorOptions,this.recieverOptions=e?.recieverOptions,this.wrtc=e?.wrtc}get[wn](){return!0}get[Symbol.toStringTag](){return"@libp2p/webrtc-direct"}async dial(e,t){const r=function(e,t){const{sink:r,source:n}=e,i={remoteAddr:t.remoteAddr,async sink(e){null!=t.signal&&(e=qr(e,t.signal));try{await r(e)}catch(e){"aborted"!==e.type&&zr.error(e)}},source:null!=t.signal?qr(n,t.signal):n,timeline:{open:Date.now()},async close(){if(e.closed)return;const t=Date.now(),r=setTimeout((()=>{if(null!=i.remoteAddr){const{host:e,port:r}=i.remoteAddr.toOptions();zr("timeout closing socket to %s:%s after %dms, destroying it manually",e,r,Date.now()-t)}e.closed||e.close().catch((e=>{zr.error("could not close socket",e)}))}),2e3);try{await e.close()}finally{clearTimeout(r)}}};return e.addEventListener("close",(()=>{null==i.timeline.close&&(i.timeline.close=Date.now())}),{once:!0}),i}(await this._connect(e,t),{remoteAddr:e,signal:t.signal});bn("new outbound connection %s",r.remoteAddr);const n=await t.upgrader.upgradeOutbound(r);return bn("outbound connection %s upgraded",r.remoteAddr),n}async _connect(e,t){if(!0===t.signal?.aborted)throw new Fr;const r={initiator:!0,trickle:!1,...this.initiatorOptions};return null!=this.wrtc&&(r.wrtc=this.wrtc),await new Promise(((n,i)=>{let s;const o=e.toOptions();bn("Dialing %s:%s",o.host,o.port);const a=new gn(r),c=e=>{const t=e.detail;if(!s){const e=`connection error ${o.host}:${o.port}: ${t.message}`;bn.error(e),t.message=e,h(t)}},l=()=>{s=!0,bn("connection opened %s:%s",o.host,o.port),h()},u=()=>{bn.error("connection aborted %s:%s",o.host,o.port),a.close().finally((()=>{h(new Fr)}))},h=e=>{a.removeEventListener("error",c),a.removeEventListener("ready",l),t.signal?.removeEventListener("abort",u),null!=e?i(e):n(a)};a.addEventListener("error",c,{once:!0}),a.addEventListener("ready",l,{once:!0}),a.addEventListener("close",(()=>{a.removeEventListener("error",c)})),t.signal?.addEventListener("abort",u),a.addEventListener("signal",(e=>{(async e=>{if("offer"!==e.type)return;const t=JSON.stringify(e);let r=o.host;6!==o.family||r.startsWith("[")||(r=`[${r}]`);const n=`http://${r}:${o.port}/?signal=${q.encode(Pt(t))}`;try{const e=await Vr(n),t=await e.text();if(""===t.trim())return;const r=St(q.decode(t)),i=JSON.parse(r);a.handleSignal(i)}catch(e){await a.close(e),i(e)}})(e.detail).catch((async e=>{await a.close(e)}))}))}))}createListener(e){return function(){throw new Error("WebRTCDirect Servers can not be created in the browser!")}((this.recieverOptions,this.wrtc))}filter(e){return(e=Array.isArray(e)?e:[e]).filter((e=>!e.protoCodes().includes(290)&&Rr.matches(e.decapsulateCode(421))))}}function _n(e={}){return()=>new vn(e)}const Sn=Symbol.for("@achingbrain/uint8arraylist");function Cn(e,t){if(null==t||t<0)throw new RangeError("index is out of bounds");let r=0;for(const n of e){const e=r+n.byteLength;if(t<e)return{buf:n,index:t-r};r=e}throw new RangeError("index is out of bounds")}function An(e){return Boolean(e?.[Sn])}class In{constructor(...e){Object.defineProperty(this,Sn,{value:!0}),this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(const r of e)if(r instanceof Uint8Array)t+=r.byteLength,this.bufs.push(r);else{if(!An(r))throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");t+=r.byteLength,this.bufs.push(...r.bufs)}this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(const r of e.reverse())if(r instanceof Uint8Array)t+=r.byteLength,this.bufs.unshift(r);else{if(!An(r))throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");t+=r.byteLength,this.bufs.unshift(...r.bufs)}this.length+=t}get(e){const t=Cn(this.bufs,e);return t.buf[t.index]}set(e,t){const r=Cn(this.bufs,e);r.buf[r.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let r=0;r<e.length;r++)this.set(t+r,e[r]);else{if(!An(e))throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList");for(let r=0;r<e.length;r++)this.set(t+r,e.get(r))}}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength)return this.bufs=[],void(this.length=0);for(;this.bufs.length>0;){if(!(e>=this.bufs[0].byteLength)){this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift()}}}slice(e,t){const{bufs:r,length:n}=this._subList(e,t);return Bt(r,n)}subarray(e,t){const{bufs:r,length:n}=this._subList(e,t);return 1===r.length?r[0]:Bt(r,n)}sublist(e,t){const{bufs:r,length:n}=this._subList(e,t),i=new In;return i.length=n,i.bufs=r,i}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(0===e&&t===this.length)return{bufs:[...this.bufs],length:this.length};const r=[];let n=0;for(let i=0;i<this.bufs.length;i++){const s=this.bufs[i],o=n,a=o+s.byteLength;if(n=a,e>=a)continue;const c=e>=o&&e<a,l=t>o&&t<=a;if(c&&l){if(e===o&&t===a){r.push(s);break}const n=e-o;r.push(s.subarray(n,n+(t-e)));break}if(c){if(0===e){r.push(s);continue}r.push(s.subarray(e-o))}else{if(l){if(t===a){r.push(s);break}r.push(s.subarray(0,t-o));break}r.push(s)}}return{bufs:r,length:t-e}}indexOf(e,t=0){if(!(An(e)||e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const r=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),0===e.length)return t>this.length?this.length:t;const n=r.byteLength;if(0===n)throw new TypeError("search must be at least 1 byte long");const i=new Int32Array(256);for(let e=0;e<256;e++)i[e]=-1;for(let e=0;e<n;e++)i[r[e]]=e;const s=i,o=this.byteLength-r.byteLength,a=r.byteLength-1;let c;for(let e=t;e<=o;e+=c){c=0;for(let t=a;t>=0;t--){const n=this.get(e+t);if(r[t]!==n){c=Math.max(1,t-s[n]);break}}if(0===c)return e}return-1}getInt8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){const r=wt(1);new DataView(r.buffer,r.byteOffset,r.byteLength).setInt8(0,t),this.write(r,e)}getInt16(e,t){const r=this.subarray(e,e+2);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt16(0,t)}setInt16(e,t,r){const n=mt(2);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt16(0,t,r),this.write(n,e)}getInt32(e,t){const r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt32(0,t)}setInt32(e,t,r){const n=mt(4);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt32(0,t,r),this.write(n,e)}getBigInt64(e,t){const r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getBigInt64(0,t)}setBigInt64(e,t,r){const n=mt(8);new DataView(n.buffer,n.byteOffset,n.byteLength).setBigInt64(0,t,r),this.write(n,e)}getUint8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){const r=wt(1);new DataView(r.buffer,r.byteOffset,r.byteLength).setUint8(0,t),this.write(r,e)}getUint16(e,t){const r=this.subarray(e,e+2);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint16(0,t)}setUint16(e,t,r){const n=mt(2);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint16(0,t,r),this.write(n,e)}getUint32(e,t){const r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint32(0,t)}setUint32(e,t,r){const n=mt(4);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint32(0,t,r),this.write(n,e)}getBigUint64(e,t){const r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getBigUint64(0,t)}setBigUint64(e,t,r){const n=mt(8);new DataView(n.buffer,n.byteOffset,n.byteLength).setBigUint64(0,t,r),this.write(n,e)}getFloat32(e,t){const r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getFloat32(0,t)}setFloat32(e,t,r){const n=mt(4);new DataView(n.buffer,n.byteOffset,n.byteLength).setFloat32(0,t,r),this.write(n,e)}getFloat64(e,t){const r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getFloat64(0,t)}setFloat64(e,t,r){const n=mt(8);new DataView(n.buffer,n.byteOffset,n.byteLength).setFloat64(0,t,r),this.write(n,e)}equals(e){if(null==e)return!1;if(!(e instanceof In))return!1;if(e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!Xt(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){const r=new In;return r.bufs=e,null==t&&(t=e.reduce(((e,t)=>e+t.byteLength),0)),r.length=t,r}}function Tn(e){return new Uint8Array(e)}var Rn;!function(e){e[e.NEW_STREAM=0]="NEW_STREAM",e[e.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",e[e.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",e[e.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",e[e.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",e[e.RESET_RECEIVER=5]="RESET_RECEIVER",e[e.RESET_INITIATOR=6]="RESET_INITIATOR"}(Rn||(Rn={}));const kn=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),Nn=Object.freeze({NEW_STREAM:Rn.NEW_STREAM,MESSAGE:Rn.MESSAGE_INITIATOR,CLOSE:Rn.CLOSE_INITIATOR,RESET:Rn.RESET_INITIATOR}),Ln=Object.freeze({MESSAGE:Rn.MESSAGE_RECEIVER,CLOSE:Rn.CLOSE_RECEIVER,RESET:Rn.RESET_RECEIVER}),Dn=1048576,Pn=(e,t)=>{t.append(e)},Bn=10240,On=new class{constructor(){this._pool=Tn(Bn),this._poolOffset=0}write(e,t){const r=this._pool;let n=this._poolOffset;Dt.encode(e.id<<3|e.type,r,n),n+=Dt.encode.bytes??0,e.type!==Rn.NEW_STREAM&&e.type!==Rn.MESSAGE_INITIATOR&&e.type!==Rn.MESSAGE_RECEIVER||null==e.data?Dt.encode(0,r,n):Dt.encode(e.data.length,r,n),n+=Dt.encode.bytes??0;const i=r.subarray(this._poolOffset,n);Bn-n<100?(this._pool=Tn(Bn),this._poolOffset=0):this._poolOffset=n,t.append(i),e.type!==Rn.NEW_STREAM&&e.type!==Rn.MESSAGE_INITIATOR&&e.type!==Rn.MESSAGE_RECEIVER||null==e.data||t.append(e.data)}},xn=1<<20;class Un{constructor(e=xn,t=4194304){this._buffer=new In,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(null==e||0===e.length)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw Object.assign(new Error("unprocessed message queue size too large!"),{code:"ERR_MSG_QUEUE_TOO_BIG"});const t=[];for(;0!==this._buffer.length;){if(null==this._headerInfo)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(e){if("ERR_MSG_TOO_BIG"===e.code)throw e;break}const{id:e,type:r,length:n,offset:i}=this._headerInfo;if(this._buffer.length-i<n)break;const s={id:e,type:r};r!==Rn.NEW_STREAM&&r!==Rn.MESSAGE_INITIATOR&&r!==Rn.MESSAGE_RECEIVER||(s.data=this._buffer.sublist(i,i+n)),t.push(s),this._buffer.consume(i+n),this._headerInfo=null}return t}_decodeHeader(e){const{value:t,offset:r}=Kn(e),{value:n,offset:i}=Kn(e,r),s=7&t;if(null==kn[s])throw new Error(`Invalid type received: ${s}`);if(n>this._maxMessageSize)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"});return{id:t>>3,type:s,offset:r+i,length:n}}}const Mn=128,Vn=127;function Kn(e,t=0){let r,n=0,i=0,s=t;const o=e.length;do{if(s>=o||i>49)throw t=0,new RangeError("Could not decode varint");r=e.get(s++),n+=i<28?(r&Vn)<<i:(r&Vn)*Math.pow(2,i),i+=7}while(r>=Mn);return{value:n,offset:t=s-t}}var Fn=__webpack_require__(2044);const qn=ne("libp2p:mplex:stream"),jn="ERR_STREAM_RESET";var Hn=__webpack_require__(8558);const zn=ne("libp2p:mplex");function $n(e){const t={...e,type:`${kn[e.type]} (${e.type})`};return e.type===Rn.NEW_STREAM&&(t.data=St(e.data instanceof Uint8Array?e.data:e.data.subarray())),e.type!==Rn.MESSAGE_INITIATOR&&e.type!==Rn.MESSAGE_RECEIVER||(t.data=St(e.data instanceof Uint8Array?e.data:e.data.subarray(),"base16")),t}class Gn{constructor(e){this.protocol="/mplex/6.7.0",e=e??{},this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=e,this.sink=this._createSink();const t=this._createSource();this._source=t,this.source=t,this.closeController=new AbortController,this.rateLimiter=new Hn.RateLimiterMemory({points:e.disconnectThreshold??5,duration:1})}get streams(){const e=[];for(const t of this._streams.initiators.values())e.push(t);for(const t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new Error("Muxer already closed");const t=this._streamId++;e=null==e?t.toString():e.toString();const r=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:r})}close(e){this.closeController.signal.aborted||(null!=e?this.streams.forEach((t=>t.abort(e))):this.streams.forEach((e=>e.close())),this.closeController.abort())}_newReceiverStream(e){const{id:t,name:r}=e,n=this._streams.receivers;return this._newStream({id:t,name:r,type:"receiver",registry:n})}_newStream(e){const{id:t,name:r,type:n,registry:i}=e;if(zn("new %s stream %s",n,t),"initiator"===n&&this._streams.initiators.size===(this._init.maxOutboundStreams??1024))throw Qt(new Error("Too many outbound streams open"),"ERR_TOO_MANY_OUTBOUND_STREAMS");if(i.has(t))throw new Error(`${n} stream ${t} already exists!`);const s=function(e){const{id:t,name:r,send:n,onEnd:i,type:s="initiator",maxMsgSize:o=xn}=e,a=new AbortController,c=new AbortController,l=new AbortController,u="initiator"===s?Nn:Ln,h="initiator"===s?`i${t}`:`r${t}`,d=`${null==r?t:r}`;let p,f=!1,y=!1,g=!1;const m={open:Date.now()},w=e=>{y||(y=!0,qn.trace("%s stream %s sink end - err: %o",s,d,e),null!=e&&null==p&&(p=e),f&&(m.close=Date.now(),null!=i&&i(p)))},E=en({onEnd:e=>{f||(f=!0,qn.trace("%s stream %s source end - err: %o",s,d,e),null!=e&&null==p&&(p=e),y&&(b.stat.timeline.close=Date.now(),null!=i&&i(p)))}}),b={close:()=>{qn.trace("%s stream %s close",s,d),b.closeRead(),b.closeWrite()},closeRead:()=>{qn.trace("%s stream %s closeRead",s,d),f||E.end()},closeWrite:()=>{if(qn.trace("%s stream %s closeWrite",s,d),!y){l.abort();try{n({id:t,type:u.CLOSE})}catch(e){qn.trace("%s stream %s error sending close",s,r,e)}w()}},abort:e=>{qn.trace("%s stream %s abort",s,d,e),E.end(e),a.abort(),w(e)},reset:()=>{const e=Qt(new Error("stream reset"),jn);c.abort(),E.end(e),w(e)},sink:async e=>{if(g)throw Qt(new Error("sink already called on stream"),"ERR_DOUBLE_SINK");if(g=!0,y)throw Qt(new Error("stream closed for writing"),"ERR_SINK_ENDED");e=qr(e,(0,Fn.anySignal)([a.signal,c.signal,l.signal]));try{"initiator"===s&&n({id:t,type:Nn.NEW_STREAM,data:new In(Pt(d))});for await(let r of e)for(;r.length>0;){if(r.length<=o){n({id:t,type:u.MESSAGE,data:r instanceof Uint8Array?new In(r):r});break}r=r instanceof Uint8Array?new In(r):r,n({id:t,type:u.MESSAGE,data:r.sublist(0,o)}),r.consume(o)}}catch(e){if("aborted"===e.type&&"The operation was aborted"===e.message){if(l.signal.aborted)return;c.signal.aborted&&(e.message="stream reset",e.code=jn),a.signal.aborted&&(e.message="stream aborted",e.code="ERR_STREAM_ABORT")}if(e.code===jn)qn.trace("%s stream %s reset",s,r);else{qn.trace("%s stream %s error",s,r,e);try{n({id:t,type:u.RESET})}catch(e){qn.trace("%s stream %s error sending reset",s,r,e)}}return E.end(e),void w(e)}try{n({id:t,type:u.CLOSE})}catch(e){qn.trace("%s stream %s error sending close",s,r,e)}w()},source:E,sourcePush:e=>{E.push(e)},sourceReadableLength:()=>E.readableLength,stat:{direction:"initiator"===s?"outbound":"inbound",timeline:m},metadata:{},id:h};return b}({id:t,name:r,send:e=>{zn.enabled&&zn.trace("%s stream %s send",n,t,$n(e)),this._source.push(e)},type:n,onEnd:()=>{zn("%s stream with id %s and protocol %s ended",n,t,s.stat.protocol),i.delete(t),null!=this._init.onStreamEnd&&this._init.onStreamEnd(s)},maxMsgSize:this._init.maxMsgSize});return i.set(t,s),s}_createSink(){return async e=>{const t=[this.closeController.signal];null!=this._init.signal&&t.push(this._init.signal),e=qr(e,Fn(t));try{const t=new Un(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(const r of e)for(const e of t.write(r))await this._handleIncoming(e);this._source.end()}catch(e){zn("error in sink",e),this._source.end(e)}}}_createSource(){const e=function(e={}){return tn((e=>{let t;const r=[];for(;!e.isEmpty()&&(t=e.shift(),null!=t);){if(null!=t.error)throw t.error;!1===t.done&&r.push(t.value)}return null==t?{done:!0}:{done:!0===t.done,value:r}}),e)}({objectMode:!0,onEnd:e=>{this.close(e)}});return Object.assign(async function*(e,t=0){if(null!=t&&0!==t)yield*async function*(e,t={}){let r=new In,n=!1,i=rn(),s=Number(t.size??Dn);(isNaN(s)||0===s||s<0)&&(s=Dn);const o=t.yieldAfter??0,a=t.serialize??Pn;for(Promise.resolve().then((async()=>{try{let t;for await(const n of e)a(n,r),r.byteLength>=s?(clearTimeout(t),i.resolve()):t=setTimeout((()=>{i.resolve()}),o);clearTimeout(t),i.resolve()}catch(e){i.reject(e)}finally{n=!0}}));!n;)if(await i.promise,i=rn(),r.byteLength>0){const e=r;r=new In,yield e.subarray()}}(e,{size:t,serialize:(e,t)=>{for(const r of e)On.write(r,t)}});else for await(const t of e){const e=new In;for(const r of t)On.write(r,e);yield e.subarray()}}(e,this._init.minSendBytes),{push:e.push,end:e.end,return:e.return})}async _handleIncoming(e){const{id:t,type:r}=e;if(zn.enabled&&zn.trace("incoming message",$n(e)),e.type===Rn.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??1024)){zn("too many inbound streams open"),this._source.push({id:t,type:Rn.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{return zn("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),void this._source.end(new Error("Too many open streams"))}return}const r=this._newReceiverStream({id:t,name:St(e.data instanceof Uint8Array?e.data:e.data.subarray())});return void(null!=this._init.onIncomingStream&&this._init.onIncomingStream(r))}const n=(1==(1&r)?this._streams.initiators:this._streams.receivers).get(t);if(null==n)return void zn("missing stream %s for message type %s",t,kn[r]);const i=this._init.maxStreamBufferSize??4194304;switch(r){case Rn.MESSAGE_INITIATOR:case Rn.MESSAGE_RECEIVER:if(n.sourceReadableLength()>i){this._source.push({id:e.id,type:r===Rn.MESSAGE_INITIATOR?Rn.RESET_RECEIVER:Rn.RESET_INITIATOR});const t=Qt(new Error("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers"),"ERR_STREAM_INPUT_BUFFER_FULL");return void n.abort(t)}n.sourcePush(e.data);break;case Rn.CLOSE_INITIATOR:case Rn.CLOSE_RECEIVER:n.closeRead();break;case Rn.RESET_INITIATOR:case Rn.RESET_RECEIVER:n.reset();break;default:zn("unknown message type %s",r)}}}class Wn{constructor(e={}){this.protocol="/mplex/6.7.0",this._init=e}createStreamMuxer(e={}){return new Gn({...e,...this._init})}}function Yn(e={}){return()=>new Wn(e)}function Qn(e){const t=en(),r=function(e){const t=async function*(){let t=yield,r=new In;for await(const n of e)if(null!=t)for(r.append(n);r.length>=t;){const e=r.sublist(0,t);if(r.consume(t),t=yield e,null==t){r.length>0&&(t=yield r,r=new In);break}}else r.append(n),t=yield r,r=new In;if(null!=t)throw Object.assign(new Error(`stream ended before ${t} bytes became available`),{code:"ERR_UNDER_READ",buffer:r})}();return t.next(),t}(e.source),n=rn();let i;const s=e.sink(async function*(){yield*t;const e=await n.promise;yield*e}());return s.catch((e=>{i=e})),{reader:r,writer:t,stream:{sink:async e=>null!=i?await Promise.reject(i):(n.resolve(e),await s),source:r},rest:()=>t.end(),write:t.push,read:async()=>{const e=await r.next();if(null!=e.value)return e.value}}}function Xn(e){return e instanceof Uint8Array?{get:t=>e[t],set(t,r){e[t]=r}}:{get:t=>e.get(t),set(t,r){e.set(t,r)}}}const Zn=4294967296;class Jn{constructor(e=0,t=0){this.hi=e,this.lo=t}toBigInt(e){if(!0===e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31!=0){const e=1+~this.lo>>>0;let t=~this.hi>>>0;return 0===e&&(t=t+1>>>0),-(BigInt(e)+(BigInt(t)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toNumber(e){return Number(this.toBigInt(e))}zzDecode(){const e=-(1&this.lo),t=((this.lo>>>1|this.hi<<31)^e)>>>0,r=(this.hi>>>1^e)>>>0;return new Jn(r,t)}zzEncode(){const e=this.hi>>31,t=((this.hi<<1|this.lo>>>31)^e)>>>0,r=(this.lo<<1^e)>>>0;return new Jn(t,r)}toBytes(e,t=0){const r=Xn(e);for(;this.hi>0;)r.set(t++,127&this.lo|128),this.lo=(this.lo>>>7|this.hi<<25)>>>0,this.hi>>>=7;for(;this.lo>127;)r.set(t++,127&this.lo|128),this.lo=this.lo>>>7;r.set(t++,this.lo)}static fromBigInt(e){if(0n===e)return new Jn;const t=e<0;t&&(e=-e);let r=0|Number(e>>32n),n=0|Number(e-(BigInt(r)<<32n));return t&&(r=~r>>>0,n=~n>>>0,++n>Zn&&(n=0,++r>Zn&&(r=0))),new Jn(r,n)}static fromNumber(e){if(0===e)return new Jn;const t=e<0;t&&(e=-e);let r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new Jn(n,r)}static fromBytes(e,t=0){const r=Xn(e),n=new Jn;let i=0;if(e.length-t>4){for(;i<4;++i)if(n.lo=(n.lo|(127&r.get(t))<<7*i)>>>0,r.get(t++)<128)return n;if(n.lo=(n.lo|(127&r.get(t))<<28)>>>0,n.hi=(n.hi|(127&r.get(t))>>4)>>>0,r.get(t++)<128)return n;i=0}else for(;i<4;++i){if(t>=e.length)throw RangeError(`index out of range: ${t} > ${e.length}`);if(n.lo=(n.lo|(127&r.get(t))<<7*i)>>>0,r.get(t++)<128)return n}if(e.length-t>4){for(;i<5;++i)if(n.hi=(n.hi|(127&r.get(t))<<7*i+3)>>>0,r.get(t++)<128)return n}else if(t<e.byteLength)for(;i<5;++i){if(t>=e.length)throw RangeError(`index out of range: ${t} > ${e.length}`);if(n.hi=(n.hi|(127&r.get(t))<<7*i+3)>>>0,r.get(t++)<128)return n}throw RangeError("invalid varint encoding")}}const ei=Math.pow(2,7),ti=Math.pow(2,14),ri=Math.pow(2,21),ni=Math.pow(2,28),ii=Math.pow(2,35),si=Math.pow(2,42),oi=Math.pow(2,49),ai=Math.pow(2,56),ci=Math.pow(2,63),li={encodingLength:e=>e<ei?1:e<ti?2:e<ri?3:e<ni?4:e<ii?5:e<si?6:e<oi?7:e<ai?8:e<ci?9:10,encode(e,t,r=0){if(null!=Number.MAX_SAFE_INTEGER&&e>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return null==t&&(t=wt(li.encodingLength(e))),Jn.fromNumber(e).toBytes(t,r),t},decode:(e,t=0)=>Jn.fromBytes(e,t).toNumber(!0)},ui=e=>{const t=li.encodingLength(e),r=(n=t,null!=globalThis?.Buffer?.allocUnsafe?globalThis.Buffer.allocUnsafe(n):new Uint8Array(n));var n;return li.encode(e,r),ui.bytes=t,r};function hi(e){const t=(e=e??{}).lengthEncoder??ui;return async function*(e){for await(const r of e){const e=t(r.byteLength);e instanceof Uint8Array?yield e:yield*e,r instanceof Uint8Array?yield r:yield*r}}}ui.bytes=0,hi.single=(e,t)=>{const r=(t=t??{}).lengthEncoder??ui;return new In(r(e.byteLength),e)};const di=8,pi=4194304;var fi;!function(e){e[e.LENGTH=0]="LENGTH",e[e.DATA=1]="DATA"}(fi||(fi={}));const yi=e=>{const t=li.decode(e);return yi.bytes=li.encodingLength(t),t};function gi(e){return async function*(t){const r=new In;let n=fi.LENGTH,i=-1;const s=e?.lengthDecoder??yi,o=e?.maxLengthLength??di,a=e?.maxDataLength??pi;for await(const c of t)for(r.append(c);r.byteLength>0;){if(n===fi.LENGTH)try{if(i=s(r),i<0)throw Qt(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(i>a)throw Qt(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");const t=s.bytes;r.consume(t),null!=e?.onLength&&e.onLength(i),n=fi.DATA}catch(e){if(e instanceof RangeError){if(r.byteLength>o)throw Qt(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw e}if(n===fi.DATA){if(r.byteLength<i)break;const t=r.sublist(0,i);r.consume(i),null!=e?.onData&&e.onData(t),yield t,n=fi.LENGTH}}if(r.byteLength>0)throw Qt(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}}function mi(e,t={}){const r=Qn(e),n=gi.fromReader(r.reader,t),i={read:async e=>{const{value:t}=await r.reader.next(e);if(null==t)throw new Error("Value is null");return t},readLP:async()=>{const{value:e}=await n.next();if(null==e)throw new Error("Value is null");return e},readPB:async e=>{const t=await i.readLP();if(null==t)throw new Error("Value is null");const r=t instanceof Uint8Array?t:t.subarray();return e.decode(r)},write:e=>{e instanceof Uint8Array?r.writer.push(e):r.writer.push(e.subarray())},writeLP:e=>{i.write(hi.single(e,t))},writePB:(e,t)=>{i.writeLP(t.encode(e))},pb:e=>({read:async()=>await i.readPB(e),write:t=>{i.writePB(t,e)}}),unwrap:()=>(r.rest(),r.stream)};return i}function wi(){const e=rn();let t=!1;return{sink:async r=>{if(t)throw new Error("already piped");t=!0,e.resolve(r)},source:async function*(){const t=await e.promise;yield*t}()}}async function*Ei(...e){const t=en({objectMode:!0});Promise.resolve().then((async()=>{try{await Promise.all(e.map((async e=>{for await(const r of e)t.push(r)}))),t.end()}catch(e){t.end(e)}})),yield*t}yi.bytes=0,gi.fromReader=(e,t)=>{let r=1;const n=async function*(){for(;;)try{const{done:t,value:n}=await e.next(r);if(!0===t)return;null!=n&&(yield n)}catch(e){if("ERR_UNDER_READ"===e.code)return{done:!0,value:null};throw e}finally{r=1}}();return gi({...t??{},onLength:e=>{r=e}})(n)};const bi=(...e)=>{let t;for(;e.length>0;)t=e.shift()(t);return t},vi=e=>null!=e&&("function"==typeof e[Symbol.asyncIterator]||"function"==typeof e[Symbol.iterator]||"function"==typeof e.next),_i=e=>null!=e&&"function"==typeof e.sink&&vi(e.source),Si=e=>t=>{const r=e.sink(t);if(null!=r.then){const t=en({objectMode:!0});r.then((()=>{t.end()}),(e=>{t.end(e)}));const n=async function*(){yield*e.source,t.end()};return Ei(t,n())}return e.source};function Ci(e,...t){if(_i(e)){const t=e;e=()=>t.source}else if(vi(e)){const t=e;e=()=>t}const r=[e,...t];if(r.length>1&&_i(r[r.length-1])&&(r[r.length-1]=r[r.length-1].sink),r.length>2)for(let e=1;e<r.length-1;e++)_i(r[e])&&(r[e]=Si(r[e]));return bi(...r)}const Ai=65535,Ii=Boolean(globalThis.process?.env?.DUMP_SESSION_KEYS);var Ti=__webpack_require__(512),Ri=__webpack_require__(7664),ki=__webpack_require__(3294),Ni=__webpack_require__(5501);const Li={hashSHA256:e=>(0,ki.vp)(e),getHKDF(e,t){const r=new Ti.t(ki.mE,t,e).expand(96);return[r.subarray(0,32),r.subarray(32,64),r.subarray(64,96)]},generateX25519KeyPair(){const e=Ri.Au();return{publicKey:e.publicKey,privateKey:e.secretKey}},generateX25519KeyPairFromSeed(e){const t=Ri._w(e);return{publicKey:t.publicKey,privateKey:t.secretKey}},generateX25519SharedKey:(e,t)=>Ri.gi(e,t),chaCha20Poly1305Encrypt:(e,t,r,n)=>new Ni.OK(n).seal(t,e,r),chaCha20Poly1305Decrypt:(e,t,r,n,i)=>new Ni.OK(n).open(t,e,r,i)},Di=e=>{const t=(2,globalThis.Buffer?globalThis.Buffer.allocUnsafe(2):new Uint8Array(2));return new DataView(t.buffer,t.byteOffset,t.byteLength).setUint16(0,e,!1),t};Di.bytes=2;const Pi=e=>{if(e.length<2)throw RangeError("Could not decode int16BE");return e instanceof Uint8Array?new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1):e.getUint16(0)};Pi.bytes=2;class Bi extends Error{constructor(e="Unexpected Peer"){super(e),this.code=Bi.code}static get code(){return"ERR_UNEXPECTED_PEER"}}class Oi extends Error{constructor(e="Invalid crypto exchange"){super(e),this.code=Oi.code}static get code(){return"ERR_INVALID_CRYPTO_EXCHANGE"}}class xi extends Error{constructor(e="Invalid crypto transmission"){super(e),this.code=xi.code}static get code(){return"ERR_INVALID_CRYPTO_TRANSMISSION"}}var Ui=__webpack_require__(1408),Mi=__webpack_require__(593),Vi=__webpack_require__(1173),Ki=__webpack_require__(3155),Fi=__webpack_require__(9693);Fi._configure(),Ui._configure(Mi),Vi._configure(Ki);const qi=["uint64","int64","sint64","fixed64","sfixed64"];function ji(e,t){const r=function(e){return function(e){for(const t of qi){if(null==e[t])continue;const r=e[t];e[t]=function(){return BigInt(r.call(this).toString())}}return e}(new Ui(e))}(e instanceof Uint8Array?e:e.subarray());return t.decode(r)}function Hi(e,t){const r=function(e){for(const t of qi){if(null==e[t])continue;const r=e[t];e[t]=function(e){return r.call(this,e.toString())}}return e}(Vi.create());return t.encode(e,r,{lengthDelimited:!1}),r.finish()}var zi,$i,Gi,Wi,Yi,Qi;function Xi(e,t,r,n){return{name:e,type:t,encode:r,decode:n}}function Zi(e){function t(t){if(null==e[t.toString()])throw new Error("Invalid enum value");return e[t]}return Xi("enum",zi.VARINT,(function(e,r){const n=t(e);r.int32(n)}),(function(e){return t(e.int32())}))}function Ji(e,t){return Xi("message",zi.LENGTH_DELIMITED,e,t)}(Qi=zi||(zi={}))[Qi.VARINT=0]="VARINT",Qi[Qi.BIT64=1]="BIT64",Qi[Qi.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",Qi[Qi.START_GROUP=3]="START_GROUP",Qi[Qi.END_GROUP=4]="END_GROUP",Qi[Qi.BIT32=5]="BIT32",function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}($i||($i={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(Gi||(Gi={})),function(e){e.codec=()=>Zi(Gi)}($i||($i={})),function(e){let t;e.codec=()=>(null==t&&(t=Ji(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),$i.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=$i.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>Hi(t,e.codec()),e.decode=t=>ji(t,e.codec())}(Wi||(Wi={})),function(e){let t;e.codec=()=>(null==t&&(t=Ji(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),$i.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=$i.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>Hi(t,e.codec()),e.decode=t=>ji(t,e.codec())}(Yi||(Yi={})),__webpack_require__(3068),__webpack_require__(7450);var es=__webpack_require__(3832);class ts extends Error{constructor(e="The operation was aborted"){super(e),this.code=ts.code,this.type=ts.type}static get code(){return"ABORT_ERR"}static get type(){return"aborted"}}class rs extends Error{constructor(e,t,r){super(e),this.code=t,this.name=r?.name??"CodeError",this.props=r??{}}}const ns={get(e=globalThis){const t=e.crypto;if(null==t||null==t.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return t}};var is=__webpack_require__(7116);function ss(e,t){let r=Uint8Array.from(e.abs().toByteArray());if(r=0===r[0]?r.subarray(1):r,null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=Bt([new Uint8Array(t-r.length),r])}return St(r,"base64url")}function os(e){const t=function(e,t){let r=Pt(e,"base64urlpad");return r}(e);return new es.jsbn.BigInteger(St(t,"base16"),16)}__webpack_require__(5764);function as(e){const t=e?.algorithm??"AES-GCM";let r=e?.keyLength??16;const n=e?.nonceLength??12,i=e?.digest??"SHA-256",s=e?.saltLength??16,o=e?.iterations??32767,a=ns.get();return r*=8,{encrypt:async function(e,c){const l=a.getRandomValues(new Uint8Array(s)),u=a.getRandomValues(new Uint8Array(n)),h={name:t,iv:u};"string"==typeof c&&(c=Pt(c));const d={name:"PBKDF2",salt:l,iterations:o,hash:{name:i}},p=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),f=await a.subtle.deriveKey(d,p,{name:t,length:r},!0,["encrypt"]),y=await a.subtle.encrypt(h,f,e);return Bt([l,h.iv,new Uint8Array(y)])},decrypt:async function(e,c){const l=e.subarray(0,s),u=e.subarray(s,s+n),h=e.subarray(s+n),d={name:t,iv:u};"string"==typeof c&&(c=Pt(c));const p={name:"PBKDF2",salt:l,iterations:o,hash:{name:i}},f=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),y=await a.subtle.deriveKey(p,f,{name:t,length:r},!0,["decrypt"]),g=await a.subtle.decrypt(d,y,h);return new Uint8Array(g)}}}Object.keys({"P-256":256,"P-384":384,"P-521":521}).join(" / "),__webpack_require__(3219);var cs=__webpack_require__(5856),ls=__webpack_require__.t(cs,2);const us=BigInt(0),hs=BigInt(1),ds=BigInt(2),ps=BigInt(3),fs=BigInt(8),ys=Object.freeze({a:us,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:hs,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")}),gs=(e,t)=>(e+t/ds)/t,ms={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(e){const{n:t}=ys,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-hs*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,o=BigInt("0x100000000000000000000000000000000"),a=gs(s*e,t),c=gs(-n*e,t);let l=$s(e-a*r-c*i,t),u=$s(-a*n-c*s,t);const h=l>o,d=u>o;if(h&&(l=t-l),d&&(u=t-u),l>o||u>o)throw new Error("splitScalarEndo: Endomorphism failed, k="+e);return{k1neg:h,k1:l,k2neg:d,k2:u}}},ws=32,Es=32,bs=32,vs=ws+1,_s=2*ws+1;function Ss(e){const{a:t,b:r}=ys,n=$s(e*e),i=$s(n*e);return $s(i+t*e+r)}const Cs=ys.a===us;class As extends Error{constructor(e){super(e)}}function Is(e){if(!(e instanceof Ts))throw new TypeError("JacobianPoint expected")}class Ts{constructor(e,t,r){this.x=e,this.y=t,this.z=r}static fromAffine(e){if(!(e instanceof Ns))throw new TypeError("JacobianPoint#fromAffine: expected Point");return e.equals(Ns.ZERO)?Ts.ZERO:new Ts(e.x,e.y,hs)}static toAffineBatch(e){const t=function(e,t=ys.P){const r=new Array(e.length),n=Ws(e.reduce(((e,n,i)=>n===us?e:(r[i]=e,$s(e*n,t))),hs),t);return e.reduceRight(((e,n,i)=>n===us?e:(r[i]=$s(e*r[i],t),$s(e*n,t))),n),r}(e.map((e=>e.z)));return e.map(((e,r)=>e.toAffine(t[r])))}static normalizeZ(e){return Ts.toAffineBatch(e).map(Ts.fromAffine)}equals(e){Is(e);const{x:t,y:r,z:n}=this,{x:i,y:s,z:o}=e,a=$s(n*n),c=$s(o*o),l=$s(t*c),u=$s(i*a),h=$s($s(r*o)*c),d=$s($s(s*n)*a);return l===u&&h===d}negate(){return new Ts(this.x,$s(-this.y),this.z)}double(){const{x:e,y:t,z:r}=this,n=$s(e*e),i=$s(t*t),s=$s(i*i),o=e+i,a=$s(ds*($s(o*o)-n-s)),c=$s(ps*n),l=$s(c*c),u=$s(l-ds*a),h=$s(c*(a-u)-fs*s),d=$s(ds*t*r);return new Ts(u,h,d)}add(e){Is(e);const{x:t,y:r,z:n}=this,{x:i,y:s,z:o}=e;if(i===us||s===us)return this;if(t===us||r===us)return e;const a=$s(n*n),c=$s(o*o),l=$s(t*c),u=$s(i*a),h=$s($s(r*o)*c),d=$s($s(s*n)*a),p=$s(u-l),f=$s(d-h);if(p===us)return f===us?this.double():Ts.ZERO;const y=$s(p*p),g=$s(p*y),m=$s(l*y),w=$s(f*f-g-ds*m),E=$s(f*(m-w)-h*g),b=$s(n*o*p);return new Ts(w,E,b)}subtract(e){return this.add(e.negate())}multiplyUnsafe(e){const t=Ts.ZERO;if("bigint"==typeof e&&e===us)return t;let r=zs(e);if(r===hs)return this;if(!Cs){let e=t,n=this;for(;r>us;)r&hs&&(e=e.add(n)),n=n.double(),r>>=hs;return e}let{k1neg:n,k1:i,k2neg:s,k2:o}=ms.splitScalar(r),a=t,c=t,l=this;for(;i>us||o>us;)i&hs&&(a=a.add(l)),o&hs&&(c=c.add(l)),l=l.double(),i>>=hs,o>>=hs;return n&&(a=a.negate()),s&&(c=c.negate()),c=new Ts($s(c.x*ms.beta),c.y,c.z),a.add(c)}precomputeWindow(e){const t=Cs?128/e+1:256/e+1,r=[];let n=this,i=n;for(let s=0;s<t;s++){i=n,r.push(i);for(let t=1;t<2**(e-1);t++)i=i.add(n),r.push(i);n=i.double()}return r}wNAF(e,t){!t&&this.equals(Ts.BASE)&&(t=Ns.BASE);const r=t&&t._WINDOW_SIZE||1;if(256%r)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let n=t&&ks.get(t);n||(n=this.precomputeWindow(r),t&&1!==r&&(n=Ts.normalizeZ(n),ks.set(t,n)));let i=Ts.ZERO,s=Ts.BASE;const o=1+(Cs?128/r:256/r),a=2**(r-1),c=BigInt(2**r-1),l=2**r,u=BigInt(r);for(let t=0;t<o;t++){const r=t*a;let o=Number(e&c);e>>=u,o>a&&(o-=l,e+=hs);const h=r,d=r+Math.abs(o)-1,p=t%2!=0,f=o<0;0===o?s=s.add(Rs(p,n[h])):i=i.add(Rs(f,n[d]))}return{p:i,f:s}}multiply(e,t){let r,n,i=zs(e);if(Cs){const{k1neg:e,k1:s,k2neg:o,k2:a}=ms.splitScalar(i);let{p:c,f:l}=this.wNAF(s,t),{p:u,f:h}=this.wNAF(a,t);c=Rs(e,c),u=Rs(o,u),u=new Ts($s(u.x*ms.beta),u.y,u.z),r=c.add(u),n=l.add(h)}else{const{p:e,f:s}=this.wNAF(i,t);r=e,n=s}return Ts.normalizeZ([r,n])[0]}toAffine(e){const{x:t,y:r,z:n}=this,i=this.equals(Ts.ZERO);null==e&&(e=i?fs:Ws(n));const s=e,o=$s(s*s),a=$s(o*s),c=$s(t*o),l=$s(r*a),u=$s(n*s);if(i)return Ns.ZERO;if(u!==hs)throw new Error("invZ was invalid");return new Ns(c,l)}}function Rs(e,t){const r=t.negate();return e?r:t}Ts.BASE=new Ts(ys.Gx,ys.Gy,hs),Ts.ZERO=new Ts(us,hs,us);const ks=new WeakMap;class Ns{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,ks.delete(this)}hasEvenY(){return this.y%ds===us}static fromCompressedHex(e){const t=32===e.length,r=js(t?e:e.subarray(1));if(!eo(r))throw new Error("Point is not on curve");let n=function(e){const{P:t}=ys,r=BigInt(6),n=BigInt(11),i=BigInt(22),s=BigInt(23),o=BigInt(44),a=BigInt(88),c=e*e*e%t,l=c*c*e%t,u=Gs(l,ps)*l%t,h=Gs(u,ps)*l%t,d=Gs(h,ds)*c%t,p=Gs(d,n)*d%t,f=Gs(p,i)*p%t,y=Gs(f,o)*f%t,g=Gs(y,a)*y%t,m=Gs(g,o)*f%t,w=Gs(m,ps)*l%t,E=Gs(w,s)*p%t,b=Gs(E,r)*c%t,v=Gs(b,ds);if(v*v%t!==e)throw new Error("Cannot find square root");return v}(Ss(r));const i=(n&hs)===hs;t?i&&(n=$s(-n)):1==(1&e[0])!==i&&(n=$s(-n));const s=new Ns(r,n);return s.assertValidity(),s}static fromUncompressedHex(e){const t=js(e.subarray(1,ws+1)),r=js(e.subarray(ws+1,2*ws+1)),n=new Ns(t,r);return n.assertValidity(),n}static fromHex(e){const t=Hs(e),r=t.length,n=t[0];if(r===ws)return this.fromCompressedHex(t);if(r===vs&&(2===n||3===n))return this.fromCompressedHex(t);if(r===_s&&4===n)return this.fromUncompressedHex(t);throw new Error(`Point.fromHex: received invalid point. Expected 32-${vs} compressed bytes or ${_s} uncompressed bytes, not ${r}`)}static fromPrivateKey(e){return Ns.BASE.multiply(ro(e))}static fromSignature(e,t,r){const{r:n,s:i}=no(t);if(![0,1,2,3].includes(r))throw new Error("Cannot recover: invalid recovery bit");const s=Ys(Hs(e)),{n:o}=ys,a=2===r||3===r?n+o:n,c=Ws(a,o),l=$s(-s*c,o),u=$s(i*c,o),h=1&r?"03":"02",d=Ns.fromHex(h+Ms(a)),p=Ns.BASE.multiplyAndAddUnsafe(d,l,u);if(!p)throw new Error("Cannot recover signature: point at infinify");return p.assertValidity(),p}toRawBytes(e=!1){return qs(this.toHex(e))}toHex(e=!1){const t=Ms(this.x);return e?`${this.hasEvenY()?"02":"03"}${t}`:`04${t}${Ms(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){const e="Point is not on elliptic curve",{x:t,y:r}=this;if(!eo(t)||!eo(r))throw new Error(e);const n=$s(r*r);if($s(n-Ss(t))!==us)throw new Error(e)}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new Ns(this.x,$s(-this.y))}double(){return Ts.fromAffine(this).double().toAffine()}add(e){return Ts.fromAffine(this).add(Ts.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return Ts.fromAffine(this).multiply(e,this).toAffine()}multiplyAndAddUnsafe(e,t,r){const n=Ts.fromAffine(this),i=t===us||t===hs||this!==Ns.BASE?n.multiplyUnsafe(t):n.multiply(t),s=Ts.fromAffine(e).multiplyUnsafe(r),o=i.add(s);return o.equals(Ts.ZERO)?void 0:o.toAffine()}}function Ls(e){return Number.parseInt(e[0],16)>=8?"00"+e:e}function Ds(e){if(e.length<2||2!==e[0])throw new Error(`Invalid signature integer tag: ${xs(e)}`);const t=e[1],r=e.subarray(2,t+2);if(!t||r.length!==t)throw new Error("Invalid signature integer: wrong length");if(0===r[0]&&r[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:js(r),left:e.subarray(t+2)}}Ns.BASE=new Ns(ys.Gx,ys.Gy),Ns.ZERO=new Ns(us,us);class Ps{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromCompact(e){const t=e instanceof Uint8Array,r="Signature.fromCompact";if("string"!=typeof e&&!t)throw new TypeError(`${r}: Expected string or Uint8Array`);const n=t?xs(e):e;if(128!==n.length)throw new Error(`${r}: Expected 64-byte hex`);return new Ps(Fs(n.slice(0,64)),Fs(n.slice(64,128)))}static fromDER(e){const t=e instanceof Uint8Array;if("string"!=typeof e&&!t)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");const{r,s:n}=function(e){if(e.length<2||48!=e[0])throw new Error(`Invalid signature tag: ${xs(e)}`);if(e[1]!==e.length-2)throw new Error("Invalid signature: incorrect length");const{data:t,left:r}=Ds(e.subarray(2)),{data:n,left:i}=Ds(r);if(i.length)throw new Error(`Invalid signature: left bytes after parsing: ${xs(i)}`);return{r:t,s:n}}(t?e:qs(e));return new Ps(r,n)}static fromHex(e){return this.fromDER(e)}assertValidity(){const{r:e,s:t}=this;if(!Js(e))throw new Error("Invalid Signature: r must be 0 < r < n");if(!Js(t))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){const e=ys.n>>hs;return this.s>e}normalizeS(){return this.hasHighS()?new Ps(this.r,$s(-this.s,ys.n)):this}toDERRawBytes(){return qs(this.toDERHex())}toDERHex(){const e=Ls(Ks(this.s)),t=Ls(Ks(this.r)),r=e.length/2,n=t.length/2,i=Ks(r),s=Ks(n);return`30${Ks(n+r+4)}02${s}${t}02${i}${e}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return qs(this.toCompactHex())}toCompactHex(){return Ms(this.r)+Ms(this.s)}}function Bs(...e){if(!e.every((e=>e instanceof Uint8Array)))throw new Error("Uint8Array list expected");if(1===e.length)return e[0];const t=e.reduce(((e,t)=>e+t.length),0),r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const i=e[t];r.set(i,n),n+=i.length}return r}const Os=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function xs(e){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");let t="";for(let r=0;r<e.length;r++)t+=Os[e[r]];return t}const Us=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function Ms(e){if("bigint"!=typeof e)throw new Error("Expected bigint");if(!(us<=e&&e<Us))throw new Error("Expected number 0 <= n < 2^256");return e.toString(16).padStart(64,"0")}function Vs(e){const t=qs(Ms(e));if(32!==t.length)throw new Error("Error: expected 32 bytes");return t}function Ks(e){const t=e.toString(16);return 1&t.length?`0${t}`:t}function Fs(e){if("string"!=typeof e)throw new TypeError("hexToNumber: expected string, got "+typeof e);return BigInt(`0x${e}`)}function qs(e){if("string"!=typeof e)throw new TypeError("hexToBytes: expected string, got "+typeof e);if(e.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+e.length);const t=new Uint8Array(e.length/2);for(let r=0;r<t.length;r++){const n=2*r,i=e.slice(n,n+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");t[r]=s}return t}function js(e){return Fs(xs(e))}function Hs(e){return e instanceof Uint8Array?Uint8Array.from(e):qs(e)}function zs(e){if("number"==typeof e&&Number.isSafeInteger(e)&&e>0)return BigInt(e);if("bigint"==typeof e&&Js(e))return e;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function $s(e,t=ys.P){const r=e%t;return r>=us?r:t+r}function Gs(e,t){const{P:r}=ys;let n=e;for(;t-- >us;)n*=n,n%=r;return n}function Ws(e,t=ys.P){if(e===us||t<=us)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let r=$s(e,t),n=t,i=us,s=hs,o=hs,a=us;for(;r!==us;){const e=n/r,t=n%r,c=i-o*e,l=s-a*e;n=r,r=t,i=o,s=a,o=c,a=l}if(n!==hs)throw new Error("invert: does not exist");return $s(i,t)}function Ys(e,t=!1){const r=function(e){const t=8*e.length-8*Es,r=js(e);return t>0?r>>BigInt(t):r}(e);if(t)return r;const{n}=ys;return r>=n?r-n:r}let Qs,Xs;class Zs{constructor(e,t){if(this.hashLen=e,this.qByteLen=t,"number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");this.v=new Uint8Array(e).fill(1),this.k=new Uint8Array(e).fill(0),this.counter=0}hmac(...e){return ho.hmacSha256(this.k,...e)}hmacSync(...e){return Xs(this.k,...e)}checkSync(){if("function"!=typeof Xs)throw new As("hmacSha256Sync needs to be set")}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(e=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),e),this.v=await this.hmac(this.v),0!==e.length&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),e),this.v=await this.hmac(this.v))}reseedSync(e=new Uint8Array){this.checkSync(),this.k=this.hmacSync(this.v,Uint8Array.from([0]),e),this.v=this.hmacSync(this.v),0!==e.length&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),e),this.v=this.hmacSync(this.v))}async generate(){this.incr();let e=0;const t=[];for(;e<this.qByteLen;){this.v=await this.hmac(this.v);const r=this.v.slice();t.push(r),e+=this.v.length}return Bs(...t)}generateSync(){this.checkSync(),this.incr();let e=0;const t=[];for(;e<this.qByteLen;){this.v=this.hmacSync(this.v);const r=this.v.slice();t.push(r),e+=this.v.length}return Bs(...t)}}function Js(e){return us<e&&e<ys.n}function eo(e){return us<e&&e<ys.P}function to(e,t,r,n=!0){const{n:i}=ys,s=Ys(e,!0);if(!Js(s))return;const o=Ws(s,i),a=Ns.BASE.multiply(s),c=$s(a.x,i);if(c===us)return;const l=$s(o*$s(t+r*c,i),i);if(l===us)return;let u=new Ps(c,l),h=(a.x===u.r?0:2)|Number(a.y&hs);return n&&u.hasHighS()&&(u=u.normalizeS(),h^=1),{sig:u,recovery:h}}function ro(e){let t;if("bigint"==typeof e)t=e;else if("number"==typeof e&&Number.isSafeInteger(e)&&e>0)t=BigInt(e);else if("string"==typeof e){if(e.length!==2*Es)throw new Error("Expected 32 bytes of private key");t=Fs(e)}else{if(!(e instanceof Uint8Array))throw new TypeError("Expected valid private key");if(e.length!==Es)throw new Error("Expected 32 bytes of private key");t=js(e)}if(!Js(t))throw new Error("Expected private key: 0 < key < n");return t}function no(e){if(e instanceof Ps)return e.assertValidity(),e;try{return Ps.fromDER(e)}catch(t){return Ps.fromCompact(e)}}function io(e,t=!1){return Ns.fromPrivateKey(e).toRawBytes(t)}function so(e){return js(e.length>ws?e.slice(0,ws):e)}function oo(e){const t=so(e),r=$s(t,ys.n);return ao(r<us?t:r)}function ao(e){return Vs(e)}const co={strict:!0};Ns.BASE._setWindowSize(8);const lo={node:ls,web:"object"==typeof self&&"crypto"in self?self.crypto:void 0},uo={},ho={bytesToHex:xs,hexToBytes:qs,concatBytes:Bs,mod:$s,invert:Ws,isValidPrivateKey(e){try{return ro(e),!0}catch(e){return!1}},_bigintTo32Bytes:Vs,_normalizePrivateKey:ro,hashToPrivateKey:e=>{e=Hs(e);const t=Es+8;if(e.length<t||e.length>1024)throw new Error("Expected valid bytes of private key as per FIPS 186");return Vs($s(js(e),ys.n-hs)+hs)},randomBytes:(e=32)=>{if(lo.web)return lo.web.getRandomValues(new Uint8Array(e));if(lo.node){const{randomBytes:t}=lo.node;return Uint8Array.from(t(e))}throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>ho.hashToPrivateKey(ho.randomBytes(Es+8)),precompute(e=8,t=Ns.BASE){const r=t===Ns.BASE?t:new Ns(t.x,t.y);return r._setWindowSize(e),r.multiply(ps),r},sha256:async(...e)=>{if(lo.web){const t=await lo.web.subtle.digest("SHA-256",Bs(...e));return new Uint8Array(t)}if(lo.node){const{createHash:t}=lo.node,r=t("sha256");return e.forEach((e=>r.update(e))),Uint8Array.from(r.digest())}throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(e,...t)=>{if(lo.web){const r=await lo.web.subtle.importKey("raw",e,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),n=Bs(...t),i=await lo.web.subtle.sign("HMAC",r,n);return new Uint8Array(i)}if(lo.node){const{createHmac:r}=lo.node,n=r("sha256",e);return t.forEach((e=>n.update(e))),Uint8Array.from(n.digest())}throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(e,...t)=>{let r=uo[e];if(void 0===r){const t=await ho.sha256(Uint8Array.from(e,(e=>e.charCodeAt(0))));r=Bs(t,t),uo[e]=r}return ho.sha256(r,...t)},taggedHashSync:(e,...t)=>{if("function"!=typeof Qs)throw new As("sha256Sync is undefined, you need to set it");let r=uo[e];if(void 0===r){const t=Qs(Uint8Array.from(e,(e=>e.charCodeAt(0))));r=Bs(t,t),uo[e]=r}return Qs(r,...t)},_JacobianPoint:Ts};function po(e){if(isNaN(e)||e<=0)throw new rs("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return ho.randomBytes(e)}function fo(e,t){return t.map((t=>os(e[t])))}async function yo(e){const t=[await ns.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await mo(e)],r=await go({privateKey:t[0],publicKey:t[1]});return{privateKey:r[0],publicKey:r[1]}}async function go(e){if(null==e.privateKey||null==e.publicKey)throw new rs("Private and public key are required","ERR_INVALID_PARAMETERS");return await Promise.all([ns.get().subtle.exportKey("jwk",e.privateKey),ns.get().subtle.exportKey("jwk",e.publicKey)])}async function mo(e){return await ns.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function wo(e,t,r,n){const i=t?function(e){return es.pki.setRsaPublicKey(...fo(e,["n","e"]))}(e):function(e){return es.pki.setRsaPrivateKey(...fo(e,["n","e","d","p","q","dp","dq","qi"]))}(e);return Pt(n(St(Uint8Array.from(r),"ascii"),i),"ascii")}async function Eo(e,t){const r=as(),n=await r.encrypt(e,t);return J.encode(n)}Object.defineProperties(ho,{sha256Sync:{configurable:!1,get:()=>Qs,set(e){Qs||(Qs=e)}},hmacSha256Sync:{configurable:!1,get:()=>Xs,set(e){Xs||(Xs=e)}}}),__webpack_require__(8095);class bo{constructor(e){this._key=e}async verify(e,t){return await async function(e,t,r){const n=await ns.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return await ns.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,r)}(this._key,t,e)}marshal(){return function(e){if(null==e.n||null==e.e)throw new rs("JWK was missing components","ERR_INVALID_PARAMETERS");const t=es.pki.publicKeyToAsn1({n:os(e.n),e:os(e.e)});return Pt(es.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return Wi.encode({Type:$i.RSA,Data:this.marshal()}).subarray()}encrypt(e){return wo(this._key,!0,e,((e,t)=>t.encrypt(e)))}equals(e){return Xt(this.bytes,e.bytes)}async hash(){const{bytes:e}=await He.digest(this.bytes);return e}}class vo{constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return po(16)}async sign(e){return await async function(e,t){const r=await ns.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await ns.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,Uint8Array.from(t));return new Uint8Array(n,0,n.byteLength)}(this._key,e)}get public(){if(null==this._publicKey)throw new rs("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new bo(this._publicKey)}decrypt(e){return wo(this._key,!1,e,((e,t)=>t.decrypt(e)))}marshal(){return function(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new rs("JWK was missing components","ERR_INVALID_PARAMETERS");const t=es.pki.privateKeyToAsn1({n:os(e.n),e:os(e.e),d:os(e.d),p:os(e.p),q:os(e.q),dP:os(e.dp),dQ:os(e.dq),qInv:os(e.qi)});return Pt(es.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return Yi.encode({Type:$i.RSA,Data:this.marshal()}).subarray()}equals(e){return Xt(this.bytes,e.bytes)}async hash(){const{bytes:e}=await He.digest(this.bytes);return e}async id(){return St(await this.public.hash(),"base58btc")}async export(e,t="pkcs-8"){if("pkcs-8"===t){const t=new es.util.ByteBuffer(this.marshal()),r=es.asn1.fromDer(t),n=es.pki.privateKeyFromAsn1(r),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return es.pki.encryptRsaPrivateKey(n,e,i)}if("libp2p-key"===t)return await Eo(this.bytes,e);throw new rs(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}async function _o(e){const t=function(e){const t=es.asn1.fromDer(St(e,"ascii")),r=es.pki.privateKeyFromAsn1(t);return{kty:"RSA",n:ss(r.n),e:ss(r.e),d:ss(r.d),p:ss(r.p),q:ss(r.q),dp:ss(r.dP),dq:ss(r.dQ),qi:ss(r.qInv),alg:"RS256"}}(e),r=await yo(t);return new vo(r.privateKey,r.publicKey)}function So(e){const t=function(e){const t=es.asn1.fromDer(St(e,"ascii")),r=es.pki.publicKeyFromAsn1(t);return{kty:"RSA",n:ss(r.n),e:ss(r.e)}}(e);return new bo(t)}async function Co(e){const t=await yo(e);return new vo(t.privateKey,t.publicKey)}async function Ao(e){const t=await async function(e){const t=await ns.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await go(t);return{privateKey:r[0],publicKey:r[1]}}(e);return new vo(t.privateKey,t.publicKey)}var Io=__webpack_require__(7420),To=__webpack_require__.t(Io,2);const Ro=BigInt(0),ko=BigInt(1),No=BigInt(2),Lo=BigInt(8),Do=BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),Po=Object.freeze({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),l:Do,n:Do,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")}),Bo=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000"),Oo=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),xo=(BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742"),BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235")),Uo=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),Mo=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),Vo=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");class Ko{constructor(e,t,r,n){this.x=e,this.y=t,this.z=r,this.t=n}static fromAffine(e){if(!(e instanceof Go))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return e.equals(Go.ZERO)?Ko.ZERO:new Ko(e.x,e.y,ko,sa(e.x*e.y))}static toAffineBatch(e){const t=function(e,t=Po.P){const r=new Array(e.length),n=oa(e.reduce(((e,n,i)=>n===Ro?e:(r[i]=e,sa(e*n,t))),ko),t);return e.reduceRight(((e,n,i)=>n===Ro?e:(r[i]=sa(e*r[i],t),sa(e*n,t))),n),r}(e.map((e=>e.z)));return e.map(((e,r)=>e.toAffine(t[r])))}static normalizeZ(e){return this.toAffineBatch(e).map(this.fromAffine)}equals(e){qo(e);const{x:t,y:r,z:n}=this,{x:i,y:s,z:o}=e,a=sa(t*o),c=sa(i*n),l=sa(r*o),u=sa(s*n);return a===c&&l===u}negate(){return new Ko(sa(-this.x),this.y,this.z,sa(-this.t))}double(){const{x:e,y:t,z:r}=this,{a:n}=Po,i=sa(e*e),s=sa(t*t),o=sa(No*sa(r*r)),a=sa(n*i),c=e+t,l=sa(sa(c*c)-i-s),u=a+s,h=u-o,d=a-s,p=sa(l*h),f=sa(u*d),y=sa(l*d),g=sa(h*u);return new Ko(p,f,g,y)}add(e){qo(e);const{x:t,y:r,z:n,t:i}=this,{x:s,y:o,z:a,t:c}=e,l=sa((r-t)*(o+s)),u=sa((r+t)*(o-s)),h=sa(u-l);if(h===Ro)return this.double();const d=sa(n*No*c),p=sa(i*No*a),f=p+d,y=u+l,g=p-d,m=sa(f*h),w=sa(y*g),E=sa(f*g),b=sa(h*y);return new Ko(m,w,b,E)}subtract(e){return this.add(e.negate())}precomputeWindow(e){const t=1+256/e,r=[];let n=this,i=n;for(let s=0;s<t;s++){i=n,r.push(i);for(let t=1;t<2**(e-1);t++)i=i.add(n),r.push(i);n=i.double()}return r}wNAF(e,t){!t&&this.equals(Ko.BASE)&&(t=Go.BASE);const r=t&&t._WINDOW_SIZE||1;if(256%r)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let n=t&&$o.get(t);n||(n=this.precomputeWindow(r),t&&1!==r&&(n=Ko.normalizeZ(n),$o.set(t,n)));let i=Ko.ZERO,s=Ko.BASE;const o=1+256/r,a=2**(r-1),c=BigInt(2**r-1),l=2**r,u=BigInt(r);for(let t=0;t<o;t++){const r=t*a;let o=Number(e&c);e>>=u,o>a&&(o-=l,e+=ko);const h=r,d=r+Math.abs(o)-1,p=t%2!=0,f=o<0;0===o?s=s.add(Fo(p,n[h])):i=i.add(Fo(f,n[d]))}return Ko.normalizeZ([i,s])[0]}multiply(e,t){return this.wNAF(da(e,Po.l),t)}multiplyUnsafe(e){let t=da(e,Po.l,!1);const r=Ko.BASE,n=Ko.ZERO;if(t===Ro)return n;if(this.equals(n)||t===ko)return this;if(this.equals(r))return this.wNAF(t);let i=n,s=this;for(;t>Ro;)t&ko&&(i=i.add(s)),s=s.double(),t>>=ko;return i}isSmallOrder(){return this.multiplyUnsafe(Po.h).equals(Ko.ZERO)}isTorsionFree(){let e=this.multiplyUnsafe(Po.l/No).double();return Po.l%No&&(e=e.add(this)),e.equals(Ko.ZERO)}toAffine(e){const{x:t,y:r,z:n}=this,i=this.equals(Ko.ZERO);null==e&&(e=i?Lo:oa(n));const s=sa(t*e),o=sa(r*e),a=sa(n*e);if(i)return Go.ZERO;if(a!==ko)throw new Error("invZ was invalid");return new Go(s,o)}fromRistrettoBytes(){Ho()}toRistrettoBytes(){Ho()}fromRistrettoHash(){Ho()}}function Fo(e,t){const r=t.negate();return e?r:t}function qo(e){if(!(e instanceof Ko))throw new TypeError("ExtendedPoint expected")}function jo(e){if(!(e instanceof zo))throw new TypeError("RistrettoPoint expected")}function Ho(){throw new Error("Legacy method: switch to RistrettoPoint")}Ko.BASE=new Ko(Po.Gx,Po.Gy,ko,sa(Po.Gx*Po.Gy)),Ko.ZERO=new Ko(Ro,ko,ko,Ro);class zo{constructor(e){this.ep=e}static calcElligatorRistrettoMap(e){const{d:t}=Po,r=sa(Oo*e*e),n=sa((r+ko)*Mo);let i=BigInt(-1);const s=sa((i-t*r)*sa(r+t));let{isValid:o,value:a}=ca(n,s),c=sa(a*e);ta(c)||(c=sa(-c)),o||(a=c),o||(i=r);const l=sa(i*(r-ko)*Vo-s),u=a*a,h=sa((a+a)*s),d=sa(l*xo),p=sa(ko-u),f=sa(ko+u);return new Ko(sa(h*f),sa(p*d),sa(d*f),sa(h*p))}static hashToCurve(e){const t=ia((e=ha(e,64)).slice(0,32)),r=this.calcElligatorRistrettoMap(t),n=ia(e.slice(32,64)),i=this.calcElligatorRistrettoMap(n);return new zo(r.add(i))}static fromHex(e){e=ha(e,32);const{a:t,d:r}=Po,n="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",i=ia(e);if(!function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}(ea(i),e)||ta(i))throw new Error(n);const s=sa(i*i),o=sa(ko+t*s),a=sa(ko-t*s),c=sa(o*o),l=sa(a*a),u=sa(t*r*c-l),{isValid:h,value:d}=la(sa(u*l)),p=sa(d*a),f=sa(d*p*u);let y=sa((i+i)*p);ta(y)&&(y=sa(-y));const g=sa(o*f),m=sa(y*g);if(!h||ta(m)||g===Ro)throw new Error(n);return new zo(new Ko(y,g,ko,m))}toRawBytes(){let{x:e,y:t,z:r,t:n}=this.ep;const i=sa(sa(r+t)*sa(r-t)),s=sa(e*t),o=sa(s*s),{value:a}=la(sa(i*o)),c=sa(a*i),l=sa(a*s),u=sa(c*l*n);let h;if(ta(n*u)){let r=sa(t*Oo),n=sa(e*Oo);e=r,t=n,h=sa(c*Uo)}else h=l;ta(e*u)&&(t=sa(-t));let d=sa((r-t)*h);return ta(d)&&(d=sa(-d)),ea(d)}toHex(){return Xo(this.toRawBytes())}toString(){return this.toHex()}equals(e){jo(e);const t=this.ep,r=e.ep,n=sa(t.x*r.y)===sa(t.y*r.x),i=sa(t.y*r.y)===sa(t.x*r.x);return n||i}add(e){return jo(e),new zo(this.ep.add(e.ep))}subtract(e){return jo(e),new zo(this.ep.subtract(e.ep))}multiply(e){return new zo(this.ep.multiply(e))}multiplyUnsafe(e){return new zo(this.ep.multiplyUnsafe(e))}}zo.BASE=new zo(Ko.BASE),zo.ZERO=new zo(Ko.ZERO);const $o=new WeakMap;class Go{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,$o.delete(this)}static fromHex(e,t=!0){const{d:r,P:n}=Po,i=(e=ha(e,32)).slice();i[31]=-129&e[31];const s=ra(i);if(t&&s>=n)throw new Error("Expected 0 < hex < P");if(!t&&s>=Bo)throw new Error("Expected 0 < hex < 2**256");const o=sa(s*s),a=sa(o-ko),c=sa(r*o+ko);let{isValid:l,value:u}=ca(a,c);if(!l)throw new Error("Point.fromHex: invalid y coordinate");const h=(u&ko)===ko;return 0!=(128&e[31])!==h&&(u=sa(-u)),new Go(u,s)}static async fromPrivateKey(e){return(await fa(e)).point}toRawBytes(){const e=ea(this.y);return e[31]|=this.x&ko?128:0,e}toHex(){return Xo(this.toRawBytes())}toX25519(){const{y:e}=this;return ea(sa((ko+e)*oa(ko-e)))}isTorsionFree(){return Ko.fromAffine(this).isTorsionFree()}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new Go(sa(-this.x),this.y)}add(e){return Ko.fromAffine(this).add(Ko.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return Ko.fromAffine(this).multiply(e,this).toAffine()}}Go.BASE=new Go(Po.Gx,Po.Gy),Go.ZERO=new Go(Ro,ko);class Wo{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromHex(e){const t=ha(e,64),r=Go.fromHex(t.slice(0,32),!1),n=ra(t.slice(32,64));return new Wo(r,n)}assertValidity(){const{r:e,s:t}=this;if(!(e instanceof Go))throw new Error("Expected Point instance");return da(t,Po.l,!1),this}toRawBytes(){const e=new Uint8Array(64);return e.set(this.r.toRawBytes()),e.set(ea(this.s),32),e}toHex(){return Xo(this.toRawBytes())}}function Yo(...e){if(!e.every((e=>e instanceof Uint8Array)))throw new Error("Expected Uint8Array list");if(1===e.length)return e[0];const t=e.reduce(((e,t)=>e+t.length),0),r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const i=e[t];r.set(i,n),n+=i.length}return r}const Qo=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function Xo(e){if(!(e instanceof Uint8Array))throw new Error("Uint8Array expected");let t="";for(let r=0;r<e.length;r++)t+=Qo[e[r]];return t}function Zo(e){if("string"!=typeof e)throw new TypeError("hexToBytes: expected string, got "+typeof e);if(e.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const t=new Uint8Array(e.length/2);for(let r=0;r<t.length;r++){const n=2*r,i=e.slice(n,n+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");t[r]=s}return t}function Jo(e){return Zo(e.toString(16).padStart(64,"0"))}function ea(e){return Jo(e).reverse()}function ta(e){return(sa(e)&ko)===ko}function ra(e){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+Xo(Uint8Array.from(e).reverse()))}const na=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function ia(e){return sa(ra(e)&na)}function sa(e,t=Po.P){const r=e%t;return r>=Ro?r:t+r}function oa(e,t=Po.P){if(e===Ro||t<=Ro)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let r=sa(e,t),n=t,i=Ro,s=ko,o=ko,a=Ro;for(;r!==Ro;){const e=n/r,t=n%r,c=i-o*e,l=s-a*e;n=r,r=t,i=o,s=a,o=c,a=l}if(n!==ko)throw new Error("invert: does not exist");return sa(i,t)}function aa(e,t){const{P:r}=Po;let n=e;for(;t-- >Ro;)n*=n,n%=r;return n}function ca(e,t){const r=sa(t*t*t),n=sa(r*r*t);let i=sa(e*r*function(e){const{P:t}=Po,r=BigInt(5),n=BigInt(10),i=BigInt(20),s=BigInt(40),o=BigInt(80),a=e*e%t*e%t,c=aa(a,No)*a%t,l=aa(c,ko)*e%t,u=aa(l,r)*l%t,h=aa(u,n)*u%t,d=aa(h,i)*h%t,p=aa(d,s)*d%t,f=aa(p,o)*p%t,y=aa(f,o)*p%t,g=aa(y,n)*u%t;return{pow_p_5_8:aa(g,No)*e%t,b2:a}}(e*n).pow_p_5_8);const s=sa(t*i*i),o=i,a=sa(i*Oo),c=s===e,l=s===sa(-e),u=s===sa(-e*Oo);return c&&(i=o),(l||u)&&(i=a),ta(i)&&(i=sa(-i)),{isValid:c||l,value:i}}function la(e){return ca(ko,e)}function ua(e){return sa(ra(e),Po.l)}function ha(e,t){const r=e instanceof Uint8Array?Uint8Array.from(e):Zo(e);if("number"==typeof t&&r.length!==t)throw new Error(`Expected ${t} bytes`);return r}function da(e,t,r=!0){if(!t)throw new TypeError("Specify max value");if("number"==typeof e&&Number.isSafeInteger(e)&&(e=BigInt(e)),"bigint"==typeof e&&e<t)if(r){if(Ro<e)return e}else if(Ro<=e)return e;throw new TypeError("Expected valid scalar: 0 < scalar < max")}let pa;async function fa(e){return function(e){const t=((o=e.slice(0,32))[0]&=248,o[31]&=127,o[31]|=64,o),r=e.slice(32,64),n=ua(t),i=Go.BASE.multiply(n),s=i.toRawBytes();var o;return{head:t,prefix:r,scalar:n,point:i,pointBytes:s}}(await ma.sha512(function(e){if(32!==(e="bigint"==typeof e||"number"==typeof e?Jo(da(e,Bo)):ha(e)).length)throw new Error("Expected 32 bytes");return e}(e)))}async function ya(e){return(await fa(e)).pointBytes}Go.BASE._setWindowSize(8);const ga={node:To,web:"object"==typeof self&&"crypto"in self?self.crypto:void 0},ma={bytesToHex:Xo,hexToBytes:Zo,concatBytes:Yo,getExtendedPublicKey:fa,mod:sa,invert:oa,TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],hashToPrivateScalar:e=>{if((e=ha(e)).length<40||e.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");return sa(ra(e),Po.l-ko)+ko},randomBytes:(e=32)=>{if(ga.web)return ga.web.getRandomValues(new Uint8Array(e));if(ga.node){const{randomBytes:t}=ga.node;return new Uint8Array(t(e).buffer)}throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>ma.randomBytes(32),sha512:async(...e)=>{const t=Yo(...e);if(ga.web){const e=await ga.web.subtle.digest("SHA-512",t.buffer);return new Uint8Array(e)}if(ga.node)return Uint8Array.from(ga.node.createHash("sha512").update(t).digest());throw new Error("The environment doesn't have sha512 function")},precompute(e=8,t=Go.BASE){const r=t.equals(Go.BASE)?t:new Go(t.x,t.y);return r._setWindowSize(e),r.multiply(No),r},sha512Sync:void 0};Object.defineProperties(ma,{sha512Sync:{configurable:!1,get:()=>pa,set(e){pa||(pa=e)}}});const wa=32,Ea=64,ba=32;async function va(e,t,r){return await async function(e,t,r){const{r:n,SB:i,msg:s,pub:o}=function(e,t,r){t=ha(t),r instanceof Go||(r=Go.fromHex(r,!1));const{r:n,s:i}=e instanceof Wo?e.assertValidity():Wo.fromHex(e);return{r:n,s:i,SB:Ko.BASE.multiplyUnsafe(i),pub:r,msg:t}}(e,t,r),a=await ma.sha512(n.toRawBytes(),o.toRawBytes(),s);return function(e,t,r,n){const i=ua(n),s=Ko.fromAffine(e).multiplyUnsafe(i);return Ko.fromAffine(t).add(s).subtract(r).multiplyUnsafe(Po.h).equals(Ko.ZERO)}(o,n,i,a)}(t,r,e)}function _a(e,t){const r=new Uint8Array(Ea);for(let n=0;n<ba;n++)r[n]=e[n],r[ba+n]=t[n];return r}class Sa{constructor(e){this._key=ka(e,wa)}async verify(e,t){return await va(this._key,t,e)}marshal(){return this._key}get bytes(){return Wi.encode({Type:$i.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Xt(this.bytes,e.bytes)}async hash(){const{bytes:e}=await He.digest(this.bytes);return e}}class Ca{constructor(e,t){this._key=ka(e,Ea),this._publicKey=ka(t,wa)}async sign(e){return await async function(e,t){const r=e.subarray(0,ba);return await async function(e,t){e=ha(e);const{prefix:r,scalar:n,pointBytes:i}=await fa(t),s=ua(await ma.sha512(r,e)),o=Go.BASE.multiply(s),a=sa(s+ua(await ma.sha512(o.toRawBytes(),i,e))*n,Po.l);return new Wo(o,a).toRawBytes()}(t,r)}(this._key,e)}get public(){return new Sa(this._publicKey)}marshal(){return this._key}get bytes(){return Yi.encode({Type:$i.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Xt(this.bytes,e.bytes)}async hash(){const{bytes:e}=await He.digest(this.bytes);return e}async id(){const e=await Ge.digest(this.public.bytes);return q.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if("libp2p-key"===t)return await Eo(this.bytes,e);throw new rs(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function Aa(e){if(e.length>Ea){const t=(e=ka(e,Ea+wa)).subarray(0,Ea),r=e.subarray(Ea,e.length);return new Ca(t,r)}const t=(e=ka(e,Ea)).subarray(0,Ea),r=e.subarray(wa);return new Ca(t,r)}function Ia(e){return e=ka(e,wa),new Sa(e)}async function Ta(){const{privateKey:e,publicKey:t}=await async function(){const e=ma.randomPrivateKey(),t=await ya(e);return{privateKey:_a(e,t),publicKey:t}}();return new Ca(e,t)}async function Ra(e){const{privateKey:t,publicKey:r}=await async function(e){if(e.length!==ba)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const t=e,r=await ya(t);return{privateKey:_a(t,r),publicKey:r}}(e);return new Ca(t,r)}function ka(e,t){if((e=Uint8Array.from(e??[])).length!==t)throw new rs(`Key must be a Uint8Array of length ${t}, got ${e.length}`,"ERR_INVALID_KEY_TYPE");return e}async function Na(e,t){const{digest:r}=await He.digest(t);try{return await async function(e,t,r={}){const{seed:n,m:i,d:s}=function(e,t,r){if(null==e)throw new Error(`sign: expected valid message hash, not "${e}"`);const n=Hs(e),i=ro(t),s=[ao(i),oo(n)];if(null!=r){!0===r&&(r=ho.randomBytes(ws));const e=Hs(r);if(e.length!==ws)throw new Error(`sign: Expected ${ws} bytes of extra data`);s.push(e)}return{seed:Bs(...s),m:so(n),d:i}}(e,t,r.extraEntropy),o=new Zs(bs,Es);let a;for(await o.reseed(n);!(a=to(await o.generate(),i,s,r.canonical));)await o.reseed();return function(e,t){const{sig:r,recovery:n}=e,{der:i,recovered:s}=Object.assign({canonical:!0,der:!0},t),o=i?r.toDERRawBytes():r.toCompactRawBytes();return s?[o,n]:o}(a,r)}(r,e)}catch(e){throw new rs(String(e),"ERR_INVALID_INPUT")}}async function La(e,t,r){try{const{digest:n}=await He.digest(r);return function(e,t,r,n=co){let i;try{i=no(e),t=Hs(t)}catch(e){return!1}const{r:s,s:o}=i;if(n.strict&&i.hasHighS())return!1;const a=Ys(t);let c;try{c=function(e){return e instanceof Ns?(e.assertValidity(),e):Ns.fromHex(e)}(r)}catch(e){return!1}const{n:l}=ys,u=Ws(o,l),h=$s(a*u,l),d=$s(s*u,l),p=Ns.BASE.multiplyAndAddUnsafe(c,h,d);return!!p&&$s(p.x,l)===s}(t,n,e)}catch(e){throw new rs(String(e),"ERR_INVALID_INPUT")}}function Da(e){try{Ns.fromHex(e)}catch(e){throw new rs(String(e),"ERR_INVALID_PUBLIC_KEY")}}class Pa{constructor(e){Da(e),this._key=e}async verify(e,t){return await La(this._key,t,e)}marshal(){return e=this._key,Ns.fromHex(e).toRawBytes(!0);var e}get bytes(){return Wi.encode({Type:$i.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Xt(this.bytes,e.bytes)}async hash(){const{bytes:e}=await He.digest(this.bytes);return e}}class Ba{constructor(e,t){this._key=e,this._publicKey=t??function(e){try{return io(e,!0)}catch(e){throw new rs(String(e),"ERR_INVALID_PRIVATE_KEY")}}(e),function(e){try{io(e,!0)}catch(e){throw new rs(String(e),"ERR_INVALID_PRIVATE_KEY")}}(this._key),Da(this._publicKey)}async sign(e){return await Na(this._key,e)}get public(){return new Pa(this._publicKey)}marshal(){return this._key}get bytes(){return Yi.encode({Type:$i.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Xt(this.bytes,e.bytes)}async hash(){const{bytes:e}=await He.digest(this.bytes);return e}async id(){return St(await this.public.hash(),"base58btc")}async export(e,t="libp2p-key"){if("libp2p-key"===t)return await Eo(this.bytes,e);throw new rs(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function Oa(e){return new Ba(e)}function xa(e){return new Pa(e)}async function Ua(){const e=await ho.randomPrivateKey();return new Ba(e)}const Ma={rsa:f,ed25519:y,secp256k1:g};function Va(e){const t=Object.keys(Ma).join(" / ");return new rs(`invalid or unsupported key type ${e}. Must be ${t}`,"ERR_UNSUPPORTED_KEY_TYPE")}function Ka(e){if("rsa"===(e=e.toLowerCase())||"ed25519"===e||"secp256k1"===e)return Ma[e];throw Va(e)}async function Fa(e,t){return await Ka(e).generateKeyPair(t??2048)}function qa(e){const t=Wi.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case $i.RSA:return Ma.rsa.unmarshalRsaPublicKey(r);case $i.Ed25519:return Ma.ed25519.unmarshalEd25519PublicKey(r);case $i.Secp256k1:return Ma.secp256k1.unmarshalSecp256k1PublicKey(r);default:throw Va(t.Type??"RSA")}}async function ja(e){const t=Yi.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case $i.RSA:return await Ma.rsa.unmarshalRsaPrivateKey(r);case $i.Ed25519:return Ma.ed25519.unmarshalEd25519PrivateKey(r);case $i.Secp256k1:return Ma.secp256k1.unmarshalSecp256k1PrivateKey(r);default:throw Va(t.Type??"RSA")}}async function Ha(e,t){try{const r=await async function(e,t){const r=J.decode(e),n=as();return await n.decrypt(r,t)}(e,t);return await ja(r)}catch(e){}const r=es.pki.decryptRsaPrivateKey(e,t);if(null===r)throw new rs("Cannot read the key, most likely the password is wrong or not a RSA key","ERR_CANNOT_DECRYPT_PEM");let n=es.asn1.toDer(es.pki.privateKeyToAsn1(r));return n=Pt(n.getBytes(),"ascii"),await Ma.rsa.unmarshalRsaPrivateKey(n)}const za=Symbol.for("@libp2p/peer-id");function $a(e){return null!=e&&Boolean(e[za])}const Ga=Symbol.for("nodejs.util.inspect.custom"),Wa=Object.values(yt).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),yt.identity.decoder),Ya=114,Qa=36,Xa=37;class Za{constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}get[za](){return!0}toString(){return null==this.string&&(this.string=q.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return at.createV1(Ya,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return Xt(this.multihash.bytes,e);if("string"==typeof e)return nc(e).equals(this);if(null!=e?.multihash?.bytes)return Xt(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[Ga](){return`PeerId(${this.toString()})`}}class Ja extends Za{constructor(e){super({...e,type:"RSA"}),this.type="RSA",this.publicKey=e.publicKey}}class ec extends Za{constructor(e){super({...e,type:"Ed25519"}),this.type="Ed25519",this.publicKey=e.multihash.digest}}class tc extends Za{constructor(e){super({...e,type:"secp256k1"}),this.type="secp256k1",this.publicKey=e.multihash.digest}}function rc(e){if("RSA"===e.type)return new Ja(e);if("Ed25519"===e.type)return new ec(e);if("secp256k1"===e.type)return new tc(e);throw new rs("Not a PeerId","ERR_INVALID_PARAMETERS")}function nc(e,t){if(t=t??Wa,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=Ve(q.decode(`z${e}`));return e.startsWith("12D")?new ec({multihash:t}):e.startsWith("16U")?new tc({multihash:t}):new Ja({multihash:t})}return ic(Wa.decode(e))}function ic(e){try{const t=Ve(e);if(t.code===Ge.code){if(t.digest.length===Qa)return new ec({multihash:t});if(t.digest.length===Xa)return new tc({multihash:t})}if(t.code===He.code)return new Ja({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==Ya)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===He.code)return new Ja({multihash:e.multihash});if(t.code===Ge.code){if(t.digest.length===Qa)return new ec({multihash:e.multihash});if(t.digest.length===Xa)return new tc({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(at.decode(e))}throw new Error("Supplied PeerID CID is invalid")}async function sc(e,t){return e.length===Qa?new ec({multihash:Me(Ge.code,e),privateKey:t}):e.length===Xa?new tc({multihash:Me(Ge.code,e),privateKey:t}):new Ja({multihash:await He.digest(e),publicKey:e,privateKey:t})}var oc,ac;async function cc(e){return await sc(e.identityKey)}function lc(e){return ac.decode(e)}function uc(e){const t=Pt("noise-libp2p-static-key:");return Bt([t,e],t.length+e.length)}async function hc(e,t,r){const n=await sc(t.identityKey);if(!n.equals(r))throw new Error(`Payload identity key ${n.toString()} does not match expected remote peer ${r.toString()}`);const i=uc(e);if(null==n.publicKey)throw new Error("PublicKey was missing from PeerId");if(null==t.identitySig)throw new Error("Signature was missing from message");const s=qa(n.publicKey);if(!await s.verify(i,t.identitySig))throw new Error("Static key doesn't match to peer that signed payload!");return n}function dc(e){return e instanceof Uint8Array&&32===e.length}!function(e){let t;e.codec=()=>(null==t&&(t=Ji(((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.webtransportCerthashes)for(const r of e.webtransportCerthashes)t.uint32(10),t.bytes(r);!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={webtransportCerthashes:[]},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();t>>>3==1?r.webtransportCerthashes.push(e.bytes()):e.skipType(7&t)}return r}))),t),e.encode=t=>Hi(t,e.codec()),e.decode=t=>ji(t,e.codec())}(oc||(oc={})),function(e){let t;e.codec=()=>(null==t&&(t=Ji(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),(!0===r.writeDefaults||null!=e.identityKey&&e.identityKey.byteLength>0)&&(t.uint32(10),t.bytes(e.identityKey)),(!0===r.writeDefaults||null!=e.identitySig&&e.identitySig.byteLength>0)&&(t.uint32(18),t.bytes(e.identitySig)),null!=e.extensions&&(t.uint32(34),oc.codec().encode(e.extensions,t,{writeDefaults:!1})),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={identityKey:new Uint8Array(0),identitySig:new Uint8Array(0)},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.identityKey=e.bytes();break;case 2:r.identitySig=e.bytes();break;case 4:r.extensions=oc.codec().decode(e,e.uint32());break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>Hi(t,e.codec()),e.decode=t=>ji(t,e.codec())}(ac||(ac={}));const pc=ne("libp2p:noise");let fc;function yc(e){e?(fc(`LOCAL_PUBLIC_EPHEMERAL_KEY ${St(e.publicKey,"hex")}`),fc(`LOCAL_PRIVATE_EPHEMERAL_KEY ${St(e.privateKey,"hex")}`)):fc("Missing local ephemeral keys.")}function gc(e){fc(`REMOTE_EPHEMERAL_PUBLIC_KEY ${St(e,"hex")}`)}fc=Ii?pc:Object.assign((()=>{}),{enabled:!1,trace:()=>{},error:()=>{}});class mc{constructor(e=0){this.n=e,this.bytes=new Uint8Array(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>4294967295)throw new Error("Cipherstate has reached maximum n, a new handshake must be performed")}}class wc{constructor(e){this.crypto=e}encryptWithAd(e,t,r){const n=this.encrypt(e.k,e.n,t,r);return e.n.increment(),n}decryptWithAd(e,t,r,n){const{plaintext:i,valid:s}=this.decrypt(e.k,e.n,t,r,n);return s&&e.n.increment(),{plaintext:i,valid:s}}hasKey(e){return!this.isEmptyKey(e.k)}createEmptyKey(){return new Uint8Array(32)}isEmptyKey(e){return Xt(this.createEmptyKey(),e)}encrypt(e,t,r,n){return t.assertValue(),this.crypto.chaCha20Poly1305Encrypt(n,t.getBytes(),r,e)}encryptAndHash(e,t){let r;return r=this.hasKey(e.cs)?this.encryptWithAd(e.cs,e.h,t):t,this.mixHash(e,r),r}decrypt(e,t,r,n,i){t.assertValue();const s=this.crypto.chaCha20Poly1305Decrypt(n,t.getBytes(),r,e,i);return s?{plaintext:s,valid:!0}:{plaintext:new Uint8Array(0),valid:!1}}decryptAndHash(e,t){let r,n=!0;return this.hasKey(e.cs)?({plaintext:r,valid:n}=this.decryptWithAd(e.cs,e.h,t)):r=t,this.mixHash(e,t),{plaintext:r,valid:n}}dh(e,t){try{const r=this.crypto.generateX25519SharedKey(e,t);return 32===r.length?r:r.subarray(0,32)}catch(e){return pc(e.message),new Uint8Array(32)}}mixHash(e,t){e.h=this.getHash(e.h,t)}getHash(e,t){return this.crypto.hashSHA256(Bt([e,t],e.length+t.length))}mixKey(e,t){const[r,n]=this.crypto.getHKDF(e.ck,t);e.cs=this.initializeKey(n),e.ck=r}initializeKey(e){return{k:e,n:new mc}}initializeSymmetric(e){const t=Pt(e,"utf-8"),r=this.hashProtocolName(t),n=r,i=this.createEmptyKey();return{cs:this.initializeKey(i),ck:n,h:r}}hashProtocolName(e){if(e.length<=32){const t=new Uint8Array(32);return t.set(e),t}return this.getHash(e,new Uint8Array(0))}split(e){const[t,r]=this.crypto.getHKDF(e.ck,new Uint8Array(0));return{cs1:this.initializeKey(t),cs2:this.initializeKey(r)}}writeMessageRegular(e,t){const r=this.encryptWithAd(e,new Uint8Array(0),t);return{ne:this.createEmptyKey(),ns:new Uint8Array(0),ciphertext:r}}readMessageRegular(e,t){return this.decryptWithAd(e,new Uint8Array(0),t.ciphertext)}}class Ec extends wc{initializeInitiator(e,t,r,n){const i=this.initializeSymmetric("Noise_XX_25519_ChaChaPoly_SHA256");return this.mixHash(i,e),{ss:i,s:t,rs:r,psk:n,re:new Uint8Array(32)}}initializeResponder(e,t,r,n){const i=this.initializeSymmetric("Noise_XX_25519_ChaChaPoly_SHA256");return this.mixHash(i,e),{ss:i,s:t,rs:r,psk:n,re:new Uint8Array(32)}}writeMessageA(e,t,r){const n=new Uint8Array(0);e.e=void 0!==r?r:this.crypto.generateX25519KeyPair();const i=e.e.publicKey;return this.mixHash(e.ss,i),{ne:i,ns:n,ciphertext:this.encryptAndHash(e.ss,t)}}writeMessageB(e,t){e.e=this.crypto.generateX25519KeyPair();const r=e.e.publicKey;this.mixHash(e.ss,r),this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const n=e.s.publicKey,i=this.encryptAndHash(e.ss,n);return this.mixKey(e.ss,this.dh(e.s.privateKey,e.re)),{ne:r,ns:i,ciphertext:this.encryptAndHash(e.ss,t)}}writeMessageC(e,t){const r=e.s.publicKey,n=this.encryptAndHash(e.ss,r);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));const i=this.encryptAndHash(e.ss,t),s={ne:this.createEmptyKey(),ns:n,ciphertext:i},{cs1:o,cs2:a}=this.split(e.ss);return{h:e.ss.h,messageBuffer:s,cs1:o,cs2:a}}readMessageA(e,t){return dc(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),this.decryptAndHash(e.ss,t.ciphertext)}readMessageB(e,t){if(dc(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const{plaintext:r,valid:n}=this.decryptAndHash(e.ss,t.ns);n&&dc(r)&&(e.rs=r),this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:i,valid:s}=this.decryptAndHash(e.ss,t.ciphertext);return{plaintext:i,valid:n&&s}}readMessageC(e,t){const{plaintext:r,valid:n}=this.decryptAndHash(e.ss,t.ns);if(n&&dc(r)&&(e.rs=r),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:i,valid:s}=this.decryptAndHash(e.ss,t.ciphertext),{cs1:o,cs2:a}=this.split(e.ss);return{h:e.ss.h,plaintext:i,valid:n&&s,cs1:o,cs2:a}}initSession(e,t,r){const n=this.createEmptyKey(),i=new Uint8Array(32);let s;return s=e?this.initializeInitiator(t,r,i,n):this.initializeResponder(t,r,i,n),{hs:s,i:e,mc:0}}sendMessage(e,t,r){let n;if(0===e.mc)n=this.writeMessageA(e.hs,t,r);else if(1===e.mc)n=this.writeMessageB(e.hs,t);else if(2===e.mc){const{h:r,messageBuffer:i,cs1:s,cs2:o}=this.writeMessageC(e.hs,t);n=i,e.h=r,e.cs1=s,e.cs2=o}else{if(!(e.mc>2))throw new Error("Session invalid.");if(e.i){if(!e.cs1)throw new Error("CS1 (cipher state) is not defined");n=this.writeMessageRegular(e.cs1,t)}else{if(!e.cs2)throw new Error("CS2 (cipher state) is not defined");n=this.writeMessageRegular(e.cs2,t)}}return e.mc++,n}recvMessage(e,t){let r=new Uint8Array(0),n=!1;if(0===e.mc)({plaintext:r,valid:n}=this.readMessageA(e.hs,t));else if(1===e.mc)({plaintext:r,valid:n}=this.readMessageB(e.hs,t));else if(2===e.mc){const{h:i,plaintext:s,valid:o,cs1:a,cs2:c}=this.readMessageC(e.hs,t);r=s,n=o,e.h=i,e.cs1=a,e.cs2=c}return e.mc++,{plaintext:r,valid:n}}}class bc{constructor(e,t,r,n,i,s,o,a){this.remoteExtensions={webtransportCerthashes:[]},this.isInitiator=e,this.payload=t,this.prologue=r,this.staticKeypair=i,this.connection=s,o&&(this.remotePeer=o),this.xx=a??new Ec(n),this.session=this.xx.initSession(this.isInitiator,this.prologue,this.staticKeypair)}async propose(){var e;if(e=this.session.hs.s,fc(`LOCAL_STATIC_PUBLIC_KEY ${St(e.publicKey,"hex")}`),fc(`LOCAL_STATIC_PRIVATE_KEY ${St(e.privateKey,"hex")}`),this.isInitiator){pc("Stage 0 - Initiator starting to send first message.");const e=this.xx.sendMessage(this.session,new Uint8Array(0));this.connection.writeLP(function(e){return Bt([e.ne,e.ciphertext],e.ne.length+e.ciphertext.length)}(e)),pc("Stage 0 - Initiator finished sending first message."),yc(this.session.hs.e)}else{pc("Stage 0 - Responder waiting to receive first message...");const e=function(e){if(e.length<32)throw new Error("Cannot decode stage 0 MessageBuffer: length less than 32 bytes.");return{ne:e.subarray(0,32),ciphertext:e.subarray(32,e.length),ns:new Uint8Array(0)}}((await this.connection.readLP()).subarray()),{valid:t}=this.xx.recvMessage(this.session,e);if(!t)throw new Oi("xx handshake stage 0 validation fail");pc("Stage 0 - Responder received first message."),gc(this.session.hs.re)}}async exchange(){if(this.isInitiator){pc("Stage 1 - Initiator waiting to receive first message from responder...");const t=function(e){if(e.length<80)throw new Error("Cannot decode stage 1 MessageBuffer: length less than 80 bytes.");return{ne:e.subarray(0,32),ns:e.subarray(32,80),ciphertext:e.subarray(80,e.length)}}((await this.connection.readLP()).subarray()),{plaintext:r,valid:n}=this.xx.recvMessage(this.session,t);if(!n)throw new Oi("xx handshake stage 1 validation fail");pc("Stage 1 - Initiator received the message."),gc(this.session.hs.re),e=this.session.hs.rs,fc(`REMOTE_STATIC_PUBLIC_KEY ${St(e,"hex")}`),pc("Initiator going to check remote's signature...");try{const e=lc(r);this.remotePeer=this.remotePeer||await cc(e),await hc(this.session.hs.rs,e,this.remotePeer),this.setRemoteNoiseExtension(e.extensions)}catch(e){throw new Bi(`Error occurred while verifying signed payload: ${e.message}`)}pc("All good with the signature!")}else{pc("Stage 1 - Responder sending out first message with signed payload and static key.");const e=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(function(e){return Bt([e.ne,e.ns,e.ciphertext],e.ne.length+e.ns.length+e.ciphertext.length)}(e)),pc("Stage 1 - Responder sent the second handshake message with signed payload."),yc(this.session.hs.e)}var e}async finish(){if(this.isInitiator){pc("Stage 2 - Initiator sending third handshake message.");const e=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(function(e){return Bt([e.ns,e.ciphertext],e.ns.length+e.ciphertext.length)}(e)),pc("Stage 2 - Initiator sent message with signed payload.")}else{pc("Stage 2 - Responder waiting for third handshake message...");const e=function(e){if(e.length<48)throw new Error("Cannot decode stage 2 MessageBuffer: length less than 48 bytes.");return{ne:new Uint8Array(0),ns:e.subarray(0,48),ciphertext:e.subarray(48,e.length)}}((await this.connection.readLP()).subarray()),{plaintext:t,valid:r}=this.xx.recvMessage(this.session,e);if(!r)throw new Oi("xx handshake stage 2 validation fail");pc("Stage 2 - Responder received the message, finished handshake.");try{const e=lc(t);this.remotePeer=this.remotePeer||await cc(e),await hc(this.session.hs.rs,e,this.remotePeer),this.setRemoteNoiseExtension(e.extensions)}catch(e){throw new Bi(`Error occurred while verifying signed payload: ${e.message}`)}}var e;(e=this.session).cs1&&e.cs2?(fc(`CIPHER_STATE_1 ${e.cs1.n.getUint64()} ${St(e.cs1.k,"hex")}`),fc(`CIPHER_STATE_2 ${e.cs2.n.getUint64()} ${St(e.cs2.k,"hex")}`)):fc("Missing cipher state.")}encrypt(e,t){const r=this.getCS(t);return this.xx.encryptWithAd(r,new Uint8Array(0),e)}decrypt(e,t,r){const n=this.getCS(t,!1);return this.xx.decryptWithAd(n,new Uint8Array(0),e,r)}getRemoteStaticKey(){return this.session.hs.rs}getCS(e,t=!0){if(!e.cs1||!e.cs2)throw new Oi("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?t?e.cs1:e.cs2:t?e.cs2:e.cs1}setRemoteNoiseExtension(e){e&&(this.remoteExtensions=e)}}class vc{constructor(e={}){this.protocol="/noise";const{staticNoiseKey:t,extensions:r,crypto:n,prologueBytes:i,metrics:s}=e;this.crypto=n??Li,this.extensions=r,this.metrics=s?function(e){return{xxHandshakeSuccesses:e.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:e.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:e.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:e.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:e.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}(s):void 0,this.staticKeys=t?this.crypto.generateX25519KeyPairFromSeed(t):this.crypto.generateX25519KeyPair(),this.prologue=i??new Uint8Array(0)}async secureOutbound(e,t,r){const n=mi(t,{lengthEncoder:Di,lengthDecoder:Pi,maxDataLength:Ai}),i=await this.performHandshake({connection:n,isInitiator:!0,localPeer:e,remotePeer:r});return{conn:await this.createSecureConnection(n,i),remoteExtensions:i.remoteExtensions,remotePeer:i.remotePeer}}async secureInbound(e,t,r){const n=mi(t,{lengthEncoder:Di,lengthDecoder:Pi,maxDataLength:Ai}),i=await this.performHandshake({connection:n,isInitiator:!1,localPeer:e,remotePeer:r});return{conn:await this.createSecureConnection(n,i),remotePeer:i.remotePeer,remoteExtensions:i.remoteExtensions}}async performHandshake(e){const t=await async function(e,t,r){const n=await async function(e,t){if(null==e.privateKey)throw new Error("PrivateKey was missing from PeerId");const r=await ja(e.privateKey);return await r.sign(t)}(e,uc(t));if(null==e.publicKey)throw new Error("PublicKey was missing from local PeerId");return function(e,t,r){return ac.encode({identityKey:e,identitySig:t,extensions:r??{webtransportCerthashes:[]}}).subarray()}(e.publicKey,n,r)}(e.localPeer,this.staticKeys.publicKey,this.extensions);return await this.performXXHandshake(e,t)}async performXXHandshake(e,t){const{isInitiator:r,remotePeer:n,connection:i}=e,s=new bc(r,t,this.prologue,this.crypto,this.staticKeys,i,n);try{await s.propose(),await s.exchange(),await s.finish(),this.metrics?.xxHandshakeSuccesses.increment()}catch(e){if(this.metrics?.xxHandshakeErrors.increment(),e instanceof Error)throw e.message=`Error occurred during XX handshake: ${e.message}`,e}return s}async createSecureConnection(e,t){const[r,n]=function(){const e=wi(),t=wi();return[{source:e.source,sink:t.sink},{source:t.source,sink:e.sink}]}(),i=e.unwrap();return await Ci(r,function(e,t){return async function*(r){for await(const n of r)for(let r=0;r<n.length;r+=65519){let i=r+65519;i>n.length&&(i=n.length);const s=e.encrypt(n.subarray(r,i),e.session);t?.encryptedPackets.increment(),yield Di(s.byteLength),yield s}}}(t,this.metrics),i,gi({lengthDecoder:Pi}),function(e,t){return async function*(r){for await(const n of r)for(let r=0;r<n.length;r+=Ai){let i=r+Ai;if(i>n.length&&(i=n.length),i-Ni.pg<r)throw new Error("Invalid chunk");const s=n.subarray(r,i),o=n.subarray(r,i-Ni.pg),{plaintext:a,valid:c}=e.decrypt(s,e.session,o);if(!c)throw t?.decryptErrors.increment(),new Error("Failed to validate decrypted chunk");t?.decryptedPackets.increment(),yield a}}}(t,this.metrics),r),n}}function _c(e={}){return()=>new vc(e)}var Sc=128,Cc=-128,Ac=Math.pow(2,31),Ic=128,Tc=127,Rc=Math.pow(2,7),kc=Math.pow(2,14),Nc=Math.pow(2,21),Lc=Math.pow(2,28),Dc=Math.pow(2,35),Pc=Math.pow(2,42),Bc=Math.pow(2,49),Oc=Math.pow(2,56),xc=Math.pow(2,63);const Uc={encode:function e(t,r,n){r=r||[];for(var i=n=n||0;t>=Ac;)r[n++]=255&t|Sc,t/=128;for(;t&Cc;)r[n++]=255&t|Sc,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},decode:function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&Tc)<<s:(n&Tc)*Math.pow(2,s),s+=7}while(n>=Ic);return e.bytes=o-r,i},encodingLength:function(e){return e<Rc?1:e<kc?2:e<Nc?3:e<Lc?4:e<Dc?5:e<Pc?6:e<Bc?7:e<Oc?8:e<xc?9:10}},Mc=(e,t=0)=>[Uc.decode(e,t),Uc.decode.bytes],Vc=(e,t,r=0)=>(Uc.encode(e,t,r),t),Kc=e=>Uc.encodingLength(e),Fc=(new Uint8Array(0),e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}),qc=(e,t)=>{const r=t.byteLength,n=Kc(e),i=n+Kc(r),s=new Uint8Array(i+r);return Vc(e,s,0),Vc(r,s,n),s.set(t,i),new Hc(e,r,t,s)},jc=e=>{const t=Fc(e),[r,n]=Mc(t),[i,s]=Mc(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Hc(r,i,o,t)};class Hc{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const zc=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*l+1>>>0,o=new Uint8Array(s);e[t];){var u=r[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=s-1;(0!==u||h<i)&&-1!==d;d--,h++)u+=a*o[d]>>>0,o[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var p=s-i;p!==s&&0===o[p];)p++;for(var f=new Uint8Array(n+(s-p)),y=n;p!==s;)f[y++]=o[p++];return f}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*u+1>>>0,l=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,p=o-1;(0!==h||d<n)&&-1!==p;p--,d++)h+=256*l[p]>>>0,l[p]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,i++}for(var f=o-n;f!==o&&0===l[f];)f++;for(var y=c.repeat(r);f<o;++f)y+=e.charAt(l[f]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}};class $c{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Gc{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return Yc(this,e)}}class Wc{constructor(e){this.decoders=e}or(e){return Yc(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Yc=(e,t)=>new Wc({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class Qc{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new $c(e,t,r),this.decoder=new Gc(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Xc=({name:e,prefix:t,encode:r,decode:n})=>new Qc(e,t,r,n),Zc=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=zc(r,t);return Xc({prefix:e,name:t,encode:n,decode:e=>Fc(i(e))})},Jc=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>Xc({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,l=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),el=Zc({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),tl=Zc({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),rl=Jc({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),nl=Jc({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),il=Jc({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),sl=Jc({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ol=Jc({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),al=Jc({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),cl=Jc({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ll=Jc({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ul=Jc({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),hl=new WeakMap,dl=e=>{const t=hl.get(e);if(null==t){const t=new Map;return hl.set(e,t),t}return t};class pl{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==ml)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==wl)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return pl.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=qc(e,t);return pl.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return pl.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return((e,t)=>{const{bytes:r,version:n}=e;return 0===n?yl(r,dl(e),t||el.encoder):gl(r,dl(e),t||rl.encoder)})(this,e)}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof pl)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new pl(e,r,n,i||El(e,r,n.bytes))}if(!0===t[bl]){const{version:e,multihash:r,code:n}=t,i=jc(r);return pl.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==ml)throw new Error(`Version 0 CID must use dag-pb (code: ${ml}) block encoding`);return new pl(e,t,r,r.bytes);case 1:{const n=El(e,t,r.bytes);return new pl(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return pl.create(0,ml,e)}static createV1(e,t){return pl.create(1,e,t)}static decode(e){const[t,r]=pl.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=pl.inspectBytes(e),r=t.size-t.multihashSize,n=Fc(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Hc(t.multihashCode,t.digestSize,i,n);return[0===t.version?pl.createV0(s):pl.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=Mc(e.subarray(t));return t+=n,r};let n=r(),i=ml;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=fl(e,t),i=pl.decode(n);return dl(i).set(r,e),i}}const fl=(e,t)=>{switch(e[0]){case"Q":{const r=t||el;return[el.prefix,r.decode(`${el.prefix}${e}`)]}case el.prefix:{const r=t||el;return[el.prefix,r.decode(e)]}case rl.prefix:{const r=t||rl;return[rl.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},yl=(e,t,r)=>{const{prefix:n}=r;if(n!==el.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const i=r.encode(e).slice(1);return t.set(n,i),i}return i},gl=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},ml=112,wl=18,El=(e,t,r)=>{const n=Kc(e),i=n+Kc(t),s=new Uint8Array(i+r.byteLength);return Vc(e,s,0),Vc(t,s,n),s.set(r,i),s},bl=Symbol.for("@ipld/js-cid/CID"),vl=Xc({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),_l=Jc({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Sl=Jc({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Cl=Zc({prefix:"9",name:"base10",alphabet:"0123456789"}),Al=Jc({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Il=Jc({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Tl=Zc({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Rl=Zc({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),kl=Jc({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Nl=Jc({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ll=Jc({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Dl=Jc({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Pl=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Bl=Pl.reduce(((e,t,r)=>(e[r]=t,e)),[]),Ol=Pl.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]),xl=Xc({prefix:"🚀",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+Bl[t]),"")},decode:function(e){const t=[];for(const r of e){const e=Ol[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}}),Ul=({name:e,code:t,encode:r})=>new Ml(e,t,r);class Ml{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?qc(this.code,t):t.then((e=>qc(this.code,e)))}throw Error("Unknown type, must be binary type")}}const Vl=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Kl=Ul({name:"sha2-256",code:18,encode:Vl("SHA-256")}),Fl=Ul({name:"sha2-512",code:19,encode:Vl("SHA-512")}),ql=Fc,jl={code:0,name:"identity",encode:ql,digest:e=>qc(0,ql(e))},Hl="raw",zl=85,$l=e=>Fc(e),Gl=e=>Fc(e),Wl=new TextEncoder,Yl=new TextDecoder,Ql="json",Xl=512,Zl=e=>Wl.encode(JSON.stringify(e)),Jl=e=>JSON.parse(Yl.decode(e)),eu={...E,...b,...v,..._,...S,...w,...C,...m,...A,...I},tu=Symbol.for("@libp2p/peer-id"),ru=Symbol.for("nodejs.util.inspect.custom"),nu=Object.values(eu).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),eu.identity.decoder),iu=114,su=36,ou=37;class au{constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}get[tu](){return!0}toString(){return null==this.string&&(this.string=el.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return pl.createV1(iu,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return Xt(this.multihash.bytes,e);if("string"==typeof e)return hu(e).equals(this);if(null!=e?.multihash?.bytes)return Xt(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[ru](){return`PeerId(${this.toString()})`}}class cu extends au{constructor(e){super({...e,type:"RSA"}),this.type="RSA",this.publicKey=e.publicKey}}class lu extends au{constructor(e){super({...e,type:"Ed25519"}),this.type="Ed25519",this.publicKey=e.multihash.digest}}class uu extends au{constructor(e){super({...e,type:"secp256k1"}),this.type="secp256k1",this.publicKey=e.multihash.digest}}function hu(e,t){if(t=t??nu,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=jc(el.decode(`z${e}`));return e.startsWith("12D")?new lu({multihash:t}):e.startsWith("16U")?new uu({multihash:t}):new cu({multihash:t})}return function(e){try{const t=jc(e);if(t.code===jl.code){if(t.digest.length===su)return new lu({multihash:t});if(t.digest.length===ou)return new uu({multihash:t})}if(t.code===Kl.code)return new cu({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==iu)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===Kl.code)return new cu({multihash:e.multihash});if(t.code===jl.code){if(t.digest.length===su)return new lu({multihash:e.multihash});if(t.digest.length===ou)return new uu({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(pl.decode(e))}throw new Error("Supplied PeerID CID is invalid")}(nu.decode(e))}const du=Symbol.for("@libp2p/peer-discovery"),pu=ne("libp2p:bootstrap");class fu extends Wr{constructor(e,t={list:[]}){if(null==t.list||0===t.list.length)throw new Error("Bootstrap requires a list of peer addresses");super(),this.components=e,this.timeout=t.timeout??1e3,this.list=[];for(const e of t.list){if(!Br.matches(e)){pu.error("Invalid multiaddr");continue}const t=hr(e),r=t.getPeerId();if(null==r){pu.error("Invalid bootstrap multiaddr without peer id");continue}const n={id:hu(r),multiaddrs:[t],protocols:[]};this.list.push(n)}this._init=t}get[du](){return!0}get[Symbol.toStringTag](){return"@libp2p/bootstrap"}isStarted(){return Boolean(this.timer)}start(){this.isStarted()||(pu("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout((()=>{this._discoverBootstrapPeers().catch((e=>{pu.error(e)}))}),this.timeout))}async _discoverBootstrapPeers(){if(null!=this.timer)for(const e of this.list){if(await this.components.peerStore.tagPeer(e.id,this._init.tagName??"bootstrap",{value:this._init.tagValue??50,ttl:this._init.tagTTL??12e4}),null==this.timer)return;this.dispatchEvent(new Qr("peer",{detail:e}))}}stop(){null!=this.timer&&clearTimeout(this.timer),this.timer=void 0}}function yu(e){return null!=e&&"function"==typeof e.start&&"function"==typeof e.stop}async function gu(e){const t=[];for await(const r of e)t.push(r);return t}fu.tag="bootstrap";const mu=(e,t)=>async function*(){const r=await gu(e);yield*r.sort(t)}();async function wu(e){for await(const t of e);}async function*Eu(e,t){for await(const r of e)await t(r)&&(yield r)}async function*bu(e,t){let r=0;if(!(t<1))for await(const n of e)if(yield n,r++,r===t)return}class vu{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,r){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:r,value:n}of e)await this.put(r,n,t),yield{key:r,value:n}}async*getMany(e,t={}){for await(const r of e)yield this.get(r,t)}async*deleteMany(e,t={}){for await(const r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(t,r){e.push({key:t,value:r})},delete(e){t.push(e)},commit:async r=>{await wu(this.putMany(e,r)),e=[],await wu(this.deleteMany(t,r)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let r=this._all(e,t);if(null!=e.prefix&&(r=Eu(r,(t=>t.key.toString().startsWith(e.prefix)))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>Eu(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>mu(e,t)),r)),null!=e.offset){let t=0;r=Eu(r,(()=>t++>=e.offset))}return null!=e.limit&&(r=bu(r,e.limit)),r}queryKeys(e,t){let r=this._allKeys(e,t);if(null!=e.prefix&&(r=Eu(r,(t=>t.toString().startsWith(e.prefix)))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>Eu(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>mu(e,t)),r)),null!=e.offset){let t=0;r=Eu(r,(()=>t++>=e.offset))}return null!=e.limit&&(r=bu(r,e.limit)),r}}let _u=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>e+((t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_")),"");const Su="/",Cu=(new TextEncoder).encode(Su),Au=Cu[0];class Iu{constructor(e,t){if("string"==typeof e)this._buf=Pt(e);else{if(!(e instanceof Uint8Array))throw new Error("Invalid key, should be String of Uint8Array");this._buf=e}if(null==t&&(t=!0),t&&this.clean(),0===this._buf.byteLength||this._buf[0]!==Au)throw new Error("Invalid key")}toString(e="utf8"){return St(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new Iu(e.join(Su))}static random(){return new Iu(_u().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||"string"==typeof e?new Iu(e):"function"==typeof e.uint8Array?new Iu(e.uint8Array()):null}clean(){if(null!=this._buf&&0!==this._buf.byteLength||(this._buf=Cu),this._buf[0]!==Au){const e=new Uint8Array(this._buf.byteLength+1);e.fill(Au,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===Au;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),r=e.list();for(let e=0;e<t.length;e++){if(r.length<e+1)return!1;const n=t[e],i=r[e];if(n<i)return!0;if(n>i)return!1}return t.length<r.length}reverse(){return Iu.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Su).slice(1)}type(){return function(e){const t=e.split(":");return t.length<2?"":t.slice(0,-1).join(":")}(this.baseNamespace())}name(){return function(e){const t=e.split(":");return t[t.length-1]}(this.baseNamespace())}instance(e){return new Iu(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Su)||(e+=Su),e+=this.type(),new Iu(e)}parent(){const e=this.list();return 1===e.length?new Iu(Su):new Iu(e.slice(0,-1).join(Su))}child(e){return this.toString()===Su?e:e.toString()===Su?this:new Iu(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()!==this.toString()&&e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()!==this.toString()&&this.toString().startsWith(e.toString())}isTopLevel(){return 1===this.list().length}concat(...e){return Iu.withNamespaces([...this.namespaces(),...(t=e.map((e=>e.namespaces())),[].concat(...t))]);var t}}class Tu extends vu{constructor(){super(),this.data={}}open(){return Promise.resolve()}close(){return Promise.resolve()}async put(e,t){this.data[e.toString()]=t}async get(e){if(!await this.has(e))throw t=t||new Error("Not Found"),Qt(t,"ERR_NOT_FOUND");var t;return this.data[e.toString()]}async has(e){return void 0!==this.data[e.toString()]}async delete(e){delete this.data[e.toString()]}async*_all(){yield*Object.entries(this.data).map((([e,t])=>({key:new Iu(e),value:t})))}async*_allKeys(){yield*Object.entries(this.data).map((([e])=>new Iu(e)))}}var Ru,ku;async function*Nu(e,t){yield*async function*(e,t){for await(const r of e)yield t(r)}(e,(async e=>(await t.addressBook.add(e.id,e.multiaddrs),e)))}function Lu(e){const t=new Set;return Eu(e,(e=>!t.has(e.id.toString())&&(t.add(e.id.toString()),!0)))}async function*Du(e,t=1){let r=0;for await(const t of e)r++,yield t;if(r<t)throw Qt(new Error("not found"),"NOT_FOUND")}!function(e){e.NOT_STARTED_YET="The libp2p node is not started yet",e.DHT_DISABLED="DHT is not available",e.PUBSUB_DISABLED="PubSub is not available",e.CONN_ENCRYPTION_REQUIRED="At least one connection encryption module is required",e.ERR_TRANSPORTS_REQUIRED="At least one transport module is required",e.ERR_PROTECTOR_REQUIRED="Private network is enforced, but no protector was provided",e.NOT_FOUND="Not found"}(Ru||(Ru={})),function(e){e.DHT_DISABLED="ERR_DHT_DISABLED",e.ERR_PUBSUB_DISABLED="ERR_PUBSUB_DISABLED",e.PUBSUB_NOT_STARTED="ERR_PUBSUB_NOT_STARTED",e.DHT_NOT_STARTED="ERR_DHT_NOT_STARTED",e.CONN_ENCRYPTION_REQUIRED="ERR_CONN_ENCRYPTION_REQUIRED",e.ERR_TRANSPORTS_REQUIRED="ERR_TRANSPORTS_REQUIRED",e.ERR_PROTECTOR_REQUIRED="ERR_PROTECTOR_REQUIRED",e.ERR_PEER_DIAL_INTERCEPTED="ERR_PEER_DIAL_INTERCEPTED",e.ERR_CONNECTION_INTERCEPTED="ERR_CONNECTION_INTERCEPTED",e.ERR_INVALID_PROTOCOLS_FOR_STREAM="ERR_INVALID_PROTOCOLS_FOR_STREAM",e.ERR_CONNECTION_ENDED="ERR_CONNECTION_ENDED",e.ERR_CONNECTION_FAILED="ERR_CONNECTION_FAILED",e.ERR_NODE_NOT_STARTED="ERR_NODE_NOT_STARTED",e.ERR_ALREADY_ABORTED="ERR_ALREADY_ABORTED",e.ERR_TOO_MANY_ADDRESSES="ERR_TOO_MANY_ADDRESSES",e.ERR_NO_VALID_ADDRESSES="ERR_NO_VALID_ADDRESSES",e.ERR_RELAYED_DIAL="ERR_RELAYED_DIAL",e.ERR_DIALED_SELF="ERR_DIALED_SELF",e.ERR_DISCOVERED_SELF="ERR_DISCOVERED_SELF",e.ERR_DUPLICATE_TRANSPORT="ERR_DUPLICATE_TRANSPORT",e.ERR_ENCRYPTION_FAILED="ERR_ENCRYPTION_FAILED",e.ERR_HOP_REQUEST_FAILED="ERR_HOP_REQUEST_FAILED",e.ERR_INVALID_KEY="ERR_INVALID_KEY",e.ERR_INVALID_MESSAGE="ERR_INVALID_MESSAGE",e.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",e.ERR_INVALID_PEER="ERR_INVALID_PEER",e.ERR_MUXER_UNAVAILABLE="ERR_MUXER_UNAVAILABLE",e.ERR_NOT_FOUND="ERR_NOT_FOUND",e.ERR_TIMEOUT="ERR_TIMEOUT",e.ERR_TRANSPORT_UNAVAILABLE="ERR_TRANSPORT_UNAVAILABLE",e.ERR_TRANSPORT_DIAL_FAILED="ERR_TRANSPORT_DIAL_FAILED",e.ERR_UNSUPPORTED_PROTOCOL="ERR_UNSUPPORTED_PROTOCOL",e.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED="ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED",e.ERR_INVALID_MULTIADDR="ERR_INVALID_MULTIADDR",e.ERR_SIGNATURE_NOT_VALID="ERR_SIGNATURE_NOT_VALID",e.ERR_FIND_SELF="ERR_FIND_SELF",e.ERR_NO_ROUTERS_AVAILABLE="ERR_NO_ROUTERS_AVAILABLE",e.ERR_CONNECTION_NOT_MULTIPLEXED="ERR_CONNECTION_NOT_MULTIPLEXED",e.ERR_NO_DIAL_TOKENS="ERR_NO_DIAL_TOKENS",e.ERR_KEYCHAIN_REQUIRED="ERR_KEYCHAIN_REQUIRED",e.ERR_INVALID_CMS="ERR_INVALID_CMS",e.ERR_MISSING_KEYS="ERR_MISSING_KEYS",e.ERR_NO_KEY="ERR_NO_KEY",e.ERR_INVALID_KEY_NAME="ERR_INVALID_KEY_NAME",e.ERR_INVALID_KEY_TYPE="ERR_INVALID_KEY_TYPE",e.ERR_KEY_ALREADY_EXISTS="ERR_KEY_ALREADY_EXISTS",e.ERR_INVALID_KEY_SIZE="ERR_INVALID_KEY_SIZE",e.ERR_KEY_NOT_FOUND="ERR_KEY_NOT_FOUND",e.ERR_OLD_KEY_NAME_INVALID="ERR_OLD_KEY_NAME_INVALID",e.ERR_NEW_KEY_NAME_INVALID="ERR_NEW_KEY_NAME_INVALID",e.ERR_PASSWORD_REQUIRED="ERR_PASSWORD_REQUIRED",e.ERR_PEM_REQUIRED="ERR_PEM_REQUIRED",e.ERR_CANNOT_READ_KEY="ERR_CANNOT_READ_KEY",e.ERR_MISSING_PRIVATE_KEY="ERR_MISSING_PRIVATE_KEY",e.ERR_MISSING_PUBLIC_KEY="ERR_MISSING_PUBLIC_KEY",e.ERR_INVALID_OLD_PASS_TYPE="ERR_INVALID_OLD_PASS_TYPE",e.ERR_INVALID_NEW_PASS_TYPE="ERR_INVALID_NEW_PASS_TYPE",e.ERR_INVALID_PASS_LENGTH="ERR_INVALID_PASS_LENGTH",e.ERR_NOT_IMPLEMENTED="ERR_NOT_IMPLEMENTED",e.ERR_WRONG_PING_ACK="ERR_WRONG_PING_ACK",e.ERR_INVALID_RECORD="ERR_INVALID_RECORD",e.ERR_ALREADY_SUCCEEDED="ERR_ALREADY_SUCCEEDED",e.ERR_NO_HANDLER_FOR_PROTOCOL="ERR_NO_HANDLER_FOR_PROTOCOL",e.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS",e.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS",e.ERR_CONNECTION_DENIED="ERR_CONNECTION_DENIED"}(ku||(ku={}));var Pu=__webpack_require__(715);async function Bu(e){for await(const t of e)return t}var Ou=__webpack_require__(7695),xu=__webpack_require__(7187);const Uu=ne("libp2p:peer-routing");class Mu{constructor(e,t){this.components=e,this.routers=t.routers??[],this.refreshManagerInit=t.refreshManager??{},this.started=!1,this._findClosestPeersTask=this._findClosestPeersTask.bind(this)}isStarted(){return this.started}async start(){this.started||0===this.routers.length||null!=this.timeoutId||!1===this.refreshManagerInit.enabled||(this.timeoutId=(0,Ou.setDelayedInterval)(this._findClosestPeersTask,this.refreshManagerInit.interval,this.refreshManagerInit.bootDelay),this.started=!0)}async _findClosestPeersTask(){if(null==this.abortController)try{this.abortController=new Pu.TimeoutController(this.refreshManagerInit.timeout??1e4);try{(0,xu.setMaxListeners)?.(1/0,this.abortController.signal)}catch{}await wu(this.getClosestPeers(this.components.peerId.toBytes(),{signal:this.abortController.signal}))}catch(e){Uu.error(e)}finally{this.abortController?.clear(),this.abortController=void 0}}async stop(){(0,Ou.clearDelayedInterval)(this.timeoutId),this.abortController?.abort(),this.started=!1}async findPeer(e,t){if(0===this.routers.length)throw Qt(new Error("No peer routers available"),ku.ERR_NO_ROUTERS_AVAILABLE);if(e.toString()===this.components.peerId.toString())throw Qt(new Error("Should not try to find self"),ku.ERR_FIND_SELF);const r=await Ci(Ei(...this.routers.map((r=>async function*(){try{yield await r.findPeer(e,t)}catch(e){Uu.error(e)}}()))),(e=>Eu(e,Boolean)),(e=>Nu(e,this.components.peerStore)),(async e=>await Bu(e)));if(null!=r)return r;throw Qt(new Error(Ru.NOT_FOUND),ku.ERR_NOT_FOUND)}async*getClosestPeers(e,t){if(0===this.routers.length)throw Qt(new Error("No peer routers available"),ku.ERR_NO_ROUTERS_AVAILABLE);yield*Ci(Ei(...this.routers.map((r=>r.getClosestPeers(e,t)))),(e=>Nu(e,this.components.peerStore)),(e=>Lu(e)),(e=>Du(e)))}}class Vu{constructor(e,t){this.routers=t.routers??[],this.started=!1,this.components=e}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,t={}){if(0===this.routers.length)throw Qt(new Error("No content this.routers available"),ku.ERR_NO_ROUTERS_AVAILABLE);yield*Ci(Ei(...this.routers.map((r=>r.findProviders(e,t)))),(e=>Nu(e,this.components.peerStore)),(e=>Lu(e)),(e=>Du(e)))}async provide(e,t={}){if(0===this.routers.length)throw Qt(new Error("No content routers available"),ku.ERR_NO_ROUTERS_AVAILABLE);await Promise.all(this.routers.map((async r=>await r.provide(e,t))))}async put(e,t,r){if(!this.isStarted())throw Qt(new Error(Ru.NOT_STARTED_YET),ku.DHT_NOT_STARTED);const n=this.components.dht;null!=n&&await wu(n.put(e,t,r))}async get(e,t){if(!this.isStarted())throw Qt(new Error(Ru.NOT_STARTED_YET),ku.DHT_NOT_STARTED);const r=this.components.dht;if(null!=r)for await(const n of r.get(e,t))if("VALUE"===n.name)return n.value;throw Qt(new Error(Ru.NOT_FOUND),ku.ERR_NOT_FOUND)}async*getMany(e,t,r){if(!this.isStarted())throw Qt(new Error(Ru.NOT_STARTED_YET),ku.DHT_NOT_STARTED);if(null==t||0===t)return;let n=0;const i=this.components.dht;if(null!=i)for await(const s of i.get(e,r))if("VALUE"===s.name&&(yield{from:s.from,val:s.value},n++,n===t))break;if(0===n)throw Qt(new Error(Ru.NOT_FOUND),ku.ERR_NOT_FOUND)}}const Ku=e=>e;class Fu extends Wr{constructor(e,t){super();const{listen:r=[],announce:n=[]}=t;this.components=e,this.listen=r.map((e=>e.toString())),this.announce=new Set(n.map((e=>e.toString()))),this.observed=new Set,this.announceFilter=t.announceFilter??Ku}getListenAddrs(){return Array.from(this.listen).map((e=>hr(e)))}getAnnounceAddrs(){return Array.from(this.announce).map((e=>hr(e)))}getObservedAddrs(){return Array.from(this.observed).map((e=>hr(e)))}confirmObservedAddr(e){}removeObservedAddr(e){}addObservedAddr(e){let t=hr(e);const r=t.getPeerId();null!=r&&nc(r).equals(this.components.peerId)&&(t=t.decapsulate(hr(`/p2p/${this.components.peerId.toString()}`)));const n=t.toString();this.observed.has(n)||(this.observed.add(n),this.dispatchEvent(new Qr("change:addresses")))}getAddresses(){let e=this.getAnnounceAddrs().map((e=>e.toString()));0===e.length&&(e=this.components.transportManager.getAddrs().map((e=>e.toString()))),e=e.concat(this.getObservedAddrs().map((e=>e.toString())));const t=new Set(e);return this.announceFilter(Array.from(t).map((e=>hr(e)))).map((e=>!0===e.protos().pop()?.path||e.getPeerId()===this.components.peerId.toString()?e:e.encapsulate(`/p2p/${this.components.peerId.toString()}`)))}}const qu=__webpack_require__(942),ju=ne("libp2p:connection-manager:latency-monitor:visibility-change-emitter");class Hu extends Wr{constructor(){super(),this.hidden="hidden",this.visibilityChange="visibilityChange",null!=globalThis.document&&(this._initializeVisibilityVarNames(),this._addVisibilityChangeListener())}_initializeVisibilityVarNames(){let e="hidden",t="visibilitychange";void 0!==globalThis.document.hidden?(e="hidden",t="visibilitychange"):void 0!==globalThis.document.mozHidden?(e="mozHidden",t="mozvisibilitychange"):void 0!==globalThis.document.msHidden?(e="msHidden",t="msvisibilitychange"):void 0!==globalThis.document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),this.hidden=e,this.visibilityChange=t}_addVisibilityChangeListener(){void 0===globalThis.document.addEventListener||void 0===document[this.hidden]?ju("Checking page visibility requires a browser that supports the Page Visibility API."):globalThis.document.addEventListener(this.visibilityChange,this._handleVisibilityChange.bind(this),!1)}isVisible(){if(void 0!==this.hidden&&void 0!==document[this.hidden])return null==document[this.hidden]}_handleVisibilityChange(){const e=!1===globalThis.document[this.hidden];ju(e?"Page Visible":"Page Hidden"),this.dispatchEvent(new Qr("visibilityChange",{detail:e}))}}const zu=ne("libp2p:connection-manager:latency-monitor");class $u extends Wr{constructor(e={}){super();const{latencyCheckIntervalMs:t,dataEmitIntervalMs:r,asyncTestFn:n,latencyRandomPercentage:i}=e;this.latencyCheckIntervalMs=t??500,this.latencyRandomPercentage=i??10,this.latencyCheckMultiply=this.latencyRandomPercentage/100*2*this.latencyCheckIntervalMs,this.latencyCheckSubtract=this.latencyCheckMultiply/2,this.dataEmitIntervalMs=null===r||0===r?void 0:r??5e3,zu("latencyCheckIntervalMs: %s dataEmitIntervalMs: %s",this.latencyCheckIntervalMs,this.dataEmitIntervalMs),null!=this.dataEmitIntervalMs?zu("Expecting ~%s events per summary",this.latencyCheckIntervalMs/this.dataEmitIntervalMs):zu("Not emitting summaries"),this.asyncTestFn=n,null!=globalThis.process?.hrtime?(zu("Using process.hrtime for timing"),this.now=globalThis.process.hrtime,this.getDeltaMS=e=>{const t=this.now(e);return 1e3*t[0]+t[1]/1e6}):"undefined"!=typeof window&&null!=window.performance?.now?(zu("Using performance.now for timing"),this.now=window.performance.now.bind(window.performance),this.getDeltaMS=e=>Math.round(this.now()-e)):(zu("Using Date.now for timing"),this.now=Date.now,this.getDeltaMS=e=>this.now()-e),this.latencyData=this.initLatencyData()}start(){void 0!==globalThis.window&&(this.visibilityChangeEmitter=new Hu,this.visibilityChangeEmitter.addEventListener("visibilityChange",(e=>{const{detail:t}=e;t?this._startTimers():(this._emitSummary(),this._stopTimers())}))),!0===this.visibilityChangeEmitter?.isVisible()&&this._startTimers()}stop(){this._stopTimers()}_startTimers(){null==this.checkLatencyID&&(this.checkLatency(),null!=this.dataEmitIntervalMs&&(this.emitIntervalID=setInterval((()=>this._emitSummary()),this.dataEmitIntervalMs),"function"==typeof this.emitIntervalID.unref&&this.emitIntervalID.unref()))}_stopTimers(){null!=this.checkLatencyID&&(clearTimeout(this.checkLatencyID),this.checkLatencyID=void 0),null!=this.emitIntervalID&&(clearInterval(this.emitIntervalID),this.emitIntervalID=void 0)}_emitSummary(){const e=this.getSummary();e.events>0&&this.dispatchEvent(new Qr("data",{detail:e}))}getSummary(){const e={events:this.latencyData.events,minMs:this.latencyData.minMs,maxMs:this.latencyData.maxMs,avgMs:this.latencyData.events>0?this.latencyData.totalMs/this.latencyData.events:Number.POSITIVE_INFINITY,lengthMs:this.getDeltaMS(this.latencyData.startTime)};return this.latencyData=this.initLatencyData(),zu.trace("Summary: %O",e),e}checkLatency(){const e=Math.random()*this.latencyCheckMultiply-this.latencyCheckSubtract,t={deltaOffset:Math.ceil(this.latencyCheckIntervalMs+e),startTime:this.now()},r=()=>{if(null==this.checkLatencyID)return;const e=this.getDeltaMS(t.startTime)-t.deltaOffset;this.checkLatency(),this.latencyData.events++,this.latencyData.minMs=Math.min(this.latencyData.minMs,e),this.latencyData.maxMs=Math.max(this.latencyData.maxMs,e),this.latencyData.totalMs+=e,zu.trace("MS: %s Data: %O",e,this.latencyData)};zu.trace("localData: %O",t),this.checkLatencyID=setTimeout((()=>{null!=this.asyncTestFn?(t.deltaOffset=0,t.startTime=this.now(),this.asyncTestFn(r)):(t.deltaOffset-=1,r())}),t.deltaOffset),"function"==typeof this.checkLatencyID.unref&&this.checkLatencyID.unref()}initLatencyData(){return{startTime:this.now(),minMs:Number.POSITIVE_INFINITY,maxMs:Number.NEGATIVE_INFINITY,events:0,totalMs:0}}}const Gu="OPEN",Wu="CLOSING",Yu="CLOSED";function Qu(e,t){const r={[Symbol.iterator]:()=>r,next:()=>{const r=e.next(),n=r.value;return!0===r.done||null==n?{done:!0,value:void 0}:{done:!1,value:t(n)}}};return r}class Xu{constructor(e){if(this.map=new Map,null!=e)for(const[t,r]of e.entries())this.map.set(t.toString(),r)}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){this.map.delete(e.toString())}entries(){return Qu(this.map.entries(),(e=>[nc(e[0]),e[1]]))}forEach(e){this.map.forEach(((t,r)=>{e(t,nc(r),this)}))}get(e){return this.map.get(e.toString())}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),t)}keys(){return Qu(this.map.keys(),(e=>nc(e)))}values(){return this.map.values()}get size(){return this.map.size}}class Zu{constructor(e){if(this.set=new Set,null!=e)for(const t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return Qu(this.set.entries(),(e=>{const t=nc(e[0]);return[t,t]}))}forEach(e){this.set.forEach((t=>{const r=nc(t);e(r,r,this)}))}has(e){return this.set.has(e.toString())}values(){return Qu(this.set.values(),(e=>nc(e)))}intersection(e){const t=new Zu;for(const r of e)this.has(r)&&t.add(r);return t}difference(e){const t=new Zu;for(const r of this)e.has(r)||t.add(r);return t}union(e){const t=new Zu;for(const r of e)t.add(r);for(const e of this)t.add(e);return t}}class Ju{constructor(e){if(this.list=[],null!=e)for(const t of e)this.list.push(t.toString())}[Symbol.iterator](){return mapIterable(this.list.entries(),(e=>peerIdFromString(e[1])))}concat(e){const t=new Ju(this);for(const r of e)t.push(r);return t}entries(){return mapIterable(this.list.entries(),(e=>[e[0],peerIdFromString(e[1])]))}every(e){return this.list.every(((t,r)=>e(peerIdFromString(t),r,this)))}filter(e){const t=new Ju;return this.list.forEach(((r,n)=>{const i=peerIdFromString(r);e(i,n,this)&&t.push(i)})),t}find(e){const t=this.list.find(((t,r)=>e(peerIdFromString(t),r,this)));if(null!=t)return peerIdFromString(t)}findIndex(e){return this.list.findIndex(((t,r)=>e(peerIdFromString(t),r,this)))}forEach(e){this.list.forEach(((t,r)=>{e(peerIdFromString(t),r,this)}))}includes(e){return this.list.includes(e.toString())}indexOf(e){return this.list.indexOf(e.toString())}pop(){const e=this.list.pop();if(null!=e)return peerIdFromString(e)}push(...e){for(const t of e)this.list.push(t.toString())}shift(){const e=this.list.shift();if(null!=e)return peerIdFromString(e)}unshift(...e){let t=this.list.length;for(let t=e.length-1;t>-1;t--)this.list.unshift(e[t].toString());return t}get length(){return this.list.length}}function eh(e){if($a(e))return{peerId:e};if(lr(e)){const t=e.getPeerId();return{multiaddr:e,peerId:null==t?void 0:nc(t)}}throw Qt(new Error(`${e} is not a PeerId or a Multiaddr`),ku.ERR_INVALID_MULTIADDR)}const th=ne("libp2p:connection-manager"),rh={maxConnections:1/0,minConnections:0,maxEventLoopDelay:1/0,pollInterval:2e3,autoDialInterval:1e4,inboundConnectionThreshold:5,maxIncomingPendingConnections:10};class nh extends Wr{constructor(e,t){if(super(),this.opts=qu.call({ignoreUndefined:!0},rh,t),this.opts.maxConnections<this.opts.minConnections)throw Qt(new Error("Connection Manager maxConnections must be greater than minConnections"),ku.ERR_INVALID_PARAMETERS);th("options: %o",this.opts),this.components=e,this.connections=new Map,this.started=!1,null!=t.maxEventLoopDelay&&t.maxEventLoopDelay>0&&t.maxEventLoopDelay!==1/0&&(this.latencyMonitor=new $u({latencyCheckIntervalMs:t.pollInterval,dataEmitIntervalMs:t.pollInterval}));try{(0,xu.setMaxListeners)?.(1/0,this)}catch{}this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.startupReconnectTimeout=t.startupReconnectTimeout??6e4,this.dialTimeout=t.dialTimeout??3e4,this.allow=(t.allow??[]).map((e=>hr(e))),this.deny=(t.deny??[]).map((e=>hr(e))),this.inboundConnectionRateLimiter=new Hn.RateLimiterMemory({points:this.opts.inboundConnectionThreshold,duration:1}),this.incomingPendingConnections=0}isStarted(){return this.started}async start(){this.components.metrics?.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{const e={inbound:0,outbound:0};for(const t of this.connections.values())for(const r of t)"inbound"===r.stat.direction?e.inbound++:e.outbound++;return e}}),this.components.metrics?.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{const e={};for(const t of this.connections.values())for(const r of t)for(const t of r.streams){const r=`${t.stat.direction} ${t.stat.protocol??"unnegotiated"}`;e[r]=(e[r]??0)+1}return e}}),this.components.metrics?.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{const e={};for(const t of this.connections.values())for(const r of t){const t={};for(const e of r.streams){const r=`${e.stat.direction} ${e.stat.protocol??"unnegotiated"}`;t[r]=(t[r]??0)+1}for(const[r,n]of Object.entries(t))e[r]=e[r]??[],e[r].push(n)}const t={};for(let[r,n]of Object.entries(e)){n=n.sort(((e,t)=>e-t));const e=Math.floor(.9*n.length);t[r]=n[e]}return t}}),this.latencyMonitor?.start(),this._onLatencyMeasure=this._onLatencyMeasure.bind(this),this.latencyMonitor?.addEventListener("data",this._onLatencyMeasure),this.started=!0,th("started")}async afterStart(){this.components.upgrader.addEventListener("connection",this.onConnect),this.components.upgrader.addEventListener("connectionEnd",this.onDisconnect),Promise.resolve().then((async()=>{const e=[];for(const t of await this.components.peerStore.all())(await this.components.peerStore.getTags(t.id)).filter((e=>"keep-alive"===e.name)).length>0&&e.push(t.id);this.connectOnStartupController?.clear(),this.connectOnStartupController=new Pu.TimeoutController(this.startupReconnectTimeout);try{(0,xu.setMaxListeners)?.(1/0,this.connectOnStartupController.signal)}catch{}await Promise.all(e.map((async e=>{await this.openConnection(e,{signal:this.connectOnStartupController?.signal}).catch((e=>{th.error(e)}))})))})).catch((e=>{th.error(e)})).finally((()=>{this.connectOnStartupController?.clear()}))}async beforeStop(){this.connectOnStartupController?.abort(),this.components.upgrader.removeEventListener("connection",this.onConnect),this.components.upgrader.removeEventListener("connectionEnd",this.onDisconnect)}async stop(){this.latencyMonitor?.removeEventListener("data",this._onLatencyMeasure),this.latencyMonitor?.stop(),this.started=!1,await this._close(),th("stopped")}async _close(){const e=[];for(const t of this.connections.values())for(const r of t)e.push((async()=>{try{await r.close()}catch(e){th.error(e)}})());th("closing %d connections",e.length),await Promise.all(e),this.connections.clear()}onConnect(e){this._onConnect(e).catch((e=>{th.error(e)}))}async _onConnect(e){const{detail:t}=e;if(!this.started)return void await t.close();const r=t.remotePeer,n=r.toString(),i=this.connections.get(n);null!=i?i.push(t):this.connections.set(n,[t]),null!=r.publicKey&&await this.components.peerStore.keyBook.set(r,r.publicKey);const s=this.getConnections().length,o=s-this.opts.maxConnections;await this._checkMaxLimit("maxConnections",s,o),this.dispatchEvent(new Qr("peer:connect",{detail:t}))}onDisconnect(e){const{detail:t}=e;if(!this.started)return;const r=t.remotePeer.toString();let n=this.connections.get(r);null!=n&&n.length>1?(n=n.filter((e=>e.id!==t.id)),this.connections.set(r,n)):null!=n&&(this.connections.delete(r),this.dispatchEvent(new Qr("peer:disconnect",{detail:t})))}getConnections(e){if(null!=e)return this.connections.get(e.toString())??[];let t=[];for(const e of this.connections.values())t=t.concat(e);return t}async openConnection(e,t={}){const{peerId:r,multiaddr:n}=eh(e);if(null==r&&null==n)throw Qt(new TypeError("Can only open connections to PeerIds or Multiaddrs"),ku.ERR_INVALID_PARAMETERS);if(null!=r){th("dial to",r);const e=this.getConnections(r);if(e.length>0)return th("had an existing connection to %p",r),e[0]}let i;if(null==t?.signal){i=new Pu.TimeoutController(this.dialTimeout),t.signal=i.signal;try{(0,xu.setMaxListeners)?.(1/0,i.signal)}catch{}}try{const r=await this.components.dialer.dial(e,t);let n=this.connections.get(r.remotePeer.toString());null==n&&(n=[],this.connections.set(r.remotePeer.toString(),n));let i=!1;for(const e of n)e.id===r.id&&(i=!0);return i||n.push(r),r}finally{null!=i&&i.clear()}}async closeConnections(e){const t=this.connections.get(e.toString())??[];await Promise.all(t.map((async e=>await e.close())))}getAll(e){if(!$a(e))throw Qt(new Error("peerId must be an instance of peer-id"),ku.ERR_INVALID_PARAMETERS);const t=e.toString(),r=this.connections.get(t);return null!=r?r.filter((e=>e.stat.status===Gu)):[]}_onLatencyMeasure(e){const{detail:t}=e;this._checkMaxLimit("maxEventLoopDelay",t.avgMs,1).catch((e=>{th.error(e)}))}async _checkMaxLimit(e,t,r=1){const n=this.opts[e];null!=n?(th.trace("checking limit of %s. current value: %d of %d",e,t,n),t>n&&(th("%s: limit exceeded: %p, %d/%d, pruning %d connection(s)",this.components.peerId,e,t,n,r),await this._pruneConnections(r))):th.trace("limit %s was not set so it cannot be applied",e)}async _pruneConnections(e){const t=this.getConnections(),r=new Xu;for(const e of t){const t=e.remotePeer;if(r.has(t))continue;const n=await this.components.peerStore.getTags(t);r.set(t,n.reduce(((e,t)=>e+t.value),0))}const n=t.sort(((e,t)=>{const n=r.get(e.remotePeer)??0,i=r.get(t.remotePeer)??0;if(n>i)return 1;if(n<i)return-1;const s=e.stat.timeline.open,o=t.stat.timeline.open;return s<o?1:s>o?-1:0})),i=[];for(const t of n)if(th("too many connections open - closing a connection to %p",t.remotePeer),i.push(t),i.length===e)break;await Promise.all(i.map((async e=>{try{await e.close()}catch(e){th.error(e)}this.onDisconnect(new Qr("connectionEnd",{detail:e}))})))}async acceptIncomingConnection(e){if(this.deny.some((t=>e.remoteAddr.toString().startsWith(t.toString()))))return th("connection from %s refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some((t=>e.remoteAddr.toString().startsWith(t.toString()))))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.opts.maxIncomingPendingConnections)return th("connection from %s refused - incomingPendingConnections exceeded by peer %s",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){const t=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(t,1)}catch{return th("connection from %s refused - inboundConnectionThreshold exceeded by host %s",t,e.remoteAddr),!1}}return this.getConnections().length<this.opts.maxConnections?(this.incomingPendingConnections++,!0):(th("connection from %s refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}}var ih=__webpack_require__(2916);async function*sh(e,t){const r=await gu(e);yield*r.sort(t)}const oh=ne("libp2p:connection-manager:auto-dialler"),ah={enabled:!0,minConnections:0,autoDialInterval:1e4};class ch{constructor(e,t){this.components=e,this.options=qu.call({ignoreUndefined:!0},ah,t),this.running=!1,this._autoDial=this._autoDial.bind(this),oh("options: %j",this.options)}isStarted(){return this.running}async start(){this.options.enabled?(this.running=!0,this._autoDial().catch((e=>{oh.error("could start autodial",e)})),oh("started")):oh("not enabled")}async stop(){this.options.enabled?(this.running=!1,null!=this.autoDialTimeout&&this.autoDialTimeout.clear(),oh("stopped")):oh("not enabled")}async _autoDial(){null!=this.autoDialTimeout&&this.autoDialTimeout.clear();const e=this.options.minConnections;if(this.components.connectionManager.getConnections().length>=e)return void(this.autoDialTimeout=ih(this._autoDial,this.options.autoDialInterval));const t=await this.components.peerStore.all(),r=await Ci(t.sort((()=>Math.random()>.5?1:-1)),(e=>Eu(e,(e=>!e.id.equals(this.components.peerId)))),(e=>sh(e,((e,t)=>t.protocols.length>e.protocols.length||null!=t.id.publicKey&&null==e.id.publicKey?1:-1))),(async e=>await gu(e)));for(let t=0;this.running&&t<r.length&&this.components.connectionManager.getConnections().length<e;t++){if(!this.running)return;const e=r[t];if(0===this.components.connectionManager.getConnections(e.id).length){oh("connecting to a peerStore stored peer %p",e.id);try{await this.components.connectionManager.openConnection(e.id)}catch(e){oh.error("could not connect to peerStore stored peer",e)}}}this.running&&(this.autoDialTimeout=ih(this._autoDial,this.options.autoDialInterval))}}var lh;!function(e){let t,r,n,i,s,o;!function(e){e.SUCCESS="SUCCESS",e.HOP_SRC_ADDR_TOO_LONG="HOP_SRC_ADDR_TOO_LONG",e.HOP_DST_ADDR_TOO_LONG="HOP_DST_ADDR_TOO_LONG",e.HOP_SRC_MULTIADDR_INVALID="HOP_SRC_MULTIADDR_INVALID",e.HOP_DST_MULTIADDR_INVALID="HOP_DST_MULTIADDR_INVALID",e.HOP_NO_CONN_TO_DST="HOP_NO_CONN_TO_DST",e.HOP_CANT_DIAL_DST="HOP_CANT_DIAL_DST",e.HOP_CANT_OPEN_DST_STREAM="HOP_CANT_OPEN_DST_STREAM",e.HOP_CANT_SPEAK_RELAY="HOP_CANT_SPEAK_RELAY",e.HOP_CANT_RELAY_TO_SELF="HOP_CANT_RELAY_TO_SELF",e.STOP_SRC_ADDR_TOO_LONG="STOP_SRC_ADDR_TOO_LONG",e.STOP_DST_ADDR_TOO_LONG="STOP_DST_ADDR_TOO_LONG",e.STOP_SRC_MULTIADDR_INVALID="STOP_SRC_MULTIADDR_INVALID",e.STOP_DST_MULTIADDR_INVALID="STOP_DST_MULTIADDR_INVALID",e.STOP_RELAY_REFUSED="STOP_RELAY_REFUSED",e.MALFORMED_MESSAGE="MALFORMED_MESSAGE"}(t=e.Status||(e.Status={})),function(e){e[e.SUCCESS=100]="SUCCESS",e[e.HOP_SRC_ADDR_TOO_LONG=220]="HOP_SRC_ADDR_TOO_LONG",e[e.HOP_DST_ADDR_TOO_LONG=221]="HOP_DST_ADDR_TOO_LONG",e[e.HOP_SRC_MULTIADDR_INVALID=250]="HOP_SRC_MULTIADDR_INVALID",e[e.HOP_DST_MULTIADDR_INVALID=251]="HOP_DST_MULTIADDR_INVALID",e[e.HOP_NO_CONN_TO_DST=260]="HOP_NO_CONN_TO_DST",e[e.HOP_CANT_DIAL_DST=261]="HOP_CANT_DIAL_DST",e[e.HOP_CANT_OPEN_DST_STREAM=262]="HOP_CANT_OPEN_DST_STREAM",e[e.HOP_CANT_SPEAK_RELAY=270]="HOP_CANT_SPEAK_RELAY",e[e.HOP_CANT_RELAY_TO_SELF=280]="HOP_CANT_RELAY_TO_SELF",e[e.STOP_SRC_ADDR_TOO_LONG=320]="STOP_SRC_ADDR_TOO_LONG",e[e.STOP_DST_ADDR_TOO_LONG=321]="STOP_DST_ADDR_TOO_LONG",e[e.STOP_SRC_MULTIADDR_INVALID=350]="STOP_SRC_MULTIADDR_INVALID",e[e.STOP_DST_MULTIADDR_INVALID=351]="STOP_DST_MULTIADDR_INVALID",e[e.STOP_RELAY_REFUSED=390]="STOP_RELAY_REFUSED",e[e.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE"}(r||(r={})),function(e){e.codec=()=>Zi(r)}(t=e.Status||(e.Status={})),function(e){e.HOP="HOP",e.STOP="STOP",e.STATUS="STATUS",e.CAN_HOP="CAN_HOP"}(n=e.Type||(e.Type={})),function(e){e[e.HOP=1]="HOP",e[e.STOP=2]="STOP",e[e.STATUS=3]="STATUS",e[e.CAN_HOP=4]="CAN_HOP"}(i||(i={})),function(e){e.codec=()=>Zi(i)}(n=e.Type||(e.Type={})),function(e){let t;e.codec=()=>(null==t&&(t=Ji(((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),(!0===r.writeDefaults||null!=e.id&&e.id.byteLength>0)&&(t.uint32(10),t.bytes(e.id)),null!=e.addrs)for(const r of e.addrs)t.uint32(18),t.bytes(r);!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={id:new Uint8Array(0),addrs:[]},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.id=e.bytes();break;case 2:r.addrs.push(e.bytes());break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>Hi(t,e.codec()),e.decode=t=>ji(t,e.codec())}(s=e.Peer||(e.Peer={})),e.codec=()=>(null==o&&(o=Ji(((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.type&&(r.uint32(8),e.Type.codec().encode(t.type,r)),null!=t.srcPeer&&(r.uint32(18),e.Peer.codec().encode(t.srcPeer,r,{writeDefaults:!1})),null!=t.dstPeer&&(r.uint32(26),e.Peer.codec().encode(t.dstPeer,r,{writeDefaults:!1})),null!=t.code&&(r.uint32(32),e.Status.codec().encode(t.code,r)),!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();switch(r>>>3){case 1:n.type=e.Type.codec().decode(t);break;case 2:n.srcPeer=e.Peer.codec().decode(t,t.uint32());break;case 3:n.dstPeer=e.Peer.codec().decode(t,t.uint32());break;case 4:n.code=e.Status.codec().decode(t);break;default:t.skipType(7&r)}}return n}))),o),e.encode=t=>Hi(t,e.codec()),e.decode=t=>ji(t,e.codec())}(lh||(lh={}));const uh=ne("libp2p:stream:converter");function hh(e,t={}){const{stream:r,remoteAddr:n}=e,{sink:i,source:s}=r,o=async function*(){for await(const e of s)yield*e}(),a={async sink(e){null!=t.signal&&(e=qr(e,t.signal));try{await i(e),await c()}catch(e){"aborted"!==e.type&&uh(e)}},source:null!=t.signal?qr(o,t.signal):o,remoteAddr:n,timeline:{open:Date.now(),close:void 0},async close(){await i(async function*(){yield new Uint8Array(0)}()),await c()}};async function c(){return null==a.timeline.close&&(a.timeline.close=Date.now()),await Promise.resolve()}return a}const dh="/libp2p/circuit/relay/0.1.0";function ph(e,t){e.write({type:lh.Type.STATUS,code:t})}function fh(e,t){try{null!=e.dstPeer?.addrs&&e.dstPeer.addrs.forEach((e=>hr(e)))}catch(r){throw ph(t,e.type===lh.Type.HOP?lh.Status.HOP_DST_MULTIADDR_INVALID:lh.Status.STOP_DST_MULTIADDR_INVALID),r}try{null!=e.srcPeer?.addrs&&e.srcPeer.addrs.forEach((e=>hr(e)))}catch(r){throw ph(t,e.type===lh.Type.HOP?lh.Status.HOP_SRC_MULTIADDR_INVALID:lh.Status.STOP_SRC_MULTIADDR_INVALID),r}}const yh=ne("libp2p:circuit:stream-handler");class gh{constructor(e){const{stream:t,maxLength:r=4096}=e;this.stream=t,this.shake=Qn(this.stream),this.decoder=gi.fromReader(this.shake.reader,{maxDataLength:r})}async read(){const e=await this.decoder.next();if(null!=e.value){const t=lh.decode(e.value);return yh("read message type",t.type),t}yh("read received no value, closing stream"),this.close()}write(e){yh("write message type %s",e.type),this.shake.write(hi.single(lh.encode(e)))}rest(){return this.shake.rest(),this.shake.stream}end(e){this.write(e),this.close()}close(){yh("closing the stream"),this.rest().sink([]).catch((e=>{yh.error(e)}))}}const mh=ne("libp2p:circuit:stop"),wh=ne("libp2p:circuit:hop");const Eh=ne("libp2p:circuit");class bh{constructor(e,t){this._init=t,this.components=e,this._started=!1}isStarted(){return this._started}async start(){this._started||(this._started=!0,await this.components.registrar.handle(dh,(e=>{this._onProtocol(e).catch((e=>{Eh.error(e)}))}),{...this._init}).catch((e=>{Eh.error(e)})))}async stop(){await this.components.registrar.unhandle(dh)}hopEnabled(){return!0}hopActive(){return!0}get[wn](){return!0}get[Symbol.toStringTag](){return"libp2p/circuit-relay-v1"}async _onProtocol(e){const{connection:t,stream:r}=e,n=new Pu.TimeoutController(this._init.hop.timeout);try{(0,xu.setMaxListeners)?.(1/0,n.signal)}catch{}try{const e=Hr(r,n.signal),i=new gh({stream:{...r,...e}}),s=await i.read();if(null==s)return Eh("request was invalid, could not read from stream"),i.write({type:lh.Type.STATUS,code:lh.Status.MALFORMED_MESSAGE}),void i.close();let o;switch(s.type){case lh.Type.CAN_HOP:Eh("received CAN_HOP request from %p",t.remotePeer),await function(e){const{connection:t,streamHandler:r,circuit:n}=e,i=n.hopEnabled();wh("can hop (%s) request from %p",i,t.remotePeer),r.end({type:lh.Type.STATUS,code:i?lh.Status.SUCCESS:lh.Status.HOP_CANT_SPEAK_RELAY})}({circuit:this,connection:t,streamHandler:i});break;case lh.Type.HOP:Eh("received HOP request from %p",t.remotePeer),await async function(e){const{connection:t,request:r,streamHandler:n,circuit:i,connectionManager:s}=e;if(!i.hopEnabled())return wh("HOP request received but we are not acting as a relay"),n.end({type:lh.Type.STATUS,code:lh.Status.HOP_CANT_SPEAK_RELAY});try{fh(r,n)}catch(e){return void wh.error("invalid hop request via peer %p %o",t.remotePeer,e)}if(null==r.dstPeer)return void wh("HOP request received but we do not receive a dstPeer");const o=ic(r.dstPeer.id),a=s.getConnections(o);if(0===a.length&&!i.hopActive())return wh("HOP request received but we are not connected to the destination peer"),n.end({type:lh.Type.STATUS,code:lh.Status.HOP_NO_CONN_TO_DST});if(0===a.length)return wh("did not have connection to remote peer"),n.end({type:lh.Type.STATUS,code:lh.Status.HOP_NO_CONN_TO_DST});const c={type:lh.Type.STOP,dstPeer:r.dstPeer,srcPeer:r.srcPeer};let l;try{wh("performing STOP request");const e=await async function(e){const{connection:t,request:r,signal:n}=e,i=await t.newStream(dh,{signal:n});mh("starting stop request to %p",t.remotePeer);const s=new gh({stream:i});s.write(r);const o=await s.read();if(null!=o){if(o.code===lh.Status.SUCCESS)return mh("stop request to %p was successful",t.remotePeer),s.rest();mh("stop request failed with code %d",o.code),s.close()}else s.close()}({connection:a[0],request:c});if(null==e)throw new Error("Could not stop");l=e}catch(e){return void wh.error(e)}wh("hop request from %p is valid",t.remotePeer),n.write({type:lh.Type.STATUS,code:lh.Status.SUCCESS});const u=n.rest();return wh("creating related connections"),await Ci(u,l,u)}({connection:t,request:s,streamHandler:i,circuit:this,connectionManager:this.components.connectionManager});break;case lh.Type.STOP:Eh("received STOP request from %p",t.remotePeer),o=await function(e){const{connection:t,request:r,streamHandler:n}=e;try{fh(r,n)}catch(e){return void mh.error("invalid stop request via peer %p %o",t.remotePeer,e)}return mh("stop request is valid"),n.write({type:lh.Type.STATUS,code:lh.Status.SUCCESS}),n.rest()}({connection:t,request:s,streamHandler:i});break;default:return Eh("Request of type %s not supported",s.type),i.write({type:lh.Type.STATUS,code:lh.Status.MALFORMED_MESSAGE}),void i.close()}if(null!=o){const e=hh({stream:o,remoteAddr:t.remoteAddr.encapsulate("/p2p-circuit").encapsulate(hr(s.dstPeer?.addrs[0])),localAddr:hr(s.srcPeer?.addrs[0])}),r=s.type===lh.Type.HOP?"relay":"inbound";Eh("new %s connection %s",r,e.remoteAddr);const n=await this.components.upgrader.upgradeInbound(e);Eh("%s connection %s upgraded",r,e.remoteAddr),null!=this.handler&&this.handler(n)}}finally{n.clear()}}async dial(e,t={}){const r=e.toString().split("/p2p-circuit"),n=hr(r[0]),i=hr(r[r.length-1]),s=n.getPeerId(),o=i.getPeerId();if(null==s||null==o){const e="Circuit relay dial failed as addresses did not have peer id";throw Eh.error(e),Qt(new Error(e),ku.ERR_RELAYED_DIAL)}const a=nc(s),c=nc(o);let l=!1,u=this.components.connectionManager.getConnections(a)[0];null==u&&(await this.components.peerStore.addressBook.add(a,[n]),u=await this.components.connectionManager.openConnection(a,t),l=!0);try{const r=await async function(e){const{connection:t,request:r,signal:n}=e,i=await t.newStream(dh,{signal:n}),s=new gh({stream:i});s.write(r);const o=await s.read();if(null==o)throw Qt(new Error("HOP request had no response"),ku.ERR_HOP_REQUEST_FAILED);if(o.code===lh.Status.SUCCESS)return wh("hop request was successful"),s.rest();throw wh("hop request failed with code %d, closing stream",o.code),s.close(),Qt(new Error(`HOP request failed with code "${o.code??"unknown"}"`),ku.ERR_HOP_REQUEST_FAILED)}({...t,connection:u,request:{type:lh.Type.HOP,srcPeer:{id:this.components.peerId.toBytes(),addrs:this.components.addressManager.getAddresses().map((e=>e.bytes))},dstPeer:{id:c.toBytes(),addrs:[hr(i).bytes]}}}),s=hh({stream:r,remoteAddr:e,localAddr:n.encapsulate(`/p2p-circuit/p2p/${this.components.peerId.toString()}`)});return Eh("new outbound connection %s",s.remoteAddr),await this.components.upgrader.upgradeOutbound(s)}catch(e){throw Eh.error("Circuit relay dial failed",e),l&&await u.close(),e}}createListener(e){return this.handler=e.handler,function(e){const t=new Map,r=Object.assign(new Wr,{close:async()=>await Promise.resolve(),listen:async function(n){const i=hr(n.toString().split("/p2p-circuit").find((e=>""!==e))),s=i.getPeerId();if(null==s)throw new Error("Could not determine relay peer from multiaddr");const o=nc(s);await e.peerStore.addressBook.add(o,[i]);const a=await e.connectionManager.openConnection(o),c=a.remoteAddr.encapsulate("/p2p-circuit");t.set(a.remotePeer.toString(),c),r.dispatchEvent(new Qr("listening"))},getAddrs:function(){const e=[];for(const r of t.values())e.push(r);return e}});return e.connectionManager.addEventListener("peer:disconnect",(e=>{const{detail:n}=e;t.delete(n.remotePeer.toString())&&r.dispatchEvent(new Qr("close"))})),r}({connectionManager:this.components.connectionManager,peerStore:this.components.peerStore})}filter(e){return(e=Array.isArray(e)?e:[e]).filter((e=>Pr.matches(e)))}}async function vh(e){const t=(new TextEncoder).encode(e),r=await He.digest(t);return at.createV0(r)}const _h="hop_relay",Sh="true",Ch="/libp2p/relay";var Ah=__webpack_require__(8951);const Ih="[a-fA-F\\d:]",Th=e=>e&&e.includeBoundaries?`(?:(?<=\\s|^)(?=${Ih})|(?<=${Ih})(?=\\s|$))`:"",Rh="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",kh="[a-fA-F\\d]{1,4}",Nh=`\n(?:\n(?:${kh}:){7}(?:${kh}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:${kh}:){6}(?:${Rh}|:${kh}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:${kh}:){5}(?::${Rh}|(?::${kh}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:${kh}:){4}(?:(?::${kh}){0,1}:${Rh}|(?::${kh}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:${kh}:){3}(?:(?::${kh}){0,2}:${Rh}|(?::${kh}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:${kh}:){2}(?:(?::${kh}){0,3}:${Rh}|(?::${kh}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:${kh}:){1}(?:(?::${kh}){0,4}:${Rh}|(?::${kh}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::(?:(?::${kh}){0,5}:${Rh}|(?::${kh}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1\n`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),Lh=new RegExp(`(?:^${Rh}$)|(?:^${Nh}$)`),Dh=new RegExp(`^${Rh}$`),Ph=new RegExp(`^${Nh}$`),Bh=e=>e&&e.exact?Lh:new RegExp(`(?:${Th(e)}${Rh}${Th(e)})|(?:${Th(e)}${Nh}${Th(e)})`,"g");Bh.v4=e=>e&&e.exact?Dh:new RegExp(`${Th(e)}${Rh}${Th(e)}`,"g"),Bh.v6=e=>e&&e.exact?Ph:new RegExp(`${Th(e)}${Nh}${Th(e)}`,"g");const Oh=Bh;var xh=__webpack_require__(6512);const{isValid:Uh,parse:Mh}=xh,Vh=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"].map((e=>new Ah.Netmask(e)));function Kh(e){return/^::$/.test(e)||/^::1$/.test(e)||/^::f{4}:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^::f{4}:0.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(e)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(e)||/^ff([0-9a-fA-F]{2,2}):/i.test(e)}const Fh=e=>{if(Uh(e)){const t=Mh(e);if("ipv4"===t.kind())return function(e){for(let t of Vh)if(t.contains(e))return!0;return!1}(t.toNormalizedString());if("ipv6"===t.kind())return Kh(e)}else if(ae(e)&&Oh.v6().test(e))return Kh(e)};function qh(e){const{address:t}=e.nodeAddress();return Boolean(Fh(t))}function jh(e,t){const r=qh(e.multiaddr),n=qh(t.multiaddr);return r&&!n?1:!r&&n||e.isCertified&&!t.isCertified?-1:!e.isCertified&&t.isCertified?1:0}const Hh=ne("libp2p:auto-relay"),zh=()=>{};class $h{constructor(e,t){this.components=e,this.addressSorter=t.addressSorter??jh,this.maxListeners=t.maxListeners??1,this.listenRelays=new Set,this.onError=t.onError??zh,this._onProtocolChange=this._onProtocolChange.bind(this),this._onPeerDisconnected=this._onPeerDisconnected.bind(this),this.components.peerStore.addEventListener("change:protocols",(e=>{this._onProtocolChange(e).catch((e=>{Hh.error(e)}))})),this.components.connectionManager.addEventListener("peer:disconnect",this._onPeerDisconnected)}async _onProtocolChange(e){const{peerId:t,protocols:r}=e.detail,n=t.toString();if(null!=r.find((e=>e===dh))){if(!this.listenRelays.has(n))try{const e=this.components.connectionManager.getConnections(t);if(0===e.length)return;const r=e[0];if(r.remoteAddr.protoCodes().includes(290))return void Hh(`relayed connection to ${n} will not be used to hop on`);const i=await async function(e){const{connection:t,signal:r}=e,n=await t.newStream(dh,{signal:r}),i=new gh({stream:n});i.write({type:lh.Type.CAN_HOP});const s=await i.read();return await i.close(),null!=s&&s.code===lh.Status.SUCCESS}({connection:r});i&&(await this.components.peerStore.metadataBook.setValue(t,_h,Pt(Sh)),await this._addListenRelay(r,n))}catch(e){this.onError(e)}}else this.listenRelays.has(n)&&await this._removeListenRelay(n)}_onPeerDisconnected(e){const t=e.detail.remotePeer.toString();this.listenRelays.has(t)&&this._removeListenRelay(t).catch((e=>{Hh.error(e)}))}async _addListenRelay(e,t){try{if(this.listenRelays.size>=this.maxListeners)return;const r=await Ci(await this.components.peerStore.addressBook.get(e.remotePeer),(e=>sh(e,this.addressSorter)),(async e=>await gu(e))),n=await Promise.all(r.map((async t=>{try{let r=t.multiaddr;return null==r.getPeerId()&&(r=r.encapsulate(`/p2p/${e.remotePeer.toString()}`)),r=r.encapsulate("/p2p-circuit"),await this.components.transportManager.listen([r]),!0}catch(e){Hh.error("error listening on circuit address",e),this.onError(e)}return!1})));n.includes(!0)&&this.listenRelays.add(t)}catch(e){this.onError(e),this.listenRelays.delete(t)}}async _removeListenRelay(e){this.listenRelays.delete(e)&&await this._listenOnAvailableHopRelays([e])}async _listenOnAvailableHopRelays(e=[]){if(this.listenRelays.size>=this.maxListeners)return;const t=[],r=await this.components.peerStore.all();for(const{id:n,metadata:i}of r){const r=n.toString();if(this.listenRelays.has(r))continue;if(e.includes(r))continue;const s=i.get(_h);if(null==s||St(s)!==Sh)continue;const o=this.components.connectionManager.getConnections(n);if(0!==o.length){if(await this._addListenRelay(o[0],r),this.listenRelays.size>=this.maxListeners)return}else t.push(n)}for(const e of t)if(await this._tryToListenOnRelay(e),this.listenRelays.size>=this.maxListeners)return;try{const e=await vh(Ch);for await(const t of this.components.contentRouting.findProviders(e)){if(0===t.multiaddrs.length)continue;const e=t.id;if(!e.equals(this.components.peerId)&&(await this.components.peerStore.addressBook.add(e,t.multiaddrs),await this._tryToListenOnRelay(e),this.listenRelays.size>=this.maxListeners))return}}catch(e){this.onError(e)}}async _tryToListenOnRelay(e){try{const t=await this.components.connectionManager.openConnection(e);await this._addListenRelay(t,e.toString())}catch(t){Hh.error("Could not use %p as relay",e,t),this.onError(t,`could not connect and listen on known hop relay ${e.toString()}`)}}}const Gh=ne("libp2p:relay");class Wh{constructor(e,t){this.components=e,this.autoRelay=!1!==t.autoRelay?.enabled?new $h(e,{addressSorter:t.addressSorter,...t.autoRelay}):void 0,this.started=!1,this.init=t,this._advertiseService=this._advertiseService.bind(this)}isStarted(){return this.started}async start(){!1!==this.init.hop.enabled&&!1!==this.init.advertise.enabled&&(this.timeout=(0,Ou.setDelayedInterval)(this._advertiseService,this.init.advertise.ttl,this.init.advertise.bootDelay)),this.started=!0}async stop(){null!=this.timeout&&(0,Ou.clearDelayedInterval)(this.timeout),this.started=!1}async _advertiseService(){try{const e=await vh(Ch);await this.components.contentRouting.provide(e)}catch(e){e.code===ku.ERR_NO_ROUTERS_AVAILABLE?(Gh.error("a content router, such as a DHT, must be provided in order to advertise the relay service",e),await this.stop()):Gh.error(e)}}}var Yh=__webpack_require__(202);__webpack_require__(9437),__webpack_require__(5414);const Qh=es.pki,Xh=ne("libp2p:keychain:cms"),Zh=new WeakMap;class Jh{constructor(e,t){if(null==e)throw Qt(new Error("keychain is required"),ku.ERR_KEYCHAIN_REQUIRED);this.keychain=e,Zh.set(this,{dek:t})}async encrypt(e,t){if(!(t instanceof Uint8Array))throw Qt(new Error("Plain data must be a Uint8Array"),ku.ERR_INVALID_PARAMETERS);const r=await this.keychain.findKeyByName(e),n=await this.keychain.getPrivateKey(e),i=Zh.get(this);if(null==i)throw Qt(new Error("dek missing"),ku.ERR_INVALID_PARAMETERS);const s=i.dek,o=es.pki.decryptRsaPrivateKey(n,s),a=await((e,t)=>{const r=Qh.rsa.setPublicKey(t.n,t.e),n=Qh.createCertificate();n.publicKey=r,n.serialNumber="01",n.validity.notBefore=new Date,n.validity.notAfter=new Date,n.validity.notAfter.setFullYear(n.validity.notBefore.getFullYear()+10);const i=[{name:"organizationName",value:"ipfs"},{shortName:"OU",value:"keystore"},{name:"commonName",value:e.id}];return n.setSubject(i),n.setIssuer(i),n.setExtensions([{name:"basicConstraints",cA:!0},{name:"keyUsage",keyCertSign:!0,digitalSignature:!0,nonRepudiation:!0,keyEncipherment:!0,dataEncipherment:!0},{name:"extKeyUsage",serverAuth:!0,clientAuth:!0,codeSigning:!0,emailProtection:!0,timeStamping:!0},{name:"nsCertType",client:!0,server:!0,email:!0,objsign:!0,sslCA:!0,emailCA:!0,objCA:!0}]),n.sign(t),n})(r,o),c=es.pkcs7.createEnvelopedData();return c.addRecipient(a),c.content=es.util.createBuffer(t),c.encrypt(),Pt(es.asn1.toDer(c.toAsn1()).getBytes(),"ascii")}async decrypt(e){if(!(e instanceof Uint8Array))throw Qt(new Error("CMS data is required"),ku.ERR_INVALID_PARAMETERS);let t;try{const r=es.util.createBuffer(St(e,"ascii")),n=es.asn1.fromDer(r);t=es.pkcs7.messageFromAsn1(n)}catch(e){throw Xh.error(e),Qt(new Error("Invalid CMS"),ku.ERR_INVALID_CMS)}const r=t.recipients.filter((e=>e.issuer.find((e=>"O"===e.shortName&&"ipfs"===e.value)))).filter((e=>e.issuer.find((e=>"CN"===e.shortName)))).map((e=>({recipient:e,keyId:e.issuer.find((e=>"CN"===e.shortName)).value}))),n=await async function(e,t){const r=e.map(t);return e[(await Promise.all(r)).findIndex((e=>e))]}(r,(async e=>{try{if(null!=await this.keychain.findKeyById(e.keyId))return!0}catch(e){return!1}return!1}));if(null==n){const e=r.map((e=>e.keyId));throw Qt(new Error(`Decryption needs one of the key(s): ${e.join(", ")}`),ku.ERR_MISSING_KEYS,{missingKeys:e})}const i=await this.keychain.findKeyById(n.keyId);if(null==i)throw Qt(new Error("No key available to decrypto"),ku.ERR_NO_KEY);const s=await this.keychain.getPrivateKey(i.name),o=Zh.get(this);if(null==o)throw Qt(new Error("dek missing"),ku.ERR_INVALID_PARAMETERS);const a=o.dek,c=es.pki.decryptRsaPrivateKey(s,a);return t.decrypt(n.recipient,c),Pt(t.content.getBytes(),"ascii")}}__webpack_require__(8925);var ed=__webpack_require__(8960);const td={sha1:"sha1","sha2-256":"sha256","sha2-512":"sha512"};function rd(e,t,r,n,i){if("sha1"!==i&&"sha2-256"!==i&&"sha2-512"!==i){const e=Object.keys(td).join(" / ");throw new rs(`Hash '${i}' is unknown or not supported. Must be ${e}`,"ERR_UNSUPPORTED_HASH_TYPE")}const s=td[i],o=ed(e,t,r,n,s);return is.encode64(o,null)}const nd=ne("libp2p:keychain"),id="/pkcs8/",sd="/info/",od=new WeakMap,ad={dek:{keyLength:64,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function cd(e){return null!=e&&"string"==typeof e&&e===Yh(e.trim())&&e.length>0}async function ld(){const e=800*Math.random()+200;await new Promise((t=>setTimeout(t,e)))}function ud(e){return new Iu(id+e)}function hd(e){return new Iu(sd+e)}class dd{constructor(e,t){if(this.components=e,this.init=qu(ad,t),null!=this.init.pass&&this.init.pass?.length<20)throw new Error("pass must be least 20 characters");if(null!=this.init.dek?.keyLength&&this.init.dek.keyLength<14)throw new Error("dek.keyLength must be least 14 bytes");if(null!=this.init.dek?.salt?.length&&this.init.dek.salt.length<16)throw new Error("dek.saltLength must be least 16 bytes");if(null!=this.init.dek?.iterationCount&&this.init.dek.iterationCount<1e3)throw new Error("dek.iterationCount must be least 1000");const r=null!=this.init.pass&&null!=this.init.dek?.salt?rd(this.init.pass,this.init.dek?.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";od.set(this,{dek:r}),this.started=!1}isStarted(){return this.started}async start(){const e=hd("self");await this.components.datastore.has(e)||await this.importPeer("self",this.components.peerId),this.started=!0}stop(){this.started=!1}get cms(){const e=od.get(this);if(null==e)throw Qt(new Error("dek missing"),ku.ERR_INVALID_PARAMETERS);const t=e.dek;return new Jh(this,t)}static generateOptions(){const e=Object.assign({},ad),t=3*Math.ceil(16/3);return e.dek.salt=St(po(t),"base64"),e}static get options(){return ad}async createKey(e,t,r=2048){if(!cd(e)||"self"===e)throw await ld(),Qt(new Error("Invalid key name"),ku.ERR_INVALID_KEY_NAME);if("string"!=typeof t)throw await ld(),Qt(new Error("Invalid key type"),ku.ERR_INVALID_KEY_TYPE);const n=ud(e);if(await this.components.datastore.has(n))throw await ld(),Qt(new Error("Key name already exists"),ku.ERR_KEY_ALREADY_EXISTS);if("rsa"===t.toLowerCase()&&(!Number.isSafeInteger(r)||r<2048))throw await ld(),Qt(new Error("Invalid RSA key size"),ku.ERR_INVALID_KEY_SIZE);let i;try{const s=await Fa(t,r),o=await s.id(),a=od.get(this);if(null==a)throw Qt(new Error("dek missing"),ku.ERR_INVALID_PARAMETERS);const c=a.dek,l=await s.export(c);i={name:e,id:o};const u=this.components.datastore.batch();u.put(n,Pt(l)),u.put(hd(e),Pt(JSON.stringify(i))),await u.commit()}catch(e){throw await ld(),e}return i}async listKeys(){const e={prefix:sd},t=[];for await(const r of this.components.datastore.query(e))t.push(JSON.parse(St(r.value)));return t}async findKeyById(e){try{return(await this.listKeys()).find((t=>t.id===e))}catch(e){throw await ld(),e}}async findKeyByName(e){if(!cd(e))throw await ld(),Qt(new Error(`Invalid key name '${e}'`),ku.ERR_INVALID_KEY_NAME);const t=hd(e);try{const e=await this.components.datastore.get(t);return JSON.parse(St(e))}catch(t){throw await ld(),nd.error(t),Qt(new Error(`Key '${e}' does not exist.`),ku.ERR_KEY_NOT_FOUND)}}async removeKey(e){if(!cd(e)||"self"===e)throw await ld(),Qt(new Error(`Invalid key name '${e}'`),ku.ERR_INVALID_KEY_NAME);const t=ud(e),r=await this.findKeyByName(e),n=this.components.datastore.batch();return n.delete(t),n.delete(hd(e)),await n.commit(),r}async renameKey(e,t){if(!cd(e)||"self"===e)throw await ld(),Qt(new Error(`Invalid old key name '${e}'`),ku.ERR_OLD_KEY_NAME_INVALID);if(!cd(t)||"self"===t)throw await ld(),Qt(new Error(`Invalid new key name '${t}'`),ku.ERR_NEW_KEY_NAME_INVALID);const r=ud(e),n=ud(t),i=hd(e),s=hd(t);if(await this.components.datastore.has(n))throw await ld(),Qt(new Error(`Key '${t}' already exists`),ku.ERR_KEY_ALREADY_EXISTS);try{const e=await this.components.datastore.get(r),o=await this.components.datastore.get(i),a=JSON.parse(St(o));a.name=t;const c=this.components.datastore.batch();return c.put(n,e),c.put(s,Pt(JSON.stringify(a))),c.delete(r),c.delete(i),await c.commit(),a}catch(e){throw await ld(),e}}async exportKey(e,t){if(!cd(e))throw await ld(),Qt(new Error(`Invalid key name '${e}'`),ku.ERR_INVALID_KEY_NAME);if(null==t)throw await ld(),Qt(new Error("Password is required"),ku.ERR_PASSWORD_REQUIRED);const r=ud(e);try{const e=St(await this.components.datastore.get(r)),n=od.get(this);if(null==n)throw Qt(new Error("dek missing"),ku.ERR_INVALID_PARAMETERS);const i=n.dek,s=await Ha(e,i);return await s.export(t)}catch(e){throw await ld(),e}}async exportPeerId(e){const t="temporary-password",r=await this.exportKey(e,t),n=await Ha(r,t);return await sc(n.public.bytes,n.bytes)}async importKey(e,t,r){if(!cd(e)||"self"===e)throw await ld(),Qt(new Error(`Invalid key name '${e}'`),ku.ERR_INVALID_KEY_NAME);if(null==t)throw await ld(),Qt(new Error("PEM encoded key is required"),ku.ERR_PEM_REQUIRED);const n=ud(e);if(await this.components.datastore.has(n))throw await ld(),Qt(new Error(`Key '${e}' already exists`),ku.ERR_KEY_ALREADY_EXISTS);let i,s;try{i=await Ha(t,r)}catch(e){throw await ld(),Qt(new Error("Cannot read the key, most likely the password is wrong"),ku.ERR_CANNOT_READ_KEY)}try{s=await i.id();const e=od.get(this);if(null==e)throw Qt(new Error("dek missing"),ku.ERR_INVALID_PARAMETERS);const r=e.dek;t=await i.export(r)}catch(e){throw await ld(),e}const o={name:e,id:s},a=this.components.datastore.batch();return a.put(n,Pt(t)),a.put(hd(e),Pt(JSON.stringify(o))),await a.commit(),o}async importPeer(e,t){try{if(!cd(e))throw Qt(new Error(`Invalid key name '${e}'`),ku.ERR_INVALID_KEY_NAME);if(null==t)throw Qt(new Error("PeerId is required"),ku.ERR_MISSING_PRIVATE_KEY);if(null==t.privateKey)throw Qt(new Error("PeerId.privKey is required"),ku.ERR_MISSING_PRIVATE_KEY);const r=await ja(t.privateKey),n=ud(e);if(await this.components.datastore.has(n))throw await ld(),Qt(new Error(`Key '${e}' already exists`),ku.ERR_KEY_ALREADY_EXISTS);const i=od.get(this);if(null==i)throw Qt(new Error("dek missing"),ku.ERR_INVALID_PARAMETERS);const s=i.dek,o=await r.export(s),a={name:e,id:t.toString()},c=this.components.datastore.batch();return c.put(n,Pt(o)),c.put(hd(e),Pt(JSON.stringify(a))),await c.commit(),a}catch(e){throw await ld(),e}}async getPrivateKey(e){if(!cd(e))throw await ld(),Qt(new Error(`Invalid key name '${e}'`),ku.ERR_INVALID_KEY_NAME);try{const t=ud(e);return St(await this.components.datastore.get(t))}catch(t){throw await ld(),nd.error(t),Qt(new Error(`Key '${e}' does not exist.`),ku.ERR_KEY_NOT_FOUND)}}async rotateKeychainPass(e,t){if("string"!=typeof e)throw await ld(),Qt(new Error(`Invalid old pass type '${typeof e}'`),ku.ERR_INVALID_OLD_PASS_TYPE);if("string"!=typeof t)throw await ld(),Qt(new Error(`Invalid new pass type '${typeof t}'`),ku.ERR_INVALID_NEW_PASS_TYPE);if(t.length<20)throw await ld(),Qt(new Error(`Invalid pass length ${t.length}`),ku.ERR_INVALID_PASS_LENGTH);nd("recreating keychain");const r=od.get(this);if(null==r)throw Qt(new Error("dek missing"),ku.ERR_INVALID_PARAMETERS);const n=r.dek;this.init.pass=t;const i=null!=t&&null!=this.init.dek?.salt?rd(t,this.init.dek.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";od.set(this,{dek:i});const s=await this.listKeys();for(const e of s){const t=St(await this.components.datastore.get(ud(e.name))),r=await Ha(t,n),s=i.toString(),o=await r.export(s),a=this.components.datastore.batch(),c={name:e.name,id:e.id};a.put(ud(e.name),Pt(o)),a.put(hd(e.name),Pt(JSON.stringify(c))),await a.commit()}nd("keychain reconstructed")}}async function pd(e){try{return{status:"fulfilled",value:await e,isFulfilled:!0,isRejected:!1}}catch(e){return{status:"rejected",reason:e,isFulfilled:!1,isRejected:!0}}}class fd{value;next;constructor(e){this.value=e}}class yd{#e;#t;#r;constructor(){this.clear()}enqueue(e){const t=new fd(e);this.#e?(this.#t.next=t,this.#t=t):(this.#e=t,this.#t=t),this.#r++}dequeue(){const e=this.#e;if(e)return this.#e=this.#e.next,this.#r--,e.value}clear(){this.#e=void 0,this.#t=void 0,this.#r=0}get size(){return this.#r}*[Symbol.iterator](){let e=this.#e;for(;e;)yield e.value,e=e.next}}function gd(e){if(!Number.isInteger(e)&&e!==Number.POSITIVE_INFINITY||!(e>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const t=new yd;let r=0;const n=async(e,n,i)=>{r++;const s=(async()=>e(...i))();n(s);try{await s}catch{}r--,t.size>0&&t.dequeue()()},i=(i,...s)=>new Promise((o=>{((i,s,o)=>{t.enqueue(n.bind(void 0,i,s,o)),(async()=>{await Promise.resolve(),r<e&&t.size>0&&t.dequeue()()})()})(i,o,s)}));return Object.defineProperties(i,{activeCount:{get:()=>r},pendingCount:{get:()=>t.size},clearQueue:{value:()=>{t.clear()}}}),i}async function md(e,t={}){const{concurrency:r=Number.POSITIVE_INFINITY}=t,n=gd(r);return Promise.all(e.map((e=>e&&"function"==typeof e.then?pd(e):pd("function"==typeof e?n((()=>e())):Promise.resolve(e)))))}class wd extends Map{constructor(e){super();const{name:t,metrics:r}=e;this.metric=r.registerMetric(t),this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){const t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function Ed(e){const{name:t,metrics:r}=e;let n;return n=null!=r?new wd({name:t,metrics:r}):new Map,n}const bd=ne("libp2p:transports");class vd extends Wr{constructor(e,t={}){super(),this.components=e,this.started=!1,this.transports=new Map,this.listeners=Ed({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??En.FATAL_ALL}add(e){const t=e[Symbol.toStringTag];if(null==t)throw Qt(new Error("Transport must have a valid tag"),ku.ERR_INVALID_KEY);if(this.transports.has(t))throw Qt(new Error("There is already a transport with this tag"),ku.ERR_DUPLICATE_TRANSPORT);bd("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}async start(){const e=this.components.addressManager.getListenAddrs();await this.listen(e),this.started=!0}async stop(){const e=[];for(const[t,r]of this.listeners)for(bd("closing listeners for %s",t);r.length>0;){const t=r.pop();null!=t&&e.push(t.close())}await Promise.all(e),bd("all listeners closed");for(const e of this.listeners.keys())this.listeners.set(e,[]);this.started=!1}async dial(e,t){const r=this.transportForMultiaddr(e);if(null==r)throw Qt(new Error(`No transport available for address ${String(e)}`),ku.ERR_TRANSPORT_UNAVAILABLE);try{return await r.dial(e,{...t,upgrader:this.components.upgrader})}catch(e){throw null==e.code&&(e.code=ku.ERR_TRANSPORT_DIAL_FAILED),e}}getAddrs(){let e=[];for(const t of this.listeners.values())for(const r of t)e=[...e,...r.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}transportForMultiaddr(e){for(const t of this.transports.values())if(t.filter([e]).length>0)return t}async listen(e){if(null==e||0===e.length)return void bd("no addresses were provided for listening, this node is dial only");const t=[];for(const[r,n]of this.transports.entries()){const i=n.filter(e),s=[];for(const e of i){bd("creating listener for %s on %s",r,e);const t=n.createListener({upgrader:this.components.upgrader});let i=this.listeners.get(r);null==i&&(i=[],this.listeners.set(r,i)),i.push(t),t.addEventListener("listening",(()=>{this.dispatchEvent(new Qr("listener:listening",{detail:t}))})),t.addEventListener("close",(()=>{this.dispatchEvent(new Qr("listener:close",{detail:t}))})),s.push(t.listen(e))}if(0!==s.length){if(null==(await md(s)).find((e=>e.isFulfilled))&&this.faultTolerance!==En.NO_FATAL)throw Qt(new Error(`Transport (${r}) could not listen on any available address`),ku.ERR_NO_VALID_ADDRESSES)}else t.push(r)}if(t.length===this.transports.size){const e=`no valid addresses were provided for transports [${t.join(", ")}]`;if(this.faultTolerance===En.FATAL_ALL)throw Qt(new Error(e),ku.ERR_NO_VALID_ADDRESSES);bd(`libp2p in dial mode only: ${e}`)}}async remove(e){bd("removing %s",e);for(const t of this.listeners.get(e)??[])await t.close();this.transports.delete(e),this.listeners.delete(e)}async removeAll(){const e=[];for(const t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}}const _d="/multistream/1.0.0",Sd=1024,Cd=ne("libp2p:mss"),Ad=Pt("\n");function Id(e){const t=new In(e,Ad);return hi.single(t)}function Td(e,t,r={}){const n=Id(t);!0===r.writeBytes?e.push(n.subarray()):e.push(n)}async function Rd(e,t){const r=await async function(e,t){let r=1;const n={[Symbol.asyncIterator]:()=>n,next:async()=>await e.next(r)};let i=n;null!=t?.signal&&(i=qr(n,t.signal));const s=await Ci(i,gi({onLength:e=>{r=e},maxDataLength:Sd}),(async e=>await Bu(e)));if(null==s||0===s.length)throw Qt(new Error("no buffer returned"),"ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");if(s.get(s.byteLength-1)!==Ad[0])throw Cd.error("Invalid mss message - missing newline - %s",s.subarray()),Qt(new Error("missing newline"),"ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");return s.sublist(0,-1)}(e,t);return St(r.subarray())}const kd=ne("libp2p:mss:select");async function Nd(e,t,r={}){t=Array.isArray(t)?[...t]:[t];const{reader:n,writer:i,rest:s,stream:o}=Qn(e),a=t.shift();if(null==a)throw new Error("At least one protocol must be specified");kd('select: write ["%s", "%s"]',_d,a),function(e,t,r={}){const n=new In;for(const e of t)n.append(Id(e));!0===r.writeBytes?e.push(n.subarray()):e.push(n)}(i,[Pt(_d),Pt(a)],r);let c=await Rd(n,r);if(kd('select: read "%s"',c),c===_d&&(c=await Rd(n,r),kd('select: read "%s"',c)),c===a)return s(),{stream:o,protocol:a};for(const e of t){kd('select: write "%s"',e),Td(i,Pt(e),r);const t=await Rd(n,r);if(kd('select: read "%s" for "%s"',t,e),t===e)return s(),{stream:o,protocol:e}}throw s(),Qt(new Error("protocol selection failed"),"ERR_UNSUPPORTED_PROTOCOL")}const Ld=ne("libp2p:mss:handle");async function Dd(e,t,r){t=Array.isArray(t)?t:[t];const{writer:n,reader:i,rest:s,stream:o}=Qn(e);for(;;){const e=await Rd(i,r);if(Ld('read "%s"',e),e!==_d){if(t.includes(e))return Td(n,Pt(e),r),Ld('respond with "%s" for "%s"',e,e),s(),{stream:o,protocol:e};"ls"!==e?(Td(n,Pt("na"),r),Ld('respond with "na" for "%s"',e)):(Td(n,new In(...t.map((e=>Id(Pt(e))))),r),Ld('respond with "%s" for %s',t,e))}else Ld('respond with "%s" for "%s"',_d,e),Td(n,Pt(_d),r)}}const Pd=Symbol.for("@libp2p/connection"),Bd=ne("libp2p:connection");class Od{constructor(e){const{remoteAddr:t,remotePeer:r,newStream:n,close:i,getStreams:s,stat:o}=e;this.id=`${parseInt(String(1e9*Math.random())).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=r,this.stat={...o,status:Gu},this._newStream=n,this._close=i,this._getStreams=s,this.tags=[],this._closing=!1}get[Symbol.toStringTag](){return"Connection"}get[Pd](){return!0}get streams(){return this._getStreams()}async newStream(e,t){if(this.stat.status===Wu)throw Qt(new Error("the connection is being closed"),"ERR_CONNECTION_BEING_CLOSED");if(this.stat.status===Yu)throw Qt(new Error("the connection is closed"),"ERR_CONNECTION_CLOSED");Array.isArray(e)||(e=[e]);const r=await this._newStream(e,t);return r.stat.direction="outbound",r}addStream(e){e.stat.direction="inbound"}removeStream(e){}async close(){if(this.stat.status!==Yu&&!this._closing){this.stat.status=Wu;try{this.streams.forEach((e=>e.close()))}catch(e){Bd.error(e)}this._closing=!0,await this._close(),this._closing=!1,this.stat.timeline.close=Date.now(),this.stat.status=Yu}}}const xd=Symbol.for("@libp2p/topology"),Ud=ne("libp2p:registrar");class Md{constructor(e){this.topologies=new Map,this.handlers=new Map,this.components=e,this._onDisconnect=this._onDisconnect.bind(this),this._onProtocolChange=this._onProtocolChange.bind(this),this._onConnect=this._onConnect.bind(this),this.components.connectionManager.addEventListener("peer:disconnect",this._onDisconnect),this.components.connectionManager.addEventListener("peer:connect",this._onConnect),this.components.peerStore.addEventListener("change:protocols",this._onProtocolChange)}getProtocols(){return Array.from(new Set([...this.topologies.keys(),...this.handlers.keys()])).sort()}getHandler(e){const t=this.handlers.get(e);if(null==t)throw Qt(new Error(`No handler registered for protocol ${e}`),ku.ERR_NO_HANDLER_FOR_PROTOCOL);return t}getTopologies(e){const t=this.topologies.get(e);return null==t?[]:[...t.values()]}async handle(e,t,r){if(this.handlers.has(e))throw Qt(new Error(`Handler already registered for protocol ${e}`),ku.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED);const n=qu.bind({ignoreUndefined:!0})({maxInboundStreams:32,maxOutboundStreams:64},r);this.handlers.set(e,{handler:t,options:n}),await this.components.peerStore.protoBook.add(this.components.peerId,[e])}async unhandle(e){const t=Array.isArray(e)?e:[e];t.forEach((e=>{this.handlers.delete(e)})),await this.components.peerStore.protoBook.remove(this.components.peerId,t)}async register(e,t){if(null==(r=t)||!Boolean(r[xd]))throw Ud.error("topology must be an instance of interfaces/topology"),Qt(new Error("topology must be an instance of interfaces/topology"),ku.ERR_INVALID_PARAMETERS);var r;const n=`${(1e9*Math.random()).toString(36)}${Date.now()}`;let i=this.topologies.get(e);return null==i&&(i=new Map,this.topologies.set(e,i)),i.set(n,t),await t.setRegistrar(this),n}unregister(e){for(const[t,r]of this.topologies.entries())r.has(e)&&(r.delete(e),0===r.size&&this.topologies.delete(t))}_onDisconnect(e){const t=e.detail;this.components.peerStore.protoBook.get(t.remotePeer).then((e=>{for(const r of e){const e=this.topologies.get(r);if(null!=e)for(const r of e.values())r.onDisconnect(t.remotePeer)}})).catch((e=>{Ud.error(e)}))}_onConnect(e){const t=e.detail;this.components.peerStore.protoBook.get(t.remotePeer).then((e=>{for(const r of e){const e=this.topologies.get(r);if(null!=e)for(const r of e.values())r.onConnect(t.remotePeer,t)}})).catch((e=>{Ud.error(e)}))}_onProtocolChange(e){const{peerId:t,protocols:r,oldProtocols:n}=e.detail,i=n.filter((e=>!r.includes(e))),s=r.filter((e=>!n.includes(e)));for(const e of i){const r=this.topologies.get(e);if(null!=r)for(const e of r.values())e.onDisconnect(t)}for(const e of s){const r=this.topologies.get(e);if(null!=r)for(const e of r.values()){const r=this.components.connectionManager.getConnections(t)[0];null!=r&&e.onConnect(t,r)}}}}const Vd=ne("libp2p:upgrader");function Kd(e,t,r){let n=0;return r.streams.forEach((r=>{r.stat.direction===t&&r.stat.protocol===e&&n++})),n}class Fd extends Wr{constructor(e,t){super(),this.components=e,this.connectionEncryption=new Map,t.connectionEncryption.forEach((e=>{this.connectionEncryption.set(e.protocol,e)})),this.muxers=new Map,t.muxers.forEach((e=>{this.muxers.set(e.protocol,e)})),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout}async upgradeInbound(e,t){if(!await this.components.connectionManager.acceptIncomingConnection(e))throw Qt(new Error("connection denied"),ku.ERR_CONNECTION_DENIED);let r,n,i,s,o;const a=new Pu.TimeoutController(this.inboundUpgradeTimeout);try{(0,xu.setMaxListeners)?.(1/0,a.signal)}catch{}try{const c=Hr(e,a.signal);if(e.source=c.source,e.sink=c.sink,await this.components.connectionGater.denyInboundConnection(e))throw Qt(new Error("The multiaddr connection is blocked by gater.acceptConnection"),ku.ERR_CONNECTION_INTERCEPTED);this.components.metrics?.trackMultiaddrConnection(e),Vd("starting the inbound connection upgrade");let l=e;if(!0!==t?.skipProtection){const t=this.components.connectionProtector;null!=t&&(Vd("protecting the inbound connection"),l=await t.protect(e))}try{if(r=l,!0!==t?.skipEncryption){if(({conn:r,remotePeer:n,protocol:o}=await this._encryptInbound(l)),await this.components.connectionGater.denyInboundEncryptedConnection(n,{...l,...r}))throw Qt(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),ku.ERR_CONNECTION_INTERCEPTED)}else{const t=e.remoteAddr.getPeerId();if(null==t)throw Qt(new Error("inbound connection that skipped encryption must have a peer id"),ku.ERR_INVALID_MULTIADDR);const r=nc(t);o="native",n=r}if(i=r,null!=t?.muxerFactory)s=t.muxerFactory;else if(this.muxers.size>0){const e=await this._multiplexInbound({...l,...r},this.muxers);s=e.muxerFactory,i=e.stream}}catch(e){throw Vd.error("Failed to upgrade inbound connection",e),e}if(await this.components.connectionGater.denyInboundUpgradedConnection(n,{...l,...r}))throw Qt(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),ku.ERR_CONNECTION_INTERCEPTED);return Vd("Successfully upgraded inbound connection"),this._createConnection({cryptoProtocol:o,direction:"inbound",maConn:e,upgradedConn:i,muxerFactory:s,remotePeer:n})}finally{this.components.connectionManager.afterUpgradeInbound(),a.clear()}}async upgradeOutbound(e,t){const r=e.remoteAddr.getPeerId();let n,i,s,o,a,c;if(null!=r&&(n=nc(r),await this.components.connectionGater.denyOutboundConnection(n,e)))throw Qt(new Error("The multiaddr connection is blocked by connectionGater.denyOutboundConnection"),ku.ERR_CONNECTION_INTERCEPTED);this.components.metrics?.trackMultiaddrConnection(e),Vd("Starting the outbound connection upgrade");let l=e;if(!0!==t?.skipProtection){const t=this.components.connectionProtector;null!=t&&(l=await t.protect(e))}try{if(i=l,!0!==t?.skipEncryption){if(({conn:i,remotePeer:s,protocol:a}=await this._encryptOutbound(l,n)),await this.components.connectionGater.denyOutboundEncryptedConnection(s,{...l,...i}))throw Qt(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),ku.ERR_CONNECTION_INTERCEPTED)}else{if(null==n)throw Qt(new Error("Encryption was skipped but no peer id was passed"),ku.ERR_INVALID_PEER);a="native",s=n}if(o=i,null!=t?.muxerFactory)c=t.muxerFactory;else if(this.muxers.size>0){const e=await this._multiplexOutbound({...l,...i},this.muxers);c=e.muxerFactory,o=e.stream}}catch(t){throw Vd.error("Failed to upgrade outbound connection",t),await e.close(t),t}if(await this.components.connectionGater.denyOutboundUpgradedConnection(s,{...l,...i}))throw Qt(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),ku.ERR_CONNECTION_INTERCEPTED);return Vd("Successfully upgraded outbound connection"),this._createConnection({cryptoProtocol:a,direction:"outbound",maConn:e,upgradedConn:o,muxerFactory:c,remotePeer:s})}_createConnection(e){const{cryptoProtocol:t,direction:r,maConn:n,upgradedConn:i,remotePeer:s,muxerFactory:o}=e;let a,c,l;null!=o&&(a=o.createStreamMuxer({direction:r,onIncomingStream:e=>{null!=l&&Promise.resolve().then((async()=>{const t=this.components.registrar.getProtocols(),{stream:n,protocol:i}=await Dd(e,t);if(Vd("%s: incoming stream opened on %s",r,i),null==l)return;const o=function(e,t){try{const{options:r}=t.getHandler(e);return r.maxInboundStreams}catch(e){if(e.code!==ku.ERR_NO_HANDLER_FOR_PROTOCOL)throw e}return 32}(i,this.components.registrar);Kd(i,"inbound",l)!==o?(e.source=n.source,e.sink=n.sink,e.stat.protocol=i,this.components.peerStore.protoBook.add(s,[i]).catch((e=>Vd.error(e))),l.addStream(e),this.components.metrics?.trackProtocolStream(e,l),this._onStream({connection:l,stream:e,protocol:i})):e.abort(Qt(new Error(`Too many inbound protocol streams for protocol "${i}" - limit ${o}`),ku.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS))})).catch((t=>{Vd.error(t),null==e.stat.timeline.close&&e.close()}))},onStreamEnd:e=>{l?.removeStream(e.id)}}),c=async(e,t={})=>{if(null==a)throw Qt(new Error("Stream is not multiplexed"),ku.ERR_MUXER_UNAVAILABLE);Vd("%s: starting new stream on %s",r,e);const n=await a.newStream();let i;try{if(null==t.signal){Vd("No abort signal was passed while trying to negotiate protocols %s falling back to default timeout",e),i=new Pu.TimeoutController(3e4),t.signal=i.signal;try{(0,xu.setMaxListeners)?.(1/0,i.signal)}catch{}}const{stream:r,protocol:o}=await Nd(n,e,t),a=function(e,t){try{const{options:r}=t.getHandler(e);return r.maxOutboundStreams}catch(e){if(e.code!==ku.ERR_NO_HANDLER_FOR_PROTOCOL)throw e}return 64}(o,this.components.registrar);if(Kd(o,"outbound",l)===a){const e=Qt(new Error(`Too many outbound protocol streams for protocol "${o}" - limit ${a}`),ku.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS);throw n.abort(e),e}return this.components.peerStore.protoBook.add(s,[o]).catch((e=>Vd.error(e))),n.source=r.source,n.sink=r.sink,n.stat.protocol=o,this.components.metrics?.trackProtocolStream(n,l),n}catch(e){if(Vd.error("could not create new stream",e),null==n.stat.timeline.close&&n.close(),null!=e.code)throw e;throw Qt(e,ku.ERR_UNSUPPORTED_PROTOCOL)}finally{null!=i&&i.clear()}},Promise.all([a.sink(i.source),i.sink(a.source)]).catch((e=>{Vd.error(e)})));const u=n.timeline;n.timeline=new Proxy(u,{set:(...e)=>(null!=l&&"close"===e[1]&&null!=e[2]&&null==u.close&&(async()=>{try{"OPEN"===l.stat.status&&await l.close()}catch(e){Vd.error(e)}finally{this.dispatchEvent(new Qr("connectionEnd",{detail:l}))}})().catch((e=>{Vd.error(e)})),Reflect.set(...e))}),n.timeline.upgraded=Date.now();const h=()=>{throw Qt(new Error("connection is not multiplexed"),ku.ERR_CONNECTION_NOT_MULTIPLEXED)};var d;return d={remoteAddr:n.remoteAddr,remotePeer:s,stat:{status:"OPEN",direction:r,timeline:n.timeline,multiplexer:a?.protocol,encryption:t},newStream:c??h,getStreams:()=>null!=a?a.streams:h(),close:async()=>{await n.close(),null!=a&&a.close()}},l=new Od(d),this.dispatchEvent(new Qr("connection",{detail:l})),l}_onStream(e){const{connection:t,stream:r,protocol:n}=e,{handler:i}=this.components.registrar.getHandler(n);i({connection:t,stream:r})}async _encryptInbound(e){const t=Array.from(this.connectionEncryption.keys());Vd("handling inbound crypto protocol selection",t);try{const{stream:r,protocol:n}=await Dd(e,t,{writeBytes:!0}),i=this.connectionEncryption.get(n);if(null==i)throw new Error(`no crypto module found for ${n}`);return Vd("encrypting inbound connection..."),{...await i.secureInbound(this.components.peerId,r),protocol:n}}catch(e){throw Qt(e,ku.ERR_ENCRYPTION_FAILED)}}async _encryptOutbound(e,t){const r=Array.from(this.connectionEncryption.keys());Vd("selecting outbound crypto protocol",r);try{const{stream:n,protocol:i}=await Nd(e,r,{writeBytes:!0}),s=this.connectionEncryption.get(i);if(null==s)throw new Error(`no crypto module found for ${i}`);return Vd("encrypting outbound connection to %p",t),{...await s.secureOutbound(this.components.peerId,n,t),protocol:i}}catch(e){throw Qt(e,ku.ERR_ENCRYPTION_FAILED)}}async _multiplexOutbound(e,t){const r=Array.from(t.keys());Vd("outbound selecting muxer %s",r);try{const{stream:n,protocol:i}=await Nd(e,r,{writeBytes:!0});return Vd("%s selected as muxer protocol",i),{stream:n,muxerFactory:t.get(i)}}catch(e){throw Vd.error("error multiplexing outbound stream",e),Qt(e,ku.ERR_MUXER_UNAVAILABLE)}}async _multiplexInbound(e,t){const r=Array.from(t.keys());Vd("inbound handling muxers %s",r);try{const{stream:n,protocol:i}=await Dd(e,r,{writeBytes:!0});return{stream:n,muxerFactory:t.get(i)}}catch(e){throw Vd.error("error multiplexing inbound stream",e),Qt(e,ku.ERR_MUXER_UNAVAILABLE)}}}var qd;!function(e){let t;e.codec=()=>(null==t&&(t=Ji(((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.protocolVersion&&(t.uint32(42),t.string(e.protocolVersion)),null!=e.agentVersion&&(t.uint32(50),t.string(e.agentVersion)),null!=e.publicKey&&(t.uint32(10),t.bytes(e.publicKey)),null!=e.listenAddrs)for(const r of e.listenAddrs)t.uint32(18),t.bytes(r);if(null!=e.observedAddr&&(t.uint32(34),t.bytes(e.observedAddr)),null!=e.protocols)for(const r of e.protocols)t.uint32(26),t.string(r);null!=e.signedPeerRecord&&(t.uint32(66),t.bytes(e.signedPeerRecord)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={listenAddrs:[],protocols:[]},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 5:r.protocolVersion=e.string();break;case 6:r.agentVersion=e.string();break;case 1:r.publicKey=e.bytes();break;case 2:r.listenAddrs.push(e.bytes());break;case 4:r.observedAddr=e.bytes();break;case 3:r.protocols.push(e.string());break;case 8:r.signedPeerRecord=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>Hi(t,e.codec()),e.decode=t=>ji(t,e.codec())}(qd||(qd={}));var jd;!function(e){let t;e.codec=()=>(null==t&&(t=Ji(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),(!0===r.writeDefaults||null!=e.publicKey&&e.publicKey.byteLength>0)&&(t.uint32(10),t.bytes(e.publicKey)),(!0===r.writeDefaults||null!=e.payloadType&&e.payloadType.byteLength>0)&&(t.uint32(18),t.bytes(e.payloadType)),(!0===r.writeDefaults||null!=e.payload&&e.payload.byteLength>0)&&(t.uint32(26),t.bytes(e.payload)),(!0===r.writeDefaults||null!=e.signature&&e.signature.byteLength>0)&&(t.uint32(42),t.bytes(e.signature)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={publicKey:new Uint8Array(0),payloadType:new Uint8Array(0),payload:new Uint8Array(0),signature:new Uint8Array(0)},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.publicKey=e.bytes();break;case 2:r.payloadType=e.bytes();break;case 3:r.payload=e.bytes();break;case 5:r.signature=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>Hi(t,e.codec()),e.decode=t=>ji(t,e.codec())}(jd||(jd={}));class Hd{constructor(e){const{peerId:t,payloadType:r,payload:n,signature:i}=e;this.peerId=t,this.payloadType=r,this.payload=n,this.signature=i}marshal(){if(null==this.peerId.publicKey)throw new Error("Missing public key");return null==this.marshaled&&(this.marshaled=jd.encode({publicKey:this.peerId.publicKey,payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return Xt(this.marshal(),e.marshal())}async validate(e){const t=zd(e,this.payloadType,this.payload);if(null==this.peerId.publicKey)throw new Error("Missing public key");const r=qa(this.peerId.publicKey);return await r.verify(t.subarray(),this.signature)}}Hd.createFromProtobuf=async e=>{const t=jd.decode(e),r=await sc(t.publicKey);return new Hd({peerId:r,payloadType:t.payloadType,payload:t.payload,signature:t.signature})},Hd.seal=async(e,t)=>{if(null==t.privateKey)throw new Error("Missing private key");const r=e.domain,n=e.codec,i=e.marshal(),s=zd(r,n,i),o=await ja(t.privateKey),a=await o.sign(s.subarray());return new Hd({peerId:t,payloadType:n,payload:i,signature:a})},Hd.openAndCertify=async(e,t)=>{const r=await Hd.createFromProtobuf(e);if(!await r.validate(t))throw Qt(new Error("envelope signature is not valid for the given domain"),"ERR_SIGNATURE_NOT_VALID");return r};const zd=(e,t,r)=>{const n=Pt(e),i=li.encode(n.byteLength),s=li.encode(t.length),o=li.encode(r.length);return new In(i,n,s,t,o,r)};var $d;!function(e){let t,r;!function(e){let t;e.codec=()=>(null==t&&(t=Ji(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),(!0===r.writeDefaults||null!=e.multiaddr&&e.multiaddr.byteLength>0)&&(t.uint32(10),t.bytes(e.multiaddr)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={multiaddr:new Uint8Array(0)},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();t>>>3==1?r.multiaddr=e.bytes():e.skipType(7&t)}return r}))),t),e.encode=t=>Hi(t,e.codec()),e.decode=t=>ji(t,e.codec())}(t=e.AddressInfo||(e.AddressInfo={})),e.codec=()=>(null==r&&(r=Ji(((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),(!0===n.writeDefaults||null!=t.peerId&&t.peerId.byteLength>0)&&(r.uint32(10),r.bytes(t.peerId)),!0!==n.writeDefaults&&0n===t.seq||(r.uint32(16),r.uint64(t.seq)),null!=t.addresses)for(const n of t.addresses)r.uint32(26),e.AddressInfo.codec().encode(n,r,{writeDefaults:!0});!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={peerId:new Uint8Array(0),seq:0n,addresses:[]},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();switch(r>>>3){case 1:n.peerId=t.bytes();break;case 2:n.seq=t.uint64();break;case 3:n.addresses.push(e.AddressInfo.codec().decode(t,t.uint32()));break;default:t.skipType(7&r)}}return n}))),r),e.encode=t=>Hi(t,e.codec()),e.decode=t=>ji(t,e.codec())}($d||($d={}));const Gd=Uint8Array.from([3,1]);class Wd{constructor(e){this.domain=Wd.DOMAIN,this.codec=Wd.CODEC;const{peerId:t,multiaddrs:r,seqNumber:n}=e;this.peerId=t,this.multiaddrs=r??[],this.seqNumber=n??BigInt(Date.now())}marshal(){return null==this.marshaled&&(this.marshaled=$d.encode({peerId:this.peerId.toBytes(),seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map((e=>({multiaddr:e.bytes})))})),this.marshaled}equals(e){return e instanceof Wd&&!!this.peerId.equals(e.peerId)&&this.seqNumber===e.seqNumber&&!!function(e,t){const r=(e,t)=>e.toString().localeCompare(t.toString());return e.length===t.length&&(t.sort(r),e.sort(r).every(((e,r)=>t[r].equals(e))))}(this.multiaddrs,e.multiaddrs)}}Wd.createFromProtobuf=e=>{const t=$d.decode(e),r=ic(t.peerId),n=(t.addresses??[]).map((e=>hr(e.multiaddr))),i=t.seq;return new Wd({peerId:r,multiaddrs:n,seqNumber:i})},Wd.DOMAIN="libp2p-peer-record",Wd.CODEC=Gd;const Yd="0.0.0",Qd=`js-libp2p/${Yd}`,Xd=ne("libp2p:identify");class Zd{constructor(e,t){this.components=e,this.started=!1,this.init=t,this.identifyProtocolStr=`/${t.protocolPrefix}/id/1.0.0`,this.identifyPushProtocolStr=`/${t.protocolPrefix}/id/push/1.0.0`,this.host={protocolVersion:`${t.protocolPrefix}/0.1.0`,...t.host},this.components.connectionManager.addEventListener("peer:connect",(e=>{const t=e.detail;this.identify(t).catch(Xd.error)})),this.components.peerStore.addEventListener("change:multiaddrs",(e=>{const{peerId:t}=e.detail;this.components.peerId.equals(t)&&this.pushToPeerStore().catch((e=>Xd.error(e)))})),this.components.peerStore.addEventListener("change:protocols",(e=>{const{peerId:t}=e.detail;this.components.peerId.equals(t)&&this.pushToPeerStore().catch((e=>Xd.error(e)))}))}isStarted(){return this.started}async start(){this.started||(await this.components.peerStore.metadataBook.setValue(this.components.peerId,"AgentVersion",Pt(this.host.agentVersion)),await this.components.peerStore.metadataBook.setValue(this.components.peerId,"ProtocolVersion",Pt(this.host.protocolVersion)),await this.components.registrar.handle(this.identifyProtocolStr,(e=>{this._handleIdentify(e).catch((e=>{Xd.error(e)}))}),{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),await this.components.registrar.handle(this.identifyPushProtocolStr,(e=>{this._handlePush(e).catch((e=>{Xd.error(e)}))}),{maxInboundStreams:this.init.maxPushIncomingStreams,maxOutboundStreams:this.init.maxPushOutgoingStreams}),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.identifyProtocolStr),await this.components.registrar.unhandle(this.identifyPushProtocolStr),this.started=!1}async push(e){const t=await this.components.peerStore.addressBook.getRawEnvelope(this.components.peerId),r=this.components.addressManager.getAddresses().map((e=>e.bytes)),n=await this.components.peerStore.protoBook.get(this.components.peerId),i=e.map((async e=>{let i;const s=new Pu.TimeoutController(this.init.timeout);try{(0,xu.setMaxListeners)?.(1/0,s.signal)}catch{}try{i=await e.newStream([this.identifyPushProtocolStr],{signal:s.signal});const o=Hr(i,s.signal);await o.sink(Ci([qd.encode({listenAddrs:r,signedPeerRecord:t,protocols:n})],hi()))}catch(e){Xd.error("could not push identify update to peer",e)}finally{null!=i&&i.close(),s.clear()}}));await Promise.all(i)}async pushToPeerStore(){if(!this.isStarted())return;const e=[];for(const t of this.components.connectionManager.getConnections()){const r=t.remotePeer;(await this.components.peerStore.get(r)).protocols.includes(this.identifyPushProtocolStr)&&e.push(t)}await this.push(e)}async _identify(e,t={}){let r,n,i=t.signal;if(null==i){r=new Pu.TimeoutController(this.init.timeout),i=r.signal;try{(0,xu.setMaxListeners)?.(1/0,r.signal)}catch{}}try{n=await e.newStream([this.identifyProtocolStr],{signal:i});const t=Hr(n,i),r=await Ci([],t,gi({maxDataLength:this.init.maxIdentifyMessageSize??8192}),(async e=>await Bu(e)));if(null==r)throw Qt(new Error("No data could be retrieved"),ku.ERR_CONNECTION_ENDED);try{return qd.decode(r)}catch(e){throw Qt(e,ku.ERR_INVALID_MESSAGE)}}finally{null!=r&&r.clear(),null!=n&&n.close()}}async identify(e,t={}){const r=await this._identify(e,t),{publicKey:n,listenAddrs:i,protocols:s,observedAddr:o,signedPeerRecord:a,agentVersion:c,protocolVersion:l}=r;if(null==n)throw Qt(new Error("public key was missing from identify message"),ku.ERR_MISSING_PUBLIC_KEY);const u=await sc(n);if(!e.remotePeer.equals(u))throw Qt(new Error("identified peer does not match the expected peer"),ku.ERR_INVALID_PEER);if(this.components.peerId.equals(u))throw Qt(new Error("identified peer is our own peer id?"),ku.ERR_INVALID_PEER);const h=Zd.getCleanMultiaddr(o);if(null!=a){Xd("received signed peer record from %p",u);try{const e=await Hd.openAndCertify(a,Wd.DOMAIN);if(!e.peerId.equals(u))throw Qt(new Error("identified peer does not match the expected peer"),ku.ERR_INVALID_PEER);if(await this.components.peerStore.addressBook.consumePeerRecord(e))return await this.components.peerStore.protoBook.set(u,s),null!=c&&await this.components.peerStore.metadataBook.setValue(u,"AgentVersion",Pt(c)),null!=l&&await this.components.peerStore.metadataBook.setValue(u,"ProtocolVersion",Pt(l)),void Xd("identify completed for peer %p and protocols %o",u,s)}catch(e){Xd("received invalid envelope, discard it and fallback to listenAddrs is available",e)}}else Xd("no signed peer record received from %p",u);Xd("falling back to legacy addresses from %p",u);try{await this.components.peerStore.addressBook.set(u,i.map((e=>hr(e))))}catch(e){Xd.error("received invalid addrs",e)}await this.components.peerStore.protoBook.set(u,s),null!=c&&await this.components.peerStore.metadataBook.setValue(u,"AgentVersion",Pt(c)),null!=l&&await this.components.peerStore.metadataBook.setValue(u,"ProtocolVersion",Pt(l)),Xd("identify completed for peer %p and protocols %o",u,s),Xd("received observed address of %s",h?.toString())}async _handleIdentify(e){const{connection:t,stream:r}=e,n=new Pu.TimeoutController(this.init.timeout);try{(0,xu.setMaxListeners)?.(1/0,n.signal)}catch{}try{const e=this.components.peerId.publicKey??new Uint8Array(0),i=await this.components.peerStore.get(this.components.peerId),s=this.components.addressManager.getAddresses().map((e=>e.decapsulateCode(Lt("p2p").code)));let o=i.peerRecordEnvelope;if(s.length>0&&null==o){const e=new Wd({peerId:this.components.peerId,multiaddrs:s}),t=await Hd.seal(e,this.components.peerId);await this.components.peerStore.addressBook.consumePeerRecord(t),o=t.marshal().subarray()}const a=qd.encode({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:e,listenAddrs:s.map((e=>e.bytes)),signedPeerRecord:o,observedAddr:t.remoteAddr.bytes,protocols:i.protocols}),c=Hr(r,n.signal),l=Ci([a],hi());await c.sink(l)}catch(e){Xd.error("could not respond to identify request",e)}finally{r.close(),n.clear()}}async _handlePush(e){const{connection:t,stream:r}=e,n=new Pu.TimeoutController(this.init.timeout);try{(0,xu.setMaxListeners)?.(1/0,n.signal)}catch{}let i;try{const e=Hr(r,n.signal),t=await Ci([],e,gi({maxDataLength:this.init.maxIdentifyMessageSize??8192}),(async e=>await Bu(e)));null!=t&&(i=qd.decode(t))}catch(e){return Xd.error("received invalid message",e)}finally{r.close(),n.clear()}if(null==i)return Xd.error("received invalid message");const s=t.remotePeer;if(this.components.peerId.equals(s))Xd("received push from ourselves?");else{if(Xd("received push from %p",s),null!=i.signedPeerRecord){Xd("received signedPeerRecord in push");try{const e=await Hd.openAndCertify(i.signedPeerRecord,Wd.DOMAIN);if(await this.components.peerStore.addressBook.consumePeerRecord(e))return Xd("consumed signedPeerRecord sent in push"),void await this.components.peerStore.protoBook.set(s,i.protocols);Xd("failed to consume signedPeerRecord sent in push")}catch(e){Xd("received invalid envelope, discard it and fallback to listenAddrs is available",e)}}else Xd("did not receive signedPeerRecord in push");try{await this.components.peerStore.addressBook.set(s,i.listenAddrs.map((e=>hr(e))))}catch(e){Xd.error("received invalid addrs",e)}try{await this.components.peerStore.protoBook.set(s,i.protocols)}catch(e){Xd.error("received invalid protocols",e)}Xd("handled push from %p",s)}}static getCleanMultiaddr(e){if(null!=e&&e.length>0)try{return hr(e)}catch{}}}var Jd,ep;!function(e){let t;e.codec=()=>(null==t&&(t=Ji(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),!0!==r.writeDefaults&&""===e.identifier||(t.uint32(10),t.string(e.identifier)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={identifier:""},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();t>>>3==1?r.identifier=e.string():e.skipType(7&t)}return r}))),t),e.encode=t=>Hi(t,e.codec()),e.decode=t=>ji(t,e.codec())}(Jd||(Jd={})),function(e){let t,r,n;!function(e){e.OK="OK",e.NOT_FOUND="NOT_FOUND",e.ERROR="ERROR"}(t=e.StatusCode||(e.StatusCode={})),function(e){e[e.OK=0]="OK",e[e.NOT_FOUND=1]="NOT_FOUND",e[e.ERROR=2]="ERROR"}(r||(r={})),function(e){e.codec=()=>Zi(r)}(t=e.StatusCode||(e.StatusCode={})),e.codec=()=>(null==n&&(n=Ji(((t,n,i={})=>{!1!==i.lengthDelimited&&n.fork(),(!0===i.writeDefaults||null!=t.status&&0!==r[t.status])&&(n.uint32(8),e.StatusCode.codec().encode(t.status,n)),(!0===i.writeDefaults||null!=t.data&&t.data.byteLength>0)&&(n.uint32(18),n.bytes(t.data)),!1!==i.lengthDelimited&&n.ldelim()}),((r,n)=>{const i={status:t.OK,data:new Uint8Array(0)},s=null==n?r.len:r.pos+n;for(;r.pos<s;){const t=r.uint32();switch(t>>>3){case 1:i.status=e.StatusCode.codec().decode(r);break;case 2:i.data=r.bytes();break;default:r.skipType(7&t)}}return i}))),n),e.encode=t=>Hi(t,e.codec()),e.decode=t=>ji(t,e.codec())}(ep||(ep={}));const tp=ne("libp2p:fetch");class rp{constructor(e,t){this.started=!1,this.components=e,this.protocol=`/${t.protocolPrefix??"libp2p"}/fetch/0.0.1`,this.lookupFunctions=new Map,this.handleMessage=this.handleMessage.bind(this),this.init=t}async start(){await this.components.registrar.handle(this.protocol,(e=>{this.handleMessage(e).catch((e=>{tp.error(e)})).finally((()=>{e.stream.close()}))}),{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}async fetch(e,t,r={}){tp("dialing %s to %p",this.protocol,e);const n=await this.components.connectionManager.openConnection(e,r);let i,s,o=r.signal;if(null==o){tp("using default timeout of %d ms",this.init.timeout),i=new Pu.TimeoutController(this.init.timeout),o=i.signal;try{(0,xu.setMaxListeners)?.(1/0,i.signal)}catch{}}try{s=await n.newStream(this.protocol,{signal:o});const e=Hr(s,o);tp("fetch %s",t);const r=await Ci([Jd.encode({identifier:t})],hi(),e,gi(),(async function(e){const r=await Bu(e);if(null==r)throw Qt(new Error("No data received"),ku.ERR_INVALID_MESSAGE);const n=ep.decode(r);switch(n.status){case ep.StatusCode.OK:return tp("received status for %s ok",t),n.data;case ep.StatusCode.NOT_FOUND:return tp("received status for %s not found",t),null;case ep.StatusCode.ERROR:{tp("received status for %s error",t);const e=St(n.data);throw Qt(new Error("Error in fetch protocol response: "+e),ku.ERR_INVALID_PARAMETERS)}default:throw tp("received status for %s unknown",t),Qt(new Error("Unknown response status"),ku.ERR_INVALID_MESSAGE)}}));return r??null}finally{null!=i&&i.clear(),null!=s&&s.close()}}async handleMessage(e){const{stream:t}=e,r=this;await Ci(t,gi(),(async function*(e){const t=await Bu(e);if(null==t)throw Qt(new Error("No data received"),ku.ERR_INVALID_MESSAGE);const n=Jd.decode(t);let i;const s=r._getLookupFunction(n.identifier);if(null!=s){tp("look up data with identifier %s",n.identifier);const e=await s(n.identifier);null!=e?(tp("sending status for %s ok",n.identifier),i={status:ep.StatusCode.OK,data:e}):(tp("sending status for %s not found",n.identifier),i={status:ep.StatusCode.NOT_FOUND,data:new Uint8Array(0)})}else{tp("sending status for %s error",n.identifier);const e=Pt(`No lookup function registered for key: ${n.identifier}`);i={status:ep.StatusCode.ERROR,data:e}}yield ep.encode(i)}),hi(),t)}_getLookupFunction(e){for(const t of this.lookupFunctions.keys())if(e.startsWith(t))return this.lookupFunctions.get(t)}registerLookupFunction(e,t){if(this.lookupFunctions.has(e))throw Qt(new Error("Fetch protocol handler for key prefix '"+e+"' already registered"),ku.ERR_KEY_ALREADY_EXISTS);this.lookupFunctions.set(e,t)}unregisterLookupFunction(e,t){null!=t&&this.lookupFunctions.get(e)!==t||this.lookupFunctions.delete(e)}}const np=ne("libp2p:ping");class ip{constructor(e,t){this.components=e,this.started=!1,this.protocol=`/${t.protocolPrefix}/ping/1.0.0`,this.init=t}async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(e){const{stream:t}=e;Ci(t,t).catch((e=>{np.error(e)}))}async ping(e,t={}){np("dialing %s to %p",this.protocol,e);const r=Date.now(),n=po(32),i=await this.components.connectionManager.openConnection(e,t);let s,o,a=t.signal;if(null==a){s=new Pu.TimeoutController(this.init.timeout),a=s.signal;try{(0,xu.setMaxListeners)?.(1/0,s.signal)}catch{}}try{o=await i.newStream([this.protocol],{signal:a});const e=Hr(o,a),t=await Ci([n],e,(async e=>await Bu(e))),s=Date.now();if(null==t||!Xt(n,t.subarray()))throw Qt(new Error("Received wrong ping ack"),ku.ERR_WRONG_PING_ACK);return s-r}finally{null!=s&&s.clear(),null!=o&&o.close()}}}var sp=__webpack_require__(9134);const op="object"==typeof window&&"object"==typeof document&&9===document.nodeType,ap=sp(),cp=op&&!ap,lp=ap&&!op,up=ap&&op,hp=void 0!==globalThis.process&&void 0!==globalThis.process.release&&"node"===globalThis.process.release.name&&!ap,dp="function"==typeof importScripts&&"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,pp=(void 0!==globalThis.process&&void 0!==globalThis.process.env&&globalThis.process.env.NODE_ENV,"undefined"!=typeof navigator&&"ReactNative"===navigator.product);function fp(e){const{address:t}=e.nodeAddress();return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(r=t)||/^::1$/.test(r);var r}const yp=ne("libp2p:nat");function gp(e=1024,t=65535){return Math.floor(Math.random()*(t-e+1)+e)}class mp{constructor(e,t){if(this.components=e,this.started=!1,this.enabled=t.enabled,this.externalAddress=t.externalAddress,this.localAddress=t.localAddress,this.description=t.description??`libp2p@${Yd} ${this.components.peerId.toString()}`,this.ttl=t.ttl??7200,this.keepAlive=t.keepAlive??!0,this.gateway=t.gateway,this.ttl<7200)throw Qt(new Error("NatManager ttl should be at least 7200 seconds"),ku.ERR_INVALID_PARAMETERS)}isStarted(){return this.started}start(){}afterStart(){cp||!this.enabled||this.started||(this.started=!0,this._start().catch((e=>{yp.error(e)})))}async _start(){const e=this.components.transportManager.getAddrs();for(const t of e){const{family:e,host:r,port:n,transport:i}=t.toOptions();if(!t.isThinWaistAddress()||"tcp"!==i)continue;if(fp(t))continue;if(4!==e)continue;const s=await this._getClient(),o=this.externalAddress??await s.externalIp(),a=Fh(o);if(!0===a)throw new Error(`${o} is private - please set config.nat.externalIp to an externally routable IP or ensure you are not behind a double NAT`);if(null==a)throw new Error(`${o} is not an IP address`);const c=gp();yp(`opening uPnP connection from ${o}:${c} to ${r}:${n}`),await s.map({publicPort:c,localPort:n,localAddress:this.localAddress,protocol:"TCP"===i.toUpperCase()?"TCP":"UDP"}),this.components.addressManager.addObservedAddr(cr({family:4,address:o,port:c},i))}}async _getClient(){return null!=this.client||(this.client=await async function(){throw new Error("Not supported in browsers")}((this.description,this.ttl,this.keepAlive,this.gateway))),this.client}async stop(){if(!cp&&null!=this.client)try{await this.client.close(),this.client=void 0}catch(e){yp.error(e)}}}const wp=ne("libp2p:peer-record-updater");class Ep{constructor(e){this.components=e,this.started=!1,this.update=this.update.bind(this)}isStarted(){return this.started}async start(){this.started=!0,this.components.transportManager.addEventListener("listener:listening",this.update),this.components.transportManager.addEventListener("listener:close",this.update),this.components.addressManager.addEventListener("change:addresses",this.update)}async stop(){this.started=!1,this.components.transportManager.removeEventListener("listener:listening",this.update),this.components.transportManager.removeEventListener("listener:close",this.update),this.components.addressManager.removeEventListener("change:addresses",this.update)}update(){Promise.resolve().then((async()=>{const e=new Wd({peerId:this.components.peerId,multiaddrs:this.components.addressManager.getAddresses().map((e=>e.decapsulateCode(Lt("p2p").code)))}),t=await Hd.seal(e,this.components.peerId);await this.components.peerStore.addressBook.consumePeerRecord(t)})).catch((e=>{wp.error("Could not update self peer record: %o",e)}))}}class bp{constructor(e){this.dht=e}async findPeer(e,t={}){for await(const r of this.dht.findPeer(e,t))if("FINAL_PEER"===r.name)return r.peer;throw Qt(new Error(Ru.NOT_FOUND),ku.ERR_NOT_FOUND)}async*getClosestPeers(e,t={}){for await(const r of this.dht.getClosestPeers(e,t))"FINAL_PEER"===r.name&&(yield r.peer)}}const vp={ERR_INVALID_PARAMETERS:"ERR_INVALID_PARAMETERS",ERR_NOT_FOUND:"ERR_NOT_FOUND"},_p=ne("libp2p:peer-store:address-book"),Sp="change:multiaddrs";async function Cp(){return!0}class Ap{constructor(e,t,r){this.dispatchEvent=e,this.store=t,this.addressFilter=r??Cp}async consumePeerRecord(e){_p.trace("consumePeerRecord await write lock");const t=await this.store.lock.writeLock();let r,n,i;_p.trace("consumePeerRecord got write lock");try{let t;try{t=Wd.createFromProtobuf(e.payload)}catch(e){return _p.error("invalid peer record received"),!1}r=t.peerId;const s=t.multiaddrs;if(!r.equals(e.peerId))return _p("signing key does not match PeerId in the PeerRecord"),!1;if(null==s||0===s.length)return!1;if(await this.store.has(r)&&(n=await this.store.load(r),null!=n.peerRecordEnvelope)){const e=await Hd.createFromProtobuf(n.peerRecordEnvelope),r=Wd.createFromProtobuf(e.payload);if(r.seqNumber>=t.seqNumber)return _p("sequence number was lower or equal to existing sequence number - stored: %d received: %d",r.seqNumber,t.seqNumber),!1}const o=await Ip(r,s,this.addressFilter,!0);i=await this.store.patchOrCreate(r,{addresses:o,peerRecordEnvelope:e.marshal().subarray()}),_p("stored provided peer record for %p",t.peerId)}finally{_p.trace("consumePeerRecord release write lock"),t()}return this.dispatchEvent(new Qr(Sp,{detail:{peerId:r,multiaddrs:i.addresses.map((({multiaddr:e})=>e)),oldMultiaddrs:null==n?[]:n.addresses.map((({multiaddr:e})=>e))}})),!0}async getRawEnvelope(e){_p.trace("getRawEnvelope await read lock");const t=await this.store.lock.readLock();_p.trace("getRawEnvelope got read lock");try{return(await this.store.load(e)).peerRecordEnvelope}catch(e){if(e.code!==vp.ERR_NOT_FOUND)throw e}finally{_p.trace("getRawEnvelope release read lock"),t()}}async getPeerRecord(e){const t=await this.getRawEnvelope(e);if(null!=t)return await Hd.createFromProtobuf(t)}async get(e){e=rc(e),_p.trace("get wait for read lock");const t=await this.store.lock.readLock();_p.trace("get got read lock");try{return(await this.store.load(e)).addresses}catch(e){if(e.code!==vp.ERR_NOT_FOUND)throw e}finally{_p.trace("get release read lock"),t()}return[]}async set(e,t){if(e=rc(e),!Array.isArray(t))throw _p.error("multiaddrs must be an array of Multiaddrs"),new rs("multiaddrs must be an array of Multiaddrs",vp.ERR_INVALID_PARAMETERS);_p.trace("set await write lock");const r=await this.store.lock.writeLock();_p.trace("set got write lock");let n,i,s=!1;try{const r=await Ip(e,t,this.addressFilter);if(0===r.length)return;try{if(n=await this.store.load(e),s=!0,new Set([...r.map((({multiaddr:e})=>e.toString())),...n.addresses.map((({multiaddr:e})=>e.toString()))]).size===n.addresses.length&&r.length===n.addresses.length)return}catch(e){if(e.code!==vp.ERR_NOT_FOUND)throw e}i=await this.store.patchOrCreate(e,{addresses:r}),_p("set multiaddrs for %p",e)}finally{_p.trace("set multiaddrs for %p",e),_p("set release write lock"),r()}this.dispatchEvent(new Qr(Sp,{detail:{peerId:e,multiaddrs:i.addresses.map((e=>e.multiaddr)),oldMultiaddrs:null==n?[]:n.addresses.map((({multiaddr:e})=>e))}})),s||this.dispatchEvent(new Qr("peer",{detail:{id:e,multiaddrs:i.addresses.map((e=>e.multiaddr)),protocols:i.protocols}}))}async add(e,t){if(e=rc(e),!Array.isArray(t))throw _p.error("multiaddrs must be an array of Multiaddrs"),new rs("multiaddrs must be an array of Multiaddrs",vp.ERR_INVALID_PARAMETERS);_p.trace("add await write lock");const r=await this.store.lock.writeLock();let n,i,s;_p.trace("add got write lock");try{const r=await Ip(e,t,this.addressFilter);if(0===r.length)return;try{if(i=await this.store.load(e),n=!0,new Set([...r.map((({multiaddr:e})=>e.toString())),...i.addresses.map((({multiaddr:e})=>e.toString()))]).size===i.addresses.length)return}catch(e){if(e.code!==vp.ERR_NOT_FOUND)throw e}s=await this.store.mergeOrCreate(e,{addresses:r}),_p("added multiaddrs for %p",e)}finally{_p.trace("set release write lock"),r()}this.dispatchEvent(new Qr(Sp,{detail:{peerId:e,multiaddrs:s.addresses.map((e=>e.multiaddr)),oldMultiaddrs:null==i?[]:i.addresses.map((({multiaddr:e})=>e))}})),!0===n&&this.dispatchEvent(new Qr("peer",{detail:{id:e,multiaddrs:s.addresses.map((e=>e.multiaddr)),protocols:s.protocols}}))}async delete(e){e=rc(e),_p.trace("delete await write lock");const t=await this.store.lock.writeLock();let r;_p.trace("delete got write lock");try{try{r=await this.store.load(e)}catch(e){if(e.code!==vp.ERR_NOT_FOUND)throw e}await this.store.patchOrCreate(e,{addresses:[]})}finally{_p.trace("delete release write lock"),t()}null!=r&&this.dispatchEvent(new Qr(Sp,{detail:{peerId:e,multiaddrs:[],oldMultiaddrs:null==r?[]:r.addresses.map((({multiaddr:e})=>e))}}))}}async function Ip(e,t,r,n=!1){const i=[];return await Promise.all(t.map((async t=>{if(!lr(t))throw _p.error("multiaddr must be an instance of Multiaddr"),new rs("multiaddr must be an instance of Multiaddr",vp.ERR_INVALID_PARAMETERS);await r(e,t)&&i.push({multiaddr:t,isCertified:n})}))),i}const Tp=ne("libp2p:peer-store:key-book"),Rp="change:pubkey";class kp{constructor(e,t){this.dispatchEvent=e,this.store=t}async set(e,t){if(e=rc(e),!(t instanceof Uint8Array))throw Tp.error("publicKey must be an instance of Uint8Array to store data"),new rs("publicKey must be an instance of PublicKey",vp.ERR_INVALID_PARAMETERS);Tp.trace("set await write lock");const r=await this.store.lock.writeLock();Tp.trace("set got write lock");let n,i=!1;try{try{if(n=await this.store.load(e),null!=n.pubKey&&Xt(n.pubKey,t))return}catch(e){if(e.code!==vp.ERR_NOT_FOUND)throw e}await this.store.patchOrCreate(e,{pubKey:t}),i=!0}finally{Tp.trace("set release write lock"),r()}i&&this.dispatchEvent(new Qr(Rp,{detail:{peerId:e,publicKey:t,oldPublicKey:null==n?void 0:n.pubKey}}))}async get(e){e=rc(e),Tp.trace("get await write lock");const t=await this.store.lock.readLock();Tp.trace("get got write lock");try{return(await this.store.load(e)).pubKey}catch(e){if(e.code!==vp.ERR_NOT_FOUND)throw e}finally{Tp("get release write lock"),t()}}async delete(e){e=rc(e),Tp.trace("delete await write lock");const t=await this.store.lock.writeLock();let r;Tp.trace("delete got write lock");try{try{r=await this.store.load(e)}catch(e){if(e.code!==vp.ERR_NOT_FOUND)throw e}await this.store.patchOrCreate(e,{pubKey:void 0})}catch(e){if(e.code!==vp.ERR_NOT_FOUND)throw e}finally{Tp.trace("delete release write lock"),t()}this.dispatchEvent(new Qr(Rp,{detail:{peerId:e,publicKey:void 0,oldPublicKey:null==r?void 0:r.pubKey}}))}}const Np=ne("libp2p:peer-store:metadata-book"),Lp="change:metadata";class Dp{constructor(e,t){this.dispatchEvent=e,this.store=t}async get(e){e=rc(e),Np.trace("get await read lock");const t=await this.store.lock.readLock();Np.trace("get got read lock");try{return(await this.store.load(e)).metadata}catch(e){if(e.code!==vp.ERR_NOT_FOUND)throw e}finally{Np.trace("get release read lock"),t()}return new Map}async getValue(e,t){e=rc(e),Np.trace("getValue await read lock");const r=await this.store.lock.readLock();Np.trace("getValue got read lock");try{return(await this.store.load(e)).metadata.get(t)}catch(e){if(e.code!==vp.ERR_NOT_FOUND)throw e}finally{Np.trace("getValue release write lock"),r()}}async set(e,t){if(e=rc(e),!(t instanceof Map))throw Np.error("valid metadata must be provided to store data"),new rs("valid metadata must be provided",vp.ERR_INVALID_PARAMETERS);Np.trace("set await write lock");const r=await this.store.lock.writeLock();let n;Np.trace("set got write lock");try{try{n=await this.store.load(e)}catch(e){if(e.code!==vp.ERR_NOT_FOUND)throw e}await this.store.mergeOrCreate(e,{metadata:t})}finally{Np.trace("set release write lock"),r()}this.dispatchEvent(new Qr(Lp,{detail:{peerId:e,metadata:t,oldMetadata:null==n?new Map:n.metadata}}))}async setValue(e,t,r){if(e=rc(e),"string"!=typeof t||!(r instanceof Uint8Array))throw Np.error("valid key and value must be provided to store data"),new rs("valid key and value must be provided",vp.ERR_INVALID_PARAMETERS);Np.trace("setValue await write lock");const n=await this.store.lock.writeLock();let i,s;Np.trace("setValue got write lock");try{try{i=await this.store.load(e);const n=i.metadata.get(t);if(null!=n&&Xt(r,n))return}catch(e){if(e.code!==vp.ERR_NOT_FOUND)throw e}s=await this.store.mergeOrCreate(e,{metadata:new Map([[t,r]])})}finally{Np.trace("setValue release write lock"),n()}this.dispatchEvent(new Qr(Lp,{detail:{peerId:e,metadata:s.metadata,oldMetadata:null==i?new Map:i.metadata}}))}async delete(e){e=rc(e),Np.trace("delete await write lock");const t=await this.store.lock.writeLock();let r;Np.trace("delete got write lock");try{try{r=await this.store.load(e)}catch(e){if(e.code!==vp.ERR_NOT_FOUND)throw e}null!=r&&await this.store.patch(e,{metadata:new Map})}finally{Np.trace("delete release write lock"),t()}null!=r&&this.dispatchEvent(new Qr(Lp,{detail:{peerId:e,metadata:new Map,oldMetadata:r.metadata}}))}async deleteValue(e,t){e=rc(e),Np.trace("deleteValue await write lock");const r=await this.store.lock.writeLock();let n,i;Np.trace("deleteValue got write lock");try{i=await this.store.load(e),n=i.metadata,n.delete(t),await this.store.patch(e,{metadata:n})}catch(e){if(e.code!==vp.ERR_NOT_FOUND)throw e}finally{Np.trace("deleteValue release write lock"),r()}null!=n&&this.dispatchEvent(new Qr(Lp,{detail:{peerId:e,metadata:n,oldMetadata:null==i?new Map:i.metadata}}))}}const Pp=ne("libp2p:peer-store:proto-book"),Bp="change:protocols";class Op{constructor(e,t){this.dispatchEvent=e,this.store=t}async get(e){Pp.trace("get wait for read lock");const t=await this.store.lock.readLock();Pp.trace("get got read lock");try{return(await this.store.load(e)).protocols}catch(e){if(e.code!==vp.ERR_NOT_FOUND)throw e}finally{Pp.trace("get release read lock"),t()}return[]}async set(e,t){if(e=rc(e),!Array.isArray(t))throw Pp.error("protocols must be provided to store data"),new rs("protocols must be provided",vp.ERR_INVALID_PARAMETERS);Pp.trace("set await write lock");const r=await this.store.lock.writeLock();let n,i;Pp.trace("set got write lock");try{try{if(n=await this.store.load(e),new Set([...t]).size===n.protocols.length)return}catch(e){if(e.code!==vp.ERR_NOT_FOUND)throw e}i=await this.store.patchOrCreate(e,{protocols:t}),Pp("stored provided protocols for %p",e)}finally{Pp.trace("set release write lock"),r()}this.dispatchEvent(new Qr(Bp,{detail:{peerId:e,protocols:i.protocols,oldProtocols:null==n?[]:n.protocols}}))}async add(e,t){if(e=rc(e),!Array.isArray(t))throw Pp.error("protocols must be provided to store data"),new rs("protocols must be provided",vp.ERR_INVALID_PARAMETERS);Pp.trace("add await write lock");const r=await this.store.lock.writeLock();let n,i;Pp.trace("add got write lock");try{try{if(n=await this.store.load(e),new Set([...n.protocols,...t]).size===n.protocols.length)return}catch(e){if(e.code!==vp.ERR_NOT_FOUND)throw e}i=await this.store.mergeOrCreate(e,{protocols:t}),Pp("added provided protocols for %p",e)}finally{Pp.trace("add release write lock"),r()}this.dispatchEvent(new Qr(Bp,{detail:{peerId:e,protocols:i.protocols,oldProtocols:null==n?[]:n.protocols}}))}async remove(e,t){if(e=rc(e),!Array.isArray(t))throw Pp.error("protocols must be provided to store data"),new rs("protocols must be provided",vp.ERR_INVALID_PARAMETERS);Pp.trace("remove await write lock");const r=await this.store.lock.writeLock();let n,i;Pp.trace("remove got write lock");try{try{n=await this.store.load(e);const r=new Set(n.protocols);for(const e of t)r.delete(e);if(n.protocols.length===r.size)return;t=Array.from(r)}catch(e){if(e.code!==vp.ERR_NOT_FOUND)throw e}i=await this.store.patchOrCreate(e,{protocols:t})}finally{Pp.trace("remove release write lock"),r()}this.dispatchEvent(new Qr(Bp,{detail:{peerId:e,protocols:i.protocols,oldProtocols:null==n?[]:n.protocols}}))}async delete(e){e=rc(e),Pp.trace("delete await write lock");const t=await this.store.lock.writeLock();let r;Pp.trace("delete got write lock");try{try{r=await this.store.load(e)}catch(e){if(e.code!==vp.ERR_NOT_FOUND)throw e}await this.store.patchOrCreate(e,{protocols:[]})}finally{Pp.trace("delete release write lock"),t()}null!=r&&this.dispatchEvent(new Qr(Bp,{detail:{peerId:e,protocols:[],oldProtocols:r.protocols}}))}}Fi._configure(),Ui._configure(Mi),Vi._configure(Ki);const xp=["uint64","int64","sint64","fixed64","sfixed64"];function Up(e,t){const r=function(e){return function(e){for(const t of xp){if(null==e[t])continue;const r=e[t];e[t]=function(){return BigInt(r.call(this).toString())}}return e}(new Ui(e))}(e instanceof Uint8Array?e:e.subarray());return t.decode(r)}function Mp(e,t){const r=function(e){for(const t of xp){if(null==e[t])continue;const r=e[t];e[t]=function(e){return r.call(this,e.toString())}}return e}(Vi.create());return t.encode(e,r,{lengthDelimited:!1}),r.finish()}var Vp,Kp,Fp,qp;function jp(e,t){return function(e,t,r,n){return{name:"message",type:t,encode:r,decode:n}}(0,Vp.LENGTH_DELIMITED,e,t)}!function(e){e[e.VARINT=0]="VARINT",e[e.BIT64=1]="BIT64",e[e.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",e[e.START_GROUP=3]="START_GROUP",e[e.END_GROUP=4]="END_GROUP",e[e.BIT32=5]="BIT32"}(Vp||(Vp={})),function(e){let t;e.codec=()=>(null==t&&(t=jp(((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.addresses)for(const r of e.addresses)t.uint32(10),Fp.codec().encode(r,t);if(null!=e.protocols)for(const r of e.protocols)t.uint32(18),t.string(r);if(null!=e.metadata)for(const r of e.metadata)t.uint32(26),qp.codec().encode(r,t);null!=e.pubKey&&(t.uint32(34),t.bytes(e.pubKey)),null!=e.peerRecordEnvelope&&(t.uint32(42),t.bytes(e.peerRecordEnvelope)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={addresses:[],protocols:[],metadata:[]},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.addresses.push(Fp.codec().decode(e,e.uint32()));break;case 2:r.protocols.push(e.string());break;case 3:r.metadata.push(qp.codec().decode(e,e.uint32()));break;case 4:r.pubKey=e.bytes();break;case 5:r.peerRecordEnvelope=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>Mp(t,e.codec()),e.decode=t=>Up(t,e.codec())}(Kp||(Kp={})),function(e){let t;e.codec=()=>(null==t&&(t=jp(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.multiaddr&&e.multiaddr.byteLength>0&&(t.uint32(10),t.bytes(e.multiaddr)),null!=e.isCertified&&(t.uint32(16),t.bool(e.isCertified)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={multiaddr:new Uint8Array(0)},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.multiaddr=e.bytes();break;case 2:r.isCertified=e.bool();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>Mp(t,e.codec()),e.decode=t=>Up(t,e.codec())}(Fp||(Fp={})),function(e){let t;e.codec=()=>(null==t&&(t=jp(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.key&&""!==e.key&&(t.uint32(10),t.string(e.key)),null!=e.value&&e.value.byteLength>0&&(t.uint32(18),t.bytes(e.value)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={key:"",value:new Uint8Array(0)},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.key=e.string();break;case 2:r.value=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>Mp(t,e.codec()),e.decode=t=>Up(t,e.codec())}(qp||(qp={}));var Hp,zp=__webpack_require__(6729),$p=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class Gp{constructor(){Hp.set(this,[])}enqueue(e,t){const r={priority:(t={priority:0,...t}).priority,run:e};if(this.size&&$p(this,Hp,"f")[this.size-1].priority>=t.priority)return void $p(this,Hp,"f").push(r);const n=function(e,t,r){let n=0,i=e.length;for(;i>0;){const r=Math.trunc(i/2);let o=n+r;s=e[o],t.priority-s.priority<=0?(n=++o,i-=r+1):i=r}var s;return n}($p(this,Hp,"f"),r);$p(this,Hp,"f").splice(n,0,r)}dequeue(){const e=$p(this,Hp,"f").shift();return null==e?void 0:e.run}filter(e){return $p(this,Hp,"f").filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return $p(this,Hp,"f").length}}Hp=new WeakMap;var Wp,Yp,Qp,Xp,Zp,Jp,ef,tf,rf,nf,sf,of,af,cf,lf,uf,hf,df,pf,ff,yf,gf,mf,wf,Ef,bf,vf=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r},_f=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class Sf extends Error{}class Cf extends zp{constructor(e){var t,r,n,i;if(super(),Wp.add(this),Yp.set(this,void 0),Qp.set(this,void 0),Xp.set(this,0),Zp.set(this,void 0),Jp.set(this,void 0),ef.set(this,0),tf.set(this,void 0),rf.set(this,void 0),nf.set(this,void 0),sf.set(this,void 0),of.set(this,0),af.set(this,void 0),cf.set(this,void 0),lf.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!("number"==typeof(e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:Gp,...e}).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(i=null===(n=e.interval)||void 0===n?void 0:n.toString())&&void 0!==i?i:""}\` (${typeof e.interval})`);vf(this,Yp,e.carryoverConcurrencyCount,"f"),vf(this,Qp,e.intervalCap===Number.POSITIVE_INFINITY||0===e.interval,"f"),vf(this,Zp,e.intervalCap,"f"),vf(this,Jp,e.interval,"f"),vf(this,nf,new e.queueClass,"f"),vf(this,sf,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,vf(this,lf,!0===e.throwOnTimeout,"f"),vf(this,cf,!1===e.autoStart,"f")}get concurrency(){return _f(this,af,"f")}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);vf(this,af,e,"f"),_f(this,Wp,"m",wf).call(this)}async add(e,t={}){return t={timeout:this.timeout,throwOnTimeout:_f(this,lf,"f"),...t},new Promise(((r,n)=>{_f(this,nf,"f").enqueue((async()=>{var i,s,o;vf(this,of,(s=_f(this,of,"f"),++s),"f"),vf(this,Xp,(o=_f(this,Xp,"f"),++o),"f");try{if(null===(i=t.signal)||void 0===i?void 0:i.aborted)throw new Sf("The task was aborted.");let n=e({signal:t.signal});t.timeout&&(n=pn(Promise.resolve(n),t.timeout)),t.signal&&(n=Promise.race([n,_f(this,Wp,"m",Ef).call(this,t.signal)]));const s=await n;r(s),this.emit("completed",s)}catch(e){if(e instanceof ln&&!t.throwOnTimeout)return void r();n(e),this.emit("error",e)}finally{_f(this,Wp,"m",df).call(this)}}),t),this.emit("add"),_f(this,Wp,"m",yf).call(this)}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return _f(this,cf,"f")?(vf(this,cf,!1,"f"),_f(this,Wp,"m",wf).call(this),this):this}pause(){vf(this,cf,!0,"f")}clear(){vf(this,nf,new(_f(this,sf,"f")),"f")}async onEmpty(){0!==_f(this,nf,"f").size&&await _f(this,Wp,"m",bf).call(this,"empty")}async onSizeLessThan(e){_f(this,nf,"f").size<e||await _f(this,Wp,"m",bf).call(this,"next",(()=>_f(this,nf,"f").size<e))}async onIdle(){0===_f(this,of,"f")&&0===_f(this,nf,"f").size||await _f(this,Wp,"m",bf).call(this,"idle")}get size(){return _f(this,nf,"f").size}sizeBy(e){return _f(this,nf,"f").filter(e).length}get pending(){return _f(this,of,"f")}get isPaused(){return _f(this,cf,"f")}}Yp=new WeakMap,Qp=new WeakMap,Xp=new WeakMap,Zp=new WeakMap,Jp=new WeakMap,ef=new WeakMap,tf=new WeakMap,rf=new WeakMap,nf=new WeakMap,sf=new WeakMap,of=new WeakMap,af=new WeakMap,cf=new WeakMap,lf=new WeakMap,Wp=new WeakSet,uf=function(){return _f(this,Qp,"f")||_f(this,Xp,"f")<_f(this,Zp,"f")},hf=function(){return _f(this,of,"f")<_f(this,af,"f")},df=function(){var e;vf(this,of,(e=_f(this,of,"f"),--e),"f"),_f(this,Wp,"m",yf).call(this),this.emit("next")},pf=function(){_f(this,Wp,"m",mf).call(this),_f(this,Wp,"m",gf).call(this),vf(this,rf,void 0,"f")},ff=function(){const e=Date.now();if(void 0===_f(this,tf,"f")){const t=_f(this,ef,"f")-e;if(!(t<0))return void 0===_f(this,rf,"f")&&vf(this,rf,setTimeout((()=>{_f(this,Wp,"m",pf).call(this)}),t),"f"),!0;vf(this,Xp,_f(this,Yp,"f")?_f(this,of,"f"):0,"f")}return!1},yf=function(){if(0===_f(this,nf,"f").size)return _f(this,tf,"f")&&clearInterval(_f(this,tf,"f")),vf(this,tf,void 0,"f"),this.emit("empty"),0===_f(this,of,"f")&&this.emit("idle"),!1;if(!_f(this,cf,"f")){const e=!_f(this,Wp,"a",ff);if(_f(this,Wp,"a",uf)&&_f(this,Wp,"a",hf)){const t=_f(this,nf,"f").dequeue();return!!t&&(this.emit("active"),t(),e&&_f(this,Wp,"m",gf).call(this),!0)}}return!1},gf=function(){_f(this,Qp,"f")||void 0!==_f(this,tf,"f")||(vf(this,tf,setInterval((()=>{_f(this,Wp,"m",mf).call(this)}),_f(this,Jp,"f")),"f"),vf(this,ef,Date.now()+_f(this,Jp,"f"),"f"))},mf=function(){0===_f(this,Xp,"f")&&0===_f(this,of,"f")&&_f(this,tf,"f")&&(clearInterval(_f(this,tf,"f")),vf(this,tf,void 0,"f")),vf(this,Xp,_f(this,Yp,"f")?_f(this,of,"f"):0,"f"),_f(this,Wp,"m",wf).call(this)},wf=function(){for(;_f(this,Wp,"m",yf).call(this););},Ef=async function(e){return new Promise(((t,r)=>{e.addEventListener("abort",(()=>{r(new Sf("The task was aborted."))}),{once:!0})}))},bf=async function(e,t){return new Promise((r=>{const n=()=>{t&&!t()||(this.off(e,n),r())};this.on(e,n)}))};class Af extends Error{constructor(e){super(e),this.name="TimeoutError"}}class If extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const Tf=e=>void 0===globalThis.DOMException?new If(e):new DOMException(e),Rf=e=>{const t=void 0===e.reason?Tf("This operation was aborted."):e.reason;return t instanceof Error?t:Tf(t)},kf="lock:worker:request-read",Nf="lock:worker:release-read",Lf="lock:master:grant-read",Df="lock:worker:request-write",Pf="lock:worker:release-write",Bf="lock:master:grant-write",Of={},xf=e=>{e.addEventListener("message",(t=>{xf.dispatchEvent("message",e,t)})),null!=e.port&&e.port.addEventListener("message",(t=>{xf.dispatchEvent("message",e,t)}))};xf.addEventListener=(e,t)=>{null==Of[e]&&(Of[e]=[]),Of[e].push(t)},xf.removeEventListener=(e,t)=>{null!=Of[e]&&(Of[e]=Of[e].filter((e=>e===t)))},xf.dispatchEvent=function(e,t,r){null!=Of[e]&&Of[e].forEach((e=>e(t,r)))};const Uf=xf,Mf=(e,t,r,n,i)=>(s,o)=>{if(o.data.type!==r)return;const a={type:o.data.type,name:o.data.name,identifier:o.data.identifier};e.dispatchEvent(new MessageEvent(t,{data:{name:a.name,handler:async()=>(s.postMessage({type:i,name:a.name,identifier:a.identifier}),await new Promise((e=>{const t=r=>{if(null==r||null==r.data)return;const i=r.data.type,o=(r.data.name,r.data.identifier);i===n&&o===a.identifier&&(s.removeEventListener("message",t),e())};s.addEventListener("message",t)})))}}))},Vf=(e,t,r,n)=>async()=>{const i=_u();return globalThis.postMessage({type:t,identifier:i,name:e}),await new Promise((t=>{const s=o=>{if(null==o||null==o.data)return;const a=o.data.type,c=o.data.identifier;a===r&&c===i&&(globalThis.removeEventListener("message",s),t((()=>{globalThis.postMessage({type:n,identifier:i,name:e})})))};globalThis.addEventListener("message",s)}))},Kf={singleProcess:!1},Ff={};let qf;async function jf(e,t){let r;const n=new Promise((e=>{r=e}));return e.add((async()=>await function(e,t){const{milliseconds:r,fallback:n,message:i,customTimers:s={setTimeout,clearTimeout}}=t;let o;const a=new Promise(((a,c)=>{if("number"!=typeof r||1!==Math.sign(r))throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${r}\``);if(r===Number.POSITIVE_INFINITY)return void a(e);if(t.signal){const{signal:e}=t;e.aborted&&c(Rf(e)),e.addEventListener("abort",(()=>{c(Rf(e))}))}const l=new Af;o=s.setTimeout.call(void 0,(()=>{if(n)try{a(n())}catch(e){c(e)}else"function"==typeof e.cancel&&e.cancel(),!1===i?a():i instanceof Error?c(i):(l.message=i??`Promise timed out after ${r} milliseconds`,c(l))}),r),(async()=>{try{a(await e)}catch(e){c(e)}finally{s.clearTimeout.call(void 0,o)}})()}));return a.clear=()=>{s.clearTimeout.call(void 0,o),o=void 0},a}((async()=>await new Promise((e=>{r((()=>{e()}))})))(),{milliseconds:t.timeout}))),await n}const Hf={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1},zf=ne("libp2p:peer-store:store"),$f="/peers/";class Gf{constructor(e){this.components=e,this.lock=function(e){const t=Object.assign({},Hf,{name:"peer-store",singleProcess:!0});return null==qf&&(qf=(e=>{if(e=Object.assign({},Kf,e),Boolean(globalThis.document)||e.singleProcess){const e=new EventTarget;return Uf.addEventListener("message",Mf(e,"requestReadLock",kf,Nf,Lf)),Uf.addEventListener("message",Mf(e,"requestWriteLock",Df,Pf,Bf)),e}return{isWorker:!0,readLock:e=>Vf(e,kf,Lf,Nf),writeLock:e=>Vf(e,Df,Bf,Pf)}})(t),!0!==qf.isWorker&&(qf.addEventListener("requestReadLock",(e=>{null!=Ff[e.data.name]&&Ff[e.data.name].readLock().then((async t=>await e.data.handler().finally((()=>t()))))})),qf.addEventListener("requestWriteLock",(async e=>{null!=Ff[e.data.name]&&Ff[e.data.name].writeLock().then((async t=>await e.data.handler().finally((()=>t()))))})))),null==Ff[t.name]&&(Ff[t.name]=((e,t)=>{if(!0===qf.isWorker)return{readLock:qf.readLock(e,t),writeLock:qf.writeLock(e,t)};const r=new Cf({concurrency:1});let n;return{async readLock(){if(null!=n)return await jf(n,t);n=new Cf({concurrency:t.concurrency,autoStart:!1});const e=n,i=jf(n,t);return r.add((async()=>(e.start(),await e.onIdle().then((()=>{n===e&&(n=null)}))))),await i},writeLock:async()=>(n=null,await jf(r,t))}})(t.name,t)),Ff[t.name]}()}_peerIdToDatastoreKey(e){if(null==e.type)throw zf.error("peerId must be an instance of peer-id to store data"),new rs("peerId must be an instance of peer-id",vp.ERR_INVALID_PARAMETERS);const t=e.toCID().toString();return new Iu(`${$f}${t}`)}async has(e){return await this.components.datastore.has(this._peerIdToDatastoreKey(e))}async delete(e){await this.components.datastore.delete(this._peerIdToDatastoreKey(e))}async load(e){const t=await this.components.datastore.get(this._peerIdToDatastoreKey(e)),r=Kp.decode(t),n=new Map;for(const e of r.metadata)n.set(e.key,e.value);return{...r,id:e,addresses:r.addresses.map((({multiaddr:e,isCertified:t})=>({multiaddr:hr(e),isCertified:t??!1}))),metadata:n,pubKey:r.pubKey??void 0,peerRecordEnvelope:r.peerRecordEnvelope??void 0}}async save(e){if(null!=e.pubKey&&null!=e.id.publicKey&&!Xt(e.pubKey,e.id.publicKey))throw zf.error("peer publicKey bytes do not match peer id publicKey bytes"),new rs("publicKey bytes do not match peer id publicKey bytes",vp.ERR_INVALID_PARAMETERS);const t=new Set,r=e.addresses.filter((e=>!t.has(e.multiaddr.toString())&&(t.add(e.multiaddr.toString()),!0))).sort(((e,t)=>e.multiaddr.toString().localeCompare(t.multiaddr.toString()))).map((({multiaddr:e,isCertified:t})=>({multiaddr:e.bytes,isCertified:t}))),n=[];[...e.metadata.keys()].sort().forEach((t=>{const r=e.metadata.get(t);null!=r&&n.push({key:t,value:r})}));const i=Kp.encode({addresses:r,protocols:e.protocols.sort(),pubKey:e.pubKey,metadata:n,peerRecordEnvelope:e.peerRecordEnvelope});return await this.components.datastore.put(this._peerIdToDatastoreKey(e.id),i.subarray()),await this.load(e.id)}async patch(e,t){const r=await this.load(e);return await this._patch(e,t,r)}async patchOrCreate(e,t){let r;try{r=await this.load(e)}catch(t){if(t.code!==vp.ERR_NOT_FOUND)throw t;r={id:e,addresses:[],protocols:[],metadata:new Map}}return await this._patch(e,t,r)}async _patch(e,t,r){return await this.save({...r,...t,id:e})}async merge(e,t){const r=await this.load(e);return await this._merge(e,t,r)}async mergeOrCreate(e,t){let r;try{r=await this.load(e)}catch(t){if(t.code!==vp.ERR_NOT_FOUND)throw t;r={id:e,addresses:[],protocols:[],metadata:new Map}}return await this._merge(e,t,r)}async _merge(e,t,r){const n=new Map;return r.addresses.forEach((e=>{n.set(e.multiaddr.toString(),e.isCertified)})),(t.addresses??[]).forEach((e=>{const t=e.multiaddr.toString(),r=Boolean(n.get(t))||e.isCertified;n.set(t,r)})),await this.save({id:e,addresses:Array.from(n.entries()).map((([e,t])=>({multiaddr:hr(e),isCertified:t}))),protocols:Array.from(new Set([...r.protocols??[],...t.protocols??[]])),metadata:new Map([...r.metadata?.entries()??[],...t.metadata?.entries()??[]]),pubKey:t.pubKey??(null!=r?r.pubKey:void 0),peerRecordEnvelope:t.peerRecordEnvelope??(null!=r?r.peerRecordEnvelope:void 0)})}async*all(){for await(const e of this.components.datastore.queryKeys({prefix:$f})){const t=e.toString().split("/")[2],r=H.decode(t);yield this.load(ic(r))}}}var Wf,Yf;!function(e){let t;e.codec=()=>(null==t&&(t=jp(((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.tags)for(const r of e.tags)t.uint32(10),Yf.codec().encode(r,t);!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={tags:[]},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();t>>>3==1?r.tags.push(Yf.codec().decode(e,e.uint32())):e.skipType(7&t)}return r}))),t),e.encode=t=>Mp(t,e.codec()),e.decode=t=>Up(t,e.codec())}(Wf||(Wf={})),function(e){let t;e.codec=()=>(null==t&&(t=jp(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.name&&""!==e.name&&(t.uint32(10),t.string(e.name)),null!=e.value&&(t.uint32(16),t.uint32(e.value)),null!=e.expiry&&(t.uint32(24),t.uint64(e.expiry)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={name:""},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.name=e.string();break;case 2:r.value=e.uint32();break;case 3:r.expiry=e.uint64();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>Mp(t,e.codec()),e.decode=t=>Up(t,e.codec())}(Yf||(Yf={}));const Qf=ne("libp2p:peer-store");class Xf extends Wr{constructor(e,t={}){super(),this.components=e,this.store=new Gf(e),this.addressBook=new Ap(this.dispatchEvent.bind(this),this.store,t.addressFilter),this.keyBook=new kp(this.dispatchEvent.bind(this),this.store),this.metadataBook=new Dp(this.dispatchEvent.bind(this),this.store),this.protoBook=new Op(this.dispatchEvent.bind(this),this.store)}async forEach(e){Qf.trace("getPeers await read lock");const t=await this.store.lock.readLock();Qf.trace("getPeers got read lock");try{for await(const t of this.store.all())t.id.equals(this.components.peerId)||e(t)}finally{Qf.trace("getPeers release read lock"),t()}}async all(){const e=[];return await this.forEach((t=>{e.push(t)})),e}async delete(e){Qf.trace("delete await write lock");const t=await this.store.lock.writeLock();Qf.trace("delete got write lock");try{await this.store.delete(e)}finally{Qf.trace("delete release write lock"),t()}}async get(e){Qf.trace("get await read lock");const t=await this.store.lock.readLock();Qf.trace("get got read lock");try{return await this.store.load(e)}finally{Qf.trace("get release read lock"),t()}}async has(e){Qf.trace("has await read lock");const t=await this.store.lock.readLock();Qf.trace("has got read lock");try{return await this.store.has(e)}finally{Qf.trace("has release read lock"),t()}}async tagPeer(e,t,r={}){const n=r.value??0,i=Math.round(n),s=r.ttl??void 0;if(i!==n||i<0||i>100)throw new rs("Tag value must be between 0-100","ERR_TAG_VALUE_OUT_OF_BOUNDS");const o=await this.metadataBook.getValue(e,"tags");let a=[];null!=o&&(a=Wf.decode(o).tags),a=a.filter((e=>e.name!==t)),a.push({name:t,value:i,expiry:null==s?void 0:BigInt(Date.now()+s)}),await this.metadataBook.setValue(e,"tags",Wf.encode({tags:a}).subarray())}async unTagPeer(e,t){const r=await this.metadataBook.getValue(e,"tags");let n=[];null!=r&&(n=Wf.decode(r).tags),n=n.filter((e=>e.name!==t)),await this.metadataBook.setValue(e,"tags",Wf.encode({tags:n}).subarray())}async getTags(e){const t=await this.metadataBook.getValue(e,"tags");let r=[];null!=t&&(r=Wf.decode(t).tags);const n=BigInt(Date.now()),i=r.filter((e=>null==e.expiry||e.expiry>n));return i.length!==r.length&&await this.metadataBook.setValue(e,"tags",Wf.encode({tags:i}).subarray()),i.map((e=>({name:e.name,value:e.value??0})))}}class Zf{constructor(e){this.dht=e}async provide(e){await wu(this.dht.provide(e))}async*findProviders(e,t={}){for await(const r of this.dht.findProviders(e,t))"PROVIDER"===r.name&&(yield*r.providers)}async put(e,t,r){await wu(this.dht.put(e,t,r))}async get(e,t){for await(const r of this.dht.get(e,t))if("VALUE"===r.name)return r.value;throw Qt(new Error("Not found"),"ERR_NOT_FOUND")}}class Jf{constructor(e={}){this._started=!1,this._peerId=e.peerId,this._addressManager=e.addressManager,this._peerStore=e.peerStore,this._upgrader=e.upgrader,this._metrics=e.metrics,this._registrar=e.registrar,this._connectionManager=e.connectionManager,this._transportManager=e.transportManager,this._connectionGater=e.connectionGater,this._contentRouting=e.contentRouting,this._peerRouting=e.peerRouting,this._datastore=e.datastore,this._connectionProtector=e.connectionProtector,this._dht=e.dht,this._pubsub=e.pubsub,this._dialer=e.dialer}isStarted(){return this._started}async beforeStart(){await Promise.all(Object.values(this).filter((e=>yu(e))).map((async e=>{null!=e.beforeStart&&await e.beforeStart()})))}async start(){await Promise.all(Object.values(this).filter((e=>yu(e))).map((async e=>{await e.start()}))),this._started=!0}async afterStart(){await Promise.all(Object.values(this).filter((e=>yu(e))).map((async e=>{null!=e.afterStart&&await e.afterStart()})))}async beforeStop(){await Promise.all(Object.values(this).filter((e=>yu(e))).map((async e=>{null!=e.beforeStop&&await e.beforeStop()})))}async stop(){await Promise.all(Object.values(this).filter((e=>yu(e))).map((async e=>{await e.stop()}))),this._started=!1}async afterStop(){await Promise.all(Object.values(this).filter((e=>yu(e))).map((async e=>{null!=e.afterStop&&await e.afterStop()})))}get peerId(){if(null==this._peerId)throw Qt(new Error("peerId not set"),"ERR_SERVICE_MISSING");return this._peerId}set peerId(e){this._peerId=e}get addressManager(){if(null==this._addressManager)throw Qt(new Error("addressManager not set"),"ERR_SERVICE_MISSING");return this._addressManager}set addressManager(e){this._addressManager=e}get peerStore(){if(null==this._peerStore)throw Qt(new Error("peerStore not set"),"ERR_SERVICE_MISSING");return this._peerStore}set peerStore(e){this._peerStore=e}get upgrader(){if(null==this._upgrader)throw Qt(new Error("upgrader not set"),"ERR_SERVICE_MISSING");return this._upgrader}set upgrader(e){this._upgrader=e}get registrar(){if(null==this._registrar)throw Qt(new Error("registrar not set"),"ERR_SERVICE_MISSING");return this._registrar}set registrar(e){this._registrar=e}get connectionManager(){if(null==this._connectionManager)throw Qt(new Error("connectionManager not set"),"ERR_SERVICE_MISSING");return this._connectionManager}set connectionManager(e){this._connectionManager=e}get transportManager(){if(null==this._transportManager)throw Qt(new Error("transportManager not set"),"ERR_SERVICE_MISSING");return this._transportManager}set transportManager(e){this._transportManager=e}get connectionGater(){if(null==this._connectionGater)throw Qt(new Error("connectionGater not set"),"ERR_SERVICE_MISSING");return this._connectionGater}set connectionGater(e){this._connectionGater=e}get contentRouting(){if(null==this._contentRouting)throw Qt(new Error("contentRouting not set"),"ERR_SERVICE_MISSING");return this._contentRouting}set contentRouting(e){this._contentRouting=e}get peerRouting(){if(null==this._peerRouting)throw Qt(new Error("peerRouting not set"),"ERR_SERVICE_MISSING");return this._peerRouting}set peerRouting(e){this._peerRouting=e}get datastore(){if(null==this._datastore)throw Qt(new Error("datastore not set"),"ERR_SERVICE_MISSING");return this._datastore}set datastore(e){this._datastore=e}get connectionProtector(){return this._connectionProtector}set connectionProtector(e){this._connectionProtector=e}get dialer(){if(null==this._dialer)throw Qt(new Error("dialer not set"),"ERR_SERVICE_MISSING");return this._dialer}set dialer(e){this._dialer=e}get metrics(){return this._metrics}set metrics(e){this._metrics=e}get dht(){return this._dht}set dht(e){this._dht=e}get pubsub(){return this._pubsub}set pubsub(e){this._pubsub=e}}var ey=__webpack_require__(3692);function ty(e,t,r){return`${e}?name=${t}&type=${r}`}async function ry(e,t){const r=await Vr(e,{headers:new Kr({accept:"application/dns-json"}),signal:t});return await r.json()}function ny(e,t){return`${t}_${e}`}const iy=Object.assign(L("dns-over-http-resolver"),{error:L("dns-over-http-resolver:error")}),{code:sy}=Lt("dnsaddr"),oy={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:e=>e},connectionManager:{maxConnections:300,minConnections:50,autoDial:!0,autoDialInterval:1e4,maxParallelDials:100,maxDialsPerPeer:4,dialTimeout:3e4,inboundUpgradeTimeout:3e4,resolvers:{dnsaddr:async function(e,t={}){const r=new class{constructor(e={}){this._cache=new ey({max:e?.maxCache??100}),this._TXTcache=new ey({max:e?.maxCache??100}),this._servers=["https://cloudflare-dns.com/dns-query","https://dns.google/resolve"],this._request=e.request??ry,this._abortControllers=[]}cancel(){this._abortControllers.forEach((e=>e.abort()))}getServers(){return this._servers}_getShuffledServers(){const e=[...this._servers];for(let t=e.length-1;t>0;t--){const r=Math.floor(Math.random()*t),n=e[t];e[t]=e[r],e[r]=n}return e}setServers(e){this._servers=e}async resolve(e,t="A"){switch(t){case"A":return await this.resolve4(e);case"AAAA":return await this.resolve6(e);case"TXT":return await this.resolveTxt(e);default:throw new Error(`${t} is not supported`)}}async resolve4(e){const t="A",r=this._cache.get(ny(e,t));if(null!=r)return r;let n=!1;for(const r of this._getShuffledServers()){const i=new AbortController;this._abortControllers.push(i);try{const n=await this._request(ty(r,e,t),i.signal),s=n.Answer.map((e=>e.data)),o=Math.min(...n.Answer.map((e=>e.TTL)));return this._cache.set(ny(e,t),s,{ttl:o}),s}catch(s){i.signal.aborted&&(n=!0),iy.error(`${r} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter((e=>e!==i))}}if(n)throw Object.assign(new Error("queryA ECANCELLED"),{code:"ECANCELLED"});throw new Error(`Could not resolve ${e} record ${t}`)}async resolve6(e){const t="AAAA",r=this._cache.get(ny(e,t));if(null!=r)return r;let n=!1;for(const r of this._getShuffledServers()){const i=new AbortController;this._abortControllers.push(i);try{const n=await this._request(ty(r,e,t),i.signal),s=n.Answer.map((e=>e.data)),o=Math.min(...n.Answer.map((e=>e.TTL)));return this._cache.set(ny(e,t),s,{ttl:o}),s}catch(s){i.signal.aborted&&(n=!0),iy.error(`${r} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter((e=>e!==i))}}if(n)throw Object.assign(new Error("queryAaaa ECANCELLED"),{code:"ECANCELLED"});throw new Error(`Could not resolve ${e} record ${t}`)}async resolveTxt(e){const t="TXT",r=this._TXTcache.get(ny(e,t));if(null!=r)return r;let n=!1;for(const r of this._getShuffledServers()){const i=new AbortController;this._abortControllers.push(i);try{const n=await this._request(ty(r,e,t),i.signal),s=n.Answer.map((e=>[e.data.replace(/['"]+/g,"")])),o=Math.min(...n.Answer.map((e=>e.TTL)));return this._TXTcache.set(ny(e,t),s,{ttl:o}),s}catch(s){i.signal.aborted&&(n=!0),iy.error(`${r} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter((e=>e!==i))}}if(n)throw Object.assign(new Error("queryTxt ECANCELLED"),{code:"ECANCELLED"});throw new Error(`Could not resolve ${e} record ${t}`)}clearCache(){this._cache.clear(),this._TXTcache.clear()}};null!=t.signal&&t.signal.addEventListener("abort",(()=>{r.cancel()}));const n=e.getPeerId(),[,i]=e.stringTuples().find((([e])=>e===sy))??[];if(null==i)throw new Error("No hostname found in multiaddr");let s=(await r.resolveTxt(`_dnsaddr.${i}`)).flat().map((e=>e.split("=")[1]));return null!=n&&(s=s.filter((e=>e.includes(n)))),s}},addressSorter:jh},connectionGater:{},transportManager:{faultTolerance:En.FATAL_ALL},peerRouting:{refreshManager:{enabled:!0,interval:6e5,bootDelay:1e4}},nat:{enabled:!0,ttl:7200,keepAlive:!0},relay:{enabled:!0,advertise:{bootDelay:9e5,enabled:!1,ttl:18e5},hop:{enabled:!1,active:!1,timeout:3e4},autoRelay:{enabled:!1,maxListeners:2}},identify:{protocolPrefix:"ipfs",host:{agentVersion:Qd},timeout:6e4,maxInboundStreams:1,maxOutboundStreams:1,maxPushIncomingStreams:1,maxPushOutgoingStreams:1},ping:{protocolPrefix:"ipfs",maxInboundStreams:1,maxOutboundStreams:1,timeout:1e4},fetch:{protocolPrefix:"libp2p",maxInboundStreams:1,maxOutboundStreams:1,timeout:1e4}};var ay;!function(e){let t;e.codec=()=>(null==t&&(t=Ji(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),(!0===r.writeDefaults||null!=e.id&&e.id.byteLength>0)&&(t.uint32(10),t.bytes(e.id)),null!=e.pubKey&&(t.uint32(18),t.bytes(e.pubKey)),null!=e.privKey&&(t.uint32(26),t.bytes(e.privKey)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={id:new Uint8Array(0)},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.id=e.bytes();break;case 2:r.pubKey=e.bytes();break;case 3:r.privKey=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>Hi(t,e.codec()),e.decode=t=>ji(t,e.codec())}(ay||(ay={}));const cy=async()=>{const e=await Fa("Ed25519"),t=await async function(e){return await sc((t=e.public,Ka(r=(r??"rsa").toLowerCase()),t.bytes),function(e,t){return Ka(t=(t??"rsa").toLowerCase()),e.bytes}(e));var t,r}(e);if("Ed25519"===t.type)return t;throw new Error(`Generated unexpected PeerId type "${t.type}"`)};class ly extends Wr{get[du](){return!0}get[Symbol.toStringTag](){return"@libp2p/dummy-dht"}get wan(){throw Qt(new Error(Ru.DHT_DISABLED),ku.DHT_DISABLED)}get lan(){throw Qt(new Error(Ru.DHT_DISABLED),ku.DHT_DISABLED)}get(){throw Qt(new Error(Ru.DHT_DISABLED),ku.DHT_DISABLED)}findProviders(){throw Qt(new Error(Ru.DHT_DISABLED),ku.DHT_DISABLED)}findPeer(){throw Qt(new Error(Ru.DHT_DISABLED),ku.DHT_DISABLED)}getClosestPeers(){throw Qt(new Error(Ru.DHT_DISABLED),ku.DHT_DISABLED)}provide(){throw Qt(new Error(Ru.DHT_DISABLED),ku.DHT_DISABLED)}put(){throw Qt(new Error(Ru.DHT_DISABLED),ku.DHT_DISABLED)}async getMode(){throw Qt(new Error(Ru.DHT_DISABLED),ku.DHT_DISABLED)}async setMode(){throw Qt(new Error(Ru.DHT_DISABLED),ku.DHT_DISABLED)}async refreshRoutingTable(){throw Qt(new Error(Ru.DHT_DISABLED),ku.DHT_DISABLED)}}class uy extends Wr{constructor(){super(...arguments),this.topicValidators=new Map}isStarted(){return!1}start(){}stop(){}get globalSignaturePolicy(){throw Qt(new Error(Ru.PUBSUB_DISABLED),ku.ERR_PUBSUB_DISABLED)}get multicodecs(){throw Qt(new Error(Ru.PUBSUB_DISABLED),ku.ERR_PUBSUB_DISABLED)}getPeers(){throw Qt(new Error(Ru.PUBSUB_DISABLED),ku.ERR_PUBSUB_DISABLED)}getTopics(){throw Qt(new Error(Ru.PUBSUB_DISABLED),ku.ERR_PUBSUB_DISABLED)}subscribe(){throw Qt(new Error(Ru.PUBSUB_DISABLED),ku.ERR_PUBSUB_DISABLED)}unsubscribe(){throw Qt(new Error(Ru.PUBSUB_DISABLED),ku.ERR_PUBSUB_DISABLED)}getSubscribers(){throw Qt(new Error(Ru.PUBSUB_DISABLED),ku.ERR_PUBSUB_DISABLED)}async publish(){throw Qt(new Error(Ru.PUBSUB_DISABLED),ku.ERR_PUBSUB_DISABLED)}}var hy=__webpack_require__(5103);const dy=ne("libp2p:dialer:dial-request");class py{constructor(e){const{addrs:t,dialAction:r,dialer:n}=e;this.addrs=t,this.dialer=n,this.dialAction=r}async run(e={}){const t=this.dialer.getTokens(this.addrs.length);if(t.length<1)throw Qt(new Error("No dial tokens available"),ku.ERR_NO_DIAL_TOKENS);const r=new hy;for(const e of t)r.push(e).catch((e=>{dy.error(e)}));const n=this.addrs.map((()=>{const e=new AbortController;try{(0,xu.setMaxListeners)?.(1/0,e.signal)}catch{}return e}));if(null!=e.signal)try{(0,xu.setMaxListeners)?.(1/0,e.signal)}catch{}let i=0,s=!1;try{return await Promise.any(this.addrs.map((async(o,a)=>{const c=await r.shift();if(s)throw this.dialer.releaseToken(t.splice(t.indexOf(c),1)[0]),Qt(new Error("dialAction already succeeded"),ku.ERR_ALREADY_SUCCEEDED);const l=n[a];if(null==l)throw Qt(new Error("dialAction did not come with an AbortController"),ku.ERR_INVALID_PARAMETERS);let u;try{const t=l.signal;u=await this.dialAction(o,{...e,signal:null!=e.signal?(0,Fn.anySignal)([t,e.signal]):t}),n[a]=void 0}finally{i++,this.addrs.length-i>=t.length?r.push(c).catch((e=>{dy.error(e)})):this.dialer.releaseToken(t.splice(t.indexOf(c),1)[0])}if(null==u)throw Qt(new Error("dialAction led to empty object"),ku.ERR_TRANSPORT_DIAL_FAILED);return s=!0,u})))}finally{n.forEach((e=>{void 0!==e&&e.abort()})),t.forEach((e=>this.dialer.releaseToken(e)))}}}const fy=ne("libp2p:dialer");class yy{constructor(e,t={}){this.started=!1,this.addressSorter=t.addressSorter??jh,this.maxAddrsToDial=t.maxAddrsToDial??25,this.timeout=t.dialTimeout??3e4,this.maxDialsPerPeer=t.maxDialsPerPeer??4,this.tokens=[...new Array(t.maxParallelDials??100)].map(((e,t)=>t)),this.components=e,this.pendingDials=Ed({name:"libp2p_dialler_pending_dials",metrics:e.metrics}),this.pendingDialTargets=Ed({name:"libp2p_dialler_pending_dial_targets",metrics:e.metrics});for(const[e,r]of Object.entries(t.resolvers??{}))or.set(e,r)}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1;for(const e of this.pendingDials.values())try{e.controller.abort()}catch(e){fy.error(e)}this.pendingDials.clear();for(const e of this.pendingDialTargets.values())e.abort();this.pendingDialTargets.clear()}async dial(e,t={}){const{peerId:r,multiaddr:n}=eh(e);if(null!=r){if(this.components.peerId.equals(r))throw Qt(new Error("Tried to dial self"),ku.ERR_DIALED_SELF);if(null!=n&&(fy("storing multiaddrs %p",r,n),await this.components.peerStore.addressBook.add(r,[n])),await this.components.connectionGater.denyDialPeer(r))throw Qt(new Error("The dial request is blocked by gater.allowDialPeer"),ku.ERR_PEER_DIAL_INTERCEPTED)}fy("creating dial target for %p",r);const i=new AbortController,s=my();this.pendingDialTargets.set(s,i);let o,a=i.signal;null!=t.signal&&(a=(0,Fn.anySignal)([a,t.signal]));try{o=await this._createDialTarget({peerId:r,multiaddr:n},{...t,signal:a})}finally{this.pendingDialTargets.delete(s)}if(0===o.addrs.length)throw Qt(new Error("The dial request has no valid addresses"),ku.ERR_NO_VALID_ADDRESSES);const c=this.pendingDials.get(o.id)??this._createPendingDial(o,t);try{const e=await c.promise;return fy("dial succeeded to %s",o.id),e}catch(e){throw fy("dial failed to %s",o.id,e),c.controller.signal.aborted&&(e.code=ku.ERR_TIMEOUT),fy.error(e),e}finally{c.destroy()}}async _createDialTarget(e,t){let r=[];if(lr(e.multiaddr)&&r.push(e.multiaddr),!lr(e.multiaddr)&&$a(e.peerId)&&r.push(...await this._loadAddresses(e.peerId)),r=(await Promise.all(r.map((async e=>await this._resolve(e,t))))).flat().filter((e=>Boolean(this.components.transportManager.transportForMultiaddr(e)))),r=[...new Set(r.map((e=>e.toString())))].map((e=>hr(e))),r.length>this.maxAddrsToDial)throw Qt(new Error("dial with more addresses than allowed"),ku.ERR_TOO_MANY_ADDRESSES);const n=$a(e.peerId)?e.peerId:void 0;if(null!=n){const e=`/p2p/${n.toString()}`;r=r.map((t=>{const r=t.getPeerId();return null!=r&&n.equals(r)?t:t.encapsulate(e)}))}return{id:null==n?my():n.toString(),addrs:r}}async _loadAddresses(e){const t=await this.components.peerStore.addressBook.get(e);return(await Promise.all(t.map((async t=>!await this.components.connectionGater.denyDialMultiaddr(e,t.multiaddr)&&t)))).filter(gy).sort(this.addressSorter).map((e=>e.multiaddr))}_createPendingDial(e,t={}){const r=new py({addrs:e.addrs,dialAction:async(e,t={})=>{if(!0===t.signal?.aborted)throw Qt(new Error("already aborted"),ku.ERR_ALREADY_ABORTED);return await this.components.transportManager.dial(e,t).catch((t=>{throw fy.error("dial to %s failed",e,t),t}))},dialer:this}),n=new Pu.TimeoutController(this.timeout),i=[n.signal];null!=t.signal&&i.push(t.signal);const s=(0,Fn.anySignal)(i);try{(0,xu.setMaxListeners)?.(1/0,s)}catch{}const o={dialRequest:r,controller:n,promise:r.run({...t,signal:s}),destroy:()=>{n.clear(),this.pendingDials.delete(e.id)}};return this.pendingDials.set(e.id,o),o}getTokens(e){const t=Math.min(e,this.maxDialsPerPeer,this.tokens.length),r=this.tokens.splice(0,t);return fy("%d tokens request, returning %d, %d remaining",e,t,this.tokens.length),r}releaseToken(e){this.tokens.includes(e)||(fy("token %d released",e),this.tokens.push(e))}async _resolve(e,t){if(!e.protoNames().includes("dnsaddr"))return[e];const r=await this._resolveRecord(e,t);return(await Promise.all(r.map((async e=>await this._resolve(e,t))))).flat().reduce(((e,t)=>(null==e.find((e=>e.equals(t)))&&e.push(t),e)),[])}async _resolveRecord(e,t){try{return e=hr(e.toString()),await e.resolve(t)}catch(t){return fy.error(`multiaddr ${e.toString()} could not be resolved`,t),[]}}}function gy(e){return Boolean(e)}function my(){return`${parseInt(String(1e9*Math.random()),10).toString()}${Date.now()}`}const wy=ne("libp2p");class Ey extends Wr{constructor(e){super(),this.started=!1,this.peerId=e.peerId;const t=this.components=new Jf({peerId:e.peerId,datastore:e.datastore??new Tu,connectionGater:{denyDialPeer:async()=>await Promise.resolve(!1),denyDialMultiaddr:async()=>await Promise.resolve(!1),denyInboundConnection:async()=>await Promise.resolve(!1),denyOutboundConnection:async()=>await Promise.resolve(!1),denyInboundEncryptedConnection:async()=>await Promise.resolve(!1),denyOutboundEncryptedConnection:async()=>await Promise.resolve(!1),denyInboundUpgradedConnection:async()=>await Promise.resolve(!1),denyOutboundUpgradedConnection:async()=>await Promise.resolve(!1),filterMultiaddrForPeer:async()=>await Promise.resolve(!0),...e.connectionGater}});t.peerStore=new Xf(t,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...e.peerStore}),this.services=[t],null!=e.metrics&&(this.metrics=this.components.metrics=this.configureComponent(e.metrics(this.components))),this.peerStore=this.components.peerStore,this.peerStore.addEventListener("peer",(e=>{const{detail:t}=e;this.dispatchEvent(new Qr("peer:discovery",{detail:t}))})),null!=e.connectionProtector&&(this.components.connectionProtector=e.connectionProtector(t)),this.components.upgrader=new Fd(this.components,{connectionEncryption:(e.connectionEncryption??[]).map((e=>this.configureComponent(e(this.components)))),muxers:(e.streamMuxers??[]).map((e=>this.configureComponent(e(this.components)))),inboundUpgradeTimeout:e.connectionManager.inboundUpgradeTimeout}),this.components.dialer=new yy(this.components,e.connectionManager),this.connectionManager=this.components.connectionManager=new nh(this.components,e.connectionManager),this.components.connectionManager.addEventListener("peer:disconnect",(e=>{this.dispatchEvent(new Qr("peer:disconnect",{detail:e.detail}))})),this.components.connectionManager.addEventListener("peer:connect",(e=>{this.dispatchEvent(new Qr("peer:connect",{detail:e.detail}))})),this.registrar=this.components.registrar=new Md(this.components),this.components.transportManager=new vd(this.components,e.transportManager),this.components.addressManager=new Fu(this.components,e.addresses),this.configureComponent(new Ep(this.components)),this.configureComponent(new ch(this.components,{enabled:e.connectionManager.autoDial,minConnections:e.connectionManager.minConnections,autoDialInterval:e.connectionManager.autoDialInterval}));const r=dd.generateOptions();this.keychain=this.configureComponent(new dd(this.components,{...r,...e.keychain})),this.services.push(new mp(this.components,e.nat)),e.transports.forEach((e=>{this.components.transportManager.add(this.configureComponent(e(this.components)))})),this.identifyService=new Zd(this.components,{...e.identify}),this.configureComponent(this.identifyService),null!=e.dht?this.dht=this.components.dht=e.dht(this.components):this.dht=new ly,null!=e.pubsub?this.pubsub=this.components.pubsub=e.pubsub(this.components):this.pubsub=new uy;const n=(e.peerRouters??[]).map((e=>this.configureComponent(e(this.components))));null!=e.dht&&(n.push(this.configureComponent(new bp(this.dht))),this.dht.addEventListener("peer",(e=>{this.onDiscoveryPeer(e)}))),this.peerRouting=this.components.peerRouting=this.configureComponent(new Mu(this.components,{...e.peerRouting,routers:n}));const i=(e.contentRouters??[]).map((e=>this.configureComponent(e(this.components))));null!=e.dht&&i.push(this.configureComponent(new Zf(this.dht))),this.contentRouting=this.components.contentRouting=this.configureComponent(new Vu(this.components,{routers:i})),e.relay.enabled&&(this.components.transportManager.add(this.configureComponent(new bh(this.components,e.relay))),this.configureComponent(new Wh(this.components,{addressSorter:e.connectionManager.addressSorter,...e.relay}))),this.fetchService=this.configureComponent(new rp(this.components,{...e.fetch})),this.pingService=this.configureComponent(new ip(this.components,{...e.ping}));for(const t of e.peerDiscovery??[])this.configureComponent(t(this.components)).addEventListener("peer",(e=>{this.onDiscoveryPeer(e)}))}configureComponent(e){return yu(e)&&this.services.push(e),e}async start(){if(!this.started){this.started=!0,wy("libp2p is starting");try{await Promise.all(this.services.map((async e=>{null!=e.beforeStart&&await e.beforeStart()}))),await Promise.all(this.services.map((e=>e.start()))),await Promise.all(this.services.map((async e=>{null!=e.afterStart&&await e.afterStart()}))),wy("libp2p has started")}catch(e){throw wy.error("An error occurred starting libp2p",e),await this.stop(),e}}}async stop(){this.started&&(wy("libp2p is stopping"),this.started=!1,await Promise.all(this.services.map((async e=>{null!=e.beforeStop&&await e.beforeStop()}))),await Promise.all(this.services.map((e=>e.stop()))),await Promise.all(this.services.map((async e=>{null!=e.afterStop&&await e.afterStop()}))),wy("libp2p has stopped"))}isStarted(){return this.started}getConnections(e){return this.components.connectionManager.getConnections(e)}getPeers(){const e=new Zu;for(const t of this.components.connectionManager.getConnections())e.add(t.remotePeer);return Array.from(e)}async dial(e,t={}){return await this.components.connectionManager.openConnection(e,t)}async dialProtocol(e,t,r={}){if(null==t)throw Qt(new Error("no protocols were provided to open a stream"),ku.ERR_INVALID_PROTOCOLS_FOR_STREAM);if(0===(t=Array.isArray(t)?t:[t]).length)throw Qt(new Error("no protocols were provided to open a stream"),ku.ERR_INVALID_PROTOCOLS_FOR_STREAM);const n=await this.dial(e,r);return await n.newStream(t,r)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(e){lr(e)&&(e=nc(e.getPeerId()??"")),await this.components.connectionManager.closeConnections(e)}async getPublicKey(e,t={}){if(wy("getPublicKey %p",e),null!=e.publicKey)return e.publicKey;const r=await this.peerStore.get(e);if(null!=r.pubKey)return r.pubKey;if(null==this.dht)throw Qt(new Error("Public key was not in the peer store and the DHT is not enabled"),ku.ERR_NO_ROUTERS_AVAILABLE);const n=Bt([Pt("/pk/"),e.multihash.digest]);for await(const r of this.dht.get(n,t))if("VALUE"===r.name){const t=qa(r.value);return await this.peerStore.keyBook.set(e,r.value),t.bytes}throw Qt(new Error(`Node not responding with its public key: ${e.toString()}`),ku.ERR_INVALID_RECORD)}async fetch(e,t,r={}){if(lr(e)){const t=nc(e.getPeerId()??"");await this.components.peerStore.addressBook.add(t,[e]),e=t}return await this.fetchService.fetch(e,t,r)}async ping(e,t={}){if(lr(e)){const t=nc(e.getPeerId()??"");await this.components.peerStore.addressBook.add(t,[e]),e=t}return await this.pingService.ping(e,t)}async handle(e,t,r){Array.isArray(e)||(e=[e]),await Promise.all(e.map((async e=>{await this.components.registrar.handle(e,t,r)})))}async unhandle(e){Array.isArray(e)||(e=[e]),await Promise.all(e.map((async e=>{await this.components.registrar.unhandle(e)})))}async register(e,t){return await this.registrar.register(e,t)}unregister(e){this.registrar.unregister(e)}onDiscoveryPeer(e){const{detail:t}=e;t.id.toString()!==this.peerId.toString()?(t.multiaddrs.length>0&&this.components.peerStore.addressBook.add(t.id,t.multiaddrs).catch((e=>wy.error(e))),t.protocols.length>0&&this.components.peerStore.protoBook.set(t.id,t.protocols).catch((e=>wy.error(e))),this.dispatchEvent(new Qr("peer:discovery",{detail:t}))):wy.error(new Error(ku.ERR_DISCOVERED_SELF))}}document.addEventListener("DOMContentLoaded",(async()=>{const e=await async function(e){const t=await async function(e){if(null==e.peerId){const t=e.datastore;if(null!=t)try{const r=new dd({datastore:t},{...dd.generateOptions(),...e.keychain??{}});e.peerId=await r.exportPeerId("self")}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}}return null==e.peerId&&(e.peerId=await cy()),new Ey(function(e){const t=qu(oy,e);if(null==t.transports||t.transports.length<1)throw Qt(new Error(Ru.ERR_TRANSPORTS_REQUIRED),ku.ERR_TRANSPORTS_REQUIRED);if(null==t.connectionEncryption||0===t.connectionEncryption.length)throw Qt(new Error(Ru.CONN_ENCRYPTION_REQUIRED),ku.CONN_ENCRYPTION_REQUIRED);if(null===t.connectionProtector&&null!=globalThis.process?.env?.LIBP2P_FORCE_PNET)throw Qt(new Error(Ru.ERR_PROTECTOR_REQUIRED),ku.ERR_PROTECTOR_REQUIRED);return t.identify.host.agentVersion===Qd&&(hp||lp?t.identify.host.agentVersion+=` UserAgent=${globalThis.process.version}`:(cp||dp||up||pp)&&(t.identify.host.agentVersion+=` UserAgent=${globalThis.navigator.userAgent}`)),t}(e))}(e);return!1!==e.start&&await t.start(),t}({transports:[_n()],streamMuxers:[Yn()],connectionEncryption:[_c()],peerDiscovery:[(t={list:["/ip4/127.0.0.1/tcp/9090/http/p2p-webrtc-direct/p2p/12D3KooWCuo3MdXfMgaqpLC5Houi1TRoFqgK9aoxok4NK5udMu8m"]},e=>new fu(e,t))]});var t;const r=document.getElementById("status"),n=document.getElementById("output");function i(e){console.info(e),n.textContent+=`${e.trim()}\n`}n.textContent="",e.addEventListener("peer:discovery",(t=>{i(`Found peer ${t.detail.id.toString()}`),e.dial(t.detail.id).catch((e=>{i(`Could not dial ${t.detail.id}`)}))})),e.connectionManager.addEventListener("peer:connect",(e=>{i(`Connected to ${e.detail.remotePeer.toString()}`)})),e.connectionManager.addEventListener("peer:disconnect",(e=>{i(`Disconnected from ${e.detail.remotePeer.toString()}`)})),r.innerText="libp2p started!",i(`libp2p id is ${e.peerId.toString()}`)}))})()})();